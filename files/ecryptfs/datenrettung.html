<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>ecryptfs/Datenrettung › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../ecryptfs/datenrettung.html">Datenrettung</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/ecryptfs/Datenrettung">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../ecryptfs/datenrettung/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../ecryptfs/datenrettung/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../ecryptfs/datenrettung/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../ecryptfs/datenrettung/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../ecryptfs/datenrettung/a/backlinks.html">Datenrettung</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../editor.html">Einen Editor nutzen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../rechte.html">Rechte für Dateien und Ordner ändern</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../dateimanager.html#Root-Rechte">Root-Rechte erlangen</a></p></li></ol></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Allgemeine-Hinweise">Allgemeine Hinweise
</a></li><li><a class="crosslink" href="#Daten-automatisiert-auslesen">Daten automatisiert auslesen
</a></li><li><a class="crosslink" href="#Vorbereitungen-fuer-die-manuelle-Datenrettung">Vorbereitungen für die manuelle Datenrettu...</a><ol class="arabic"><li><a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien
</a></li><li><a class="crosslink" href="#Daten-einbinden">Daten einbinden
</a><ol class="arabic"><li><a class="crosslink" href="#Integriertes-Homeverzeichnis">Integriertes Homeverzeichnis
</a></li><li><a class="crosslink" href="#Separates-Homeverzeichnis">Separates Homeverzeichnis
</a></li></ol></li><li><a class="crosslink" href="#wrapped-passphrase-auslesen">wrapped-passphrase auslesen
</a></li></ol></li><li><a class="crosslink" href="#Daten-manuell-auslesen">Daten manuell auslesen
</a><ol class="arabic"><li><a class="crosslink" href="#Lesender-Datenzugriff">Lesender Datenzugriff
</a></li><li><a class="crosslink" href="#Datenzugriff-mit-Bearbeitung">Datenzugriff mit Bearbeitung
</a><ol class="arabic"><li><a class="crosslink" href="#Benutzer-aktivieren">Benutzer aktivieren
</a></li><li><a class="crosslink" href="#Verzeichnis-aufschliessen">Verzeichnis aufschließen
</a></li><li><a class="crosslink" href="#Benutzer-deaktivieren">Benutzer deaktivieren
</a></li></ol></li></ol></li><li><a class="crosslink" href="#Schluesseldaten-reparieren">Schlüsseldaten reparieren
</a><ol class="arabic"><li><a class="crosslink" href="#berpruefung-der-Schluesseldateien">Überprüfung der Schlüsseldateien
</a></li><li><a class="crosslink" href="#Reparatur-vorbereiten">Reparatur vorbereiten
</a></li><li><a class="crosslink" href="#wrapped-passphrase-erstellen">wrapped-passphrase erstellen
</a></li><li><a class="crosslink" href="#auto-mount-erstellen">auto-mount erstellen
</a></li><li><a class="crosslink" href="#auto-umount-erstellen">auto-umount erstellen
</a></li><li><a class="crosslink" href="#Private-mnt-erstellen">Private.mnt erstellen
</a></li><li><a class="crosslink" href="#Private-sig-erstellen">Private.sig erstellen
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><a class="external" href="http://ecryptfs.sourceforge.net/" rel="nofollow">ecryptfs-utils</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> bietet eine sehr einfache Möglichkeit einen
</p><ul><li><p>einzelnen Ordner (<strong>~/Private</strong>) innerhalb eines nicht verschlüsselten <a class="internal" href="../homeverzeichnis.html">Homeverzeichnisses</a>, bzw. das </p></li><li><p>gesamte Homeverzeichnis</p></li></ul><p>eines Benutzers zu verschlüsseln. Die Ent- bzw. Verschlüsselung geschieht dabei automatisch beim Ein-/Ausloggen des Benutzers.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Daten im "verschlüsselten" Bereich sind, sobald der jeweilige Benutzer sich angemeldet hat, auch prinzipiell von anderen Nutzern oder Anwendungen lesbar. Falls dies nicht gewünscht ist, sind die Rechte <sup><a href="#source-3">[3]</a></sup> entsprechend zu setzen.
</p></div></div><p>Sollte es trotz aller Vorsichtsmaßnahmen hierbei zu Problem kommen, (etwa mit der Fehlermeldung "ERROR: Encrypted private directory is not setup properly"), soll die nachfolgende Beschreibung helfen, wieder Zugriff auf die verschlüsselten Daten zu erhalten. 
Manchmal möchte man auch einfach von einem anderen System, beispielsweise einem neu oder parallel installierten Ubuntu, Zugriff auf einen verschlüsselten Ordner bekommen.</p><div class="section_1"><h2 id="Allgemeine-Hinweise">Allgemeine Hinweise<a class="headerlink" href="#Allgemeine-Hinweise">¶</a></h2><p>
Sollte das System nicht mehr bis zum Desktop gelangen, so startet man mit einem Live-System (CD/DVD bzw. USB-Stick) <span class="underline">gleicher</span> Architektur (i386, amd64 bzw. mac). Will man den Zugriff über einen <a class="internal" href="../dateimanager.html">Dateimanager</a> ausführen, so muss dabei auch noch die Desktop-Variante (GNOME, KDE bzw. XFCE) berücksichtigt werden.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ist die Partition mit dem Verzeichnis <strong>~/.Private</strong> bzw. mit dem verschlüsselten <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> (integrierte oder auch separate Partition) so defekt, dass diese wie nachfolgend beschrieben nicht mehr einzubinden ist, so muss man davon ausgehen, das die Daten mit <span class="underline">einfachen</span> Mitteln nicht mehr zu retten sind.
</p></div></div></div><div class="section_1"><h2 id="Daten-automatisiert-auslesen">Daten automatisiert auslesen<a class="headerlink" href="#Daten-automatisiert-auslesen">¶</a></h2><p>
Mit dem Befehl <code class="notranslate">ecryptfs-recover-private</code>, kann man jeden verschlüsselten Ordner entschlüsseln und mit Lesezugriff einbinden lassen. Dabei muss das Login-Passwort des Benutzers, für den die Verschlüsselung angelegt wurde, bekannt sein.</p><p>Vorgehen:</p><p>Zunächst wird die Zielpartition, auf der sich die verschlüsselten Daten befinden, in einem funktionierenden System eingebunden. Das funktionierende System kann ein parallel installiertes Ubuntu oder ein Livesystem (CD/DVD bzw. USB-Stick) sein. Wichtig ist, dass das System die <span class="underline">gleiche</span> Architektur (i386, amd64) aufweist wie das System, auf dem den die verschlüsselten Verzeichnisse angelegt wurden.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Auch wenn die <a class="internal" href="../ecryptfs.html">ecryptfs</a>-Verschlüsselung mit einer älteren Ubuntuversion erfolgte, lässt sich <code class="notranslate">ecryptfs-recover-private</code> anwenden. Entscheidend ist, dass das funktionierende System bzw. die Live-CD den Befehl <code class="notranslate">ecryptfs-recover-private</code> bereitstellt.
</p></div></div><p>In einem Terminal gibt man nun
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ecryptfs-recover-private </pre></div></div><p>ein. Der Befehl durchsucht alle eingebundenen Partitionen nach Ordnern, die mit <a class="internal" href="../ecryptfs.html">ecryptfs</a> verschlüsselt wurden. Die Ausgabe sieht beispielsweise so aus:</p><pre class="notranslate">INFO: Searching for encrypted private directories (this might take a while)...
INFO: Found [/home/.ecryptfs/BENUTZERNAME/.Private].
Try to recover this directory? [Y/n]: </pre><p>Gibt es mehrere verschlüsselte Benutzerverzeichnisse, werden diese der Reihe nach abgefragt. Bestätigt man die Wiederherstellung, muss man das <span class="underline">Login</span> Passwort von BENUTZERNAME eingeben.</p><p>Nach Eingabe des Passwortes wird das Verzeichnis von BENUTZERNAME automatisch entschlüsselt und eingebunden. Der Ort wird im Terminal angegeben, in der Regel wird dabei ein Ordner unter <strong>/tmp</strong> erstellt. Nun kann man mit jedem Dateibrowser auf die Dateien zugreifen. Man hat jedoch nur Lese- keinen Schreibzugriff. Will man die Daten verändern, muss man also zunächst eine Kopie anlegen.</p><p>Sollte der Zugriff auf die Dateien verweigert werden, liegt das wahrscheinlich an entsprechend gesetzten Zugriffsrechten <sup><a href="#source-2">[2]</a></sup>. In dem Fall hilft ein Dateimanager mit <a class="internal" href="../dateimanager.html#Root-Rechte">Root-Rechten</a> oder das Kopieren in einem Root-Terminal.</p></div><div class="section_1"><h2 id="Vorbereitungen-fuer-die-manuelle-Datenrettung">Vorbereitungen für die manuelle Datenrettung<a class="headerlink" href="#Vorbereitungen-fuer-die-manuelle-Datenrettung">¶</a></h2><p>
Wenn das automatische Auslesen mit <code class="notranslate">ecryptfs-recover-private</code> nicht möglich ist, kann eine manuelle Wiederherstellung und Entschlüsselung der Daten helfen.</p><div class="section_2"><h3 id="Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien<a class="headerlink" href="#Systempfade-der-Schluesseldateien">¶</a></h3><p>
Die für die Entschlüsselung erforderlichen Dateien befinden sich in einem für <code class="notranslate">ecryptfs-utils</code> reservierten Verzeichnis. Die Pfade dorthin unterscheiden sich abhängig von der Variante:</p><p>Bei der Variante Verzeichnis <strong>~/Private</strong> befinden sich diese im Verzeichnis:</p><ul><li><p><strong>/home/BENUTZERNAME/.ecryptfs</strong></p></li></ul><p>
für die Variante gesamtes Homeverzeichnis befinden sich diese im Verzeichnis:</p><ul><li><p><strong>/home/.ecryptfs/BENUTZERNAME/.ecryptfs</strong></p></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Inhalte der beiden versteckten Verzeichnisse
</p><ul><li><p><strong>/home/BENUTZERNAME/.ecryptfs</strong> bzw.</p></li><li><p><strong>/home/.ecryptfs/BENUTZERNAME/.ecryptfs</strong></p></li></ul><p>unterscheiden sich nicht. Während in diesem "nur" die Schlüsseldaten liegen, sind im dazugehörigen Verzeichnis
</p><ul><li><p><strong>/home/BENUTZERNAME/.Private</strong> bzw.</p></li><li><p><strong>/home/.ecryptfs/BENUTZERNAME/.Private</strong></p></li></ul><p>die verschlüsselten Daten des jeweiligen Nutzers gespeichert.
</p></div></div><p>Bei allen Varianten sollten sich im Verzeichnis <strong>.ecryptfs</strong> jeweils die folgenden Dateien befinden:</p><pre class="notranslate">auto-mount  (Null-Byte Indikator-Datei)
auto-umount (Null-Byte Indikator-Datei)
Private.mnt (der relevante mount-point, in der Regel /home/BENUTZERNAME)
Private.sig (Hinweis auf Verschlüsselung von Ordnern und Files)
wrapped-passphrase (Verschlüsselungspasswort - encryptet)
.wrapped-passphrase.recorded (Null-Byte Indikator-Datei)</pre></div><div class="section_2"><h3 id="Daten-einbinden">Daten einbinden<a class="headerlink" href="#Daten-einbinden">¶</a></h3><p>
Man startet mit einer Live-CD (-DVD) bzw. Live-USB-Stick ein Ubuntu mit der gleichen Architektur und öffnet am Live-Desktop ein Terminal <sup><a href="#source-1">[1]</a></sup> und bindet das "beschädigte" System in das Ubuntu-Live-System ein.</p><p>Handelt es sich dabei um ein <a class="internal" href="../software-raid.html">Software-RAID</a>, <a class="internal" href="../logical_volume_manager.html">LVM</a> oder anderes System, so sind entsprechende Maßnahmen vorab im Live-System zu ergreifen. Nachfolgend die Partitions-Bezeichnungen verwenden, wie diese im Terminal mit</p><div class="bash"><div class="contents"><pre class="notranslate">sudo blkid </pre></div></div><p>
angezeigt werden.</p><div class="section_3"><h4 id="Integriertes-Homeverzeichnis">Integriertes Homeverzeichnis<a class="headerlink" href="#Integriertes-Homeverzeichnis">¶</a></h4><p>
Befindet sich das Verzeichnis <strong>/home/BENUTZERNAME</strong> auf der <span class="underline">selben</span> Partition wie das Wurzelverzeichnis (nachfolgend wird als Beispiel <strong>/dev/sda1</strong> für das Wurzelverzeichnis angenommen), dann gibt man ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount /dev/sda1 /mnt </pre></div></div></div><div class="section_3"><h4 id="Separates-Homeverzeichnis">Separates Homeverzeichnis<a class="headerlink" href="#Separates-Homeverzeichnis">¶</a></h4><p>
Befindet sich das Verzeichnis <strong>/BENUTZERNAME</strong> auf einer vom Wurzelverzeichnis <span class="underline">getrennten</span> Partition (als Beispiel Wurzelverzeichnis = <strong>/dev/sda1</strong>, home = <strong>/dev/sda5</strong> ), so muss das System beginnend mit root ( <strong>/</strong> ) in der richtigen Reihenfolge vorab aufgebaut werden.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount /dev/sda1 /mnt
sudo mount /dev/sda5 /mnt/home </pre></div></div><p>Sollten noch andere Verzeichnisse (siehe <strong>/etc/fstab</strong>) erforderlich sein, so sind auch diese einzubinden. Nun <span class="underline">sollte</span> man schon einmal überprüfen, ob man auf die (noch verschlüsselten) Daten als solche bzw. Schlüsseldateien schon zugreifen kann.</p><p>Falls man sich die Basisdaten zur Verschlüsselung nicht notiert hatte, sollte man diese jetzt erst einmal auslesen!</p></div></div><div class="section_2"><h3 id="wrapped-passphrase-auslesen">wrapped-passphrase auslesen<a class="headerlink" href="#wrapped-passphrase-auslesen">¶</a></h3><p>
Zur Prüfung, ob die Passphrase (nicht das Login-Passwort) stimmt und dieses unbeschädigt ist, kann man sich dieses mit dem folgenden Befehl im Terminal <sup><a href="#source-1">[1]</a></sup> anzeigen lassen, nachdem man in das für den BENUTZERNAME relevante Verzeichnis <strong>.ecryptfs</strong> gewechselt ist (siehe <a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade</a>).</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Hier weder ein <code class="notranslate">sudo</code> einsetzen noch ein <code class="notranslate">Administrator-Terminal</code> benutzen!
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-unwrap-passphrase </pre></div></div><p>und schließt mit 
<span class="key">⏎</span>  ab, danach folgt die Eingabe:</p><div class="bash"><div class="contents"><pre class="notranslate">passphrase: </pre></div></div><p>Dort gibt man nun das Benutzerpasswort ein und schließt mit 
<span class="key">⏎</span>  ab. Den angezeigten Schlüssel unbedingt notieren oder in eine Datei kopieren.</p></div></div><div class="section_1"><h2 id="Daten-manuell-auslesen">Daten manuell auslesen<a class="headerlink" href="#Daten-manuell-auslesen">¶</a></h2><p>
Die Partition(en), auf denen die Daten zum Auslesen liegen, sollten gemäß der Beschreibung <a class="crosslink" href="#Daten-einbinden">Daten einbinden</a> fürs Live-System verfügbar gemacht werden.</p><div class="section_2"><h3 id="Lesender-Datenzugriff">Lesender Datenzugriff<a class="headerlink" href="#Lesender-Datenzugriff">¶</a></h3><p>
Man erstellt im Live-System einen Benutzer mit dem identischen Benutzernamen (optional mit UserID) und Login-Passwort, wie dieses für die zu lesenden Daten vorgegeben ist mit:</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei der Abfrage wird das Login-Passwort als "UNIX-Passwort" bezeichnet, die Eingabe erfolgt blind, es erfolgt keine Anzeige bei der Eingabe! 
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo adduser --encrypt-home [--uid xxxx] BENUTZERNAME
....
Geben Sie ein neues UNIX-Passwort ein:
Geben Sie ein neues UNIX-Passwort erneut ein:
... # Eingabe zu Name etc. kann vernachlässigt werden </pre></div></div><p>Anschließend fügt man den Benutzer noch der Gruppe <a class="internal" href="../sudo.html">sudo</a> hinzu:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo adduser BENUTZERNAME sudo </pre></div></div><p>Nun stellt man den Zugriff auf die oben eingebundenen, verschlüsselten Daten für das Livesystem her:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo mount -o bind /mnt/home/.ecryptfs /home/.ecryptfs </pre></div></div><p>Man meldet sich nun aus dem "Ubuntu-Livesystem" ab und mit dem &lt;Benutzername&gt; am Login wieder an. Damit sollten die Daten wieder im Klartext lesbar sein. Nach Abschluss der Arbeiten <span class="underline">sollte</span> man sich abmelden und das eingehängte System vom Livesystem lösen bzw. das Livesystem herunter fahren.</p></div><div class="section_2"><h3 id="Datenzugriff-mit-Bearbeitung">Datenzugriff mit Bearbeitung<a class="headerlink" href="#Datenzugriff-mit-Bearbeitung">¶</a></h3><p>
Werden über das <a class="crosslink" href="#Daten-auslesen">Auslesen</a> hinaus weitere Schritte erforderlich, sind um die erforderlichen Kernel-Informationen für <code class="notranslate">ecryptfs-utils</code> vom Ubuntu-Live-System zu erhalten, in das Terminal <sup><a href="#source-1">[1]</a></sup> folgende Eingaben / Schritte erforderlich:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ for fs in dev proc sys; do sudo mount --bind /$fs /mnt/$fs; done </pre></div></div><p>Nun wechselt man mit dem Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo chroot /mnt </pre></div></div><p>in das <em>"defekte"</em> System.</p><div class="section_3"><h4 id="Benutzer-aktivieren">Benutzer aktivieren<a class="headerlink" href="#Benutzer-aktivieren">¶</a></h4><p>
Man wechselt nun den Benutzer - dabei auf das Minus- und die Leer-Zeichen bei der Eingabe achten. Bei der Abfrage zum Passwort ist das <code class="notranslate">&lt;Login-Passwort&gt;</code> von <code class="notranslate">BENUTZERNAME</code> einzugeben. Die angezeigten Meldungen können ignoriert werden.</p><div class="bash"><div class="contents"><pre class="notranslate">root@ubuntu:~$ su - BENUTZERNAME
Passwort: &lt; Login-Passwort von BENUTZERNAME </pre></div></div></div><div class="section_3"><h4 id="Verzeichnis-aufschliessen">Verzeichnis aufschließen<a class="headerlink" href="#Verzeichnis-aufschliessen">¶</a></h4><p>
Mit den nächsten Eingaben schließt man das <em>"verschlüsselte"</em> Verzeichnis auf:</p><div class="bash"><div class="contents"><pre class="notranslate">BENUTZERNAME@ubuntu:~$ ecryptfs-add-passphrase --fnek
Passphrase: &lt; notierte Passphrase
BENUTZERNAME@ubuntu:~$ ecryptfs-mount-private </pre></div></div><p>Jetzt hat man Zugriff auf die Daten, sowohl über den <a class="internal" href="../dateimanager.html">Dateimanager</a>, als auch im Terminal, dazu noch folgende Eingabe</p><div class="bash"><div class="contents"><pre class="notranslate">BENUTZERNAME@ubuntu:~$ cd ..
BENUTZERNAME@ubuntu:~$ cd BENUTZERNAME </pre></div></div><p>damit die Daten angezeigt, ausgelesen und auch extern gesichert werden können. Will man einen <a class="internal" href="../dateimanager.html">Dateimanager</a> benutzen, dann diesen <span class="underline">jetzt</span> aus dem Terminal <sup><a href="#source-1">[1]</a></sup> heraus aufrufen.</p></div><div class="section_3"><h4 id="Benutzer-deaktivieren">Benutzer deaktivieren<a class="headerlink" href="#Benutzer-deaktivieren">¶</a></h4><p>
Um keine Datenverluste zu erleiden, die eingebundenen Verzeichnisse richtig verlassen, dazu im Terminal <sup><a href="#source-1">[1]</a></sup> eingeben:</p><div class="bash"><div class="contents"><pre class="notranslate">BENUTZERNAME@ubuntu:~$ ecryptfs-umount-private
BENUTZERNAME@ubuntu:~$ exit
logout
root@ubuntu:~$ exit
ubuntu@ubuntu:~$ </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ist das Vorstehende nicht ohne Fehlermeldungen auszuführen, so sind aufgrund der Vielzahl der Möglichkeiten tieferes Basiswissen zu Linux und zu den aufgetretenen Fehlern erforderlich, die diese Beschreibung sprengen würde - wobei eine Wiederherstellung nicht grundsätzlich ausgeschlossen wird.
</p></div></div></div></div></div><div class="section_1"><h2 id="Schluesseldaten-reparieren">Schlüsseldaten reparieren<a class="headerlink" href="#Schluesseldaten-reparieren">¶</a></h2><p>
Wenn man bei einer Prüfung erkennt, dass die Schlüsseldateien nicht mehr brauchbar sind oder gar fehlen, so kann man dieses <em>"reparieren"</em>.</p><div class="section_2"><h3 id="berpruefung-der-Schluesseldateien">Überprüfung der Schlüsseldateien<a class="headerlink" href="#berpruefung-der-Schluesseldateien">¶</a></h3><p>
Dies setzt allerdings voraus, dass die Datei <strong>wrapped-passphrase</strong> entweder intakt ist und <a class="crosslink" href="#wrapped-passphrase-auslesen">vorab ausgelesen</a> werden konnte, eine Kopie von ihr existiert und das Passwort, mit dem das Verzeichnis <strong>~/Private</strong> bzw. das Home-Verzeichnis verschlüsselt wurde, bekannt sind. Ist das nicht der Fall, ist eine Wiederherstellung der Daten nicht möglich. Die verschlüsselten Verzeichnisse können in diesem Fall nicht mehr entschlüsselt werden!</p></div><div class="section_2"><h3 id="Reparatur-vorbereiten">Reparatur vorbereiten<a class="headerlink" href="#Reparatur-vorbereiten">¶</a></h3><p>
Man ruft ein Terminal auf, bindet zuerst wie unter <a class="crosslink" href="#Daten-einbinden">Daten einbinden</a> beschrieben, die Partition(en) ein und wechselt mit:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo chroot /mnt
ubuntu@ubuntu:~$ su - BENUTZERNAME
Passwort: &lt; Login-Passwort von BENUTZERNAME
BENUTZERNAME@ubuntu:~$ cd /mnt/home/.ecryptfs/BENUTZERNAME/.ecryptfs
BENUTZERNAME@ubuntu: /mnt/home/.ecryptfs/BENUTZERNAME/.ecryptfs&gt;$ </pre></div></div><p>
in das System vom <em>"alten"</em> Benutzer.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Man sollte das Terminal solange nicht verlassen, bis alle Dateien angelegt wurden. Mit dieser Maßnahme werden bei der Erstellung die Rechte <sup><a href="#source-3">[3]</a></sup> und Benutzer-ID gleich richtig mit angelegt.</p><p>Obige Pfadangabe ist gemäß dem aktuellen Pfad zu den <a class="crosslink" href="#Systempfade-der-Schluesseldateien">Schlüsseldateien</a> anzupassen. Nachfolgend wird auf die <em>"beispielhafte"</em> Pfadangabe der Terminal-Zeile mit
</p><ul><li><p><strong>BENUTZERNAME@ubuntu: /mnt/home/.ecryptfs/BENUTZERNAME/.ecryptfs&gt;$</strong></p></li></ul><p>verzichtet und nur noch auf die Befehle an diesem Prompt eingegangen.
</p></div></div></div><div class="section_2"><h3 id="wrapped-passphrase-erstellen">wrapped-passphrase erstellen<a class="headerlink" href="#wrapped-passphrase-erstellen">¶</a></h3><p>
Ist das Verschlüsselungspasswort unbekannt, kann es (wie oben unter <a class="crosslink" href="#wrapped-passphrase-auslesen">Passphrase</a> auslesen beschrieben) aus einer intakten <strong>wrapped-passphrase</strong>-Datei ausgelesen werden. Nachdem es bekannt ist, kann die Datei wie folgt im Terminal <sup><a href="#source-1">[1]</a></sup> neu erstellt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-wrap-passphrase wrapped-passphrase </pre></div></div><p>Die nachfolgenden Abfragen sind wie folgt zu beantworten (es erfolgt keine Anzeige, <span class="underline">blinde</span> Eingabe erforderlich):</p><div class="bash"><div class="contents"><pre class="notranslate">Passphrase to wrap:  &lt; Eingabe notierte Passphrase
Wrapping passphrase: &lt; Eingabe Login-Passwort von BENUTZERNAME </pre></div></div><p>und die erforderlichen Zugriffs-Rechte <sup><a href="#source-3">[3]</a></sup> dieser Datei einschränken mit:</p><div class="bash"><div class="contents"><pre class="notranslate">chmod 700 wrapped-passphrase </pre></div></div></div><div class="section_2"><h3 id="auto-mount-erstellen">auto-mount erstellen<a class="headerlink" href="#auto-mount-erstellen">¶</a></h3><p>
Man erstellt im Terminal <sup><a href="#source-1">[1]</a></sup> die leere Datei <strong>auto-mount</strong> mit folgendem Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">touch auto-mount </pre></div></div></div><div class="section_2"><h3 id="auto-umount-erstellen">auto-umount erstellen<a class="headerlink" href="#auto-umount-erstellen">¶</a></h3><p>
Man erstellt im Terminal <sup><a href="#source-1">[1]</a></sup> die leere Datei <strong>auto-umount</strong> mit folgendem Befehl :
</p><div class="bash"><div class="contents"><pre class="notranslate">touch auto-umount </pre></div></div></div><div class="section_2"><h3 id="Private-mnt-erstellen">Private.mnt erstellen<a class="headerlink" href="#Private-mnt-erstellen">¶</a></h3><p>
Man erstellt im Terminal <sup><a href="#source-1">[1]</a></sup> die Datei <strong>Private.mnt</strong> mit folgendem Befehl
</p><ul><li><p>für das Verzeichnis <strong>~/Private</strong></p></li></ul><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">echo /home/BENUTZERNAME/Private &gt; Private.mnt </pre></div></div><ul><li><p>für ein gesamtes Homeverzeichnis</p></li></ul><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">echo /home/BENUTZERNAME &gt; Private.mnt </pre></div></div><p>Danach die Zugriffs-Rechte <sup><a href="#source-3">[3]</a></sup> dieser Datei einschränken mit:</p><div class="bash"><div class="contents"><pre class="notranslate">chmod 700 Private.mnt </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wie man erkennen kann, kann man den Pfad, wohin die <em>eigentlichen</em> Daten aus dem Verzeichnis <strong>.Private</strong> eingebunden werden sollen, seinen Bedürfnissen anpassen - als Beispiel für einzelnes Ziel-Verzeichnis
</p><ul><li><p><strong>/home/BENUTZERNAME/Dokumente/Geheim</strong></p></li></ul></div></div></div><div class="section_2"><h3 id="Private-sig-erstellen">Private.sig erstellen<a class="headerlink" href="#Private-sig-erstellen">¶</a></h3><p>
Um die Basisdaten für diese Datei zu erhalten, gibt man in das Terminal <sup><a href="#source-1">[1]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-add-passphrase --fnek
Passphrase: &lt; Eingabe notierte Passphrase </pre></div></div><p>und erhält nun u.a. folgende Zeilen (hier beispielhaftes Ergebnis):</p><pre class="notranslate">Inserted auth tok with sig [14140887552e0bec] into the user session keyring
Inserted auth tok with sig [de5d090606c60111] into the user session keyring</pre><p>Man erstellt die Datei <strong>Private.sig</strong>, indem man die <span class="underline">eigenen</span> Schlüsselwerte zwischen den <strong>[ ]</strong> zeilenweise überträgt mit:</p><div class="bash"><div class="contents"><pre class="notranslate">echo 14140887552e0bec &gt; Private.sig
echo de5d090606c60111 &gt;&gt; Private.sig </pre></div></div><p>Bei der zweiten Zeile das doppelte <em>"&gt;&gt;"</em> beachten und danach die Rechte <sup><a href="#source-3">[3]</a></sup> einschränken mit:
</p><div class="bash"><div class="contents"><pre class="notranslate">chmod 700 Private.sig </pre></div></div><p>Um keine Datenverluste zu erleiden, nun im Terminal noch eingeben:</p><div class="bash"><div class="contents"><pre class="notranslate">exit
logout
ubuntu@ubuntu:~$ </pre></div></div><p>Man sollte diese Daten / Dateien jetzt <span class="underline">auch</span> extern sichern, bevor man die Mount-Punkte wieder auflöst und  versucht, das System erneut zu starten.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="../ecryptfs.html">ecryptfs</a> <img alt="{Übersicht}" src="../_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Das <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> bzw. ein Verzeichnis darin verschlüsseln</p><ul><li><p><a class="internal" href="../ecryptfs/einrichten.html">Einrichten</a> - wie man eine Verschlüsselung installiert / entfernt</p></li><li><p><a class="internal" href="../ecryptfs/nutzung.html">Nutzung</a> - wie man seine Daten bearbeiten und nutzen kann</p><ul><li><p><a class="internal" href="../ecryptfs/nutzung.html#Wechsel-Login-Passwort">Wechsel-Login-Passwort</a> - dieser Abschnitt dient zur Problembehebung bei Passwortänderungen</p></li></ul></li></ul></li><li><p><a class="internal" href="../gddrescue.html">gddrescue</a> - Datenrettung von defekten Datenträgern (z.B. CD-ROM, Disketten etc.)</p></li></ul><p>
</p><ul><li><p><a class="external" href="https://help.ubuntu.com/community/EncryptedPrivateDirectory" rel="nofollow">Weitere aktuelle Hinweise</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://blog.dustinkirkland.com/2011/04/introducing-ecryptfs-recover-private.html" rel="nofollow">Blogeintrag zu ecryptfs-recover-private</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../ecryptfs/datenrettung/a/revision/913973.html">Diese Revision</a> wurde am 24. Oktober 2016 08:03 von <a href="https://ubuntuusers.de/user/jl4jsjsjyjw8sl/">jl4jsjsjyjw8sl</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../ecryptfs.html">ecryptfs</a></li>
<li><a href="../ecryptfs/datenrettung.html">Datenrettung</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>