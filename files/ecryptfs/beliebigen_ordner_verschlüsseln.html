<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>ecryptfs/Beliebigen_Ordner_verschlüsseln › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../ecryptfs/beliebigen_ordner_verschlüsseln.html">Beliebigen Ordner verschlüsseln</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/ecryptfs/Beliebigen_Ordner_verschlüsseln">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/backlinks.html">Beliebigen Ordner verschlüsseln</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="../trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../sudo.html">Root-Rechte</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../fstab.html">Erstellen von dauerhaften Einhängepunkten</a></p></li></ol></div></div><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Funktionsweise-von-ecryptfs">Funktionsweise von ecryptfs
</a></li><li><a class="crosslink" href="#Verschluesselung-mit-frei-waehlbarer-Passphrase">Verschlüsselung mit frei wählbarer Passphr...</a></li><li><a class="crosslink" href="#Bei-Anmeldung-automatisch-eingehaengtes-Verzeichnis">Bei Anmeldung automatisch eingehängtes Ver...</a></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>
<a class="internal" href="../ecryptfs.html">ecryptfs</a> bietet - neben der in Ubuntu mit Bordmitteln möglichen Verschlüsselung des gesamten Homeverzeichnisses oder des Ordners "~/Private" - auch die Möglichkeit, beliebige weitere Ordner zu verschlüsseln.</p><p>Dies kann beispielsweise als Ersatz für <a class="internal" href="../truecrypt.html">Truecrypt</a> oder <a class="internal" href="../encfs.html">EncFS</a> sinnvoll sein, oder auch dazu verwendet werden, um Teile eines verschlüsselten Homeverzeichnisses auf eine zweite Festplatte auszulagern.</p><p>Im Folgenden werden diese beiden Möglichkeiten beschrieben.</p><div class="section_1"><h2 id="Funktionsweise-von-ecryptfs">Funktionsweise von ecryptfs<a class="headerlink" href="#Funktionsweise-von-ecryptfs">¶</a></h2><p>
Um die folgenden Ausführungen besser verstehen zu können, ist ein grundlegendes Verständnis für die Funktionsweise von ecryptfs hilfreich.</p><p>ecryptfs speichert die verschlüsselten Daten in einem Verzeichnis und stellt diese in einem anderen Verzeichnis unverschlüsselt dar. Es ist etwa mit einem <a class="internal" href="../mount.html#Einzelne-Ordner-einbinden">mount --bind</a>, jedoch mit dazwischen geschalteter Verschlüsselung vergleichbar.</p><p>Um den verschlüsselten Ordner einhängen zu können, ist es stets notwendig, vorher die Passphrase im Kernel-Keyring zu hinterlegen. Aus der Passphrase leitet sich eine Signatur ab. Diese dient zur Zuordnung der Passphrase und muss daher beim Einhängen angegeben werden.</p><p>Für Einhängevorgänge sind grundsätzlich Root-Rechte notwendig. Ein Einhängen des verschlüsselten Verzeichnisses ohne weitere Konfiguration ist daher auch dem Systemverwalter vorbehalten, ein vorangestelltes <a class="internal" href="../sudo.html">sudo</a> ist notwendig.<br/>Durch einen Eintrag in der Datei <a class="internal" href="../fstab.html">/etc/fstab</a> kann aber erreicht werden, dass das Einhängen auch mit normalen Benutzerrechten möglich ist.</p><p>Diese Unterscheidung, mit welchen Rechten der Einhängevorgang erfolgt, ist von Belang, da die Passphrase in den Keyring jenes Benutzers geladen werden muss, welcher danach das Einhängen durchführt. Beispielsweise wird ein Einhängen mit Root-Rechten nicht funktionieren, wenn zuvor die Passphrase im Keyring des Benutzers hinterlegt wurde.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Der Speicherort sowie der Einhängepunkt der verschlüsselten Daten darf nicht innerhalb eines bereits mit ecryptfs verschlüsseltem Verzeichnis liegen. Wenn also die Verschlüsselung des gesamten Homeverzeichnisses verwendet wird, müssen Verzeichnisse außerhalb dessen verwendet werden.</p><p>Bei Tests verursachte dies wiederholt Probleme.</p><p>Sollen die Verzeichnisse letztendlich im Benutzerverzeichnis bereitgestellt werden, wird auf die Möglichkeit von <a class="internal" href="../ln.html#Symbolische-Verknuepfungen">Symlinks</a> verwiesen.
</p></div></div><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Es ist möglich ecryptfs so einzurichten, dass nur ein Verzeichnis verwendet und dabei eine Ansicht der unverschlüsselten Information über die verschlüsselten Dateien gelegt wird. Diese werden erst nach dem Aushängen des ecryptfs-Dateisystems wieder sichtbar.</p><p>Da dies ein abstrakteres Konzept ist, welches Anfängern oft nicht gleich zu zugänglich ist, wird im Weiteren auf diese Möglichkeit nicht näher eingegangen. Es ist jedoch in allen Fällen möglich, statt zweier Verzeichnisse immer nur eines zu verwenden.
</p></div></div></div><div class="section_1"><h2 id="Verschluesselung-mit-frei-waehlbarer-Passphrase">Verschlüsselung mit frei wählbarer Passphrase<a class="headerlink" href="#Verschluesselung-mit-frei-waehlbarer-Passphrase">¶</a></h2><p>
</p><div class="section_2"><h3 id="Eckdaten">Eckdaten:<a class="headerlink" href="#Eckdaten">¶</a></h3><p>
</p><ul><li><p>Die Passphrase kann frei gewählt werden und muss nicht mit Login-Passwort übereinstimmen.</p></li><li><p>Das Verzeichnis wird händisch eingehängt.</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Einhaengen">Einhängen<a class="headerlink" href="#Einhaengen">¶</a></h3><p>
Zunächst müssen die beiden Ordner angelegt und mit den entsprechenden Rechten versehen werden.<br/>Dabei steht ".geheim" für das Verzeichnis, dass die verschlüsselten Dateien enthält, "geheim" für die entsperrte Ansicht.</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir ~/.geheim ~/geheim
chmod 700 ~/.geheim ~/geheim
chown BENUTZER:GRUPPE ~/.geheim ~/geheim </pre></div></div><p>Die Einrichtung wird in einem Terminal mit folgendem Befehl aufgerufen:</p><div class="bash"><div class="contents"><pre class="notranslate">$ sudo mount.ecryptfs /home/$USER/.geheim /home/$USER/geheim </pre></div></div><p>Daraufhin wird zunächst die Passphrase abgefragt. Ein vorheriges Laden der Passphrase in den Kernel-Keyring kann in diesem Fall somit entfallen.</p><p>Anschließend werden einige Einstellungen abgefragt. In den meisten Fällen können die Vorschläge durch Drücken der Eingabetaste übernommen werden, lediglich bei</p><div class="bash"><div class="contents"><pre class="notranslate">Enable filename encryption (y/n) [n]: y </pre></div></div><p>wird für eine erhöhte Sicherheit empfohlen, die Verschlüsselung der Dateinamen einzuschalten. Anderenfalls sind die Dateinamen auch im ausgehängten Zustand im Klartext lesbar.</p><p>Sobald die Abfragen erledigt sind, ist das Verzeichnis eingehängt.</p><p>Testweise kann nun auch eine Datei angelegt werden.</p><div class="bash"><div class="contents"><pre class="notranslate">$ touch ~/geheim/test.txt </pre></div></div><p>Ein <a class="internal" href="../ls.html">ls</a> zeigt nun die verschlüsselte Datei an:</p><div class="bash"><div class="contents"><pre class="notranslate">$ ls ~/.geheim/
ECRYPTFS_FNEK_ENCRYPTED.FWbOeBfUnSnpYkTOd2D9gIm.covYF956EV7IZmlCozkw.nYzVVD0YUrJ1--- </pre></div></div></div><div class="section_2"><h3 id="Verkuerzte-Variante">Verkürzte Variante<a class="headerlink" href="#Verkuerzte-Variante">¶</a></h3><p>
Will man nicht jedes Mal den kompletten Abfragedialog durchgehen, so empfiehlt es sich, die notwendigen Optionen dem <a class="internal" href="../mount.html">mount</a>-Befehl direkt zu übergeben.</p><p>Es wird dann lediglich die Passphrase abgefragt, die übergebenen Optionen werden übersprungen.</p><p>Der entsprechende Befehl sieht folgendermassen aus, wobei <code class="notranslate">ecryptfs_sig</code> und <code class="notranslate">ecryptfs_fnek_sig</code> natürlich an die eigenen Gegebenheiten anzupassen sind. Die Signaturen werden im Zuge des interaktiven Einhängevorganges ausgegeben.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount -t ecryptfs -o ecryptfs_passthrough=n,ecryptfs_enable_filename_crypto=y,ecryptfs_sig=daa8dae0cdecf593,ecryptfs_fnek_sig=daa8dae0cdecf593,ecryptfs_unlink_sigs,ecryptfs_key_bytes=16,ecryptfs_cipher=aes ~/.geheim ~/geheim </pre></div></div></div><div class="section_2"><h3 id="Nicht-interaktives-Einhaengen">Nicht-interaktives Einhängen<a class="headerlink" href="#Nicht-interaktives-Einhaengen">¶</a></h3><p>
Will man den Abfragedialog komplett umgehen, so ist dies möglich, indem man den Befehl <code class="notranslate">mount</code> mit der Option <code class="notranslate">-i</code> aufruft.</p><p>Da nun aber auch die Passphrase nicht mehr abgefragt wird, muss diese zuvor händisch in den Kernel-Keyring geladen werden. Dies geschieht beispielsweise mit dem Befehl:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ecryptfs-add-passphrase </pre></div></div><p>Danach kann das Einhängen mit dem bereits oben genannten, um <code class="notranslate">-i</code> erweiterten mount-Befehl erfolgen (Achtung: Signaturen anpassen!):
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount -i -t ecryptfs -o ecryptfs_passthrough=n,ecryptfs_enable_filename_crypto=y,ecryptfs_sig=daa8dae0cdecf593,ecryptfs_fnek_sig=daa8dae0cdecf593,ecryptfs_unlink_sigs,ecryptfs_key_bytes=16,ecryptfs_cipher=aes ~/.geheim ~/geheim </pre></div></div></div><div class="section_2"><h3 id="Einhaengen-mit-Benutzerrechten">Einhängen mit Benutzerrechten<a class="headerlink" href="#Einhaengen-mit-Benutzerrechten">¶</a></h3><p>
Wie bereits am Anfang des Artikels beschrieben sind zum Einhängen von Dateisystemen grundsätzlich Root-Rechte erforderlich.</p><p>Ausnahmen bilden (neben <a class="internal" href="../fuse.html">FUSE</a>) nur jene Dateisysteme, für die zuvor ein Einhängepunkt in der Datei <a class="internal" href="../fstab.html">/etc/fstab</a> definiert und dieser mit der Option <code class="notranslate">user</code> versehen wurde.</p><p>Für das Einhängen mit nicht-privilegierten Rechten ist somit zwingend dieser Eintrag zu erstellen.</p><div class="section_3"><h4 id="Einrichtung">Einrichtung<a class="headerlink" href="#Einrichtung">¶</a></h4><p>
Voraussetzung für die nächsten Schritte ist, dass das betroffene Verzeichnis eingehängt ist.</p><p>Die Datei <code class="notranslate">/etc/mtab</code> enthält Informationen über die aktuell einhängten Dateisysteme. Da diese im gleichen Format wie die Einträge der <code class="notranslate">/etc/fstab</code> vorliegen, können diese direkt übernommen werden.</p><p>Dazu in einem Editor der Wahl die Zeile betreffend des eben erstellten Mounts aus der <code class="notranslate">/etc/mtab</code> in die <code class="notranslate">/etc/fstab</code> kopieren.</p><p>Alternativ kann dies auch in einem Terminal mit dem folgenden Befehl durchgeführt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">grep /home/$USER/geheim /etc/mtab | sudo tee -a /etc/fstab </pre></div></div><p>Anschließend muß die Zeile noch um 2 Optionen erweitert werden:
</p><ul><li><p><code class="notranslate">noauto:</code> Verhindert ein automatisches Einhängen beim Starten.</p></li><li><p><code class="notranslate">user:</code> Ermögicht auch normalen Benutzern das Einhängen.</p></li></ul><p>
Die Zeile sollte letztendlich folgendermaßen aussehen:</p><pre class="notranslate">/home/BENUTZERNAME/.geheim /home/BENUTZERNAME/geheim ecryptfs noauto,user,rw,ecryptfs_sig=daa8dae0cdecf593,ecryptfs_cipher=aes,ecryptfs_key_bytes=16,ecryptfs_fnek_sig=daa8dae0cdecf593,ecryptfs_unlink_sigs 0 0</pre></div><div class="section_3"><h4 id="Einhaengen-2">Einhängen<a class="headerlink" href="#Einhaengen-2">¶</a></h4><p>
Um das eingerichtete Verzeichnis zu verwenden sind zwei Schritte notwendig.</p><p>Zunächst muß die Passphrase im Kernel-Keyring hinterlegt werden. Dies geschieht mit dem Befehl (<strong>ohne sudo!</strong>)</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-add-passphrase </pre></div></div><p>Anschließend kann das Verzeichnis mit dem Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">mount -i ~/geheim/ </pre></div></div><p>eingehängt und somit entsperrt werden.</p><p>Dabei ist wieder die Option <code class="notranslate">-i</code> zu verwenden, um den Einrichtungsdialog zu umgehen.</p></div><div class="section_3"><h4 id="Aushaengen">Aushängen<a class="headerlink" href="#Aushaengen">¶</a></h4><p>
Das Aushängen erfolgt mit dem Befehl
</p><div class="bash"><div class="contents"><pre class="notranslate">umount ~/geheim/ </pre></div></div><p>Da in der <code class="notranslate">/etc/fstab</code> die Option <code class="notranslate">ecryptfs_unlink_sigs</code> eingetragen wurde, wird beim Aushängeprozess auch die Passphrase aus dem Kernel-Keyring gelöscht. Für ein erneutes Einhängen ist die neuerliche Eingabe der Passphrase erforderlich.</p></div></div><div class="section_2"><h3 id="Verschluesselung-der-Passphrase">Verschlüsselung der Passphrase<a class="headerlink" href="#Verschluesselung-der-Passphrase">¶</a></h3><p>
Bei der Verwendung einer ausreichend langen oder <a class="internal" href="../pwgen.html">zufälligen</a> Passphrase, wird die manuelle Eingabe dieser immer schwieriger bis nahezu unmöglich werden.</p><p>Ecryptfs bietet daher auch die Möglichkeit, eine Passphrase mit einem Passwort zu verschlüsseln, um sie anschliessend verschlüsselt abspeichern zu können. Ubuntu verwendet dieses Verfahren auch für die Verschlüsselung des Benutzerverzeichnisses bzw des Private-Ordners.</p><div class="section_3"><h4 id="Einrichtung-2">Einrichtung<a class="headerlink" href="#Einrichtung-2">¶</a></h4><p>
Die Verschlüsselung erfolgt im Terminal mit dem Befehl <code class="notranslate">ecryptfs-wrap-passphrase</code> mit Angabe der Datei, in der das Ergebnis gespeichert werden soll. Beispielsweise:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-wrap-passphrase verschluesselte_passphrase.txt </pre></div></div><p>
Anschließend wird die ecrypt-Passphrase abgefragt ... <br/><small>(diese kann auch mittels Copy &amp; Paste eingefügt werden, also entweder über das <em>Menü</em> -&gt; <em>Bearbeiten</em> -&gt; <em>Einfügen</em> oder mittels der Tastenkombination 
<span class="key">Strg</span>  + 
<span class="key">⇧</span>  + 
<span class="key">V</span> )</small>
</p><div class="bash"><div class="contents"><pre class="notranslate">Passphrase to wrap:  </pre></div></div><p>
... und zuletzt ist das Passwort zur Verschlüsselung der Passphrase einzugeben:
</p><div class="bash"><div class="contents"><pre class="notranslate">Wrapping passphrase: </pre></div></div><p>Die verschlüsselte Passphrase ist dann in der Datei <code class="notranslate">verschluesselte_passphrase.txt</code> abgespeichert.</p><p>Das Ergebnis kann mit folgendem Befehl kontrolliert werden. Bei Eingabe des korrekten Passwortes wird die Passphrase in Klartext ausgegeben.
</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-unwrap-passphrase verschluesselte_passphrase.txt 
Passphrase: 
DasisteineTest-Passphrase </pre></div></div></div><div class="section_3"><h4 id="Verwendung">Verwendung<a class="headerlink" href="#Verwendung">¶</a></h4><p>
Das Einfügen der Passphrase in den Kernel-Keyring erfolgt dann mit dem Befehl <code class="notranslate">ecryptfs-insert-wrapped-passphrase-into-keyring</code>, wieder unter Angabe der vorher erzeugten Datei, welche die verschlüsselte Passphrase enthält.</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-insert-wrapped-passphrase-into-keyring verschluesselte_passphrase.txt 
Passphrase: 
Inserted auth tok with sig [a86fb90127b96b92] into the user session keyring </pre></div></div><p>Das Einhängen erfolgt nach einer der oben beschrieben Methoden. Je nachdem, ob der Einhängevorgang als Root- oder als normaler Benutzer erfolgen wird, muss das Einfügen der Passphrase mit den entsprechenden Rechten erfolgen (also gegebenenfalls mit einem vorangestelltem <code class="notranslate">sudo</code>).</p></div></div></div><div class="section_1"><h2 id="Bei-Anmeldung-automatisch-eingehaengtes-Verzeichnis">Bei Anmeldung automatisch eingehängtes Verzeichnis<a class="headerlink" href="#Bei-Anmeldung-automatisch-eingehaengtes-Verzeichnis">¶</a></h2><p>
</p><div class="section_2"><h3 id="Eckdaten-2">Eckdaten:<a class="headerlink" href="#Eckdaten-2">¶</a></h3><p>
</p><ul><li><p>Es wird ein beliebiges Verzeichnis außerhalb des und zusätzlich zum bereits verschlüsselten Benutzerverzeichnisses verschlüsselt.</p></li><li><p>Das Verzeichnis wird beim Anmelden automatisch entsperrt.</p></li><li><p>Um eine automatische Entsperrung zu erreichen, wird die gleiche Passphrase wie für das Homeverzeichnis verwendet.</p></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Es wird die Verwendung eines verschlüsselten Benutzerverzeichnisses vorausgesetzt. Für die Verschlüsselung eines einzelnen Verzeichnisses ohne Verwendung eines verschlüsselten Benutzerverzeichnisses wird die Einrichtung und Verwendung des Verzeichnisses <code class="notranslate">~/Private</code> empfohlen, Hinweise dazu unter <a class="internal" href="../ecryptfs/einrichten.html#Einrichtung-Verzeichnis-Private">ecryptfs/Einrichten</a></p><p>Möchte man nun beispielsweise den Thunderbird-Profil-Ordner verschlüsseln, so kann man das mit Hilfe von <a class="internal" href="../ln.html#Symbolische-Verknuepfungen">Symlinks</a> realisieren.
</p></div></div></div><div class="section_2"><h3 id="Allgemeine-Information">Allgemeine Information<a class="headerlink" href="#Allgemeine-Information">¶</a></h3><p>
Wenn eine Verschlüsselung entweder des gesamten Benutzerverzeichnisses oder des Ordners <code class="notranslate">~/Private</code> mit Hilfe der Ubuntu-Bordmittel eingerichtet wurde, so wird das jeweilige Verzeichnis beim Anmeldevorgang durch PAM (Pluggable Authentication Modules) eingehängt.</p><p>Das Modul <code class="notranslate">pam_ecryptfs</code> übernimmt das Anmeldepasswort, entschlüsselt damit die Passphrase, hinterlegt dieses im Kernel-Keyring und hängt das Verzeichnis am gewünschten Ort ein.</p><p>Dieses Verhalten macht sich diese Anleitung zunutze.<br/>Nachdem die gleiche Passphrase und daraus resultierend auch die gleichen Signaturen verwendet werden, wird das Laden der Passphrase in den Keyring dem Modul <code class="notranslate">pam_ecryptfs</code> überlassen.</p><p>Nachdem <code class="notranslate">pam_ecryptfs</code> nur mit einem, von Ubuntu vorkonfiguriertem Verzeichnis umgehen kann wird für das automatischen Einhängen ein weiteres PAM-Modul (<code class="notranslate">pam_mount</code>) verwendet.</p></div><div class="section_2"><h3 id="Einrichtung-3">Einrichtung<a class="headerlink" href="#Einrichtung-3">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Für das Verständnis der folgenden Ausführungen wird empfohlen, auch den ersten Abschnitt durchzulesen. Es werden eventuell nicht alle dortigen Ausführungen wiederholt.
</p></div></div><p>Für das Beispiel wird angenommen, dass eine Festplatte namens "2nd_hdd" existiert, welche beim Start bereits unter <code class="notranslate">/media/2nd_hdd</code> eingehängt wurde.</p><p>Zunächst müssen selbstverständlich wieder die beiden Ordner angelegt und erforderlichenfalls mit den entsprechenden Rechten versehen werden.</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir /media/2nd_hdd/.geheim media/2nd_hdd/geheim
chmod 700 /media/2nd_hdd/.geheim media/2nd_hdd/geheim
chown BENUTZER:GRUPPE /media/2nd_hdd/.geheim media/2nd_hdd/geheim </pre></div></div><p>Da die gleiche Passphrase wie für das vorkonfigurierte Verzeichnis verwendet wird, kann die obig beschriebene Ersteinrichtung übersprungen und die erforderlichen Angaben können direkt der <code class="notranslate">/etc/mtab</code> aus der Zeile, welche das Benutzerverzeichnis beschreibt, entnommen und in die <code class="notranslate">/etc/fstab</code> übertragen werden.</p><p>Dies geschieht entweder mit einem Texteditor der Wahl oder eben im Terminal, diesmal mit dem Befehl:
</p><div class="bash"><div class="contents"><pre class="notranslate">grep /home/$USER/.Private /etc/mtab | sudo tee -a /etc/fstab </pre></div></div><p>Anschließend muß ebenfalls die Datei /etc/fstab editiert werden.</p><ul><li><p>Zunächst sind das <strong>Verzeichnis</strong> und der <strong>Einhängepunkt anzupassen</strong>.</p></li><li><p>Weiters müssen wieder die Option <code class="notranslate">noauto</code> (das Einhängen erfolgt erst beim Einloggen und nicht schon beim Systemstart) und die Option <code class="notranslate">user</code> hinzugefügt werden.</p></li><li><p>Die Option <code class="notranslate">ecryptfs_unlink_sigs</code> wird entfernt, da sonst bei einem manuellen Aushängen der Schlüssel auf dem Kernel-Keyring entfernt würde und ein einfaches erneutes Einhängen nicht mehr möglich wäre.</p></li></ul><p>
Die entsprechende Zeile der <code class="notranslate">/etc/fstab</code> sollte schließlich so aussehen:
</p><pre class="notranslate">/media/2nd_hdd/.geheim /media/2nd_hdd/geheim ecryptfs noauto,user,ecryptfs_check_dev_ruid,ecryptfs_cipher=aes,ecryptfs_key_bytes=16,ecryptfs_sig=bba5322e6b198732,ecryptfs_fnek_sig=de277bb623fd467c 0 0</pre><p>Das Verzeichnis kann nun schon eingehängt und getestet werden.<br/>Zwingend erforderlich ist dabei erneut die Verwendung der Option <code class="notranslate">-i</code>.</p><div class="bash"><div class="contents"><pre class="notranslate">$ mount -i media/2nd_hdd/geheim/
$ touch media/2nd_hdd/geheim/test.txt
$ ls /media/2nd_hdd/.geheim/
ECRYPTFS_FNEK_ENCRYPTED.FWbS7riq6zp4T-QHDQIzEkaI3VmLeOS0h8DGCRWss-F8TsFQu6HQzJ3bJU-- </pre></div></div></div><div class="section_2"><h3 id="Automatisches-Einhaengen">Automatisches Einhängen<a class="headerlink" href="#Automatisches-Einhaengen">¶</a></h3><p>
Das PAM-Modul <code class="notranslate">pam_ecryptfs</code> kann bei der Anmeldung nur das vorkonfigurierte Verzeichnis einhängen. Um das selbstdefinierte Verzeichnis einzuhängen, ist ein weiteres Modul notwendig. Dazu wird <code class="notranslate">pam_mount</code> verwendet, welches nachinstalliert werden muß. Im Terminal geschieht dies bespielsweise mit:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libpam-mount </pre></div></div><p>Die Einrichtung erfolgt durch Bearbeitung der Konfigurationsdatei <code class="notranslate">/etc/security/pam_mount.conf.xml</code> mit Rootrechten in einem Texteditor der Wahl.</p><p>Dazu wird nach dem Kommentar <code class="notranslate">"&lt;!-- Volume definitions --&gt;"</code> folgender Abschnitt eingefügt.</p><p>Dabei definiert
</p><ul><li><p>die erste Zeile den Einhängepunkt. Die Optionen sind an jene der /etc/fstab angelehnt, lediglich <code class="notranslate">user</code> gibt an, dass das Einhängen nur für den Benutzer mit dem angegebenen Benutzernamen versucht werden soll.</p></li><li><p>Die zweite Zeile bestimmt, dass der Einhängevorgang nicht mit dem Befehl <code class="notranslate">mount</code>, sondern wieder mit <code class="notranslate">mount -i</code> durchgeführt wird.</p></li></ul><p>
</p><pre class="notranslate">		&lt;!-- Volume definitions --&gt;

&lt;volume user="BENUTZERNAME" noroot="1" fstype="ecryptfs" path="/media/2nd_hdd/.geheim"/&gt;
&lt;lclmount&gt;mount -i %(VOLUME) "%(before=\"-o\" OPTIONS)"&lt;/lclmount&gt;

		&lt;!-- pam_mount parameters: General tunables --&gt;</pre><p>Bei korrekter Einrichtung wird nun das Verzeichnis bei der Anmeldung automatisch entsperrt und bei der Abmeldung gesperrt werden.</p></div></div><div class="section_1"><h2 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Kernel-Keyring-einsehen">Kernel-Keyring einsehen<a class="headerlink" href="#Kernel-Keyring-einsehen">¶</a></h3><p>
Zur Überprüfung, welche Passphrasen im Kernel-Keyring geladen sind, kann der Befehl <code class="notranslate">keyctl</code> verwendet werden.</p><p>Für nicht-privilegierte Bentutzer lautet der Befehl:
</p><div class="bash"><div class="contents"><pre class="notranslate">keyctl list @u </pre></div></div><p>
Für den Benutzer <code class="notranslate">root</code> muss ein sudo vorangestellt werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo keyctl list @u </pre></div></div><p>
</p></div><div class="section_2"><h3 id="Log-Datei-fuer-pam-mount">Log-Datei für pam_mount<a class="headerlink" href="#Log-Datei-fuer-pam-mount">¶</a></h3><p>
Sollte das Einhängen durch <code class="notranslate">pam_mount</code> fehlschlagen, können die entsprechenden Fehlermeldungen der Datei <code class="notranslate">/var/log/auth.log</code> entnommen werden.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="../ecryptfs.html">ecryptfs</a></p></li><li><p><a class="external" href="https://wiki.archlinux.org/index.php/ECryptfs" rel="nofollow" title="https://wiki.archlinux.org/index.php/ECryptfs">https://wiki.archlinux.org/index.php/ECryptfs</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> umfangreiche Dokumentation im Arch-Wiki</p></li></ul></div></div>
<p class="meta">
<a href="../ecryptfs/beliebigen_ordner_verschlüsseln/a/revision/851638.html">Diese Revision</a> wurde am 21. November 2015 03:24 von <a href="https://ubuntuusers.de/user/mrkramps/">mrkramps</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../ecryptfs.html">ecryptfs</a></li>
<li><a href="../ecryptfs/beliebigen_ordner_verschlüsseln.html">Beliebigen Ordner verschlüsseln</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>