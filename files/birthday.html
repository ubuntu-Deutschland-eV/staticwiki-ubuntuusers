<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>birthday › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./birthday.html">birthday</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/birthday">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./birthday/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./birthday/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./birthday/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./birthday/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./birthday/a/backlinks.html">birthday</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./versteckte_dateien.html">Versteckte Dateien</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./autostart.html">Automatischer Start von Programmen</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Benutzung">Benutzung
</a></li><li><a class="crosslink" href="#Tipps">Tipps
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/terminal.png" class="image-left" src="./_/e81889fd6e485dd32e1cde611eabc18abced7993.png"/>
<a class="interwiki interwiki-sourceforge" href="http://sourceforge.net/projects/birthday">birthday</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein Kommandozeilen-Programm, das an Geburtstage oder andere Ereignisse erinnert und diese auf der Kommandozeile (auf Wunsch auch in einem textbasierten Kalender) ausgibt. Bei Geburtstagen erfolgt die Ausgabe in Englisch, andere Ereignisse werden in der Sprache ausgegeben, die man bei der Eingabe verwendet hat.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Folgendes Paket muss installiert <sup><a href="#source-1">[1]</a></sup> werden:
</p><ul><li><p><strong>birthday</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install birthday </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install birthday </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Benutzung">Benutzung<a class="headerlink" href="#Benutzung">¶</a></h2><p>
Die allgemeine Syntax sieht wie folgt aus <sup><a href="#source-2">[2]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">birthday [OPTIONEN] </pre></div></div><p>
Da das Programm in der Voreinstellung Einträge aus der versteckten Datei <sup><a href="#source-3">[3]</a></sup> <strong>~/.birthdays</strong> liest, muss diese zuerst angelegt werden. Mit einem Editor <sup><a href="#source-4">[4]</a></sup> können Geburtstage oder andere Ereignisse eingetragen werden. Ein einfacher Eintrag für eine Geburtstagserinnerung kann folgendermaßen aussehen:</p><pre class="notranslate">Max Mustermann=25/10/1998</pre><p>
Der anschließende Aufruf von</p><div class="bash"><div class="contents"><pre class="notranslate">birthday </pre></div></div><p>
im Terminal erzeugt am 05.10.2011 folgende Ausgabe:</p><pre class="notranslate">Max Mustermann is 13 years old in 2 weeks and 6 days' time.</pre><div class="section_2"><h3 id="Optionen">Optionen<a class="headerlink" href="#Optionen">¶</a></h3><p>
Wie oben bereits erwähnt, kennt birthday einige Optionen, die hier aufgeführt werden.</p><p>
</p><table><tr class="titel"><td colspan="2"> Programmoptionen </td></tr><tr class="kopf"><td> Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-w</code> </td><td> Listet die bevorstehenden Ereignisse auf </td></tr><tr><td> <code class="notranslate">-c</code> </td><td> Zeigt die Kalenderansicht </td></tr><tr><td style="width: 15%"><code class="notranslate">-f file</code> </td><td> Liest die Ereignisse aus der Datei <code class="notranslate">file</code> anstatt aus <strong>~/.birthdays</strong>. Die Datei <code class="notranslate">file</code> sollte in diesem Fall mit absolutem Pfad angegeben werden. </td></tr></table><p>
Mehr zu den Optionen von birthday erfährt man in der <a class="internal" href="./man.html">Manpage</a>.</p></div><div class="section_2"><h3 id="Format-Datendatei">Format Datendatei<a class="headerlink" href="#Format-Datendatei">¶</a></h3><p>
Jede Zeile in der Datei <strong>~/.birthdays</strong>, die mit einer Raute (<code class="notranslate">#</code>) beginnt, ist ein Kommentar und wird nicht beachtet. Jede andere Zeile besteht aus dem Namen, einer Person oder eines Ereignisses, gefolgt von einem Gleichheitszeichen (<code class="notranslate">=</code>) und einem Datum in der Form <code class="notranslate">TT/MM</code> oder <code class="notranslate">TT/MM/JJJJ</code> (<code class="notranslate">TT, MM</code>: Tag/Monat zweistellig; <code class="notranslate">JJJJ</code>: Jahr, vierstellig). Zum Schluss folgt ein Kürzel, das die Art des Ereignisses beschreibt.</p><p>
</p><table><tr class="titel"><td colspan="3"> Optionen innerhalb der Datendatei </td></tr><tr class="kopf"><td> Kürzel </td><td> Beschreibung </td><td> Beispiel </td></tr><tr><td> <code class="notranslate">bd</code> </td><td> Diese Zeile ist ein Geburtstag (Standard). Das Jahr sollte das Jahr der Geburt sein. </td><td> <code class="notranslate">Max Mustermann=25/10/1998 bd</code> </td></tr><tr><td> <code class="notranslate">ann</code> </td><td> Diese Zeile ist ein Jahrestag. </td><td> <code class="notranslate">Hochzeitstag=25/10/2011 ann</code> </td></tr><tr><td> <code class="notranslate">ev</code> </td><td> Diese Zeile ist ein Ereignis irgend einer Art. Wenn das Jahr angegeben wird, wird das Ereignis nur in diesem Jahr angezeigt, ansonsten jedes Jahr. </td><td> <code class="notranslate">Konzert=25/10/2011 ev</code> </td></tr><tr><td> <code class="notranslate">w[x]</code> </td><td> Warnt x Tage im voraus. Voreinstellung: 21 Tage. </td><td> <code class="notranslate">Hochzeitstag=25/10/2011 ann w10</code> </td></tr><tr><td> <code class="notranslate">to[x]</code> </td><td> Das Ereignis dauert bis Datum x. Das angegebene Datum sollte das selbe Format wie das Datum des Ereignisses haben. </td><td> <code class="notranslate">GP Deutschland=25/10/2011 ev to28/10/2011</code> </td></tr><tr><td> <code class="notranslate">for[x]</code> </td><td> Das Ereignis dauert x Tage. </td><td> <code class="notranslate">GP Deutschland=25/10/2011 ev for3</code> </td></tr></table></div><div class="section_2"><h3 id="Automatische-Anzeige-der-Ereignisse-nach-dem-Anmelden">Automatische Anzeige der Ereignisse nach dem Anmelden<a class="headerlink" href="#Automatische-Anzeige-der-Ereignisse-nach-dem-Anmelden">¶</a></h3><p>
</p><div class="section_3"><h4 id="Methode-1">Methode 1<a class="headerlink" href="#Methode-1">¶</a></h4><p>
Man legt einen Eintrag im Autostart <sup><a href="#source-5">[5]</a></sup> an und trägt als Befehl folgendes ein:
</p><div class="bash"><div class="contents"><pre class="notranslate">x-terminal-emulator -e "bash -c '/usr/bin/birthday; read'" </pre></div></div><p>Nun öffnet sich nach dem Anmelden am Desktop das jeweilige Standard-Terminalprogramm und zeigt die anstehenden Ereignisse an. Durch Drücken der Taste 
<span class="key">⏎</span>  wird das Terminalfenster geschlossen.</p><p><img alt="./birthday_notify.png" class="image-right" src="./_/4d854a972d6d2c16d2dd2b809e6c0f3c1c85f5e1.png"/>
</p></div><div class="section_3"><h4 id="Methode-2">Methode 2<a class="headerlink" href="#Methode-2">¶</a></h4><p>
Man lässt sich die Ereignisse über den <a class="internal" href="./benachrichtigungsdienst.html">Benachrichtigungsdienst</a> anzeigen. Dazu muss das folgende Paket installiert werden <sup><a href="#source-1">[1]</a></sup>:
</p><ul><li><p><strong>libnotify-bin</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libnotify-bin </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install libnotify-bin </pre></div></div><p>
</p></div></div><p>Entweder man legt einen Eintrag im Autostart an und trägt folgenden Befehl ein:
</p><div class="bash"><div class="contents"><pre class="notranslate">bash -c '/usr/bin/notify-send -t 0 "Geburtstage" "$(/usr/bin/birthday)"' </pre></div></div><p>Oder man erstellt sich ein Skript unter <strong>/usr/local/bin</strong> mit folgendem Inhalt:
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">OUTPUT</span><span class="o">=</span><span class="k">$(</span>/usr/bin/birthday<span class="k">)</span>
/usr/bin/notify-send -t <span class="m">0</span> <span class="s2">"Geburtstage"</span> <span class="s2">"</span><span class="nv">$OUTPUT</span><span class="s2">"</span>
</pre></div>
</td></tr></table></div><p>speichert es z.B. unter dem Namen <strong>birthday_notification.sh</strong> und macht es ausführbar:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo chmod +x /usr/local/bin/birthday_notification.sh </pre></div></div><p>Nun legt man einen Eintrag im Autostart an und trägt als Befehl folgendes ein: <code class="notranslate">/usr/local/bin/birthday_notification.sh</code></p><p>Nach dem Anmelden werden die Ereignisse nun über den Benachrichtigungsdienst angezeigt. Falls man das automatische Schließen der Anzeige bevorzugt, kann man <code class="notranslate">-t 0</code> weglassen.</p></div></div></div><div class="section_1"><h2 id="Tipps">Tipps<a class="headerlink" href="#Tipps">¶</a></h2><p>
Hat man mehrere Ereignisse an einem Tag und möchte, dass diese in chronologischer statt in alphabetischer Reihenfolge angezeigt werden, so kann man diese Einträge folgendermaßen gestalten</p><pre class="notranslate">18:00 Uhr Konzert=08/10/2011 ev
14:00 Uhr Probe=08/10/2011 ev
20:00 Uhr Konzert=08/10/2011 ev
15:00 Uhr Probe=08/10/2011 ev
12:00 Uhr Lesung=08/10/2011 ev</pre><p>Die Ausgabe sähe dann so aus:
</p><pre class="notranslate">12:00 Uhr Lesung in 2 days' time.
14:00 Uhr Probe in 2 days' time.
15:00 Uhr Probe in 2 days' time.
18:00 Uhr Konzert in 2 days' time.
20:00 Uhr Konzert in 2 days' time.</pre><div class="section_2"><div class="section_3"><h4 id="Deutsche-bersetzung">Deutsche Übersetzung<a class="headerlink" href="#Deutsche-bersetzung">¶</a></h4><p>
Wer eine deutschsprachige Version des Programms haben möchte, kann sich den Quellcode herunterladen:</p><div class="bash"><div class="contents"><pre class="notranslate">apt-get source birthday </pre></div></div><p>
Siehe auch <a class="internal" href="./apt-get.html#Kompilieren-mit-apt-get">apt-get</a>. Danach muss der Inhalt der Datei  <strong>bdengine.c</strong> mit dem folgenden ersetzt werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="cm">/*</span>
<span class="cm">   birthday.c</span>

<span class="cm">   Birthday/Anniversary display on login</span>

<span class="cm">   (c) 1996 AS Mortimer</span>

<span class="cm">    This program is free software; you can redistribute it and/or</span>
<span class="cm">    modify it under the terms of the GNU General Public License as</span>
<span class="cm">    published by the Free Software Foundation; either version 2 of the</span>
<span class="cm">    License, or (at your option) any later version.  You may also</span>
<span class="cm">    distribute it under the Artistic License, as comes with Perl.</span>

<span class="cm">    This program is distributed in the hope that it will be useful,</span>
<span class="cm">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>

<span class="cm">    You should have received a copy of the GNU General Public License</span>
<span class="cm">    along with this program; if not, write to the Free Software</span>
<span class="cm">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>

<span class="cm">    You should also have recieved a copy of the Artistic license with</span>
<span class="cm">    this program.</span>

<span class="cm">   $Id: bdengine.c,v 1.4 2006/01/10 17:27:53 andymort Exp $</span>
<span class="cm">   </span>
<span class="cm">   We're getting there. At the moment, the file used by default is ~/.birthdays</span>
<span class="cm">   under UNIX, or C:\PERSONAL\BDAYS.LST under DOS, but this can be overridden on</span>
<span class="cm">   the command line. The file has the following format:</span>

<span class="cm">   name/event/whatever=date flags</span>
<span class="cm">   where:</span>
<span class="cm">     date is dd/mm, dd/mm/yy (assumes 20th century!) or dd/mm/yyyy</span>
<span class="cm">     flags is ONE or ZERO of </span>
<span class="cm">       o  bd  for a birthday (default)</span>
<span class="cm">       o  bir for a birthday (exactly equivalent to `bd')</span>
<span class="cm">       o  ann for an anniversary</span>
<span class="cm">       o  ev  for an event</span>
<span class="cm">     and zero or more of</span>
<span class="cm">       o  w&lt;n&gt; to set the warn-in-advance time to n days (don't include the</span>
<span class="cm">	 brackets! :)</span>
<span class="cm">       o  to&lt;date&gt;</span>
<span class="cm">       o  for&lt;days&gt;</span>
<span class="cm">               to specify the length of time taken by an event, for example a</span>
<span class="cm">	       holiday.</span>

<span class="cm">     Comment lines are preceeded by #.</span>
<span class="cm">     </span>
<span class="cm">     Note: If you deviate from this format, I cannot guarantee anything about</span>
<span class="cm">     it's behaviour. In most cases, it will just quietly ignore the error,</span>
<span class="cm">     which probably isn't ideal behaviour. Oh, well.</span>

<span class="cm">     2003/05/20: Automatic reallocation of output buffer in listsrings() by</span>
<span class="cm">                 Sebastian Schmidt &lt;yath@yath.eu.org&gt;.</span>

<span class="cm">*/</span>

<span class="cm">/* ========== */</span>

<span class="cp">#include</span> <span class="cpf">"birthday.h"</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdarg.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="cp">#ifdef UNIX</span>
<span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;pwd.h&gt;</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cm">/* ========== */</span>

<span class="kt">int</span> <span class="nf">skptok</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">evcmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">e2</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">deffname</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="nf">dir_include</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">parm</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">);</span>

<span class="cm">/* ========== Global variables */</span>

<span class="kt">int</span> <span class="n">iDWarn</span>   <span class="o">=</span> <span class="n">DEF_WARN</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">iMaxWarn</span> <span class="o">=</span> <span class="n">MAX_WARN</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">iMinWarn</span> <span class="o">=</span> <span class="n">MIN_WARN</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="n">MLENDAT</span><span class="p">[]</span><span class="o">=</span><span class="p">{</span><span class="mi">31</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">_ftable</span> <span class="n">FTABLE</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="p">{</span><span class="s">"bir"</span><span class="p">,</span><span class="n">F_TBIRTHDAY</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"bd"</span><span class="p">,</span> <span class="n">F_TBIRTHDAY</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"ann"</span><span class="p">,</span><span class="n">F_TANNIVERSARY</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"ev"</span><span class="p">,</span> <span class="n">F_TEVENT</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"mes"</span><span class="p">,</span> <span class="n">F_TMESSAGE</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"w"</span><span class="p">,</span>  <span class="n">F_WTIME_P</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"to"</span><span class="p">,</span> <span class="n">F_TODATE</span><span class="p">},</span>
  <span class="p">{</span><span class="s">"for"</span><span class="p">,</span> <span class="n">F_FORDAYS</span><span class="p">},</span>
  <span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#ifdef NUMS_AS_WORDS</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">NUMBERS</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">"null"</span><span class="p">,</span><span class="s">"eins"</span><span class="p">,</span><span class="s">"zwei"</span><span class="p">,</span><span class="s">"drei"</span><span class="p">,</span><span class="s">"vier"</span><span class="p">,</span><span class="s">"fünf"</span><span class="p">,</span><span class="s">"sechs"</span><span class="p">,</span><span class="s">"sieben"</span><span class="p">,</span><span class="s">"acht"</span><span class="p">,</span><span class="s">"neun"</span><span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/* list of directives. These are entered in the file prefixed by '&amp;'. The function should be declared as</span>
<span class="cm">   	struct event *dir_func(char *directive, char *parameters);</span>
<span class="cm">   and should return a pointer to a NULL-terminated list of extra records, or NULL if there are none.</span>
<span class="cm">   This structure will allow us to dynamically add directives, if we wish to do so in the future.</span>
<span class="cm">   */</span>

<span class="k">struct</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">text</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">func</span><span class="p">)(</span><span class="kt">char</span><span class="o">*</span><span class="p">,</span><span class="kt">char</span><span class="o">*</span><span class="p">,</span><span class="k">const</span> <span class="k">struct</span> <span class="n">date</span><span class="o">*</span><span class="p">);</span>
<span class="p">}</span> <span class="n">directlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span> <span class="s">"include"</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dir_include</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* ========== */</span>

<span class="cm">/* compare the first strlen(a) characters of a and b */</span>
<span class="cp">#define strbegcmp(a,b) strncmp(a,b,strlen(a))</span>

<span class="cm">/* like strcat(), but lets the buffer automagically grow :-)</span>
<span class="cm"> * (needs local variable "size" with the buffer size) */</span>
<span class="cp">#define append(where, what) do {				    \</span>
<span class="cp">    if (strlen(what) &gt; (size - strlen(where) - 1)) {		    \</span>
<span class="cp">      where = xrealloc(where, size + 128 + strlen(what));	    \</span>
<span class="cp">      size += 128 + strlen(what);				    \</span>
<span class="cp">    }								    \</span>
<span class="cp">    strcat(where, what);					    \</span>
<span class="cp">  } while(0)</span>

<span class="cm">/* ========== */</span>

<span class="cm">/* returns delta(d) in days, weeks, months, etc</span>
<span class="cm"> * the returned buffer is malloc()ed, do not forget to free() it */</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">tdelta</span><span class="p">(</span><span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">dy</span><span class="p">,</span> <span class="n">wk</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">yr</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">xmalloc</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
  <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">switch</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">today</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
    <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"heute"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
    <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"morgen"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
  <span class="k">default</span><span class="o">:</span>
    <span class="cm">/* like delta(), we ignore the year */</span>
    <span class="n">yr</span><span class="o">=-</span><span class="n">before</span><span class="p">(</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="o">*</span><span class="n">today</span><span class="p">);</span>
    <span class="n">mn</span><span class="o">=</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">month</span> <span class="o">-</span> <span class="n">today</span><span class="o">-&gt;</span><span class="n">month</span><span class="p">;</span>
    <span class="n">dy</span><span class="o">=</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">day</span> <span class="o">-</span> <span class="n">today</span><span class="o">-&gt;</span><span class="n">day</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">dy</span> <span class="o">+=</span> <span class="n">mlen</span><span class="p">(</span><span class="n">today</span><span class="o">-&gt;</span><span class="n">month</span><span class="p">,</span> <span class="n">today</span><span class="o">-&gt;</span><span class="n">year</span><span class="p">);</span>
      <span class="n">mn</span><span class="o">--</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">mn</span> <span class="o">+=</span> <span class="mi">12</span><span class="p">;</span>
      <span class="n">yr</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">wk</span> <span class="o">=</span> <span class="p">(</span><span class="n">dy</span><span class="o">/</span><span class="mi">7</span><span class="p">);</span>
    <span class="n">dy</span><span class="o">%=</span><span class="mi">7</span><span class="p">;</span>
    
    <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"in "</span><span class="p">);</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">ttime</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">wk</span><span class="p">,</span> <span class="n">dy</span><span class="p">);</span>
    <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="sc">' '</span><span class="p">)</span>
      <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>

    <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#ifdef NUMS_AS_WORDS</span>
<span class="cp">#define donum(n,txt) do {                          \</span>
<span class="cp">      if (n &gt; 1) {                                 \</span>
<span class="cp">         if (n &lt; 10) {                             \</span>
<span class="cp">            append(buf, NUMBERS[n]);               \</span>
<span class="cp">            append(buf, " " txt "");                  \</span>
<span class="cp">               if (n != 1) {                       \</span>
<span class="cp">                  append(buf, "");                \</span>
<span class="cp">               }                                   \</span>
<span class="cp">         } else {                                  \</span>
<span class="cp">            snprintf(tmp, sizeof(tmp), "%d", n);	\</span>
<span class="cp">            append(buf, tmp);                      \</span>
<span class="cp">            append(buf, " " txt "");              \</span>
<span class="cp">         }                                         \</span>
<span class="cp">         terms--;                                  \</span>
<span class="cp">         if (orgterms &gt; 1) {                       \</span>
<span class="cp">	         if (terms == 1)                        \</span>
<span class="cp">               append(buf, " und ");               \</span>
<span class="cp">            else if (terms &gt; 1)                    \</span>
<span class="cp">               append(buf, ", ");                  \</span>
<span class="cp">         }                                         \</span>
<span class="cp">      }                                            \</span>
<span class="cp">   } while(0)</span>
<span class="cp">#else </span><span class="cm">/* NUMS_AS_WORDS */</span><span class="cp"></span>
<span class="cp">#define donum(n,txt) do {                       \</span>
<span class="cp">      if (n &gt; 0) {                              \</span>
<span class="cp">         snprintf(tmp, sizeof(tmp), "%d", n);   \</span>
<span class="cp">         append(buf, tmp);                      \</span>
<span class="cp">         append(buf, " " txt "");                  \</span>
<span class="cp">         if (n != 1)                            \</span>
<span class="cp">            append(buf, "e");                   \</span>
<span class="cp">         terms--;                               \</span>
<span class="cp">         if (orgterms &gt; 1) {                    \</span>
<span class="cp">            if (terms == 1)                     \</span>
<span class="cp">               append(buf, " und ");            \</span>
<span class="cp">            else if (terms &gt; 1)                 \</span>
<span class="cp">               append(buf, ", ");               \</span>
<span class="cp">         }                                      \</span>
<span class="cp">      }                                         \</span>
<span class="cp">   } while(0)</span>
<span class="cp">#endif </span><span class="cm">/* NUMS_AS_WORDS */</span><span class="cp"></span>
<span class="cp">#ifdef NUMS_AS_WORDS</span>
<span class="cp">#define donumweek(n,txt) do {                          \</span>
<span class="cp">      if (n &gt; 1) {                                 \</span>
<span class="cp">         if (n &lt; 10) {                             \</span>
<span class="cp">            append(buf, NUMBERS[n]);               \</span>
<span class="cp">            append(buf, " " txt "");                  \</span>
<span class="cp">               if (n != 1) {                       \</span>
<span class="cp">                  append(buf, "");                \</span>
<span class="cp">               }                                   \</span>
<span class="cp">         } else {                                  \</span>
<span class="cp">            snprintf(tmp, sizeof(tmp), "%d", n);	\</span>
<span class="cp">            append(buf, tmp);                      \</span>
<span class="cp">            append(buf, " " txt "");              \</span>
<span class="cp">         }                                         \</span>
<span class="cp">         terms--;                                  \</span>
<span class="cp">         if (orgterms &gt; 1) {                       \</span>
<span class="cp">	         if (terms == 1)                        \</span>
<span class="cp">               append(buf, " und ");               \</span>
<span class="cp">            else if (terms &gt; 1)                    \</span>
<span class="cp">               append(buf, ", ");                  \</span>
<span class="cp">         }                                         \</span>
<span class="cp">      }                                            \</span>
<span class="cp">   } while(0)</span>
<span class="cp">#else </span><span class="cm">/* NUMS_AS_WORDS */</span><span class="cp"></span>
<span class="cp">#define donumweek(n,txt) do {                       \</span>
<span class="cp">      if (n &gt; 0) {                              \</span>
<span class="cp">         snprintf(tmp, sizeof(tmp), "%d", n);   \</span>
<span class="cp">         append(buf, tmp);                      \</span>
<span class="cp">         append(buf, " " txt "");                  \</span>
<span class="cp">         if (n != 1)                            \</span>
<span class="cp">            append(buf, "n");                   \</span>
<span class="cp">         terms--;                               \</span>
<span class="cp">         if (orgterms &gt; 1) {                    \</span>
<span class="cp">            if (terms == 1)                     \</span>
<span class="cp">               append(buf, " und ");            \</span>
<span class="cp">            else if (terms &gt; 1)                 \</span>
<span class="cp">               append(buf, ", ");               \</span>
<span class="cp">         }                                      \</span>
<span class="cp">      }                                         \</span>
<span class="cp">   } while(0)</span>
<span class="cp">#endif </span><span class="cm">/* NUMS_AS_WORDS */</span><span class="cp"></span>

<span class="cm">/* returns allocated buffer, don't forget to free() */</span>
<span class="kt">char</span> <span class="o">*</span><span class="nf">ttime</span><span class="p">(</span><span class="kt">int</span> <span class="n">yr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">wk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dy</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">xmalloc</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">terms</span><span class="p">,</span> <span class="n">orgterms</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
  
  <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* Initialize buffer */</span>
  <span class="n">terms</span> <span class="o">=</span> <span class="n">orgterms</span> <span class="o">=</span> <span class="p">(</span><span class="n">yr</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">mn</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">wk</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>

  <span class="n">donum</span><span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="s">"Jahr"</span><span class="p">);</span>
  <span class="n">donum</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="s">"Monat"</span><span class="p">);</span>
  <span class="n">donumweek</span><span class="p">(</span><span class="n">wk</span><span class="p">,</span> <span class="s">"Woche"</span><span class="p">);</span>
  <span class="n">donum</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="s">"Tag"</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#undef donum</span>

<span class="cm">/* lists the birthdays in their string format, one by one, and passes the string</span>
<span class="cm">   to a function. */</span>
<span class="kt">void</span> <span class="nf">liststrings</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">evl</span><span class="p">,</span> <span class="n">prnfunc</span> <span class="n">outf</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
   
   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buf</span> <span class="o">=</span> <span class="n">xmalloc</span><span class="p">(</span><span class="mi">128</span><span class="p">);</span>
      <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
      <span class="n">size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">warn</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">warnperiod</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tdelta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
            <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">warnperiod</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" für "</span><span class="p">);</span>
	         <span class="cm">/* +1 because, if the difference between two dates is one day,</span>
<span class="cm">	            then the length of an event on those days is two days */</span>
	    <span class="n">j</span> <span class="o">=</span> <span class="n">ddiff</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	         <span class="n">tmp</span> <span class="o">=</span> <span class="n">ttime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">j</span><span class="o">%</span><span class="mi">7</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
            <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tdelta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">warnperiod</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span><span class="p">);</span>
            <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" "</span><span class="p">);</span>
	    <span class="n">j</span> <span class="o">=</span> <span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>
	         <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
               <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"für "</span><span class="p">);</span>
	            <span class="n">tmp</span> <span class="o">=</span> <span class="n">ttime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="n">j</span><span class="o">%</span><span class="mi">7</span><span class="p">);</span>
               <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
               <span class="n">free</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>
               <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">" länger"</span><span class="p">);</span>
	         <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"heute beendet"</span><span class="p">);</span>
	         <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">append</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">""</span><span class="p">);</span>
         <span class="n">outf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">free</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kt">char</span> <span class="o">*</span>
<span class="nf">deffname</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(UNIX)</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

  <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="n">getpwuid</span><span class="p">(</span><span class="n">getuid</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">pw_dir</span><span class="p">);</span>
  <span class="n">strcat</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">"/"</span> <span class="n">DEFAULT_FILE</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">strdup</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
<span class="cp">#elif defined(DOS)</span>
  <span class="k">return</span> <span class="n">strdup</span><span class="p">(</span><span class="n">DOSDEFDIR</span> <span class="n">DEFAULT_FILE</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>
  
<span class="cm">/* sort the events by the time before the next time they come up, putting those</span>
<span class="cm">   where the start has passed but we are still in the time-period first */</span>
<span class="kt">int</span>
<span class="nf">evcmp</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">e1</span><span class="o">=</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">)</span><span class="n">p1</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">e2</span><span class="o">=</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">)</span><span class="n">p2</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">;</span>

  <span class="cm">/* if the delta for the enddate is less than that for the start date, then we</span>
<span class="cm">     have passed the start date but not yet the end date, and so we should</span>
<span class="cm">     display the enddate; otherwise, we should display the start date */</span>
  
  <span class="n">d1</span> <span class="o">=</span> <span class="n">e1</span><span class="o">-&gt;</span><span class="n">fromtoday</span><span class="p">;</span>
  <span class="n">d2</span> <span class="o">=</span> <span class="n">e2</span><span class="o">-&gt;</span><span class="n">fromtoday</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">d1</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">d1</span> <span class="o">&gt;</span> <span class="n">d2</span><span class="p">)</span> <span class="k">return</span>  <span class="mi">1</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">e1</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">,</span> <span class="n">e2</span><span class="o">-&gt;</span><span class="n">text</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* difference in days between two dates */</span>
<span class="cm">/* it is assumed that D1 &lt; D2, and so the result is always positive */</span>

<span class="kt">unsigned</span> <span class="nf">ddiff</span><span class="p">(</span><span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">D1</span><span class="p">,</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">D2</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">date</span> <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">dd</span><span class="p">,</span><span class="n">m</span><span class="p">;</span>

  <span class="cm">/* make working copies */</span>
  <span class="n">d1</span><span class="o">=*</span><span class="n">D1</span><span class="p">;</span>
  <span class="n">d2</span><span class="o">=*</span><span class="n">D2</span><span class="p">;</span>
  
  <span class="cm">/* sort out zero years */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">before</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">))</span>
	  <span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="p">;</span>
	<span class="k">else</span>
	  <span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">before</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">))</span>
	  <span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="p">;</span>
	<span class="k">else</span>
	  <span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* both years zero */</span>
      <span class="cm">/* NB we do actually have to use today's year, to get leap years</span>
<span class="cm">	 right. */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">before</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">))</span>
	<span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">today</span><span class="o">-&gt;</span><span class="n">year</span><span class="p">;</span>
      <span class="k">else</span> <span class="p">{</span>
	<span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">today</span><span class="o">-&gt;</span><span class="n">year</span><span class="p">;</span>
	<span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="cm">/* now we can actually do the comparison ... */</span>
  <span class="n">dd</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  
  <span class="cm">/* to start with, we work in months */</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">d1</span><span class="p">.</span><span class="n">month</span><span class="p">;</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">.</span><span class="n">month</span> <span class="o">+</span> <span class="p">(</span><span class="n">d2</span><span class="p">.</span><span class="n">year</span><span class="o">-</span><span class="n">d1</span><span class="p">.</span><span class="n">year</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">;</span> <span class="n">m</span><span class="o">++</span><span class="p">)</span>
    <span class="n">dd</span> <span class="o">+=</span> <span class="n">mlen</span><span class="p">(((</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">d1</span><span class="p">.</span><span class="n">year</span> <span class="o">+</span> <span class="n">m</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span>

  <span class="cm">/* and then we renormalise for the days within the months */</span>
  <span class="cm">/* the first month was included in our calculations */</span>
  <span class="n">dd</span> <span class="o">-=</span> <span class="n">d1</span><span class="p">.</span><span class="n">day</span><span class="p">;</span>
  <span class="cm">/* but the last one wasn't */</span>
  <span class="n">dd</span> <span class="o">+=</span> <span class="n">d2</span><span class="p">.</span><span class="n">day</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">dd</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* actually until the next anniversary of ... */</span>
<span class="kt">unsigned</span> <span class="nf">delta</span><span class="p">(</span><span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">date</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">date</span> <span class="n">d</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">dt</span><span class="p">,</span> <span class="n">mn</span><span class="p">;</span>
  
  <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">date</span><span class="p">));</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">before</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">))</span> <span class="cm">/* past the end of the year */</span>
    <span class="p">{</span>
      <span class="n">d</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">d</span><span class="p">.</span><span class="n">year</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    
  <span class="k">for</span> <span class="p">(</span><span class="n">mn</span> <span class="o">=</span> <span class="n">today</span><span class="o">-&gt;</span><span class="n">month</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">mn</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">month</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">d</span><span class="p">.</span><span class="n">year</span><span class="p">;</span> <span class="n">mn</span><span class="o">++</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">+=</span> <span class="n">mlen</span><span class="p">(((</span><span class="n">mn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span><span class="n">today</span><span class="o">-&gt;</span><span class="n">year</span> <span class="o">+</span> <span class="n">mn</span><span class="o">/</span><span class="mi">12</span><span class="p">);</span>
  
  <span class="n">dt</span> <span class="o">-=</span> <span class="n">today</span><span class="o">-&gt;</span><span class="n">day</span><span class="p">;</span>
  <span class="n">dt</span> <span class="o">+=</span> <span class="n">d</span><span class="p">.</span><span class="n">day</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="n">dt</span><span class="p">;</span>  
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">scan_date</span><span class="p">(</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="s">"%d/%d/%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">date</span><span class="o">-&gt;</span><span class="n">day</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">date</span><span class="o">-&gt;</span><span class="n">month</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">date</span><span class="o">-&gt;</span><span class="n">year</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* didn't read the year */</span>
    <span class="n">date</span><span class="o">-&gt;</span><span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/* if our year is only two digits, add 1900 to it ... */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">date</span><span class="o">-&gt;</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="n">date</span><span class="o">-&gt;</span><span class="n">year</span><span class="o">+=</span><span class="mi">1900</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="nf">readlist</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">d</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">evl</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">],</span> <span class="n">buf2</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">flags</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">nevl</span><span class="p">;</span>
  <span class="cm">/* initialise */</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">fname</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fname</span><span class="o">=</span><span class="n">deffname</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">fname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'-'</span> <span class="o">&amp;&amp;</span> <span class="n">fname</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* read from stdin */</span>
    <span class="n">file</span><span class="o">=</span><span class="n">stdin</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/* now read it */</span>
    <span class="k">if</span><span class="p">((</span><span class="n">file</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">"rt"</span><span class="p">))</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">fatal</span><span class="p">(</span><span class="s">"Kann die Datei nicht öffnen </span><span class="se">\"</span><span class="s">%s</span><span class="se">\"\n</span><span class="s">"</span><span class="p">,</span> <span class="n">fname</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>


  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">evl</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span> <span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">file</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">evl</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">)</span> <span class="n">xrealloc</span><span class="p">(</span><span class="n">evl</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="sc">'#'</span> <span class="o">||</span> <span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="n">i</span><span class="o">--</span><span class="p">;</span>
	<span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="sc">'&amp;'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">buf</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">ptr</span><span class="o">=</span><span class="n">strchr</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="sc">' '</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ptr</span><span class="o">=</span><span class="n">strchr</span><span class="p">((</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="sc">'\t'</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">ptr</span><span class="o">=</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">strlen</span><span class="p">((</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
      <span class="p">}</span>

      <span class="o">*</span><span class="n">ptr</span><span class="o">++=</span><span class="mi">0</span><span class="p">;</span>
      <span class="n">nevl</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
      <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">text</span><span class="p">);</span>
	<span class="cm">/*</span>
<span class="cm">	  fprintf(stderr, "Checking against directive #%d, %s, which has length %d, against \"%s\" with length %d\n",</span>
<span class="cm">		j, directlist[j].text, directlist[j].len, buf+1, ptr-(buf+1)-1);</span>
<span class="cm">		*/</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">==</span> <span class="n">ptr</span><span class="o">-</span><span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">strncmp</span><span class="p">(</span><span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">text</span><span class="p">,(</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">))</span>
	  <span class="p">{</span>
	    <span class="n">nevl</span> <span class="o">=</span> <span class="n">directlist</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">func</span><span class="p">((</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ptr</span><span class="p">,</span><span class="n">today</span><span class="p">);</span>
	    <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	    <span class="k">break</span><span class="p">;</span>
	  <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="n">nevl</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">nevl</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">);</span>
	<span class="n">i</span><span class="o">+=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">evl</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">)</span> <span class="n">xrealloc</span><span class="p">(</span><span class="n">evl</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
	<span class="cm">/* in fact, this loop reverses the order of the elements, but we're going to sort them later anyway. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">nevl</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
	  <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="n">nevl</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"Warnung: unbekannte Anweisung </span><span class="se">\"</span><span class="s">%s</span><span class="se">\"</span><span class="s"> ignoriert.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="p">(</span><span class="n">buf</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
	<span class="n">i</span><span class="o">--</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* parse string in buf */</span> 
    <span class="n">ptr</span> <span class="o">=</span> <span class="n">strrchr</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="sc">'='</span><span class="p">);</span> <span class="cm">/* allow '=' in text */</span>
    <span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span> <span class="cm">/* not a valid line, so ignore it! Cool, huh? */</span>
      <span class="p">{</span>
	<span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"WARNUNG: Ungültige Zeile in Eingabedatei:</span><span class="se">\n</span><span class="s">%s"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
	<span class="n">i</span><span class="o">--</span><span class="p">;</span>
	<span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      
    <span class="o">*</span><span class="p">(</span><span class="n">ptr</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  

    <span class="n">scan_date</span><span class="p">(</span> <span class="n">ptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">)</span> <span class="p">);</span>

    <span class="cm">/* parse flags */</span>

    <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">warn</span><span class="o">=</span><span class="n">iDWarn</span><span class="p">;</span>
    <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span><span class="o">=</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span><span class="o">=</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

    <span class="n">flags</span><span class="o">=</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="n">skptok</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">ptr</span><span class="p">),</span><span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">FTABLE</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">txt</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">strncmp</span><span class="p">(</span><span class="n">FTABLE</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">txt</span><span class="p">,</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">FTABLE</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">txt</span><span class="p">));</span> <span class="n">k</span><span class="o">++</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">FTABLE</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">flag</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="nl">F_WTIME_P</span><span class="p">:</span> <span class="cm">/* w&lt;n&gt; -- sets warning time */</span>
	  <span class="n">sscanf</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="s">"w %u"</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">warn</span><span class="p">));</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="nl">F_FORDAYS</span><span class="p">:</span> <span class="cm">/* for&lt;days&gt; -- sets the duration of the event */</span>
	  <span class="n">sscanf</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="s">"für %d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="p">);</span>
	  <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="o">=</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">;</span>
	  <span class="k">for</span> <span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">;</span> <span class="n">l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span><span class="o">++</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span> <span class="o">&gt;</span> <span class="n">mlen</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span><span class="p">,</span>
					  <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="p">))</span> <span class="p">{</span>
	      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span><span class="o">++</span><span class="p">;</span>
	      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
	      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="o">++</span><span class="p">;</span>
	      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	  <span class="p">}</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="nl">F_TODATE</span><span class="p">:</span>
	  <span class="n">l</span> <span class="o">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">j</span><span class="p">,</span> <span class="s">"zu %u/%u/%u"</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">month</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="p">));</span>
	  <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="o">+=</span><span class="mi">1900</span><span class="p">;</span>
	  <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="k">default</span><span class="o">:</span>
	  <span class="n">flags</span><span class="o">|=</span><span class="n">FTABLE</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">flag</span><span class="p">;</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
      <span class="p">}</span>

    <span class="cm">/* construct event text */</span>

    <span class="k">switch</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">F_MTYPE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nl">F_TBIRTHDAY</span><span class="p">:</span>
    <span class="k">default</span><span class="o">:</span> <span class="cm">/* assume it's a birthday */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">tmp_age</span><span class="o">=</span><span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tmp_age</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	  <span class="n">sprintf</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="s">"%s wird %d Jahre "</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">tmp_age</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	  <span class="n">sprintf</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="s">"%s ist %d Jahre alt"</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">tmp_age</span><span class="p">);</span>
	<span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="s">"%s hat Geburtstag"</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">F_TANNIVERSARY</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="s">"%s vor %d Jahren"</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">F_TEVENT</span><span class="p">:</span>
      <span class="cm">/* if a year was specified, and this warning isn't for it, ignore! */</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">i</span><span class="o">--</span><span class="p">;</span>
	<span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nl">F_TMESSAGE</span><span class="p">:</span>
      <span class="cm">/* Like an event, except that it only comes up on the given date, and no text at all is appended */</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">year</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ydelta</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">,</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">i</span><span class="o">--</span><span class="p">;</span>
	<span class="k">continue</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">strcpy</span><span class="p">(</span><span class="n">buf2</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">warn</span><span class="o">=-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* special code! */</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>      
    <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span> <span class="o">=</span> <span class="n">strdup</span><span class="p">(</span><span class="n">buf2</span><span class="p">);</span>

    <span class="cm">/* precalculate the "priority", the time until we next need to</span>
<span class="cm">       display something about this event. */</span>
    <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="n">d</span><span class="p">;</span>
      <span class="n">d</span><span class="o">=</span><span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">.</span><span class="n">day</span> <span class="o">&amp;&amp;</span> <span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">),</span> <span class="n">today</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span>
	<span class="n">d</span><span class="o">=</span><span class="n">delta</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enddate</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>
      <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fromtoday</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">evl</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="p">)</span> <span class="n">xrealloc</span><span class="p">(</span><span class="n">evl</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
  <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">day</span><span class="o">=</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">month</span><span class="o">=</span><span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">date</span><span class="p">.</span><span class="n">year</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">evl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">;</span>

  <span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">fname</span><span class="p">);</span>

  <span class="cm">/* NB uses i from above */</span>
  <span class="n">qsort</span><span class="p">(</span><span class="n">evl</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">event</span><span class="p">),</span> <span class="n">evcmp</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">evl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">skptok</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>  <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">' '</span> <span class="o">&amp;&amp;</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'\t'</span> <span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(;</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="sc">' '</span> <span class="o">||</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\t'</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="n">j</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ---------------------------------------------------------------------- */</span>
<span class="cm">/* Functions to parse input file directives */</span>
<span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="nf">dir_include</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">parm</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">date</span> <span class="o">*</span><span class="n">today</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">struct</span> <span class="n">event</span> <span class="o">*</span><span class="n">evl</span><span class="p">;</span>

  <span class="n">evl</span><span class="o">=</span><span class="n">readlist</span><span class="p">(</span><span class="n">strdup</span><span class="p">(</span><span class="n">parm</span><span class="p">),</span> <span class="n">today</span><span class="p">);</span>

  <span class="k">return</span> <span class="n">evl</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div><p>
Mit </p><div class="bash"><div class="contents"><pre class="notranslate">make
sudo make install  </pre></div></div><p>
wird der Quelltext dann <a class="internal" href="./programme_kompilieren.html">kompiliert</a> und installiert. Um einem Update vorzubeugen, kann <a class="internal" href="./apt-pinning.html">Apt-Pinning</a> genutzt werden.</p></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-sourceforge" href="http://sourceforge.net/projects/birthday">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="internal" href="./when.html">when</a> - Terminkalender für die Konsole</p></li><li><p><a class="internal" href="./osmo.html">Osmo</a> - grafischer Terminkalender, der bei Geburtstagen benachrichtigen kann</p></li><li><p><a class="interwiki interwiki-sourceforge2" href="http://gbirthday.sourceforge.net">GBirthday</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - GTK-Panel-Applet, in den offiziellen Paketquellen enthalten</p></li><li><p><a class="external" href="http://www.elmar-baumann.de/Birthdays/" rel="nofollow">JBirthdays</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - weitere grafische Alternative auf Basis von Java 7</p></li><li><p><a class="external" href="http://changelogs.ubuntu.com/changelogs/pool/universe/b/birthday/birthday_1.6.2-3/changelog" rel="nofollow">Changelog</a> Versionshistorie des Programms bei Ubuntu.com <img alt="{us}" src="./_/36152d62b7197ebd79bc885a8a2614445933cf09.png"/> </p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./birthday/a/revision/938768.html">Diese Revision</a> wurde am 2. Mai 2017 09:16 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./birthday.html">birthday</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>