<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>BorgBackup › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./borgbackup.html">BorgBackup</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/BorgBackup">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./borgbackup/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./borgbackup/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./borgbackup/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./borgbackup/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./borgbackup/a/backlinks.html">BorgBackup</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./artful_aardvark.html">Ubuntu 17.10</a> Artful Aardvark</p></li><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./sudo.html">Ein Programm mit Root-Rechten ausführen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./verzeichnisstruktur.html">Umgang mit Dateipfaden</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Standalone-Binary">Standalone Binary
</a></li></ol></li><li><a class="crosslink" href="#Benutzung">Benutzung
</a><ol class="arabic"><li><a class="crosslink" href="#Initialisierung">Initialisierung
</a></li><li><a class="crosslink" href="#Anlegen-von-Archiven">Anlegen von Archiven
</a></li><li><a class="crosslink" href="#Wiederherstellen-von-Daten">Wiederherstellen von Daten
</a></li><li><a class="crosslink" href="#Automatisches-Loeschen-von-Archiven">Automatisches Löschen von Archiven
</a></li><li><a class="crosslink" href="#Anlegen-von-Sicherungen-mittels-SSH">Anlegen von Sicherungen mittels SSH
</a></li><li><a class="crosslink" href="#Weitere-Borg-Befehle">Weitere Borg-Befehle
</a></li><li><a class="crosslink" href="#Skriptvorlage-BorgBackup">Skriptvorlage BorgBackup
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="logo.png" class="image-left" src="./_/926071a2b338cb3d21aa194c409cd152b0e9f39a.png"/>
<a class="external" href="https://www.borgbackup.org/" rel="nofollow">BorgBackup</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> (Borg) ist eine <a class="internal" href="./datensicherung.html">Datensicherungssoftware</a>, die eine sehr platzsparende und schnelle inkrementelle Archivierung ermöglicht. Alle Archive werden dabei an einem gemeinsamen Speicherort (Repository) abgelegt. Dieser kann sich sowohl auf dem lokalen System, als auch auf einem entfernten Rechner oder Laufwerk befinden. Borg hat weder eine grafische Oberfläche noch eine Konfigurationsdatei und wird allein über die Kommandozeile gesteuert. Mit Hilfe von Skripten kann das Backup aber sehr einfach automatisiert werden. Borg ist eine Weiterentwicklung (Fork) des Programms <a class="external" href="https://attic-backup.org/" rel="nofollow">Attic</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p><p>Besondere Eigenschaften:
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Deduplikation">Deduplikation</a></p></li><li><p>Authentifizierte Verschlüsselung möglich (AES)</p></li><li><p>Auswahl zwischen mehreren Kompressionsmethoden (lz4, zlib, lzma)</p></li><li><p>Unterstützung des <a class="internal" href="./ssh.html">SSH</a>-Protokolls für die Sicherung auf entfernten Rechnern</p></li><li><p>Unabhängig vom Dateisystem des Speicherorts</p></li></ul><p>
Borg unterscheidet sich von anderen Backupprogrammen vor allem durch die für die Deduplikation eingesetzte Technik. Hierbei werden alle Dateien in kleine Stücke (Chunks) zerlegt und mit den bereits vorhanden Chunks im Repository verglichen. Daher werden immer nur solche Daten gespeichert, die bisher noch nicht im Repository vorhanden sind. Die Deduplizierung ist bei Borg nicht auf die Dateiebene beschränkt, wie das z.B. bei <a class="internal" href="./back_in_time.html">Back In Time</a> der Fall ist. Dadurch entsteht ein entscheidender Vorteil bei kleinen Änderungen an sehr großen Dateien (z.B. Abbilder von virtuellen Maschinen oder Laufwerken). Diese müssen nicht insgesamt neu gespeichert werden, sondern es werden immer nur die veränderten Chunks neu abgelegt. Auch beim Verschieben von Dateien im Dateisystem oder bei mehrfachem Vorhandensein sehr ähnlicher Daten (z.B. mehrerer virtueller Maschinen) wirkt sich diese Form der Deduplikation positiv auf den benötigten Speicherplatz aus.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Borg ist seit <a class="internal" href="./xenial.html">Ubuntu 16.04</a> Bestandteil der offiziellen Paketquellen. Die Installation erfolgt über das Paket <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>borgbackup</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install borgbackup </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install borgbackup </pre></div></div><p>
</p></div></div><div class="section_2"><h3 id="Standalone-Binary">Standalone Binary<a class="headerlink" href="#Standalone-Binary">¶</a></h3><p>
Alternativ zu offiziellen Paketquellen können auch <a class="external" href="http://borgbackup.readthedocs.io/en/stable/installation.html#pyinstaller-binary" rel="nofollow">Standalone Binarys</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> genutzt werden. Dazu lädt man das gewünschte Binary mit dem Namen <strong>borg-linux32</strong> oder <strong>borg-linux64</strong> (je nach Systemarchitektur) von der <a class="interwiki interwiki-github" href="https://github.com/borgbackup/borg/releases">Release-Seite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> herunter und installiert sie wie folgt <sup><a href="#source-2">[2]</a></sup>:</p><ul><li><p>32-Bit: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cp borg-linux32 /usr/local/bin/borg
sudo chown root:root /usr/local/bin/borg
sudo chmod 755 /usr/local/bin/borg </pre></div></div></li><li><p>64-Bit: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cp borg-linux64 /usr/local/bin/borg
sudo chown root:root /usr/local/bin/borg
sudo chmod 755 /usr/local/bin/borg </pre></div></div></li></ul><p>
Vorteil: hierüber erhält man auch neuere Versionen als in den offiziellen Paketquellen verfügbar. Nachteil: um Updates muss man sich selbst kümmern.</p></div></div><div class="section_1"><h2 id="Benutzung">Benutzung<a class="headerlink" href="#Benutzung">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Borg muss nicht unbedingt mit Administrator- bzw. Root-Rechten ausgeführt werden. Hat der Nutzer jedoch kein Schreibrecht auf den Speicherort oder kein Leserecht für alle zu sichernden Dateien, muss den folgenden Befehlen ggf. ein <code class="notranslate">sudo</code> <sup><a href="#source-3">[3]</a></sup> vorangestellt werden.
</p></div></div><div class="section_2"><h3 id="Initialisierung">Initialisierung<a class="headerlink" href="#Initialisierung">¶</a></h3><p>
Bevor Backups in Archiven gespeichert werden können, muss mit Hilfe des Terminals ein Repository angelegt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir REPO_VERZEICHNISPFAD
borg init [OPTIONEN] REPO_VERZEICHNISPFAD </pre></div></div><p><code class="notranslate">REPO_VERZEICHNISPFAD</code> gibt dabei den Pfad <sup><a href="#source-4">[4]</a></sup> zu einem leeren Verzeichnis an, in dem das Repository angelegt werden soll. Zu möglichen Optionen siehe nachfolgende Tabelle:</p><p>
</p><table><tr class="titel"><td colspan="2"> Wichtige Optionen für den init-Befehl </td></tr><tr class="kopf"><td>Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-h</code> oder <code class="notranslate">--help</code> </td><td> Ausgabe eines Hilfetextes </td></tr><tr><td> <code class="notranslate">-v</code> oder <code class="notranslate">--verbose</code> </td><td> Ausführlichere Ausgabe von Meldungen </td></tr><tr><td> <code class="notranslate">-e</code> oder <code class="notranslate">--encryption {none,keyfile,repokey}</code> </td><td> Wählt die Art der Verschlüsselung {keine, lokale Schlüsseldatei, Schlüsseldatei im Repository} </td></tr></table><p>Standard ist eine Verschlüsselung mit Ablage der Schlüsseldatei im Repository (repokey). Diese Datei wird dann über eine Passphrase gesichert. Befindet sich das Repository auf einem entfernten Rechner und will man die Sicherheit erhöhen, kann man die Schlüsseldatei auch im Verzeichnis <strong>~.config/borg/keys</strong>' auf dem lokalen Rechner speichern (keyfile). Dann sollte man die Schlüsseldatei aber unbedingt zusätzlich sichern.  Sonst kann bei einem Datenverlust des lokalen Rechners das Archiv nicht wieder entschlüsselt werden!</p><p>Beispiel: Der Benutzer "peter" möchte auf seiner externen Festplatte "HD_Backup" ein Repository "borgbackups" anlegen. In diesem Fall sieht die Befehlszeile so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir /media/peter/HD_Backup/borgbackups
borg init /media/peter/HD_Backup/borgbackups </pre></div></div><p>Nach Eingabe der Befehlszeile wird die Passphrase abgefragt, die zur Verschlüsselung verwendet werden soll. Da im Beispiel keine gesonderte Option angegeben wurde, wird die Standardoption <code class="notranslate">repokey</code> verwendet und die Schlüsseldatei im Repository gespeichert.</p></div><div class="section_2"><h3 id="Anlegen-von-Archiven">Anlegen von Archiven<a class="headerlink" href="#Anlegen-von-Archiven">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bevor Backup-Archive erstellt werden, muss sichergestellt werden, dass genügend freier Speicherplatz im Repository-Verzeichnis vorhanden ist. Auch im Homeverzeichnis unter  <strong>~/.cache</strong> sollten nach Angaben der Borg-Entwickler mehrere Gigabyte für die Indexierung frei sein.
</p></div></div><p>Archive werden mittels <code class="notranslate">create</code> angelegt. Die Liste der Verzeichnisse, die gesichert werden sollen, wird am Ende der Befehlszeile durch Leerzeichen getrennt angegeben.</p><div class="bash"><div class="contents"><pre class="notranslate">borg create [OPTIONEN] REPO_VERZEICHNISPFAD::ARCHIVNAME VERZEICHNISPFAD_1 [VERZEICHNISPFAD_2 ...] </pre></div></div><p>
Zu möglichen Optionen für das Anlegen von Archiven siehe nachfolgende Tabelle:</p><p>
</p><table><tr class="titel"><td colspan="2"> Wichtige Optionen für den create-Befehl </td></tr><tr class="kopf"><td>Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-h</code> oder <code class="notranslate">--help</code> </td><td> Ausgabe eines Hilfetextes </td></tr><tr><td> <code class="notranslate">-v</code> oder <code class="notranslate">--verbose</code> </td><td> Ausführlichere Ausgabe von Meldungen </td></tr><tr><td> <code class="notranslate">-s</code> oder <code class="notranslate">--stats</code> </td><td> Ausgabe von Statistiken zum erzeugten Archiv </td></tr><tr><td> <code class="notranslate">-p</code> oder <code class="notranslate">--progress</code> </td><td> Ausgabe einer Fortschrittsanzeige </td></tr><tr><td> <code class="notranslate">-e</code> oder <code class="notranslate">--exclude MUSTER</code> </td><td> Ein bestimmtes Muster <code class="notranslate">MUSTER</code> bei der Sicherung ausschließen, z.B. <strong>*.tmp</strong> </td></tr><tr><td> <code class="notranslate">--exclude-caches</code> </td><td> Cache-Verzeichnisse (mit dem CACHEDIR.TAG) ausschließen </td></tr><tr><td> <code class="notranslate">-x</code> oder <code class="notranslate">--one-file-system</code> </td><td> Im gleichen Dateisystem bleiben und Einhängepunkte ignorieren </td></tr><tr><td> <code class="notranslate">-C</code> oder <code class="notranslate">--compression KOMPRESSION</code> </td><td> Kompressionsalgorithmus und Stufe wählen (siehe nachfolgende Tabelle) </td></tr></table><p>Die in Borg implementierten Kompressionsalgorithmen unterscheiden sich in Bezug auf Geschwindigkeit und Kompressionsgrad: lz4 ist sehr schnell, erreicht aber nur eine mittlere Kompression. zlib erreicht eine mittlere Geschwindigkeit und Kompression, während lzma am langsamsten ist, aber den höchsten Kompressionsgrad ermöglicht. Ein Vergleichstest der Kompressionsalgorithmen findet sich <a class="external" href="https://www.dinotools.de/2017/04/11/vergleich-der-kompression-bei-borg-backup/" rel="nofollow">hier</a>.</p><p>
</p><table><tr class="titel"><td colspan="2"> Mögliche Werte für die Kompression </td></tr><tr class="kopf"><td>Kompression </td><td> Beschreibung </td></tr><tr><td> none </td><td> Keine Kompression (Standard) </td></tr><tr><td> lz4 </td><td> lz4 </td></tr><tr><td> zlib </td><td> zlib Stufe 6 </td></tr><tr><td> zlib,N </td><td> zlib Stufe N. N von 0 bis 9, z.B. <code class="notranslate">zlib,8</code> </td></tr><tr><td> lzma </td><td> lzma Stufe 6 </td></tr><tr><td> lzma,N </td><td> lzma Stufe N. N von 0 bis 9, z.B. <code class="notranslate">lzma,4</code> </td></tr></table><p>
Beispiel: Der Benutzer "peter" hat auf einer externen Festplatte ein Repository "borgbackups" erstellt und will den Bilder- und den Video-Ordner seines Homeverzeichnisses in ein Archiv "MeineMedien" sichern. Die Kompression soll mit lzma der Stufe 4 erfolgen. In diesem Fall sieht die Befehlszeile so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">borg create -C lzma,4 /media/peter/HD_Backup/borgbackups::MeineMedien ~/Bilder ~/Videos </pre></div></div></div><div class="section_2"><h3 id="Wiederherstellen-von-Daten">Wiederherstellen von Daten<a class="headerlink" href="#Wiederherstellen-von-Daten">¶</a></h3><p>
Die Wiederherstellung von Daten kann auf zwei unterschiedlichen Wegen erfolgen. Entweder werden die gesicherten Dateien und Verzeichnisse direkt ins Dateisystem zurück kopiert oder das gesamte Repository bzw. ein einzelnes Archiv wird mittels <a class="internal" href="./fuse.html">Fuse</a> lesend ins Dateisystem eingebunden. In diesen Fall kann das Backup zunächst mit einem Dateimanager durchsucht und einzelne Dateien oder Verzeichnisse können anschließend an andere Orte kopiert werden.</p><div class="section_3"><h4 id="Zurueckspielen-von-Dateien-und-Ordnern">Zurückspielen von Dateien und Ordnern<a class="headerlink" href="#Zurueckspielen-von-Dateien-und-Ordnern">¶</a></h4><p>
Das Zurückspielen von Archiven wird mittels <code class="notranslate">extract</code> vorgenommen. Dabei wird immer das aktuelle Verzeichnis als Ziel verwendet.</p><div class="bash"><div class="contents"><pre class="notranslate">cd ZIEL_VERZEICHNISPFAD
borg extract [OPTIONEN] REPO_VERZEICHNISPFAD::ARCHIVNAME [VERZEICHNISPFAD_1 VERZEICHNISPFAD_2 ...] </pre></div></div><p>Werden am Ende der Befehlszeile keine Verzeichnisse angegeben, wird das gesamte Archiv extrahiert. Zu möglichen Optionen für das Extrahieren von Archiven siehe nachfolgende Tabelle:</p><p>
</p><table><tr class="titel"><td colspan="2"> Wichtige Optionen für den extract-Befehl </td></tr><tr class="kopf"><td>Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-h</code> oder <code class="notranslate">--help</code> </td><td> Ausgabe eines Hilfetextes </td></tr><tr><td> <code class="notranslate">-v</code> oder <code class="notranslate">--verbose</code> </td><td> Ausführlichere Ausgabe von Meldungen </td></tr><tr><td> <code class="notranslate">-e</code> oder <code class="notranslate">--exclude MUSTER</code> </td><td> Ein bestimmtes Muster <code class="notranslate">MUSTER</code> beim zurück spielen ausschließen, z.B. <strong>*.vdi</strong> </td></tr><tr><td> <code class="notranslate">-n</code> oder <code class="notranslate">--dry-run</code> </td><td> Testlauf ohne Dateien zu schreiben </td></tr></table><p>Beispiel: Das Repository "borgbackups" des Benutzers "peter" liegt auf einer externen Festplatte. Das darin befindliche Verzeichnis "home/peter/Videos" im Archiv "MeineMedien" soll in das Verzeichnis "Wiederhergestellt" im Homeverzeichnis des Benutzers kopiert werden. Dieses Verzeichnis ist noch nicht vorhanden und muss zuvor erstellt werden. In diesem Fall sehen die Befehlszeilen so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir ~/Wiederhergestellt
cd ~/Wiederhergestellt
borg extract /media/peter/HD_Backup/borgbackups::MeineMedien home/peter/Videos </pre></div></div></div><div class="section_3"><h4 id="Einhaengen-der-Sicherung-mit-Fuse">Einhängen der Sicherung mit Fuse<a class="headerlink" href="#Einhaengen-der-Sicherung-mit-Fuse">¶</a></h4><p>
Das Einhängen von Archiven erfolgt mit dem Borg-Befehl <code class="notranslate">mount</code>.</p><div class="bash"><div class="contents"><pre class="notranslate">borg mount [OPTIONEN] REPO_VERZEICHNISPFAD[::ARCHIVNAME] ZIEL_VERZEICHNISPFAD </pre></div></div><p>Wird kein Archivname angegeben, wird das gesamte Repository eingehängt. Nach dem Einhängen kann auf das Backup lesend zugegriffen werden. Zu möglichen Optionen für das Einhängen von Archiven siehe nachfolgende Tabelle:</p><p>
</p><table><tr class="titel"><td colspan="2"> Wichtige Optionen für den mount-Befehl </td></tr><tr class="kopf"><td>Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-h</code> oder <code class="notranslate">--help</code> </td><td> Ausgabe eines Hilfetextes </td></tr><tr><td> <code class="notranslate">-v</code> oder <code class="notranslate">--verbose</code> </td><td> Ausführlichere Ausgabe von Meldungen </td></tr><tr><td> <code class="notranslate">-f</code> oder <code class="notranslate">--foreground</code> </td><td> Prozess bleibt im Vordergrund. Das Backup wird ausgehängt, sobald der Prozess beendet wird. </td></tr></table><p>Wird <code class="notranslate">mount</code> ohne die Option <code class="notranslate">--foreground</code> aufgerufen, muss das Dateisystem wieder manuell ausgehängt werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">fusermount -u ZIEL_VERZEICHNISPFAD </pre></div></div><p>
Ab borg 1.9 ist das Aushängen auch mittels <code class="notranslate">borg umount &lt;mountpoint&gt;</code> möglich.</p><p>Beispiel: Das Repository "borgbackups" des Benutzers "peter" liegt auf einer externen Festplatte. Das darin befindliche Archiv "MeineMedien" soll in das Verzeichnis "Sicherung" im Homeverzeichnis eingehängt werden. Dieses Verzeichnis ist noch nicht vorhanden und muss zuvor angelegt werden. In diesem Fall sehen die Befehlszeilen so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir ~/Sicherung
borg mount /media/peter/HD_Backup/borgbackups::MeineMedien ~/Sicherung
fusermount -u ~/Sicherung # Nach Beendigung des Zugriffs </pre></div></div></div></div><div class="section_2"><h3 id="Automatisches-Loeschen-von-Archiven">Automatisches Löschen von Archiven<a class="headerlink" href="#Automatisches-Loeschen-von-Archiven">¶</a></h3><p>
Eine vom Alter der Archive abhängige automatische Löschung kann mittels <code class="notranslate">prune</code> vorgenommen werden.</p><div class="bash"><div class="contents"><pre class="notranslate">borg prune [OPTIONEN] REPO_VERZEICHNISPFAD </pre></div></div><p>Welche Archive nicht gelöscht werden sollen, wird mit Hilfe der Optionen festgelegt. Um nicht unbeabsichtigt Archive zu löschen, empfiehlt sich zunächst einen Testlauf mit den Optionen <code class="notranslate">--dry-run -v --list</code> vorzunehmen. Zu möglichen Optionen für das automatische Löschen von Archiven siehe nachfolgende Tabelle:</p><p>
</p><table><tr class="titel"><td colspan="2"> Wichtige Optionen für den prune-Befehl </td></tr><tr class="kopf"><td>Option </td><td> Beschreibung </td></tr><tr><td> <code class="notranslate">-h</code> oder <code class="notranslate">--help</code> </td><td> Ausgabe eines Hilfetextes </td></tr><tr><td> <code class="notranslate">-v</code> oder <code class="notranslate">--verbose</code> </td><td> Ausführlichere Ausgabe von Meldungen </td></tr><tr><td> <code class="notranslate">-n</code> oder <code class="notranslate">--dry-run</code> </td><td> Testlauf ohne Archive zu löschen </td></tr><tr><td> <code class="notranslate">--list</code> </td><td> Ausgabe einer Liste welche Archive gelöscht/behalten werden </td></tr><tr><td> <code class="notranslate">--keep-within=NZ</code> </td><td> Behalte alle Archive im Zeitintervall NZ. N ist dabei eine positive Ganzzahl und Z eine Abkürzung für die Zeiteinheit: "H" Stunden, "d" Tage, "w" Wochen, "m" Monate und "y" Jahre. Also z.B. "7m" für sieben Monate. </td></tr><tr><td> <code class="notranslate">-H=N</code> oder <code class="notranslate">--keep-hourly=N</code> </td><td> Behalte zusätzlich je ein Archiv der letzten N Stunden </td></tr><tr><td> <code class="notranslate">-d=N</code> oder <code class="notranslate">--keep-daily=N</code> </td><td> Behalte zusätzlich je ein Archiv der letzten N Tage </td></tr><tr><td> <code class="notranslate">-w=N</code> oder <code class="notranslate">--keep-weekly=N</code> </td><td> Behalte zusätzlich je ein Archiv der letzten N Wochen </td></tr><tr><td> <code class="notranslate">-m=N</code> oder <code class="notranslate">--keep-monthly=N</code> </td><td> Behalte zusätzlich je ein Archiv der letzten N Monate </td></tr><tr><td> <code class="notranslate">-y=N</code> oder <code class="notranslate">--keep-yearly=N</code> </td><td> Behalte zusätzlich je ein Archiv der letzten N Jahre </td></tr></table><p>Beispiel: Das Repository "borgbackups" des Benutzers "peter" liegt auf einer externen Festplatte. Alle Archive, die innerhalb des letzten Tages erstellt wurden, sollen behalten werden. Außerdem sollen zusätzlich die aktuellsten Sicherungen der letzten sieben Sicherungstage, der letzten vier Wochen und der letzten zwölf Monate behalten werden. Es wird zunächst ein Testlauf durchgeführt:</p><div class="bash"><div class="contents"><pre class="notranslate">borg prune --dry-run -v --list --keep-within=1d --keep-daily=7 --keep-weekly=4 --keep-monthly=12 /media/peter/HD_Backup/borgbackups </pre></div></div><p>
Um die Löschung tatsächlich vorzunehmen, muss der o.g. Befehl ohne die Option <code class="notranslate">--dry-run</code> ausgeführt werden.</p></div><div class="section_2"><h3 id="Anlegen-von-Sicherungen-mittels-SSH">Anlegen von Sicherungen mittels SSH<a class="headerlink" href="#Anlegen-von-Sicherungen-mittels-SSH">¶</a></h3><p>
Soll das Repository auf einem entfernten Rechner mittels <a class="internal" href="./ssh.html">SSH</a> angelegt werden, muss Borg vorher auch auf dem Zielrechner installiert werden. Danach muss bei allen den Borg-Befehlen der Ausdruck <code class="notranslate">REPO_VERZEICHNISPFAD</code> durch <code class="notranslate">ssh://BENUTZER@RECHNERNAME:PORT//REPO_VERZEICHNISPFAD</code> ersetzt werden. Dabei ist <code class="notranslate">RECHNERNAME</code> der Name oder die IP-Adresse unter der der entfernte Rechner im Netzwerk zu erreichen ist. <code class="notranslate">BENUTZER</code> ist der Benutzername zum Anmelden auf dem entfernten Rechner. Dieser Benutzer muss Schreibrechte für des Zielverzeichnis besitzen. <code class="notranslate">PORT</code> ist der SSH-Port, im Allgemeinen wird der Standardport <code class="notranslate">22</code> benutzt. Wenn ssh mit bestimmten Optionen aufgerufen werden soll, kann der SSH-Befehl vorher an die <a class="internal" href="./umgebungsvariable.html">Umgebungsvariable</a> <code class="notranslate">BORG_RSH</code> übergeben werden. Die Angabe des Pfads zu einer Schlüsseldatei erfolgt z.B. so:</p><div class="bash"><div class="contents"><pre class="notranslate">export BORG_RSH='ssh -i /PFAD/SCHLÜSSELDATEI' </pre></div></div><p>Borg verwendet dann diesen erweiterten Befehl statt eines einfachen "ssh".</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Sollte eine Installation von Borg auf dem Zielrechner nicht möglich sein, kann das Zielverzeichnis alternativ zuvor auch mittels <a class="internal" href="./fuse/sshfs.html">sshfs</a> eingebunden werden. Dann kann Borg auf dieses Verzeichnis wie auf ein lokales Verzeichnis zugreifen.
</p></div></div></div><div class="section_2"><h3 id="Weitere-Borg-Befehle">Weitere Borg-Befehle<a class="headerlink" href="#Weitere-Borg-Befehle">¶</a></h3><p>
</p><p>
</p><table><tr class="titel"><td colspan="2"> Befehlsübersicht Borg </td></tr><tr class="kopf"><td>Befehl </td><td> Beschreibung </td></tr><tr><td> borg break-lock [OPTIONEN] REPO_VERZEICHNISPFAD </td><td> Hebt den Lockmechanismus auf.  Nur benutzen, wenn kein Prozess auf das Repository zugreift! </td></tr><tr><td> borg change-passphrase [OPTIONEN] REPO_VERZEICHNISPFAD </td><td> Ändert die Passphrase </td></tr><tr><td> borg check [OPTIONEN] REPO_VERZEICHNISPFAD[::ARCHIVNAME] </td><td> Überprüfe die Konsistenz des gesamten Repositorys oder von einzelnen Archiven </td></tr><tr><td> borg delete [OPTIONEN] REPO_VERZEICHNISPFAD[::ARCHIVNAME] </td><td> Löscht einzelne Archive oder das gesamte Repository </td></tr><tr><td> borg info [OPTIONEN] REPO_VERZEICHNISPFAD::ARCHIVNAME </td><td> Ausgabe von Informationen über ein Archiv </td></tr><tr><td> borg list [OPTIONEN] REPO_VERZEICHNISPFAD[::ARCHIVNAME] </td><td> Gibt den Inhalt eines Repositorys oder eines Archivs aus </td></tr><tr><td> borg rename [OPTIONEN] REPO_VERZEICHNISPFAD::ARCHIVNAME NEUER_ARCHIVNAME </td><td> Umbenennung eines Archivs </td></tr></table><p>Eine vollständige Dokumentation aller Befehle findet man auf der <a class="external" href="https://borgbackup.readthedocs.io/en/stable/usage.html" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p></div><div class="section_2"><h3 id="Skriptvorlage-BorgBackup">Skriptvorlage BorgBackup<a class="headerlink" href="#Skriptvorlage-BorgBackup">¶</a></h3><p>
Da Borg keine Konfigurationsdatei besitzt und zudem sehr viele Optionen kennt, werden die Befehlszeilen schnell unübersichtlich. Daher erledigt man die Archivierung am besten mit Hilfe eines Skripts. Eine Vorlage ist unten aufgeführt. Mit einem Editor<sup><a href="#source-5">[5]</a></sup> kann das Skript an die eigenen Bedürfnisse angepasst werden. Zunächst gibt man den Zielpfad, den Namen des Repositorys und die zu sichernden Verzeichnisse an. Die weiteren Optionen kann man bei Bedarf ebenfalls abändern. Das Skript muss dann z.B. im Homeverzeichnis unter <strong>~/bin/borgbackup.sh</strong> gespeichert und anschließend ausführbar gemacht werden. Falls das Verzeichnis <strong>~/bin</strong> hierfür neu angelegt wurde, muss die Variable <code class="notranslate">PATH</code> vorher noch aktualisiert werden, damit das Skript gefunden wird.</p><div class="bash"><div class="contents"><pre class="notranslate">source ~/.profile # nur bei neu angelegtem ~/bin
chmod +x ~/bin/borgbackup.sh </pre></div></div><p>Das Skript kann anschießend im Terminal gestartet werden.</p><div class="bash"><div class="contents"><pre class="notranslate">borgbackup.sh </pre></div></div><div class="section_3"><h4 id="Skript">Skript<a class="headerlink" href="#Skript">¶</a></h4><p>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Skriptvorlage BorgBackup</span>
<span class="c1"># https://wiki.ubuntuusers.de/BorgBackup/</span>
<span class="c1"># https://borgbackup.readthedocs.io/en/stable/</span>


<span class="c1"># Hier Pfad zum Sicherungsmedium angeben.</span>
<span class="c1"># z.B. zielpfad="/media/peter/HD_Backup"</span>
<span class="nv">zielpfad</span><span class="o">=</span><span class="s2">""</span>

<span class="c1"># Hier Namen des Repositorys angeben.</span>
<span class="c1"># z.B. repository="borgbackups"</span>
<span class="nv">repository</span><span class="o">=</span><span class="s2">""</span>

<span class="c1"># Hier eine Liste mit den zu sichernden Verzeichnissen angeben</span>
<span class="c1"># z.B. sicherung="/home/peter/Bilder /home/peter/Videos --exclude *.tmp"</span>
<span class="nv">sicherung</span><span class="o">=</span><span class="s2">""</span>

<span class="c1"># Hier die Art der Verschlüsselung angeben</span>
<span class="c1"># z.B. verschluesselung="none"</span>
<span class="nv">verschluesselung</span><span class="o">=</span><span class="s2">"repokey"</span>

<span class="c1"># Hier die Art der Kompression angeben</span>
<span class="c1"># z.B. kompression="none"</span>
<span class="nv">kompression</span><span class="o">=</span><span class="s2">"lz4"</span>

<span class="c1"># Hier angeben, ob vor der Ausführung von BorgBackup auf vorhandene Root-Rechte geprüft werden soll</span>
<span class="c1"># z.B. rootuser="ja"</span>
<span class="nv">rootuser</span><span class="o">=</span><span class="s2">"nein"</span>

<span class="c1"># Hier angeben nach welchem Schema alte Archive gelöscht werden sollen.</span>
<span class="c1"># Die Vorgabe behält alle Sicherungen des aktuellen Tages. Zusätzlich das aktuellste Archiv der </span>
<span class="c1"># letzten 7 Sicherungstage, der letzten 4 Wochen sowie der letzten 12 Monate.</span>
<span class="nv">pruning</span><span class="o">=</span><span class="s2">"--keep-within=1d --keep-daily=7 --keep-weekly=4 --keep-monthly=12"</span>

<span class="c1">###################################################################################################</span>

<span class="nv">repopfad</span><span class="o">=</span><span class="s2">"</span><span class="nv">$zielpfad</span><span class="s2">"</span>/<span class="s2">"</span><span class="nv">$repository</span><span class="s2">"</span>

<span class="c1"># check for root</span>
<span class="k">if</span> <span class="o">[</span> <span class="k">$(</span>id -u<span class="k">)</span> -ne <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$rootuser</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"ja"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Sicherung muss als Root-User ausgeführt werden."</span>
  <span class="nb">exit</span> <span class="m">1</span>
<span class="k">fi</span>

<span class="c1"># Init borg-repo if absent</span>
<span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$repopfad</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  borg init --encryption<span class="o">=</span><span class="nv">$verschluesselung</span> <span class="nv">$repopfad</span> 
  <span class="nb">echo</span> <span class="s2">"Borg-Repository erzeugt unter </span><span class="nv">$repopfad</span><span class="s2">"</span>
<span class="k">fi</span>

<span class="c1"># backup data</span>
<span class="nv">SECONDS</span><span class="o">=</span><span class="m">0</span>
<span class="nb">echo</span> <span class="s2">"Start der Sicherung </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">."</span>

borg create --compression <span class="nv">$kompression</span> --exclude-caches --one-file-system -v --stats --progress <span class="se">\</span>
            <span class="nv">$repopfad</span>::<span class="s1">'{hostname}-{now:%Y-%m-%d-%H%M%S}'</span> <span class="nv">$sicherung</span>

<span class="nb">echo</span> <span class="s2">"Ende der Sicherung </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">. Dauer: </span><span class="nv">$SECONDS</span><span class="s2"> Sekunden"</span>

<span class="c1"># prune archives</span>
borg prune -v --list <span class="nv">$repopfad</span> --prefix <span class="s1">'{hostname}-'</span> <span class="nv">$pruning</span>
</pre></div>
</td></tr></table></div><p>Hilfe zum Umgang mit Bash-Skripten findet man auch im <a class="internal" href="./shell/bash-skripting-guide_für_anfänger.html">Bash-Skripting-Guide für Anfänger</a>.</p></div><div class="section_3"><h4 id="Skript-automatisiert-ausfuehren">Skript automatisiert ausführen<a class="headerlink" href="#Skript-automatisiert-ausfuehren">¶</a></h4><p>
Soll das Skript bzw. borg automatisiert ausgeführt werden, so muss entweder die Verschlüsselung deaktivert werden (<code class="notranslate">verschluesselung="none"</code>) oder das Passwort an Borg übergeben werden.
Dafür gibt es die Umgebungsvariable BORG_PASSPHRASE. Am einfachsten ergänzt man das Skript am Anfang um die Zeile: 
</p><div class="bash"><div class="contents"><pre class="notranslate">export BORG_PASSPHRASE="mySecretPassword" </pre></div></div><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bei dieser Variante steht das Passwort als Klartext im Skript. Man sollte also sicherstellen, dass niemand unbefugtes diese Datei lesen kann. 
</p></div></div><p>
Hilfe zum Umgang mit Umgebungsvariablen findet man auch im <a class="internal" href="./umgebungsvariable.html">Artikel zu Umgebungsvariablen</a>.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wird die Umgebungsvariable nicht innerhalb des Skriptes gesetzt und das Skript soll mit Root-Rechten ausgeführt werden, so ist dieses mittels 
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo -E borgbackup.sh  </pre></div></div><p> 
aufzurufen. Damit wird die Benutzerumgebung beim Starten des Befehls beibehalten.
</p></div></div><p>Damit das Skript auch regelmäßig ausgeführt wird, muss noch ein entsprechender Timer erstellt werden. Z.B. mittels anacron.
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get update
sudo apt-get install anacron
sudo ln -s /home/user/bin/borgbackup.sh /etc/cron.hourly/borgbackup #für anacron darf kein Punkt im Namen vorhanden sein </pre></div></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="https://www.borgbackup.org/" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="https://borgbackup.readthedocs.io/en/stable/" rel="nofollow">Dokumentation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p><ul><li><p><a class="external" href="https://readthedocs.org/projects/borgbackup/downloads/pdf/stable/" rel="nofollow">Dokumentation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> <img alt="{dl}" src="./_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/> als PDF-Datei</p></li></ul></li><li><p><a class="interwiki interwiki-github" href="https://github.com/borgbackup/borg">Quellcode</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="https://media.ccc.de/v/gpn17-8578-borgbackup_treffen#video&amp;t=2106" rel="nofollow">Vortrag vom Entwickler Thomas Waldmann</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - GPN 2017 (die ersten 35 min geben einen guten Überblick über das Projekt)</p></li><li><p><a class="internal" href="./datensicherung.html">Datensicherung</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Übersichtsartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./borgbackup/a/revision/946165.html">Diese Revision</a> wurde am 10. Januar 2018 17:15 von <a href="https://ubuntuusers.de/user/Thomas_Do/">Thomas_Do</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./borgbackup.html">BorgBackup</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>