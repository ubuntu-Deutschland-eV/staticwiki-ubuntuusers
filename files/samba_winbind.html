<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Samba_Winbind › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./samba_winbind.html">Samba Winbind</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Samba_Winbind">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./samba_winbind/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./samba_winbind/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./samba_winbind/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./samba_winbind/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./samba_winbind/a/backlinks.html">Samba Winbind</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorteile-Funktionsweise-Winbind">Vorteile/Funktionsweise Winbind
</a></li><li><a class="crosslink" href="#Vor-der-Installation">Vor der Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Bezeichnungen">Bezeichnungen
</a></li><li><a class="crosslink" href="#Testen-der-Verbindung">Testen der Verbindung
</a></li><li><a class="crosslink" href="#Zeit-synchronisieren">Zeit synchronisieren
</a></li></ol></li><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Beschreibung">Beschreibung
</a></li><li><a class="crosslink" href="#Installationsvorbereitungen">Installationsvorbereitungen
</a><ol class="arabic"><li><a class="crosslink" href="#Hosts-aendern">Hosts ändern
</a></li></ol></li><li><a class="crosslink" href="#Installation-2">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Pakete-installieren">Pakete installieren
</a></li></ol></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a><ol class="arabic"><li><a class="crosslink" href="#Kerberos-einrichten">Kerberos einrichten
</a></li><li><a class="crosslink" href="#Der-Domaene-beitreten">Der Domäne beitreten
</a></li><li><a class="crosslink" href="#Konfiguration-der-Authentication">Konfiguration der Authentication
</a></li><li><a class="crosslink" href="#PAM-Konfiguration">PAM Konfiguration
</a></li><li><a class="crosslink" href="#root-Rechte">root-Rechte
</a></li></ol></li><li><a class="crosslink" href="#Optionale-Erweiterungen">Optionale Erweiterungen
</a><ol class="arabic"><li><a class="crosslink" href="#PAM-Mount">PAM Mount
</a></li></ol></li></ol></li><li><a class="crosslink" href="#Problemloesungen">Problemlösungen
</a><ol class="arabic"><li><a class="crosslink" href="#no-logon-servers">no logon servers
</a></li><li><a class="crosslink" href="#Die-TLD-der-Domain-ist-local-example-local">Die TLD der Domain ist .local (example.l...</a></li><li><a class="crosslink" href="#Namensaufloesung">Namensauflösung
</a></li><li><a class="crosslink" href="#Upgrade-von-Ubuntu-12-04-auf-14-04">Upgrade von Ubuntu 12.04 auf 14.04
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Samba_Server/samba-logo.png" class="image-left" src="./_/a8ef26a0d93a67702ef6b8f48761da6a0e0a2c2d.png"/>
Dieser Artikel beschreibt, wie man Ubuntu an einer Windows-Domäne anmeldet, um die Benutzer am "Active Directory" zu authentifizieren. Weitere Informationen zu Samba findet man im Artikel <a class="internal" href="./samba.html">Samba</a>. Zusätzlich zur Domänen-Authentifizierung können bei der Anmeldung auch benutzerspezifische Netzwerkfreigaben verbunden werden. Diese Freigaben werden dann mit dem Domänen-Benutzer und dessen Rechten angesprochen. Bisher wurde dies mit Windows 2003 Domänen Controllern getestet (Enterprise und Small Business).</p><p>Außerdem ist es möglich, Ubuntu auch ohne ADS zu authentifizieren. Der Hauptunterschied ist, dass hierzu kein <a class="internal" href="./kerberos.html">Kerberos</a> notwendig ist. ADS ist der <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Active_Directory_Service">Active Directory Service</a>. Die gesonderten Installationsschritte für diese Methode sind im Artikel besonders gekennzeichnet.</p><div class="section_1"><h2 id="Vorteile-Funktionsweise-Winbind">Vorteile/Funktionsweise Winbind<a class="headerlink" href="#Vorteile-Funktionsweise-Winbind">¶</a></h2><p>
Winbind vereint die UNIX- und Windows NT-Konten-Verwaltung, indem es einer UNIX-Maschine erlaubt, ein vollwertiges Mitglied einer NT-Domäne zu werden. Als Endergebnis wird, immer wenn ein Programm auf der UNIX-Maschine das Betriebssystem nach einem Benutzer- oder Gruppen-Namen fragt, die Anfrage an den NT-Domänencontroller weitergegeben, der diese Namensabfrage durchführt. Weil Winbind sich auf einem sehr tiefgreifenden Level ins Betriebssystem einhängt, ist diese Umleitung zum NT-Domänencontroller völlig transparent.</p><p>Die Benutzer auf der UNIX-Maschine können dann NT-Benutzer- und NT-Gruppen-Namen so verwenden, als ob sie „native“ UNIX-Namen wären. Sie können mit <em>chown</em> Eigentümer von Dateien werden, so dass die Dateien NT-Domänen-Benutzern gehören, oder sich sogar auf einer UNIX-Maschine anmelden und eine UNIX-X-Window-Session als Domänen-Benutzer ausführen.</p><p>Das einzige sichtbare Anzeichen, dass Winbind verwendet wird, ist, dass Benutzer- und Gruppen-Namen die Form DOMÄNE\benutzer und DOMÄNE\gruppe annehmen. Das ist notwendig, da Winbind auf diese Weise erkennt, wann eine Umleitung zum Domänencontroller erforderlich ist und auf welche Domäne sich diese Anfrage bezieht.</p><p>Zusätzlich bietet Winbind einen Authentifikationsdienst, der sich ins PAM-System (Pluggable Authentication Modules) einhängt, um allen PAM-fähigen Applikationen die Authentifizierung über eine NT-Domäne anzubieten. Diese Fähigkeit löst das Problem der Synchronisation von Passwörtern zwischen Systemen, da alle Passwörter nur an einem Platz gespeichert werden - auf dem Domänencontroller.</p></div><div class="section_1"><h2 id="Vor-der-Installation">Vor der Installation<a class="headerlink" href="#Vor-der-Installation">¶</a></h2><p>
</p><div class="section_2"><h3 id="Bezeichnungen">Bezeichnungen<a class="headerlink" href="#Bezeichnungen">¶</a></h3><p>
</p><table><tr><td> <em>meinserver</em> </td><td> Name des Servers, der Domaincontroller ist </td></tr><tr><td> <em>IPADRESSE</em> </td><td> IP-Adresse des Server, der Domaincontroller ist </td></tr><tr><td> <em>example.com</em> </td><td> Domäne </td></tr><tr><td> <em>EXAMPLE</em> </td><td> alternative Workgroup </td></tr><tr><td> <em>UBUNTU</em> </td><td> Rechnername des Ubuntu Client PC's </td></tr></table></div><div class="section_2"><h3 id="Testen-der-Verbindung">Testen der Verbindung<a class="headerlink" href="#Testen-der-Verbindung">¶</a></h3><p>
Zuerst sollte man testen, ob eine Verbindung zum Server hergestellt werden kann. Dazu öffnet man ein Terminal<sup><a href="#source-2">[2]</a></sup> und verwendet den Befehl <code class="notranslate">ping</code>. Dies sollte etwa so aussehen. Falls dies nicht funktionieren sollte, hilft eventuell der Artikel <a class="internal" href="./dns_problembehebung.html">DNS Problembehebung</a> weiter.</p><div class="bash"><div class="contents"><pre class="notranslate">ping FQDN </pre></div></div><p>FQDN steht hier für den Fully Qualified Domain Name des Domaincontrollers. (meinserver.example.com) Weitere Informationen zu FQDN unter <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Domain#Fully_Qualified_Domain_Name_.28FQDN.29">FQDN</a>.</p></div><div class="section_2"><h3 id="Zeit-synchronisieren">Zeit synchronisieren<a class="headerlink" href="#Zeit-synchronisieren">¶</a></h3><p>
Anschließend sollte man sicherstellen, dass, die Zeit auf dem Client und auf dem Server nicht mehr als 2 Minuten abweicht. Andernfalls werden Fehler wie zum Beispiel</p><pre class="notranslate">kinit(v5): Clock skew too great while getting initial credentials</pre><p>beim Verbinden auftreten. Beachten sollte man auch das Ubuntu eventuell automatisch wieder eine andere Zeit aus dem Internet holt.</p></div></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
</p><div class="section_2"><h3 id="Beschreibung">Beschreibung<a class="headerlink" href="#Beschreibung">¶</a></h3><p>
Soll Ubuntu ein Mitglied einer Windows Domäne werden, dann wird hierzu <a class="internal" href="./kerberos.html">Kerberos</a> benötigt. Soll Ubuntu ohne ADS an die Domäne angebunden werden, dann wird Kerberos nicht benötigt. Die entsprechenden Installationsschritte können also ausgelassen werden.</p></div><div class="section_2"><h3 id="Installationsvorbereitungen">Installationsvorbereitungen<a class="headerlink" href="#Installationsvorbereitungen">¶</a></h3><p>
</p><div class="section_3"><h4 id="Hosts-aendern">Hosts ändern<a class="headerlink" href="#Hosts-aendern">¶</a></h4><p>
Man öffnet die Datei <strong>/etc/hosts</strong> mit einem Editor<sup><a href="#source-3">[3]</a></sup>. Dann fügt man folgende Zeile ein: 
</p><pre class="notranslate">  127.0.0.1 ubuntu.example.com localhost ubuntu
  IPADRESSE meinserver.example.com meinserver</pre><p>
Dies ist wichtig, da sonst beim Anmelden Probleme auftreten können. Unter Umständen kann man sich auch gar nicht mehr an der grafischen Oberfläche anmelden.</p></div></div><div class="section_2"><h3 id="Installation-2">Installation<a class="headerlink" href="#Installation-2">¶</a></h3><p>
</p><div class="section_3"><h4 id="Pakete-installieren">Pakete installieren<a class="headerlink" href="#Pakete-installieren">¶</a></h4><p>
Nun müssen die benötigten Pakete installiert werden<sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>krb5-user</strong> (<em>universe</em>)</p></li><li><p><strong>libpam-krb5</strong> (<em>universe</em> )</p></li><li><p><strong>winbind </strong></p></li><li><p><strong>samba </strong></p></li><li><p><strong>smbclient</strong></p></li><li><p><strong>libnss-winbind</strong></p></li><li><p><strong>libpam-winbind</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install krb5-user libpam-krb5 winbind  samba  smbclient libnss-winbind libpam-winbind </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install krb5-user libpam-krb5 winbind  samba  smbclient libnss-winbind libpam-winbind </pre></div></div><p>
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die beiden Pakete <strong>krb5-user</strong> und <strong>libpam-krb5</strong> sind nur bei der Installationsvariante mit ADS erforderlich. 
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die beiden Pakete <strong>libnss-winbind</strong> und <strong>libpam-winbind</strong> müssen ab 14.04 LTS mit installiert werden, da sonst die "getent passwd"-Prüfung nur lokale Einträge liefert. 
</p></div></div></div></div><div class="section_2"><h3 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Es wird dringend empfohlen, vor jeder Änderung an den folgenden Konfigurationsdateien eine Sicherung davon anzulegen. 
</p></div></div><div class="section_3"><h4 id="Kerberos-einrichten">Kerberos einrichten<a class="headerlink" href="#Kerberos-einrichten">¶</a></h4><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Dieser Schritt ist nur für die Variante mit ADS-Authentifizierung erforderlich. Siehe auch <a class="internal" href="./kerberos.html">Kerberos</a>. 
</p></div></div><p>Zuerst wird der Kerberos-Authentifizierungsdienst auf dem Kerberos-Server des Windows-Domänencontrollers eingestellt. Dazu die Datei <strong>/etc/krb5.conf</strong> mit einem Editor öffnen. Neue Kerberos-Konfiguration:</p><pre class="notranslate">[logging]
    default = FILE:/var/log/krb5.log

[libdefaults]
    ticket_lifetime = 24000
    clock_skew = 300
    default_realm = EXAMPLE.COM

[realms]
    EXAMPLE.COM = {
        kdc = meinserver:88
        admin_server = meinserver:464
        default_domain = EXAMPLE.COM
    }

[domain_realm]
    .example.com = EXAMPLE.COM
    example.com = EXAMPLE.COM</pre><div class="section_4"><h5 id="Testen">Testen<a class="headerlink" href="#Testen">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">kinit Administrator@EXAMPLE.COM
Password for Administrator@EXAMPLE.COM: **** </pre></div></div><p>Wobei <code class="notranslate">Administrator</code> auch jeder andere User sein kann, der Domänen-Admin ist. War nun alles erfolgreich, dann gibt <code class="notranslate">klist</code> ein Ticket aus.</p><div class="bash"><div class="contents"><pre class="notranslate">klist </pre></div></div></div><div class="section_4"><h5 id="Ausgabe">Ausgabe<a class="headerlink" href="#Ausgabe">¶</a></h5><p>
</p><pre class="notranslate">Ticket cache: FILE:/tmp/krb5cc_0
Default principal: Administrator@EXAMPLE.COM
Valid starting     Expires            Service principal
12/20/06 12:10:43  12/20/06 18:50:43  krbtgt/EXAMPLE.COM@EXAMPLE.COM


Kerberos 4 ticket cache: /tmp/tkt1000
klist: You have no tickets cached</pre><p>Damit ist die Installation von Kerberos abgeschlossen.</p></div></div><div class="section_3"><h4 id="Der-Domaene-beitreten">Der Domäne beitreten<a class="headerlink" href="#Der-Domaene-beitreten">¶</a></h4><p>
Dazu muss zuerst eine neue Samba-Konfiguration (<strong>/etc/samba/smb.conf</strong>) erstellt werden. Natürlich sollte man sich vorher wieder eine Sicherung der Originaldatei anlegen. Die neue Samba-Konfiguration (<strong>/etc/samba/smb.conf</strong>) erstellt man mit einem Editor. Je nachdem, welche Domäne verwendet wird, nach einem der folgenden Beispiele.</p><div class="section_4"><h5 id="Samba-Konfiguration-fuer-Active-Directory-Domaenen">Samba-Konfiguration für Active-Directory-Domänen<a class="headerlink" href="#Samba-Konfiguration-fuer-Active-Directory-Domaenen">¶</a></h5><p>
</p><pre class="notranslate">  [global]
  security = ads
  realm = EXAMPLE.COM
  password server = IPADRESSE     #IP des Domain Controllers
  workgroup = EXAMPLE
  idmap uid = 10000-20000
  idmap gid = 10000-20000
  winbind enum users = yes
  winbind enum groups = yes
  winbind cache time = 10
  winbind use default domain = yes
  template homedir = /home/%U
  template shell = /bin/bash
  client use spnego = yes
  client ntlmv2 auth = yes
  encrypt passwords = yes
  restrict anonymous = 2
  domain master = no
  local master = no
  preferred master = no
  os level = 0</pre></div><div class="section_4"><h5 id="Ohne-ADS-Authentifizierung">Ohne ADS Authentifizierung<a class="headerlink" href="#Ohne-ADS-Authentifizierung">¶</a></h5><p>
</p><pre class="notranslate">  [global]
  workgroup = EXAMPLE
  idmap uid = 10000-20000
  idmap gid = 10000-20000
  template shell = /bin/bash
  template homedir = /home/%U
  winbind enum users = yes
  winbind enum groups = yes
  winbind cache time = 10
  winbind separator = +
  winbind use default domain = yes
  security = domain
  password server = *
  encrypt passwords = yes
  domain master = no
  local master = no
  preferred master = no
  os level = 0</pre><p>
Jetzt tritt man der Domäne bei, bevor man winbind neu startet, da es sonst nicht hoch fährt.</p></div><div class="section_4"><h5 id="Active-Directory-Domaene-beitreten">Active Directory Domäne beitreten<a class="headerlink" href="#Active-Directory-Domaene-beitreten">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">net ads join -U Administrator </pre></div></div></div><div class="section_4"><h5 id="Domaene-ohne-ADS-beitreten">Domäne ohne ADS beitreten<a class="headerlink" href="#Domaene-ohne-ADS-beitreten">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">net rpc join -U Administrator </pre></div></div><p>Nach jeder Änderung an der Samba-Konfiguration (und auch nach jeder PAM-Änderung) muss Winbind neu gestartet werden.</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/winbind restart </pre></div></div><p>
Nun sollte man der Domäne erfolgreich beigetreten sein. Der Computer sollte auf dem Server unter "Computers" auftauchen.</p></div><div class="section_4"><h5 id="Testen-2">Testen<a class="headerlink" href="#Testen-2">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">wbinfo -u </pre></div></div><p>
sollte eine Liste der Domainbenutzer ausgeben.</p><div class="bash"><div class="contents"><pre class="notranslate">wbinfo -g </pre></div></div><p>
Sollte eine Liste der Domaingruppen ausgeben.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Sollte man die Meldung <code class="notranslate">Error looking up domain groups</code> bekommen, startet man Winbind noch einmal neu. 
</p></div></div></div></div><div class="section_3"><h4 id="Konfiguration-der-Authentication">Konfiguration der Authentication<a class="headerlink" href="#Konfiguration-der-Authentication">¶</a></h4><p>
Man öffnet die Datei <strong>/etc/nsswitch.conf</strong> in einem Editor und macht die folgenden Anpassungen:</p><pre class="notranslate">  passwd:         compat winbind
  group:          compat winbind
  shadow:         compat</pre><div class="section_4"><h5 id="Testen-3">Testen<a class="headerlink" href="#Testen-3">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/winbind restart </pre></div></div><div class="bash"><div class="contents"><pre class="notranslate">getent passwd </pre></div></div><p>
sollte nun ebenfalls die Domänenbenutzer ausgeben.</p><div class="bash"><div class="contents"><pre class="notranslate">getent group </pre></div></div><p>
sollte nun ebenfalls die Domänengruppen ausgeben.</p></div></div><div class="section_3"><h4 id="PAM-Konfiguration">PAM Konfiguration<a class="headerlink" href="#PAM-Konfiguration">¶</a></h4><p>
Die Pluggable Authentication Modules (PAM) sind eine Softwarebibliothek, die eine allgemeine Programmierschnittstelle (API) für Authentifizierungsdienste zur Verfügung stellt. PAM muss nun an eine Authentifizierung mit Winbind angepasst werden. Die entsprechenden PAM-Konfigurationsdateien befinden sich alle im Verzeichnis <strong>/etc/pam.d/</strong>.</p><p>Benutzer, die mithilfe einer Active Directory bzw. Windows NT Domäne verwaltet werden, sind nicht in den Linuxgruppen, welche Ubuntu verwendet. Diese Gruppen sind jedoch wichtig, um zum Beipiel auf USB-Geräte oder die Soundkarte (Lautstärke) zuzugreifen. Um diesen Benutzern die richtigen Gruppen zuzuweisen, wird <code class="notranslate">pam_group</code> benötigt. Damit werden die Windows-User in die entsprechenden Linuxgruppen aufgenommen.</p><p><strong>group.conf</strong> (<strong>/etc/security/group.conf</strong>): 
</p><pre class="notranslate"> * ; * ; * ; Al0000-2400 ; floppy, audio, cdrom, video, usb, plugdev, users</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ab Ubuntu 14.04 ist eine manuelle Änderung der PAM-Konfiguration (Dateien in <strong>/etc/pam.d/</strong>) nicht mehr notwendig, sondern findet automatisiert bei der Installation statt. Lediglich das Erstellen der Home-Ordner muss nachträglich mit <code class="notranslate">pam-auth-update</code> aktiviert werden.
</p></div></div><p><strong>common-account</strong> (<strong>/etc/pam.d/common-account</strong>):</p><pre class="notranslate">  account sufficient       pam_winbind.so
  account required         pam_unix.so</pre><p><strong>common-auth</strong> (<strong>/etc/pam.d/common-auth</strong>):</p><pre class="notranslate">  auth required   pam_group.so use_first_pass 
  auth sufficient pam_winbind.so
  auth sufficient pam_unix.so nullok_secure use_first_pass
  auth required   pam_deny.so</pre><p><strong>common-session</strong> (<strong>/etc/pam.d/common-session</strong>):</p><pre class="notranslate">  session required pam_unix.so
  session required pam_mkhomedir.so umask=0022 skel=/etc/skel
  session optional pam_foreground.so</pre><p><strong>sudo</strong> (<strong>/etc/pam.d/sudo</strong>): 
</p><pre class="notranslate">  auth sufficient pam_winbind.so
  auth sufficient pam_unix.so use_first_pass
  auth required   pam_deny.so

  @include common-account</pre><div class="section_4"><h5 id="Testen-4">Testen<a class="headerlink" href="#Testen-4">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/winbind stop
/etc/init.d/samba restart
/etc/init.d/winbind start </pre></div></div><p>Nun sollte man sich mit einem Domänenbenutzer anmelden können. Da es bei Fehlern an der obrigen Konfiguration vorkommen kann, dass man sich gar nicht mehr anmelden kann, ist es am besten, man testet die Anmeldung per <a class="internal" href="./ssh.html">SSH</a> und meldet sich vorsichtshalber nicht ab. Wenn auf dem Client ein SSH-Server installiert ist, sollte es nun möglich sein, sich auf diesen mit einem Domänen-Benutzer anzumelden. Näheres dazu findet man im Artikel <a class="internal" href="./ssh.html">SSH</a>.</p></div><div class="section_4"><h5 id="GUI-Login">GUI-Login<a class="headerlink" href="#GUI-Login">¶</a></h5><p>
Um sich in neueren Ubuntu-Versionen mit einem Domain-Account über die GUI anmelden zu können, muss zunächst die Eingabe eines beliebigen Benutzernamens freigeschaltet werden. Hierzu in <strong>/usr/share/lightdm/lightdm.conf.d/50-unity-greeter.conf</strong> die Konfiguration anpassen:
</p><pre class="notranslate">  [SeatDefaults]
  greeter-session=unity-greeter
  allow-guest=false
  greeter-show-remote-login=false
  greeter-show-manual-login=true
  greeter-hide-users=true</pre></div></div><div class="section_3"><h4 id="root-Rechte">root-Rechte<a class="headerlink" href="#root-Rechte">¶</a></h4><p>
Um einer Domain-Gruppe root-Rechte zu geben, muss diese in <strong>/etc/sudoers</strong> eingefügt werden:
</p><pre class="notranslate">  %gruppenname  ALL=(ALL:ALL) ALL</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Gruppen- oder Benutzernamen immer in Kleinbuchstaben angeben, auch wenn im Domain-Controller eine gemischte Schreibweise verwendet wird (z.B. <code class="notranslate">GruppenName</code> wird zu <code class="notranslate">gruppenname</code>)!
</p></div></div></div></div><div class="section_2"><h3 id="Optionale-Erweiterungen">Optionale Erweiterungen<a class="headerlink" href="#Optionale-Erweiterungen">¶</a></h3><p>
</p><div class="section_3"><h4 id="PAM-Mount">PAM Mount<a class="headerlink" href="#PAM-Mount">¶</a></h4><p>
Einhängen eines Netzlaufwerks mit den Rechten des entsprechenden Users.</p><div class="section_4"><h5 id="Pakete-installieren-2">Pakete installieren<a class="headerlink" href="#Pakete-installieren-2">¶</a></h5><p>
</p><ul><li><p><strong>libpam-mount</strong> (<em>universe</em>, <sup><a href="#source-2">[2]</a></sup> )</p></li><li><p><strong>cifs-utils</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libpam-mount cifs-utils </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install libpam-mount cifs-utils </pre></div></div><p>
</p></div></div></div><div class="section_4"><h5 id="PAM-Konfiguration-erweitern">PAM Konfiguration erweitern<a class="headerlink" href="#PAM-Konfiguration-erweitern">¶</a></h5><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ab Ubuntu 14.04 ist eine manuelle Änderung der PAM-Konfiguration (Dateien in <strong>/etc/pam.d/</strong>) nicht mehr notwendig, sondern findet automatisiert bei der Installation statt.
</p></div></div><p><strong>common-auth</strong> (<strong>/etc/pam.d/common-auth</strong>):</p><pre class="notranslate">  auth required   pam_mount.so
  auth sufficient pam_unix.so nullok_secure use_first_pass
  auth required   pam_group.so use_first_pass 
  auth sufficient pam_winbind.so use_first_pass
  auth required   pam_deny.so</pre><p><strong>common-session</strong> (<strong>/etc/pam.d/common-session</strong>):</p><pre class="notranslate">  session required pam_unix.so
  session required pam_mkhomedir.so umask=0022 skel=/etc/skel
  session optional pam_foreground.so
  session optional pam_mount.so</pre><p>Die pam_mount-Konfiguration befindet sich  in <strong>/etc/security/pam_mount.conf.xml</strong>. Mögliche Einträge sind mittels <code class="notranslate">man 5 pam_mount.conf</code> ersichtlich; es stehen insbesondere die Variablen <code class="notranslate">%(USER)</code>, <code class="notranslate">%(DOMAIN_NAME)</code>, <code class="notranslate">%(DOMAIN_USER)</code> zur Verfügung.</p><p>Die Konfiguration sieht folgendermaßen aus:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="nt">&lt;pam_mount&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
  <span class="nt">&lt;volume</span> <span class="na">fstype=</span><span class="s">"cifs"</span> <span class="na">server=</span><span class="s">"MEINSERVER"</span> <span class="na">path=</span><span class="s">"FREIGABE"</span> <span class="na">mountpoint=</span><span class="s">"/media/freigabe"</span> <span class="na">options=</span><span class="s">"iocharset=utf8,uid=xyz,dmask=0700"</span> <span class="nt">/&gt;</span>
  <span class="c">&lt;!-- ... --&gt;</span>
<span class="nt">&lt;/pam_mount&gt;</span>
</pre></div>
</td></tr></table></div><p>
Dabei ist zu beachten:</p><table><tr><td> <code class="notranslate">//meinserver/freigabe</code> </td><td> kann eingehängt werden </td></tr><tr><td> <code class="notranslate">//meinserver/freigabe/unterverzeichnis</code> </td><td> kann NICHT eingehängt werden </td></tr></table><p>
Es ist also nicht möglich, Unterverzeichnisse von Freigaben zu verbinden.</p><p>Mit dem Eintrag <code class="notranslate">&lt;luserconf name=".pam_mount.conf.xml" /&gt;</code> aktiviert man, dass zusätzlich benutzerspezifisch die Datei <code class="notranslate">$HOME/.pam_mount.conf.xml</code> eingelesen wird.</p></div><div class="section_4"><h5 id="Passwort-Text-bei-GUI-Login-aendern">Passwort-Text bei GUI-Login ändern<a class="headerlink" href="#Passwort-Text-bei-GUI-Login-aendern">¶</a></h5><p>
Nach der oben beschriebenen Änderung der <strong>/etc/pam.d/common-auth</strong> erscheint beim GUI-Login im Passwortfeld der Text <code class="notranslate">pam_mount password:</code>. Um wieder <code class="notranslate">password:</code> (oder jeden beliebigen anderen Text) anzuzeigen in <strong>/etc/security/pam_mount.conf.xml</strong> folgende Zeile vor <code class="notranslate">&lt;/pam_mount&gt;</code> ergänzen:
</p><pre class="notranslate">&lt;msg-authpw&gt;password:&lt;/msg-authpw&gt;
</pre></div></div></div></div><div class="section_1"><h2 id="Problemloesungen">Problemlösungen<a class="headerlink" href="#Problemloesungen">¶</a></h2><p>
</p><div class="section_2"><h3 id="no-logon-servers">no logon servers<a class="headerlink" href="#no-logon-servers">¶</a></h3><p>
Sollte diese Meldung beim Anmelden eines Domänenbenutzers auftauchen, muss wahrscheinlich die Startreihenfolge von Winbind und Samba modifziert werden. Dazu müssen alle Dateien mit dem Namen <strong>S20winbind</strong> und <strong>S20samba</strong> in den Ordnern <strong>/etc/rc2.d, rc3.d, rc4.d, rc5.d</strong> in <strong>S45winbind</strong> und <strong>S45samba</strong> umbenannt werden.</p><div class="bash"><div class="contents"><pre class="notranslate">mv /etc/rc2.d/S20winbind /etc/rc2.d/S45winbind
mv /etc/rc3.d/S20winbind /etc/rc3.d/S45winbind
mv /etc/rc4.d/S20winbind /etc/rc4.d/S45winbind
mv /etc/rc5.d/S20winbind /etc/rc5.d/S45winbind
mv /etc/rc2.d/S20samba /etc/rc2.d/S45samba
mv /etc/rc3.d/S20samba /etc/rc3.d/S45samba
mv /etc/rc4.d/S20samba /etc/rc4.d/S45samba
mv /etc/rc5.d/S20samba /etc/rc5.d/S45samba </pre></div></div><p>Dadurch wird Samba und Winbind in der Bootreihenfolge etwas nach hinten verschoben.</p><p>Bei selbigem Problem ab Ubuntu <strong>16.10</strong> kann es helfen die Zeile in <strong>/etc/systemd/system/multi-user.target.wants/winbind.service</strong> anzupassen:
</p><pre class="notranslate">After=network.target nmbd.target</pre><p>
zu
</p><pre class="notranslate">After=network-online.target</pre></div><div class="section_2"><h3 id="Die-TLD-der-Domain-ist-local-example-local">Die TLD der Domain ist .local (example.local)<a class="headerlink" href="#Die-TLD-der-Domain-ist-local-example-local">¶</a></h3><p>
Der Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">ping FQDN </pre></div></div><p>
endet mit:</p><pre class="notranslate">ping: unknown host meinserver.example.local</pre><p>
Das Problem lässt sich damit begründen, dass die TDL ".local" standardisiert via mDNS (Multicast-DNS) aufgelöst wird. Um dieses Verhalten abzuschalten, muss man in der Datei <strong>/etc/nsswitch.conf</strong> die Zeile</p><pre class="notranslate">hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4</pre><p>
in</p><pre class="notranslate">hosts: files dns mdns4</pre><p>
geändert werden.</p></div><div class="section_2"><h3 id="Namensaufloesung">Namensauflösung<a class="headerlink" href="#Namensaufloesung">¶</a></h3><p>
Für alle, die Probleme bei der Namensauflösung von Hostnamen in einem Windowsnetzwerk haben, kann der folgende Tipp hilfreich sein. Da es sich um ein gerade bei Einsteigern recht häufiges Problem handelt, sollte man aber auch weitere <a class="internal" href="./samba_client_gnome.html#Probleme-und-Loesungen">Problemlösungen</a> in Betracht ziehen.</p><p>Man editiert die Datei <strong>/etc/nsswitch.conf</strong> mit Root-Rechten und ergänzt diese um <code class="notranslate">wins</code>:</p><pre class="notranslate">hosts: files wins dns</pre></div><div class="section_2"><h3 id="Upgrade-von-Ubuntu-12-04-auf-14-04">Upgrade von Ubuntu 12.04 auf 14.04<a class="headerlink" href="#Upgrade-von-Ubuntu-12-04-auf-14-04">¶</a></h3><p>
Befindet sich der Server als Mitglied in einem Active Directory, funktionieren nach einem Upgrade von Ubuntu 12.04 auf 14.04 die Freigaben auf dem Server nicht mehr, da sich der Samba-Server nicht mehr gegen den Domänen-Controller authentifizieren kann. Grund ist, dass Ubuntu beim Update 2 Pakete vergisst. Das Problem sollte sich leicht beheben lassen:</p><ul><li><p><strong>libnss-winbind</strong> (<em>universe</em>)</p></li><li><p><strong>libpam-winbind</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libnss-winbind libpam-winbind </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install libnss-winbind libpam-winbind </pre></div></div><p>
</p></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://samba.org/samba/" rel="nofollow">Die englischsprachige Hauptseite des Samba-Teams</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/ActiveDirectoryWinbindHowto">ActiveDirectoryWinbindHowto</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.64-bit.de/dokumentationen/netzwerk/b/003/winbind.html" rel="nofollow">Winbind-Dokumentation</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> </p></li><li><p><a class="external" href="http://ubuntuforums.org/showthread.php?t=5409" rel="nofollow">HOWTO: NT Domain Authentifizierung</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Active_Directory">Beschreibung Active Directory und FQDN</a></p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Active_Directory_Service">Beschreibung ADS</a></p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./samba_winbind/a/revision/945726.html">Diese Revision</a> wurde am 25. Dezember 2017 22:50 von <a href="https://ubuntuusers.de/user/sonic4185/">sonic4185</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./samba_winbind.html">Samba Winbind</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>