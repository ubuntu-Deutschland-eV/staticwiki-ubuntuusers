<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>rsnapshot › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./rsnapshot.html">rsnapshot</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/rsnapshot">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./rsnapshot/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./rsnapshot/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./rsnapshot/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./rsnapshot/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./rsnapshot/a/backlinks.html">rsnapshot</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Paketen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./editor.html">Einen Texteditor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Dateisystem-des-Zielmediums">Dateisystem des Zielmediums
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a><ol class="arabic"><li><a class="crosslink" href="#Backup-Zielverzeichnis">Backup-Zielverzeichnis
</a></li><li><a class="crosslink" href="#Zielverzeichnis-nicht-automatisch-erzeugen">Zielverzeichnis nicht automatisch erzeug...</a></li><li><a class="crosslink" href="#Aufbewahrungszeitraeume">Aufbewahrungszeiträume
</a></li><li><a class="crosslink" href="#Logausgaben-und-datei">Logausgaben und -datei
</a></li><li><a class="crosslink" href="#Verzeichnisse-Dateien-ein-und-ausschliessen">Verzeichnisse/Dateien ein- und ausschlie...</a></li><li><a class="crosslink" href="#Zu-sichernde-Verzeichnisse">Zu sichernde Verzeichnisse
</a></li><li><a class="crosslink" href="#Externen-Server-sichern">Externen Server sichern
</a></li><li><a class="crosslink" href="#Fortschritt-im-berblick-behalten">Fortschritt im Überblick behalten
</a></li><li><a class="crosslink" href="#Nach-Konfigurationsaenderungen">Nach Konfigurationsänderungen
</a></li></ol></li><li><a class="crosslink" href="#Ausfuehrung">Ausführung
</a><ol class="arabic"><li><a class="crosslink" href="#Von-Hand">Von Hand
</a></li><li><a class="crosslink" href="#cron-fuer-Server">cron (für Server)
</a></li><li><a class="crosslink" href="#anacron-fuer-Desktops">anacron (für Desktops)
</a></li><li><a class="crosslink" href="#Wiederherstellung">Wiederherstellung
</a></li></ol></li><li><a class="crosslink" href="#Funktionsweise-der-Sicherung">Funktionsweise der Sicherung
</a></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/terminal.png" class="image-left" src="./_/e81889fd6e485dd32e1cde611eabc18abced7993.png"/>
Mit <a class="external" href="http://www.rsnapshot.org/" rel="nofollow">rsnapshot</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist es möglich, sogenannte "Snapshot"-Ordner zur <a class="internal" href="./sicherheit.html#Sicherungskopien">Datensicherung</a> auf z.B. einer externen USB-Festplatte zu erstellen. In diesen Ordnern liegt eine Kopie der zu sichernden Verzeichnis-Struktur und der Dateien. Sie können aus diesen Ordnern heraus direkt gelesen/restauriert werden. rsnapshot überprüft dabei selbstständig, welche Dateien neu hinzu gekommen sind oder entfernt wurden.</p><p>Ein Vorteil von rsnapshot, das wiederum auf <a class="internal" href="./rsync.html">rsync</a> basiert, ist, dass die unveränderten Dateien und Verzeichnisse nur einmal gesichert werden. In allen weiteren Snapshots wird lediglich ein Hardlink auf die vorhandene Datei gesetzt. Das kostet fast keinen Speicherplatz und erlaubt viele Sicherungen ohne entsprechenden Platzverbrauch. Auch wenn viele Snapshot-Ordner erstellt wurden, belegt jede Datei, solange sie nicht geändert wurde, nur einmal Plattenplatz.</p><p>rsnapshot ist nur mit Einschränkungen für sich häufig ändernde Dateien geeignet. Diese werden bei jedem Sicherungslauf neu gesichert und erhöhen den Platzbedarf beträchtlich. Ein Beispiel sind Mailboxen, Datenbanken oder Logfiles. Für diese ist eher rdiff in Kombination mit regelmäßigen Dumps zu empfehlen. Alternativ bzw. ergänzend kann ein getrennter rsnapshot-Job für diese aufgesetzt werden, der größere Intervalle aufweist.</p><p>Eine Alternative mit grafischer Konfiguration und Bedienung ist <a class="internal" href="./back_in_time.html">Back In Time</a>. Allgemeine Hinweise zum Thema Datensicherung und zu weiterenProgrammen finden sich im entsprechenden Artikel <a class="internal" href="./datensicherung.html">Datensicherung</a>.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
rsnapshot befindet sich in den offiziellen Paketquellen <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>rsnapshot</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install rsnapshot </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install rsnapshot </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Dateisystem-des-Zielmediums">Dateisystem des Zielmediums<a class="headerlink" href="#Dateisystem-des-Zielmediums">¶</a></h2><p>
rsnapshot macht ein inkrementelles Backup und verwendet hierfür sogenannte <a class="internal" href="./ln.html#Hardlinks">Hardlinks</a>. Dadurch muss jede unveränderte Datei nur einmal gesichert werden. Ab diesem Zeitpunkt wird sie nur verlinkt. Diese Tatsache macht es allerdings notwendig, auf dem Zielmedium, also z.B. einer externen USB-Festplatte, ein Hardlink-fähiges <a class="internal" href="./dateisystem.html">Dateisystem</a> zu haben. Die gängigen Linux-Dateisysteme, z. B. <strong>ext3</strong>, <strong>ext4</strong>, unterstützen solche Links. Inzwischen ist es auch möglich, von Linux aus auf <strong>NTFS</strong>-Partitionen Hardlinks zu erzeugen. Die <strong>FAT</strong>..-Dateisysteme hingegen scheiden für rsnapshot aus.</p></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Die Konfiguration von rsnapshot erfolgt über die Datei <strong>/etc/rsnapshot.conf</strong>. Diese Datei wird bei der Installation automatisch angelegt und kann mit einem Texteditor mit Root-Rechten <sup><a href="#source-2">[2]</a></sup> angepasst werden. Folgend werden nun die wichtigsten Konfigurationen kurz angesprochen. Für eine ausführliche Erklärung zu allen Parameter sei auf die Kommentare in der Datei bzw. die <a class="external" href="http://www.rsnapshot.org/rsnapshot.html" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> verwiesen.</p><p>Die Reihenfolge der Parameter in diesem Artikel entspricht der in der Konfigurationsdatei. Daher scheinen die einzelnen Konfigurationsschritte hier in einer nicht besonders logischen Reihenfolge zu sein.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Verzeichnisse müssen mit <strong>/</strong> enden. Daher muss man z. B. <strong>/home/user/</strong> statt <strong>/home/user</strong> benutzen. Nach dem letzten <strong>/</strong> darf kein Leerzeichen mehr stehen.</p><p>Das Trennungszeichen zwischen Schlüssel und Wert ist 
<span class="key">Tab ⇆</span> . Werden Schlüssel und Wert mit Leerzeichen getrennt, ist die Datei nicht valide.
</p></div></div><div class="section_2"><h3 id="Backup-Zielverzeichnis">Backup-Zielverzeichnis<a class="headerlink" href="#Backup-Zielverzeichnis">¶</a></h3><p>
<strong>snapshot_root</strong> ist das Zielverzeichnis, in dem die Backups abgelegt werden. Unterhalb dieses Verzeichnisses werden noch weitere Ordner angelegt, dazu aber unten mehr.</p><pre class="notranslate">snapshot_root	/var/cache/rsnapshot/</pre><p>Es ist natürlich auch möglich, die Backups auf z.B. einer externen USB-Festplatte abzulegen. Für diesen Fall sollte das Medium während/nach dem Start des Systems automatisch gemountet werden. Weitere Informationen zu diesem Thema finden sich in den Artikeln <a class="internal" href="./mount.html">mount</a> und <a class="internal" href="./fstab.html">fstab</a>.</p></div><div class="section_2"><h3 id="Zielverzeichnis-nicht-automatisch-erzeugen">Zielverzeichnis nicht automatisch erzeugen<a class="headerlink" href="#Zielverzeichnis-nicht-automatisch-erzeugen">¶</a></h3><p>
Wenn das Backup auf einem externen Medium, z.B. einer USB-Platte, gespeichert werden soll, dann darf rsnapshot natürlich nur dann speichern, wenn die Platte auch tatsächlich am Rechner angeschlossen und eingeschaltet ist. Andernfalls würde rsnapshot die Sicherungen auf der lokalen Platte z.B. unter <strong>/media/usb...</strong> ablegen. Um dies zu verhindern, muss das <strong>#</strong> vor dem folgenden Parameter entfernt und der Wert auf <strong>1</strong> gesetzt werden.</p><pre class="notranslate">no_create_root	1</pre></div><div class="section_2"><h3 id="Aufbewahrungszeitraeume">Aufbewahrungszeiträume<a class="headerlink" href="#Aufbewahrungszeitraeume">¶</a></h3><p>
Mittels des Schlüssels <code class="notranslate">retain</code> (früher <code class="notranslate">interval</code>) wird die Aufbewahrungsdauer der verschiedenen Backups definiert.</p><pre class="notranslate">#retain		hourly  6
retain		daily   7
retain		weekly  4
retain		monthly 6</pre><p>In diesem Beispiel werden stündliche Backups nicht aufgehoben (zu erkennen an dem #). Von den täglichen Backups werden 7 aufgehoben, was also bei einem System, das wirklich jeden Tag ein Backup macht, genau einer Woche entspricht. Von den wöchentlichen Backups werden 4, von den monatlichen 6 aufgehoben. Das neueste zur Verfügung stehende Backup ist daher von heute bzw. gestern, das älteste von vor einem halben Jahr.</p><p>Es werden immer erst die definierten Sicherungen ausgeführt, bevor die nächste Stufe initiiert wird. Das bedeutet, der Versuch, rsnapshot mit <code class="notranslate">rsnapshot monthly</code> aufzurufen, scheitert so lange, wie nicht alle definierten und nicht auskommentierten Vorabsicherungen mindestens einmal durchlaufen wurden.</p><p>Da rsnapshot ein inkrementelles Backup mit platzsparenden Hardlinks macht, können, je nach Menge der veränderten Daten, sehr viele Backups aufgehoben werden.</p></div><div class="section_2"><h3 id="Logausgaben-und-datei">Logausgaben und -datei<a class="headerlink" href="#Logausgaben-und-datei">¶</a></h3><p>
Die Standardeinstellungen für das Logverhalten von rsnapshot sind für bereits laufende Systeme optimiert. In der Konsole werden nur Fehler ausgegeben, eine Logdatei wird gar nicht erzeugt. Diese Einstellungen sind allerdings gerade beim Einrichten eines Backups sehr hinderlich, da man keine Informationen bekommt, ob rsnapshot gerade etwas tut und vor allem was es tut. Für die ersten Testläufe sind die folgenden Einstellungen sinnvoll, diese können bei Bedarf nach den ersten erfolgreichen Backups wieder auf den Originalzustand zurückgesetzt werden.</p><pre class="notranslate">verbose		4
loglevel	4
logfile		/var/log/rsnapshot</pre></div><div class="section_2"><h3 id="Verzeichnisse-Dateien-ein-und-ausschliessen">Verzeichnisse/Dateien ein- und ausschließen<a class="headerlink" href="#Verzeichnisse-Dateien-ein-und-ausschliessen">¶</a></h3><p>
Je nachdem, welche Verzeichnisse gesichert werden sollen, empfehlen sich die folgenden <code class="notranslate">excludes</code> (Achtung: die Leerzeichen hinter "exclude" müssen TABs sein!):</p><pre class="notranslate">exclude Recycled/
exclude Trash/
exclude lost+found/
exclude .gvfs/          ## nur bis Ubuntu 12.04 erforderlich</pre><p>Der Papierkorb (<strong>Recycled/</strong> bzw. <strong>Trash/</strong>) sollte auf jeden Fall ausgenommen werden.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Das Verzeichnis <strong>~/.gfvs</strong> muss zwingend ausgenommen werden, wenn man das Homeverzeichnis sichern will. Da das von rsnapshot verwendete rsync nicht die notwendigen Rechte hat, um in diesem Verzeichnis zu löschen, wird der Sicherungsvorgang sofort abgebrochen und die folgende Fehlermeldung ausgegeben.</p><pre class="notranslate">rsync: readlink_stat("/home/user/.gvfs") failed: Permission denied (13)
IO error encountered -- skipping file deletion
rsync error: some files/attrs were not transferred (see previous errors) (code 23) at main.c(1057) [sender=3.0.6]</pre><p>Weitere Informationen zu diesem Problem finden sich in diesem <a class="crosslink post" href="https://forum.ubuntuusers.de/post/2223919/">Beitrag</a> im Forum.
</p></div></div></div><div class="section_2"><h3 id="Zu-sichernde-Verzeichnisse">Zu sichernde Verzeichnisse<a class="headerlink" href="#Zu-sichernde-Verzeichnisse">¶</a></h3><p>
In <strong>/etc/rsnapshot.conf</strong> wird in den Zeilen, die mit <code class="notranslate">backup</code> beginnen, angegeben, welche Verzeichnisse zu sichern sind. Seit Version 1.2 gilt dabei folgende Syntax:</p><pre class="notranslate">backup   /home/        localhost/
backup   /etc/         localhost/
backup   /usr/local/   localhost/</pre><p>Der zweite Parameter in jeder Zeile <code class="notranslate">localhost/</code> stellt das Zielverzeichnis relativ zum Backup-Verzeichnis (<strong>snapshot_root</strong>) dar. Möchte man eine Datei aus einem Backup vor einer Woche wieder herstellen findet man diese entsprechend dem hier gezeigten Konfigurationsbeispiel unter: <strong>/var/cache/rsnapshot/weekly.1/localhost/</strong>.</p></div><div class="section_2"><h3 id="Externen-Server-sichern">Externen Server sichern<a class="headerlink" href="#Externen-Server-sichern">¶</a></h3><p>
Zum Sichern externer ("remote") Verzeichnisse bietet sich der Zugang über <a class="internal" href="./ssh.html">SSH</a> <span class="underline">ohne</span> Passphrase und mit einem dedizierten Backupnutzer an, der nur über beschränkte Rechte verfügt.</p><p>In einer Basiskonfiguration geht das auch direkt mit dem Rootuser, falls dieser nicht freigegeben ist [wie unter Ubuntu üblich], müssen dem Backupuser in der Sudoers-Datei <a class="internal" href="./sudo/konfiguration.html">sudo/Konfiguration</a> die entsprechenden Befehle freigegeben werden.</p><p>Die Syntax innerhalb <strong>rsnapshot.conf</strong> lautet:</p><pre class="notranslate">backup   backupuser@remotehost:/home/        remotehost/</pre><p>Dafür muss noch die <strong>rsnapshot.conf</strong> angepasst werden. Zunächst muss die Unterstützung für <a class="internal" href="./ssh.html">SSH</a> aktiviert werden.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Das ist zumindest unter <a class="internal" href="./wily.html">Ubuntu 15.04</a> nötig, frühere Versionen wurden hier nicht überprüft.
</p></div></div><p>
Dazu muss man die entsprechende Zeile auskommentieren:</p><pre class="notranslate"># Uncomment this to enable remote ssh backups over rsync.
#
cmd_ssh        /usr/bin/ssh</pre><p>
Außerdem muss noch der richtige öffentliche Schlüssel angegeben werden:</p><pre class="notranslate">ssh_args        -o BatchMode=yes -i /home/backupuser/.ssh/id_dsa</pre><p>In diesem Beispiel hat der <code class="notranslate">backupuser</code> ein eigenes Homeverzeichnis. Sicherer ist es, dem Benutzer keine eigenes Homeverzeichnis zuzuweisen, sondern ein Verzeichnis unter <strong>/var/.ssh/</strong> einzurichten, in dem die Schlüssel gespeichert werden. Auf dieses wird dann in der <strong>rsnapshot.conf</strong> verwiesen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Falls zu dem Server noch nie zuvor eine SSH-Verbindung aufgebaut wurde, wird das zunächst ohne Fehlermeldung fehlschlagen, da dem Server nicht vertraut wird und die entsprechende Eingabeaufforderung durch <code class="notranslate">BatchMode=yes</code> unterdrückt wird.</p><p>Man kann aber einfach den ersten Sicherungslauf ohne diese Option starten, oder sich mit dem selben Benutzer, der danach für das Backup verwendet wird, manuell via SSH anmelden und die Identität des Servers bestätigen.
</p></div></div><p>Wenn man mehrere Server sichern möchte - jeden in ein eigenes Unterverzeichnis - dann kann es sinnvoll sein, dedizierte <strong>rsnapshot.conf</strong>-Dateien aufzusetzen, die dann getrennt per Cron aufgerufen werden.</p><p>Dafür müssen die Konfigurationsdateien an rsnapshot mit der folgenden Syntax übergeben werden:</p><div class="bash"><div class="contents"><pre class="notranslate">rsnapshot -c /PFAD/ZUR/KONFIGURATION/rsnapshot_conf1.conf  </pre></div></div><p>Zum einen können die Jobs dann getrennt aufgerufen werden, zum anderen kann dann auch der Backup über verschiedene "mountpoints" verteilt werden, da man pro <strong>rsnapshot.conf</strong> den Parameter <code class="notranslate">snapshot_root</code> unterschiedlich belegen kann.</p><p>Beispiele:</p><ul><li><pre class="notranslate">snapshot_root   /mnt/backup_SvrGrp1/</pre><p> </p></li></ul><p>
</p><ul><li><pre class="notranslate">snapshot_root   /mnt/backup_SvrGrp2/</pre></li></ul><p>
</p></div><div class="section_2"><h3 id="Fortschritt-im-berblick-behalten">Fortschritt im Überblick behalten<a class="headerlink" href="#Fortschritt-im-berblick-behalten">¶</a></h3><p>
Wenn man sich auf den Server, auf dem rsnapshot läuft, nur über SSH einloggt und trotzdem den Fortschritt im Auge behalten möchte, belastet das Öffnen mehrerer SSH-Verbindungen den Server unnötig. Außerdem ist das Terminal nach Schließen der SSH-Verbindung natürlich nicht mehr vorhanden. Eine Alternative ist die Nutzung von <a class="internal" href="./screen.html">Screen</a>, was es ermöglicht, das Fenster in den Hintergrund zu legen oder bei Bedarf auch zu "detachen", so dass die Verbindung geschlossen werden kann und bei einem späteren Wiederaufruf der SSH-Verbindung das Ausgabefenster wieder aufgerufen werden kann.</p><p>Die Steuerung des Outputs ist über den Verbose-Parameter von <strong>rsnapshot.conf</strong> unproblematisch möglich.</p></div><div class="section_2"><h3 id="Nach-Konfigurationsaenderungen">Nach Konfigurationsänderungen<a class="headerlink" href="#Nach-Konfigurationsaenderungen">¶</a></h3><p>
Nach der Anpassung der Konfigurationsdatei sollte geprüft werden, ob diese noch valide ist. Das erledigt der Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">rsnapshot configtest </pre></div></div></div></div><div class="section_1"><h2 id="Ausfuehrung">Ausführung<a class="headerlink" href="#Ausfuehrung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Von-Hand">Von Hand<a class="headerlink" href="#Von-Hand">¶</a></h3><p>
Aufgerufen wird rsnapshot dann im Terminal <sup><a href="#source-3">[3]</a></sup> mittels</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsnapshot hourly </pre></div></div><p>oder eben <code class="notranslate">daily</code> bzw. wie man es wünscht.</p></div><div class="section_2"><h3 id="cron-fuer-Server">cron (für Server)<a class="headerlink" href="#cron-fuer-Server">¶</a></h3><p>
Wenn man einen Server mittels rsnapshot sichern möchte, so empfiehlt sich die Verwendung eines <a class="internal" href="./cron.html">Cronjobs</a>. Dieser läuft in den gewünschten Intervallen immer zu einem festen Zeitpunkt und stößt somit das inkrementelle Backup an. Um rsnapshot mittels Cron zu starten, muss z. B. die Datei <strong>/etc/crontab</strong> erweitert werden.</p><pre class="notranslate">0 2 * * * root /usr/bin/rsnapshot daily
0 5 * * 1 root /usr/bin/rsnapshot weekly
0 7 1 * * root /usr/bin/rsnapshot monthly</pre></div><div class="section_2"><h3 id="anacron-fuer-Desktops">anacron (für Desktops)<a class="headerlink" href="#anacron-fuer-Desktops">¶</a></h3><p>
Das <a class="internal" href="./cron.html">Cronjob</a>-System ist auf Desktop-Systemen, also auf Rechnern, die nicht ununterbrochen laufen, nicht zu empfehlen, da Cronjobs immer zu festen Zeitpunkten ausgeführt werden. Ist der Zeitpunkt verstrichen und der Rechner war nicht eingeschaltet, wird die entsprechende Sicherung nicht durchgeführt. Daher sollte man für Desktop-Systeme auf <a class="internal" href="./cron.html#Anacron-Anac-h-ronistic-Cron">Anacron</a> zurückgreifen. Das garantiert, dass beispielsweise Jobs, die einmal täglich ausgeführt werden sollen, auch ausgeführt werden, wenn der Rechner zu der in der <a class="internal" href="./cron.html">crontab</a> angegeben Zeit nicht läuft.</p><p>Anacron-Jobs werden, im Gegensatz zu Cron, nicht in eine Datei eingetragen, sondern die Befehle werden in Dateien geschrieben und in entsprechenden Verzeichnissen abgelegt. Auf diese Weise wird zum Beispiel die Aktualisierungsverwaltung von Ubuntu gestartet.</p><p>Wenn man rsnapshot täglich von anacron aufrufen lassen will, in der Standardkonfiguration immer 5 Minuten nach dem Systemstart, erzeugt man in einem Editor mit Root-Rechten eine Datei mit beliebigem Namen, in unserem Beispiel <strong>rsnapshot</strong>, im Verzeichnis <strong>/etc/cron.daily/</strong>. In dieser Datei trägt man den <a class="internal" href="./shell/bash-skripting-guide_für_anfänger.html#Die-Shebang">Shebang</a>, gefolgt vom rsnapshot-Aufruf ein.</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/sh</span>
/usr/bin/rsnapshot daily
</pre></div>
</td></tr></table></div><p>
Die Datei speichern und den Editor wieder verlassen. Anschließend muss die Datei mit den Rechten von anacron ausführbar sein. Dazu verwendet man den <a class="internal" href="./chmod.html">chmod-Befehl</a>.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo chmod 755 /etc/cron.daily/rsnapshot </pre></div></div><p>
Für eine wöchentliche und monatliche Ausführung geht man wie oben beschrieben vor, tauscht jedoch <code class="notranslate">cron.daily</code> gegen <code class="notranslate">cron.weekly</code> oder <code class="notranslate">cron.monthly</code>. Der Ausdruck im rsnapshot-Befehl muss nicht zwangsläufig getauscht werden, die Intervallnamen haben hier nur symbolischen Charakter. Aus Gründen der Verständlichkeit ist eine Änderung hier natürlich auch sinnvoll, allerdings nur, wenn dem in der Konfiguration von rsnapshot auch entsprechend Rechnung getragen wird.</p></div><div class="section_2"><h3 id="Wiederherstellung">Wiederherstellung<a class="headerlink" href="#Wiederherstellung">¶</a></h3><p>
Wiederherstellung als Root ist natürlich ganz einfach. Wenn jedoch die gesicherten Dateien der Nutzer selbst rücksichern soll?</p><p>Die erzeugten Verzeichnisse sind für den Standardnutzer nicht selbsterklärend (<code class="notranslate">hourly.0/server/mnt/etc.</code>, usw.). Es liegt also nahe, entweder im Linux-Filesystem symbolische Verknüpfungen ("symlinks") mit selbsterklärenden Namen auf die rsnapshot-Verzeichnisse zu erzeugen, oder dasselbe in Samba zu tun und den Nutzern dann auf "ihre" Verzeichnisse Leserechte zu geben. Dann kann jeder Nutzer seine Daten einfach zurücksichern.</p></div></div><div class="section_1"><h2 id="Funktionsweise-der-Sicherung">Funktionsweise der Sicherung<a class="headerlink" href="#Funktionsweise-der-Sicherung">¶</a></h2><p>
Für das folgende Beispiel gilt, dass stündlich gesichert wird und die Aufbewahrungszeit 6 Stunden beträgt.  In der <strong>/etc/rsnapshot.conf</strong> steht also als Intervall:</p><pre class="notranslate">retain	hourly 6</pre><p>Das Zielverzeichnis ist standardmäßig <strong>/var/cache/rsnapshot/</strong>. Das Backup mit dem kleinsten Sicherungsintervall (hier: <code class="notranslate">hourly</code>) und der 0 ist immer das aktuellste. In dem Beispiel also <strong>/var/cache/rsnapshot/hourly.0/</strong>. Als Erstes wird die Lock-Datei angelegt, um gleichzeitige Aufrufe von rsnapshot zu verhindern. Dazu wird lediglich die Prozess-ID in die Lock-Datei geschrieben (rsnapshot prüft beim Start, ob die Datei vorhanden ist):</p><div class="bash"><div class="contents"><pre class="notranslate">echo [process-id] &gt; /var/run/rsnapshot.pid </pre></div></div><p>Nun prüft rsnapshot, ob das älteste Backup vorhanden ist, wenn ja, wird dieses gelöscht. Das älteste Backup hat die höchste Zahl, abhängig von der als Intervall hinterlegten Aufbewahrungszeit.</p><div class="bash"><div class="contents"><pre class="notranslate">rm -rf /var/cache/rsnapshot/hourly.5/  </pre></div></div><p>Anschließend werden alle anderen Ordner (mit Ausnahme von <strong>/var/cache/rsnapshot/hourly.0</strong>) inkrementiert, also die Zahl im Ordnernamen erhöht.</p><div class="bash"><div class="contents"><pre class="notranslate">mv 	/var/cache/rsnapshot/hourly.4/	 /var/cache/rsnapshot/hourly.5/ 
mv 	/var/cache/rsnapshot/hourly.3/	 /var/cache/rsnapshot/hourly.4/ 
mv	/var/cache/rsnapshot/hourly.2/	 /var/cache/rsnapshot/hourly.3/ 
mv 	/var/cache/rsnapshot/hourly.1/	 /var/cache/rsnapshot/hourly.2/  </pre></div></div><p>Im Anschluss daran wird <strong>hourly.0</strong> nach <strong>hourly.1</strong> per <a class="internal" href="./ln.html#Hardlinks">Hardlink</a> kopiert.</p><div class="bash"><div class="contents"><pre class="notranslate">cp -al /var/cache/rsnapshot/hourly.0 /var/cache/rsnapshot/hourly.1 </pre></div></div><p>Nun erfolgt die eigentliche Sicherung in den Ordner <strong>hourly.0</strong> (Der Befehlsaufbau kann je nach Konfiguration abweichen):</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -a --delete --numeric-ids --relative --delete-excluded \
  --exclude=/home/BENUTZERNAME/.gvfs /home \
  /var/cache/rsnapshot/hourly.0/localhost/ </pre></div></div><p>Jetzt wird der Zeitstempel des Ordners aktualisiert:</p><div class="bash"><div class="contents"><pre class="notranslate">touch /var/cache/rsnapshot/hourly.0/ </pre></div></div><p>Zum Abschluss wird die Lock-Datei wieder gelöscht:</p><div class="bash"><div class="contents"><pre class="notranslate">rm -f /var/run/rsnapshot.pid </pre></div></div></div><div class="section_1"><h2 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h2><p>
In Versionen bis 1.3.1 dürfen Pfade in <strong>/etc/rsnapshot.conf</strong> keine Leerzeichen enthalten. Um Verzeichnisse mit Leerzeichen im Pfad dennoch sichern zu können, muss man das Leerzeichen durch ein Fragezeichen ersetzen (Quellen: <a class="external" href="http://sourceforge.net/mailarchive/message.php?msg_id=23891237" rel="nofollow">Mailarchive auf SourceForge</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>, <a class="crosslink post" href="https://forum.ubuntuusers.de/post/3792997/">Forum</a>).</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.rsnapshot.org/" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p><ul><li><p><a class="external" href="http://rsnapshot.org/faq.html" rel="nofollow">FAQ</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - häufige Fragen und Antworten</p></li><li><p><a class="interwiki interwiki-github" href="https://github.com/rsnapshot/rsnapshot">Quellcode</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul></li><li><p><a class="external" href="http://www.openfsg.com/index.php/Install_and_setup_rsnapshot_to_make_automated_backups" rel="nofollow">Install and setup rsnapshot to make automated backups</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Weitere Informationen zur Einrichtung und Benutzung, 01/2008</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./rsnapshot/a/revision/942816.html">Diese Revision</a> wurde am 30. Juli 2017 01:40 von <a href="https://ubuntuusers.de/user/airigh/">airigh</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./rsnapshot.html">rsnapshot</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>