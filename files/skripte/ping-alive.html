<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Skripte/Ping-alive › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../skripte/ping-alive.html">Ping-alive</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Skripte/Ping-alive">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../skripte/ping-alive/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../skripte/ping-alive/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../skripte/ping-alive/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../skripte/ping-alive/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../skripte/ping-alive/a/backlinks.html">Ping-alive</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><p>Das Skript sendet <a class="internal" href="../cron.html">Cronjob</a>-gesteuert einen Ping an einen definierten Host. Wenn dieser nicht antwortet, wird eine Warnmail verschickt. Nachdem der Host wieder online ist, gibt es eine Entwarnung per Email. Die Warnmail wird nur einmal in 12 Stunden geschickt.</p><p>Das Skript benötigt das Programm <strong>mailx</strong> und natürlich einen <strong>MTA</strong> (postfix ist bei Ubuntu standardmäßig installiert), damit dieser die Mails verschicken kann.</p><div class="section_1"><h2 id="Vorbereitungen">Vorbereitungen<a class="headerlink" href="#Vorbereitungen">¶</a></h2><p>
In <strong>/etc/crontab</strong> wird folgendes eingetragen: 
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>*/15 * * * * /pfad/zum/skript.sh hostname email@adresse.de
</pre></div>
</td></tr></table></div><p>
am Besten bearbeitet man diese Datei mit: 
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo crontab -e </pre></div></div><p>
Oder es wird die mit der gleichen Zeile per 
</p><div class="bash"><div class="contents"><pre class="notranslate">crontab -e </pre></div></div><p>
das Skript als benutzerspezifischer Cronjob eingetragen. Das Skript arbeitet dann nur, wenn der Benutzer angemeldet ist.</p><p>Das Skript prüft nun alle 15 Minuten die Erreichbarkeit des angegebenen Hosts. Sollen mehrere Hosts geprüft werden, so muss für jeden Host ein eigener Eintrag in der <strong>/etc/crontab</strong> erfolgen.</p></div><div class="section_1"><h2 id="Skript">Skript<a class="headerlink" href="#Skript">¶</a></h2><p>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># a² - aquadraht@notmail.org 25.05.2005</span>
<span class="c1"># minimaler update - maba@freeshell.de 06.08.2015</span>
<span class="c1"># prüft erreichbarkeit und verschickt im fehlerfall eine mail</span>
<span class="c1"># syntax: checkhost.sh host recipient</span>

<span class="c1">#set -xv</span>

<span class="nv">TMPDIR</span><span class="o">=</span>/tmp                                                                     
<span class="nv">FILE</span><span class="o">=</span>ping-alarm-<span class="nv">$1</span>                                                              
<span class="nv">FLAG</span><span class="o">=</span><span class="nv">$TMPDIR</span>/<span class="nv">$FILE</span>

<span class="c1"># check, ob FLAG älter als 12h</span>
<span class="k">if</span> <span class="o">[</span> -f <span class="nv">$FLAG</span> <span class="o">]</span>
<span class="k">then</span>
        find <span class="nv">$TMPDIR</span> -name <span class="nv">$FILE</span> -mmin +720 -exec rm -f <span class="o">{}</span> <span class="se">\;</span>
<span class="k">fi</span>


<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$FLAG</span> <span class="o">]</span>
<span class="k">then</span>
        ping -c <span class="m">1</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="k">else</span>
        ping -c <span class="m">1</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
        <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">]</span>
        <span class="k">then</span>
        cat <span class="s">&lt;&lt; EOF | mailx -s "UFF! $1 is UP again!!" $2</span>
<span class="s">$1 is up!!!!</span>
<span class="s">`date`</span>
<span class="s">EOF</span>

        <span class="nb">cd</span> /tmp
        rm <span class="nv">$FLAG</span>
        <span class="k">fi</span>

<span class="k">fi</span>

<span class="c1"># verschicke Mail, wenn Host nicht erreichbar</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> !<span class="o">=</span> <span class="s2">"0"</span> <span class="o">]</span>
<span class="k">then</span>
        cat <span class="s">&lt;&lt; EOF | mailx -s "AARGH! $1 is DOWN!!" $2</span>
<span class="s">$1 is down!!!!</span>
<span class="s">`date`</span>
<span class="s">EOF</span>

<span class="nb">cd</span> /tmp
touch <span class="nv">$FLAG</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table></div><p></p></div></div>
<p class="meta">
<a href="../skripte/ping-alive/a/revision/830178.html">Diese Revision</a> wurde am 6. August 2015 15:21 von <a href="https://ubuntuusers.de/user/micressor/">micressor</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../skripte.html">Skripte</a></li>
<li><a href="../skripte/ping-alive.html">Ping-alive</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>