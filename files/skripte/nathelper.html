<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Skripte/nathelper › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../skripte/nathelper.html">nathelper</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Skripte/nathelper">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../skripte/nathelper/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../skripte/nathelper/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../skripte/nathelper/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../skripte/nathelper/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../skripte/nathelper/a/backlinks.html">nathelper</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li></ol></div></div><p>Dieses <a class="internal" href="../perl.html">Perl</a>-Skript dient dazu, mit einem einzigen Kommandozeilenbefehl einen Ubuntu-Router mit der nötigen Network Address Translation (NAT) Funktionalität auszustatten, ohne dass man sich mit der <a class="internal" href="../iptables.html">iptables-Syntax</a> beschäftigen muss.</p><div class="section_1"><h2 id="Installation-und-Benutzung">Installation und Benutzung<a class="headerlink" href="#Installation-und-Benutzung">¶</a></h2><p>
Einfach das Skript irgendwo hin kopieren, wo es passt, bspw. nach <strong>/usr/local/sbin/nathelper</strong>. Dann die geeigneten Kommandozeilenargumente (s.u.) zusammenstellen und wenn alles wie gewünscht funktioniert den Befehl in einem Startskript (bspw. in <strong>/etc/rc.local</strong>) konservieren.</p></div><div class="section_1"><h2 id="Syntax">Syntax<a class="headerlink" href="#Syntax">¶</a></h2><p>
Das Skript wird komplett über seine Argumente gesteuert<sup><a href="#source-1">[1]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">nathelper -i IFACE OPTIONEN IP PORT(S) </pre></div></div><p>Beispiele:</p><div class="bash"><div class="contents"><pre class="notranslate">nathelper -i ppp+ -m                                                   # nur Masquerading
nathelper -i ppp+ -m 192.168.6.5 80 21 192.168.6.6 6881-6889:7001-7009  # Masquerading und verschiedene Port-Weiterleitungen </pre></div></div><p>In diesem Beispiel wird auf dem externen ppp-Device (<code class="notranslate">ppp+</code> ist ein Joker-Ausdruck, der auf alle ppp-Devices zutrifft) Masquerading eingerichtet, sowie ein paar Ports nach innen weitergeleitet. Die Ports 80 und 21 werden an den Rechner 192.168.6.5 weitergeleitet und die Ports 6881 bis 6889 werden an die Ports 7001 bis 7009 des Rechners 192.168.6.6 weitergeleitet.</p><div class="section_2"><h3 id="Optionen">Optionen<a class="headerlink" href="#Optionen">¶</a></h3><p>
</p><ul><li><p><code class="notranslate">-i iface</code>: Gibt die externe Netzwerkschnittstelle an. Für (DSL-)Modems sollte man einfach <code class="notranslate">ppp+</code> verwenden, ansonsten bspw. <code class="notranslate">eth0</code>. Diese Option muss unbedingt angegeben werden. </p></li><li><p><code class="notranslate">-m</code>: Diese Option gibt an, dass Masquerading verwendet werden soll. Dies ist in den allermeisten Fällen der Fall. </p></li><li><p><code class="notranslate">-v</code>: Gibt jeden <strong>sysctl</strong>- und <strong>iptables</strong>-Befehl auf der Konsole aus, bevor er ausgeführt wird. So kann man nebenbei die <strong>iptables</strong>-Syntax lernen oder die Funktionsweise des Skriptes kontrollieren. </p></li><li><p><code class="notranslate">-d</code>: Wie <code class="notranslate">-v</code>, allerdings werden die Befehle nur ausgegeben, aber nicht tatsächlich ausgeführt. </p></li><li><p><code class="notranslate">-q</code>: Am Ende des Skripts wird normalerweise eine Erfolgsmeldung ausgegeben. Mit Angabe der Option <code class="notranslate">-q</code> unterbleibt dies. </p></li><li><p><code class="notranslate">ip</code>: Wird ohne benannte Option auf der Kommandozeile angegeben. Bezeichnet die IP-Adresse eines Rechners, an den Port(s) weitergeleitet werden. Alle nachfolgenden <em>port</em>-Argumente bis zur nächsten IP beziehen sich auf diese Adresse. </p></li><li><p><code class="notranslate">ports</code>: Ein Weiterleitungsstatement, dass sich immer auf die letzte vorhergehende IP-Adressenbezeichnung bezieht. Folgende Möglichkeiten gibt es: </p><ul><li><p><code class="notranslate">1234</code> -&gt; Der Port 1234 wird 1:1 an denselben Port des Zielrechners weitergeleitet. </p></li><li><p><code class="notranslate">1234-1238</code> -&gt; Ein ganzer Abschnitt von Ports wird weitergeleitet. </p></li><li><p><code class="notranslate">1234,1370</code> -&gt; Mehrere verschiedene Ports werden weitergeleitet. </p></li><li><p><code class="notranslate">1234:5678</code> -&gt; Ein Port wird auf einen anderen Port des Zielrechners weitergeleitet. </p></li><li><p><code class="notranslate">u1234</code> -&gt; Dieses Port-Statement bezieht sich auf das UDP-Protokoll an Stelle des meist verwendeten TCP-Protokolls. </p></li></ul></li></ul><p>Die verschiedenen Operatoren können auch alle miteinander kombiniert werden, wobei aber auf eine gleiche Anzahl Ports rechts und links vom <code class="notranslate">:</code> geachtet werden muss. Beispiel:</p><div class="bash"><div class="contents"><pre class="notranslate">nathelper -i ppp+ -m 192.168.1.1 21-25,80,3128:10001-10007 </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Für jeden einzelnen Port wird eine <a class="internal" href="../iptables.html">iptables</a>-Regel angelegt, was sich bei einer sehr hohen Anzahl an Regeln durchaus auf die Performance auswirken kann. Es ist deswegen nicht empfehlenswert, aus Bequemlichkeit bspw. mit <code class="notranslate">1-65535</code> alle Ports umzuleiten. 
</p></div></div><ul><li><p><a class="interwiki interwiki-attachment" href="../skripte/nathelper.html">Hier das Skript herunterladen.</a> <img alt="{dl}" src="../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/></p></li></ul><p>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/usr/bin/perl -w</span>
<span class="c1">#</span>
<span class="c1"># nathelper - Masquerading und Port-Forwarding in einer Kommandozeile</span>
<span class="c1">#             benoetigt natuerlich iptables</span>
<span class="c1">#</span>
<span class="c1"># Autor: otzenpunk (UbuntuUsers.de)</span>
<span class="c1"># Lizenz: Public Domain</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Getopt::Std</span><span class="p">;</span>

<span class="k">our</span> <span class="nv">%opts</span><span class="p">;</span>
<span class="n">usage</span><span class="p">()</span> <span class="k">unless</span> <span class="nv">@ARGV</span><span class="p">;</span>
<span class="n">getopts</span><span class="p">(</span><span class="s">'qvdhmi:'</span><span class="p">,</span> <span class="o">\</span><span class="nv">%opts</span><span class="p">);</span>
<span class="n">usage</span><span class="p">()</span> <span class="k">if</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'h'</span><span class="p">}</span> <span class="ow">or</span> <span class="o">!</span><span class="nv">$opts</span><span class="p">{</span><span class="s">'i'</span><span class="p">};</span>

<span class="n">init</span><span class="p">();</span>                             <span class="c1"># ip_forward, iptables -F</span>

<span class="n">masq</span><span class="p">(</span><span class="nv">$opts</span><span class="p">{</span><span class="s">'i'</span><span class="p">})</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$opts</span><span class="p">{</span><span class="s">'m'</span><span class="p">});</span>   <span class="c1"># evtl. Masquerading</span>

<span class="k">our</span> <span class="nv">@forwards</span><span class="p">;</span>
<span class="k">our</span> <span class="nv">$fw_indx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@ARGV</span><span class="p">)</span> <span class="p">{</span>          <span class="c1"># Array of Arrays: je 1xIP und n x Ports</span>
  <span class="o">++</span><span class="nv">$fw_indx</span> <span class="k">if</span> <span class="sr">/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/</span> <span class="o">&amp;&amp;</span> <span class="nv">@forwards</span><span class="p">;</span>
  <span class="nb">push</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$forwards</span><span class="p">[</span><span class="nv">$fw_indx</span><span class="p">]},</span> <span class="nv">$_</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">forw</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="nv">@forwards</span><span class="p">;</span>             <span class="c1"># jede IP verarbeiten</span>

<span class="k">print</span> <span class="s">"NAT erfolgreich aktiviert.\n"</span> <span class="k">unless</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'q'</span><span class="p">}</span> <span class="ow">or</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'d'</span><span class="p">};</span>
<span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1"># masq(iface): Masquerading</span>

<span class="k">sub</span> <span class="nf">masq</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">@iptables</span> <span class="o">=</span> <span class="p">(</span><span class="sx">qw(/sbin/iptables -t nat -A POSTROUTING -o)</span><span class="p">,</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'i'</span><span class="p">},</span> <span class="sx">qw(-j MASQUERADE)</span><span class="p">);</span>
  <span class="n">iptables</span><span class="p">(</span><span class="nv">@iptables</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># forw(IP, Ports, ...): Ports duerfen Aufzaehlungen  (zahl,zahl)</span>
<span class="c1">#                                     Ranges         (zahl-zahl)</span>
<span class="c1">#                                 und Uebersetzungen (zahl:zahl) enthalten.</span>

<span class="k">sub</span> <span class="nf">forw</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">$argptr</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>               <span class="c1"># Pointer auf Array</span>
  <span class="k">my</span> <span class="nv">$ip</span> <span class="o">=</span> <span class="nb">shift</span> <span class="nv">@$argptr</span><span class="p">;</span>          <span class="c1"># Erstes Element = IP</span>
  <span class="k">for</span> <span class="p">(</span><span class="nv">@$argptr</span><span class="p">)</span> <span class="p">{</span>
    <span class="sr">s/[^0-9u:,-]//ig</span><span class="p">;</span>               <span class="c1"># saeubern von verbotenen Zeichen</span>
    <span class="k">my</span> <span class="nv">$proto</span> <span class="o">=</span> <span class="sr">s/^u//i</span> <span class="p">?</span> <span class="s">'udp'</span> <span class="p">:</span> <span class="s">'tcp'</span><span class="p">;</span>   <span class="c1"># u = UDP</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$von</span><span class="p">,</span> <span class="nv">$nach</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span> <span class="s">':'</span><span class="p">;</span>   <span class="c1"># Uebersetzung trennen</span>
    <span class="nv">$nach</span> <span class="o">||=</span> <span class="nv">$von</span><span class="p">;</span>                 <span class="c1"># wenn kein ':' -&gt; Ports bleiben gleich</span>
    <span class="k">my</span> <span class="nv">@von</span> <span class="o">=</span> <span class="n">expand_range</span><span class="p">(</span><span class="nv">$von</span><span class="p">);</span>   <span class="c1"># ',' und '-' expandieren</span>
    <span class="k">my</span> <span class="nv">@nach</span> <span class="o">=</span> <span class="n">expand_range</span><span class="p">(</span><span class="nv">$nach</span><span class="p">);</span>
    <span class="k">unless</span> <span class="p">(</span><span class="nv">@von</span> <span class="o">==</span> <span class="nv">@nach</span><span class="p">)</span> <span class="p">{</span>        <span class="c1"># Falsche Parameter abfangen:</span>
      <span class="k">print</span> <span class="s">"Ungleiche Anzahl Ports: "</span><span class="p">,</span> <span class="nb">join</span><span class="p">(</span><span class="s">', '</span><span class="p">,</span> <span class="nv">@von</span><span class="p">),</span> <span class="s">' -&gt; '</span><span class="p">,</span> <span class="nb">join</span><span class="p">(</span><span class="s">', '</span><span class="p">,</span> <span class="nv">@nach</span><span class="p">),</span> <span class="s">"\n\n"</span><span class="p">;</span>
      <span class="n">usage</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nv">@von</span><span class="p">)</span> <span class="p">{</span>                    <span class="c1"># je eine iptables-Zeile pro Port</span>
      <span class="k">my</span> <span class="nv">@iptables</span> <span class="o">=</span> <span class="p">(</span><span class="sx">qw(/sbin/iptables -t nat -A PREROUTING -i)</span><span class="p">,</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'i'</span><span class="p">},</span>
                      <span class="s">'-p'</span><span class="p">,</span> <span class="nv">$proto</span><span class="p">,</span> <span class="s">'--dport'</span><span class="p">,</span> <span class="nv">$_</span><span class="p">,</span>
                      <span class="sx">qw(-j DNAT --to-destination)</span><span class="p">,</span> <span class="s">"$ip:$nach[$i++]"</span><span class="p">);</span>
      <span class="n">iptables</span><span class="p">(</span><span class="nv">@iptables</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># iptables(Liste der Argumente, inkl. iptables-Pfad)</span>

<span class="k">sub</span> <span class="nf">iptables</span> <span class="p">{</span>            <span class="c1"># system() gibt &gt;0 bei Fehler</span>
  <span class="k">print</span> <span class="nb">join</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="nv">@_</span><span class="p">),</span> <span class="s">"\n"</span> <span class="k">if</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'v'</span><span class="p">}</span> <span class="ow">or</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'d'</span><span class="p">};</span>
  <span class="nb">system</span><span class="p">(</span><span class="nv">@_</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">die</span><span class="p">(</span><span class="s">"Fehler bei iptables. Root?\n"</span><span class="p">)</span> <span class="k">unless</span> <span class="p">(</span><span class="nv">$opts</span><span class="p">{</span><span class="s">'d'</span><span class="p">});</span>
<span class="p">}</span>

<span class="c1"># expand_range(Port-String inkl. [,-])</span>
<span class="c1">#             ',' und '-' expandieren und Liste zurueck</span>

<span class="k">sub</span> <span class="nf">expand_range</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">@werte</span> <span class="o">=</span> <span class="nb">split</span> <span class="s">','</span><span class="p">,</span> <span class="nb">shift</span><span class="p">;</span>
  <span class="nv">@werte</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$down</span><span class="p">,</span> <span class="nv">$up</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span> <span class="s">'-'</span><span class="p">,</span> <span class="nv">$_</span><span class="p">;</span>
    <span class="nv">$down</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nv">$up</span> <span class="o">||=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="p">(</span><span class="nv">$down</span><span class="o">..</span><span class="nv">$up</span><span class="p">)</span> <span class="p">:</span> <span class="nv">$down</span><span class="p">;</span>
  <span class="p">}</span> <span class="nv">@werte</span><span class="p">;</span>
  <span class="k">return</span> <span class="nv">@werte</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">init</span> <span class="p">{</span>
  <span class="k">print</span> <span class="s">"sysctl -w net/ipv4/ip_forward=1\n"</span> <span class="k">if</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'v'</span><span class="p">}</span> <span class="ow">or</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'d'</span><span class="p">};</span>
  <span class="nb">system</span><span class="p">(</span><span class="sx">qw(sysctl -w net/ipv4/ip_forward=1)</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nv">$opts</span><span class="p">{</span><span class="s">'d'</span><span class="p">};</span>
  <span class="n">iptables</span><span class="p">(</span><span class="sx">qw(/sbin/iptables -t nat -F)</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">usage</span> <span class="p">{</span>
  <span class="k">print</span> <span class="s">&lt;&lt;</span><span class="dl">EOT</span><span class="s">;</span>
<span class="s">Usage: $0 [-v] [-d] -i iface [-m] [ip ports ...] ...</span>
<span class="s">       $0 [-h]</span>

<span class="s">-h : Hilfe</span>
<span class="s">-v : Verbose, iptables-Befehle ausgeben und durchfuehren</span>
<span class="s">-d : Debug, nicht wirklich durchfuehren</span>
<span class="s">-q : Keine Erfolgsmeldung ausgeben</span>
<span class="s">-i : externes Interface</span>
<span class="s">-m : Masquerading aktivieren</span>

<span class="s">ip ports : Ports, die auf IP umgeleitet werden, mehrere moeglich</span>
<span class="s">ports : 1234 -&gt; Port wird 1:1 umgeleitet</span>
<span class="s">        1234:5678 -&gt; Port wird auf anderen Port umgeleitet</span>
<span class="s">        1234-1238 -&gt; Port-Range wird umgeleitet</span>
<span class="s">        1234-1238:5674-5678 -&gt; beides</span>
<span class="s">        u1234 -&gt; UDP-Port(s) verwenden</span>
<span class="dl">EOT</span>
  <span class="nb">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div><p></p></div></div></div>
<p class="meta">
<a href="../skripte/nathelper/a/revision/355667.html">Diese Revision</a> wurde am 14. Januar 2012 16:30 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../skripte.html">Skripte</a></li>
<li><a href="../skripte/nathelper.html">nathelper</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>