<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Skripte/Backupscript › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../skripte/backupscript.html">Backupscript</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Skripte/Backupscript">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../skripte/backupscript/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../skripte/backupscript/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../skripte/backupscript/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../skripte/backupscript/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../skripte/backupscript/a/backlinks.html">Backupscript</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="../trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../rechte.html">Rechte für Dateien und Ordner ändern</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Erstellen-des-Skripts">Erstellen des Skripts
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a></li><li><a class="crosslink" href="#Aufrufen-des-Skripts">Aufrufen des Skripts
</a></li><li><a class="crosslink" href="#Backup-automatisch-verschluesseln">Backup automatisch verschlüsseln
</a></li><li><a class="crosslink" href="#tar-Entferne-fuehrende-von-Elementnamen">tar - Entferne führende „/“ von Elementnam...</a></li></ol></div><p>Mit diesem Skript lassen sich leicht mehrere Verzeichnisse packen und in ein anderes Verzeichnis kopieren. Dieses Verzeichnis sollte auf einer anderen Festplatte oder auf einem Server liegen. Die Verzeichnisse werden mit <a class="internal" href="../tar.html">tar</a> in ein Archiv gepackt und <a class="internal" href="../bzip2.html">bzip2</a>-komprimiert. Für regelmäßige Datensicherungen siehe auch <a class="internal" href="../skripte/inkrementelles_backup.html">Inkrementelles Backup</a>.</p><div class="section_1"><h2 id="Erstellen-des-Skripts">Erstellen des Skripts<a class="headerlink" href="#Erstellen-des-Skripts">¶</a></h2><p>
Zuerst erstellt man ein neues Verzeichnis <strong>bin</strong> im Home-Verzeichnis für das Skript, falls dieses noch nicht existiert. Danach öffnet man einen Texteditor <sup><a href="#source-2">[2]</a></sup> und kopiert den folgenden Text hinein:</p><pre class="notranslate">#!/bin/bash
DATE=$(date +%Y-%m-%d-%H%M%S)

# pfad sollte nicht mit "/" enden!
# Dies ist nur ein Beispiel - bitte an eigene Bedürfnisse anpassen.
# Man muß schreibberechtigt im entsprechenden Verzeichnis sein.
BACKUP_DIR="/mnt/backup"

# Hier Verzeichnisse auflisten, die gesichert werden sollen.
# Dies ist nur ein Beispiel - bitte an eigene Bedürfnisse anpassen.
# Bei Verzeichnissen, für die der User keine durchgehenden Leserechte hat (z.B. /etc) sind Fehler vorprogrammiert.
# Pfade sollte nicht mit "/" enden!
SOURCE="$HOME/bin $HOME/.gaim "

tar -cjpf $BACKUP_DIR/backup-$DATE.tar.bz2 $SOURCE</pre><p>Diese Datei speichert man im  <strong>bin</strong>-Verzeichnis unter dem Namen <strong>backup</strong>. Nun exportiert man entweder einmalig den Pfad
</p><div class="bash"><div class="contents"><pre class="notranslate">export PATH=$PATH:$HOME/bin </pre></div></div><p>oder öffnet ein neues Terminal, der Pfad wird dann automatisch hinzugefügt.</p></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Das Backup-Verzeichnis (im Skript BACKUP_DIR genannt) gibt das Verzeichnis an in dem das Archiv erstellt werden soll. Es sollte zumindest auf einer anderen Festplatte liegen, besser noch auf einem anderen PC, welcher ins Dateisystem eingebunden wurde.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Sollen Verzeichnisse wie <strong>/etc</strong> gesichert werden, für die nur root durchgehende Leserechte hat, so muss das Skript mit <a class="internal" href="../sudo.html">sudo</a> gestartet werden. 
</p></div></div><p>Die zu sichernden Verzeichnisse werden in der Variablen <code class="notranslate">SOURCE</code> angegeben. Es sollte kein "/" am Ende der Verzeichnisse stehen und es muss ein Leerzeichen vor dem abschließenden " sein.</p><p>Manchmal möchte man bestimmte Unterverzeichnisse aus <strong>/home/$user</strong> vom Backup ausschliessen, weil sie z.B. zu groß sind oder anderweitig in Backup-Prozesse eingebunden sind. Dazu kann die Option <code class="notranslate">--exclude</code> verwendet werden, mit den Namen der auszuschliessenden Verzeichnisse:
</p><div class="bash"><div class="contents"><pre class="notranslate">tar -cjpf $BACKUP_DIR/backup-$DATE.tar.bz2 $SOURCE --exclude="VirtualBox VMs" --exclude=".icedove" </pre></div></div></div><div class="section_1"><h2 id="Aufrufen-des-Skripts">Aufrufen des Skripts<a class="headerlink" href="#Aufrufen-des-Skripts">¶</a></h2><p>
Das Skript muss vor der Nutzung noch ausführbar gemacht werden <sup><a href="#source-3">[3]</a></sup>, dazu im Terminal <sup><a href="#source-1">[1]</a></sup> folgendes eingeben:</p><div class="bash"><div class="contents"><pre class="notranslate">chmod u+x $HOME/bin/backup </pre></div></div><p>Das Skript lässt sich jetzt mit folgendem Befehl starten:</p><div class="bash"><div class="contents"><pre class="notranslate">backup </pre></div></div></div><div class="section_1"><h2 id="Backup-automatisch-verschluesseln">Backup automatisch verschlüsseln<a class="headerlink" href="#Backup-automatisch-verschluesseln">¶</a></h2><p>
Bei der Erstellung eines Backups bietet es sich aus verschiedenen Gründen an, dieses automatisch zu verschlüsseln. Dazu gibt es mehrere Möglichkeiten:</p><div class="section_2"><h3 id="Truecrypt-dm-crypt">Truecrypt/dm_crypt<a class="headerlink" href="#Truecrypt-dm-crypt">¶</a></h3><p>
Wer verschlüsselte Dateisysteme, z.B. mit Hilfe von Truecrypt oder LUKS benutzt, kann einfach ein Verzeichnis auf dem verschlüsselten Laufwerk als Zielort für das Backup (s.o.) angeben.</p></div><div class="section_2"><h3 id="Symmetrisch-mit-GnuPG">Symmetrisch mit GnuPG<a class="headerlink" href="#Symmetrisch-mit-GnuPG">¶</a></h3><p>
Um eine verschlüsselte Backup-Datei zu erstellen, kann man das Tar-Archiv im Skript direkt in die symmetrische Verschlüsselung von <a class="internal" href="../gnupg.html">GnuPG</a> pipen. Dazu ersetzt man im Skript einfach die Tar-Zeile mit dieser:</p><pre class="notranslate">tar -cjp $SOURCE | gpg -z 0 -c &gt; $BACKUP_DIR/backup-$DATE.tar.bz2.gpg</pre><p>Man wird beim Ausführen des Backup-Skriptes dann nach einem Passwort gefragt, mit welchem das Backup verschlüsselt wird. Dadurch erhält man dann zum Beispiel eine Datei <strong>backup-2007-11-24-170024.tar.bz2.gpg</strong>. Diese entschlüsselt man wieder mit dem Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">gpg --output backup-2007-11-24-170024.tar.bz2 --decrypt backup-2007-11-24-170024.tar.bz2.gpg </pre></div></div><p>Weitere Optionen zur symmetrischen Verschlüsselung von GnuPG findet man in den <a class="internal" href="../man.html">Manpages</a> von gpg.</p></div><div class="section_2"><h3 id="Asymmetrisch-mit-GnuPG">Asymmetrisch mit GnuPG<a class="headerlink" href="#Asymmetrisch-mit-GnuPG">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Es ist sinnlos, auf diese Weise auch die GnuPG-Schlüssel zu sichern. Im Falle eines Datenverlusts wird zum zurückspielen (bzw. entschlüsseln) des Backups der eigene GnuPG-Schlüssel benötigt. Wenn man seine GnuPG-Schlüssel sichern möchte sollte man also eine symmetrische Verschlüsselung wählen.
</p></div></div><p>Wer einen GnuPG-Schlüssel hat, kann das Backup mit dem eigenen öffentlichen Schlüssel verschlüsseln. Dann ist im Vergleich zur symetrischen Methode zum erstellen des Backups keine Passworteingabe nötig. Die tar- Zeile im Skript lautet dafür:</p><pre class="notranslate">tar -cjp $SOURCE | gpg -z 0 --encrypt -r DEINE_SCHLÜSSEL_KENNUNG &gt; $BACKUP_DIR/backup-$DATE.tar.bz2.gpg</pre><p>Wobei die Schlüssel-Kennung zum Beispiel in Form der Email-Adresse eingegeben werden kann.</p></div></div><div class="section_1"><h2 id="tar-Entferne-fuehrende-von-Elementnamen">tar - Entferne führende „/“ von Elementnamen<a class="headerlink" href="#tar-Entferne-fuehrende-von-Elementnamen">¶</a></h2><p>
<em>(engl. "tar: Removing leading '/' from member names")</em></p><p>Wenn diese Meldung erscheint, bedeutet es, dass man mit absoluten Pfadnamen arbeitet, wie zB <strong>/etc</strong>, <strong>/usr/share</strong> aber auch die $HOME-Variable ist ein absoluter Pfad. Tar liefet eine Meldung diesbezüglich, weil es bei absoluten Pfaden passieren kann, dass beim Entpacken des Backups automatisch die alten Ordner überschrieben werden, was nicht immer gewünscht ist. Um diese Meldung zu entfernen, verwendet man relative Pfadnamen also <strong>etc</strong> und <strong>usr/share</strong> und benutzt anstatt $HOME eine eigene Variable <code class="notranslate">HOMEPATH="home/$USER"</code>. Vor dem Ausführen von Tar in dem Skript muss man jetzt noch, damit die Ordner gefunden werden, ins Root-Verzeichnis wechseln mit <code class="notranslate">cd /</code>. Ein Skript, welches diese Warnung nicht bringt, könnte zum Beispiel so aussehen:</p><pre class="notranslate">#!/bin/bash
DATE=$(date +%Y-%m-%d-%H%M%S)
BACKUP_DIR="mnt/backup"
HOMEPATH="home/$USER"
SOURCE="$HOMEPATH/bin $HOMEPATH/.gaim "
cd /
tar -cjpf $BACKUP_DIR/backup-$DATE.tar.bz2 $SOURCE</pre><p>Das entfernen des führenden "/" könnte man mit der Option "-P" ausschalten, aber Vorsicht wenn man sich entschließt dies zu tun kann man die Dateien und Ordner nicht mehr an einem beliebigen Ort wieder herstellen. Tar wird sie dann nämlich immer vom Root-Verzeichnis "/" ausgehend entpacken.</p><p>Um die Meldung zu umgehen kann man die Option "-C /" benutzen um ins Root-Verzeichnis zu wechseln und dann beim Quellordner den anführenden / weglassen. Beispiel:
</p><pre class="notranslate">tar -cjpf /home/$(whoami)/pidgin-backup.tar.bz2 -C /  home/$(whoami)/.purple </pre><p></p></div></div>
<p class="meta">
<a href="../skripte/backupscript/a/revision/746887.html">Diese Revision</a> wurde am 19. August 2014 19:51 von <a href="https://ubuntuusers.de/user/Tronde/">Tronde</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../skripte.html">Skripte</a></li>
<li><a href="../skripte/backupscript.html">Backupscript</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>