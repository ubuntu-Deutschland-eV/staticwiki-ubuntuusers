<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Verschlüsseltes_System_via_SSH_freischalten › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./verschlüsseltes_system_via_ssh_freischalten.html">Verschlüsseltes System via SSH freischalten</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Verschlüsseltes_System_via_SSH_freischalten">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./verschlüsseltes_system_via_ssh_freischalten/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./verschlüsseltes_system_via_ssh_freischalten/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./verschlüsseltes_system_via_ssh_freischalten/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./verschlüsseltes_system_via_ssh_freischalten/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./verschlüsseltes_system_via_ssh_freischalten/a/backlinks.html">Verschlüsseltes System via SSH freischalten</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
Dieser Artikel ist mit keiner aktuell unterstützten Ubuntu-Version getestet! Bitte diesen Artikel testen und das getestet-Tag entsprechend anpassen.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./system_verschlüsseln.html">Installation eines verschlüsselten Systems</a></p></li></ol></div></div><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Falls man die Installation nicht richtig durchführt oder sich den falschen Schlüssel kopiert, ist es möglich, dass das System nicht mehr booten kann bzw. eine manuelle, lokale Eingabe des Schlüssels am Rechner notwendig ist.
</p></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a></li><li><a class="crosslink" href="#Netzwerk-Konfiguration">Netzwerk-Konfiguration
</a></li><li><a class="crosslink" href="#Schluessel-kopieren">Schlüssel kopieren
</a></li><li><a class="crosslink" href="#Freischalten-beim-Bootvorgang">Freischalten beim Bootvorgang
</a></li><li><a class="crosslink" href="#Ab-Ubuntu-10-04">Ab Ubuntu 10.04
</a></li><li><a class="crosslink" href="#Port-aendern">Port ändern
</a></li><li><a class="crosslink" href="#Fehlerbehebung">Fehlerbehebung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>
Dieser Artikel erklärt, wie man ein System mit verschlüsselter Root-Partition auch ohne physikalischen Zugang zum Rechner über <a class="internal" href="./ssh.html">SSH</a> freischalten kann. Verwendet wird hierzu der dropbear-SSH-Server, der im initramfs untergebracht wird. Dieses Vorgehen kann man anwenden, wenn man z.B. „Dedicated Server“ fast komplett (in diesem Fall bis auf die <strong>/boot</strong>-Partition) verschlüsseln möchte. Ob dies auch vor Angreifern schützt, die (physikalischen) Zugriff auf den Server haben, ist jedoch nicht sicher.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Folgende Pakete müssen installiert<sup><a href="#source-1">[1]</a></sup> werden:</p><ul><li><p><strong>cryptsetup</strong> (sollte schon vorhanden sein)</p></li><li><p><strong>dropbear</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install cryptsetup dropbear </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install cryptsetup dropbear </pre></div></div><p>
</p></div></div><p>Wenn bereits ein anderer SSH-Server installiert ist, wird dies erkannt und dropbear wird nur während des Bootvorgangs gestartet. Zur späteren Verifikation sollte man sich die Fingerprints, die ausgegeben werden, aufschreiben.</p></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Achtung: Jegliche Konfigurationen bezüglich des initramfs müssen via "update-initramfs" aktualisiert werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-initramfs -u </pre></div></div></div><div class="section_1"><h2 id="Netzwerk-Konfiguration">Netzwerk-Konfiguration<a class="headerlink" href="#Netzwerk-Konfiguration">¶</a></h2><p>
Die Netzwerk-Konfiguration für den Remote-Zugriff auf den Server wird in folgender Datei durchgeführt:
</p><pre class="notranslate">/etc/initramfs-tools/initramfs.conf</pre><p>Wie die genauen Regeln zur Konfiguration des Netzwerks aussehen, kann unter nfsroot.txt nachgelesen werden. Für DHCP muss keine Zeile hinzugefügt werden!</p><pre class="notranslate">#
# DEVICE: ...
#
# Specify the network interface, like eth0
#
DEVICE=</pre><p>Für eine statische Adresse muss die Zeile wie folgt geändert werden:
</p><pre class="notranslate">DEVICE=ens192
IP=192.168.56.101:::255.255.255.0::ens192:off</pre><p>Nun muss wieder eine Aktualisierung des initramfs durchgeführt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-initramfs -u </pre></div></div><p>Nun wird das Netzwerk-Device bereits vor der Abfrage des Passworts konfiguriert.</p></div><div class="section_1"><h2 id="Schluessel-kopieren">Schlüssel kopieren<a class="headerlink" href="#Schluessel-kopieren">¶</a></h2><p>
Nun muss man seinen Public Key für die schlüssel-basierte Authentifizierung auf den Server kopieren.</p><p>Auf seinem Client erzeugt man SSH-Schlüssel und kopiert diese auf den Server der entsperrt werden soll
</p><div class="bash"><div class="contents"><pre class="notranslate">ssh-keygen
scp serveruser@server:~/.ssh/id_rsa.pub ~/dropbear_id_rsa.pub </pre></div></div><p>Auf dem Server hinterlegt man den öffentlichen Teil des Schlüssels als autorisierten Schlüssel</p><div class="bash"><div class="contents"><pre class="notranslate">ssh serveruser@server
sudo touch /etc/dropbear-initramfs/authorized_keys
sudo cat ~serveruser/dropbear_id_rsa.pub &gt;&gt; /etc/dropbear-initramfs/authorized_keys
rm ~serveruser/dropbear_id_rsa.pub
sudo update-initramfs -u </pre></div></div></div><div class="section_1"><h2 id="Freischalten-beim-Bootvorgang">Freischalten beim Bootvorgang<a class="headerlink" href="#Freischalten-beim-Bootvorgang">¶</a></h2><p>
Nach dem Kopieren des RSA-Schlüssels kann man ab sofort bei jedem Bootvorgang die Root-Partition per SSH freischalten. Mit</p><div class="bash"><div class="contents"><pre class="notranslate">ssh -i ~/.ssh/id_rsa root@server </pre></div></div><p>kann man sich einloggen und bekommt eine BusyBox-Shell.</p><p>Das eigentliche Freischalten erfolgt danach über den Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">echo -n "Passphrase" &gt; /lib/cryptsetup/passfifo </pre></div></div><p>wobei die Passphrase durch das eigene Passwort ersetzt wird, das bei der Einrichtung der Verschlüsselung ausgewählt wurde. Danach wird der Server ganz normal gestartet. Ein paar Sekunden später müsste man sich normal einloggen können.</p></div><div class="section_1"><h2 id="Ab-Ubuntu-10-04">Ab Ubuntu 10.04<a class="headerlink" href="#Ab-Ubuntu-10-04">¶</a></h2><p>
Wegen der Einführung von <a class="internal" href="./plymouth.html">Plymouth</a> in 10.04 funktioniert das Freischalten nicht mehr. Eine Lösung wird in einem <a class="interwiki interwiki-bug" href="https://launchpad.net/bugs/595648">Fehlerbericht auf Launchpad</a> in Kommentar #5 beschrieben. Nach einem Update des initramfs images mittels <code class="notranslate">update-initramfs -u</code> sollte das Freischalten via SSH auch unter Systemen ab Lucid Lynx funktionieren. Das System kann dann allerdings nur noch per SSH freigeschaltet werden; das Eingeben des Passworts vor Ort mit angeschlossener Tastatur ist nicht mehr möglich.</p></div><div class="section_1"><h2 id="Port-aendern">Port ändern<a class="headerlink" href="#Port-aendern">¶</a></h2><p>
Möchte man den Port ändern auf dem Dropbear lauscht oder weitere Konfigurationen während des Bootvorgangs vornehmen muss man folgende Zeile in <strong>/etc/initramfs-tools/initramfs.conf</strong> ergänzen:
</p><pre class="notranslate">PKGOPTION_dropbear_OPTION="-p 2222"</pre></div><div class="section_1"><h2 id="Fehlerbehebung">Fehlerbehebung<a class="headerlink" href="#Fehlerbehebung">¶</a></h2><p>
Sollte eine Verbindung zu Dropbear mit der Meldung "server refused our key" abgewiesen werden, sind evtl. die Berechtigungen des .ssh-Ordners in den initramfs-tools falsch gesetzt. Ein Lösungsweg ist z.B. <a class="external" href="https://askubuntu.com/a/306832" rel="nofollow">hier</a> beschrieben. Außerdem muss nach jeder Änderung das initramfs image mittels <code class="notranslate">update-initramfs -u</code> erneuert werden.</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-bug" href="https://launchpad.net/bugs/"></a><a class="external" href="https://bugs.launchpad.net/ubuntu/+source/dropbear" rel="nofollow">Launchpad: Übersicht bekanntgemachter Dropbear Fehlerberichte</a></p></li><li><p><a class="external" href="https://www.thomas-krenn.com/de/wiki/Voll-verschl%C3%BCsseltes-System_via_SSH_freischalten" rel="nofollow">Detaillierte Anleitung inkl. Import von OpenSSH-Schlüsseln</a></p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./verschlüsseltes_system_via_ssh_freischalten/a/revision/942613.html">Diese Revision</a> wurde am 20. Juli 2017 15:25 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./verschlüsseltes_system_via_ssh_freischalten.html">Verschlüsseltes System via SSH freischalten</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>