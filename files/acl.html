<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>ACL › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./acl.html">ACL</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/ACL">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./acl/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./acl/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./acl/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./acl/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./acl/a/backlinks.html">ACL</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./rechte.html">Dateirechte unter Unix/Linux</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Benutzung">Benutzung
</a><ol class="arabic"><li><a class="crosslink" href="#Aktivieren-im-Dateisystem">Aktivieren im Dateisystem
</a></li><li><a class="crosslink" href="#Bearbeiten-von-ACLs">Bearbeiten von ACLs
</a></li></ol></li><li><a class="crosslink" href="#ACLs-fuer-Dateien-und-Verzeichnisse">ACLs für Dateien und Verzeichnisse
</a><ol class="arabic"><li><a class="crosslink" href="#Motivation">Motivation
</a></li><li><a class="crosslink" href="#Aufbau-einer-ACL">Aufbau einer ACL
</a></li><li><a class="crosslink" href="#Setzen-und-Loeschen-von-ACLs">Setzen und Löschen von ACLs
</a></li></ol></li><li><a class="crosslink" href="#Prioritaeten">Prioritäten
</a></li><li><a class="crosslink" href="#Maske">Maske
</a></li><li><a class="crosslink" href="#Shellbefehle">Shellbefehle
</a><ol class="arabic"><li><a class="crosslink" href="#bash">bash
</a></li><li><a class="crosslink" href="#ls">ls
</a></li><li><a class="crosslink" href="#chmod">chmod
</a></li><li><a class="crosslink" href="#chown-chgrp">chown, chgrp
</a></li><li><a class="crosslink" href="#mv-cp">mv, cp
</a></li><li><a class="crosslink" href="#umask-touch-mkdir-mknod-mkfifo">umask, touch, mkdir, mknod, mkfifo
</a></li></ol></li><li><a class="crosslink" href="#Vererbung-von-ACLs-und-Default-ACLs">Vererbung von ACLs und Default-ACLs
</a><ol class="arabic"><li><a class="crosslink" href="#Motivation-2">Motivation
</a></li><li><a class="crosslink" href="#Aufbau-einer-Default-ACL">Aufbau einer Default-ACL
</a></li><li><a class="crosslink" href="#Setzen-und-Loeschen-von-Default-ACLs">Setzen und Löschen von Default-ACLs
</a></li><li><a class="crosslink" href="#Dateien-und-Verzeichnisse-neu-anlegen">Dateien und Verzeichnisse neu anlegen
</a></li><li><a class="crosslink" href="#Dateien-ins-Zielverzeichnis-verschieben-und-kopieren">Dateien ins Zielverzeichnis verschieben ...</a></li></ol></li><li><a class="crosslink" href="#Verzeichnisbaeume">Verzeichnisbäume
</a><ol class="arabic"><li><a class="crosslink" href="#Problem">Problem
</a></li><li><a class="crosslink" href="#Setzen-von-ACLs-in-Verzeichnisbaeumen">Setzen von ACLs in Verzeichnisbäumen
</a></li><li><a class="crosslink" href="#Nachtraegliches-bertragen-der-ACL-auf-Unterordner">Nachträgliches Übertragen der ACL auf Un...</a></li><li><a class="crosslink" href="#Zusammenfassung">Zusammenfassung
</a></li></ol></li><li><a class="crosslink" href="#Sichern-und-Wiederherstellen-von-ACLs">Sichern und Wiederherstellen von ACLs
</a></li><li><a class="crosslink" href="#Weiteres-zu-ACLs">Weiteres zu ACLs
</a></li><li><a class="crosslink" href="#Probleme-mit-ACLs">Probleme mit ACLs
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Mit Hilfe von Access Control Lists (kurz ACL) ist es möglich, einzelnen Nutzern (oder auch Gruppen) gezielt Rechte an einzelnen Dateien zu geben oder zu entziehen. ACLs ergänzen damit die normale <a class="internal" href="./rechte.html">Rechteverwaltung</a> von Linux. Außerdem kann man mit ACLs die einheitliche Vergabe von Rechten für neu angelegte Dateien innerhalb eines Verzeichnisbaumes erzwingen.</p><p>Dies kann insbesondere auf größeren Mehrbenutzersystemen nützlich sein. Auf "normalen" Desktop-Systemen mit einem oder zwei Nutzern ist der Einsatz von ACLs üblicherweise nicht sinnvoll. Zudem gibt es viele <a class="internal" href="./shell/befehlsübersicht.html">Shellbefehle</a>, die ACL ignorieren und <a class="crosslink" href="#probleme">Probleme</a> verursachen können.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Das benötigte Paket für die Nutzung von Access Control List, <strong>libacl1</strong>, ist ab <a class="internal" href="./jaunty.html">Ubuntu 9.04</a> bereits in der Standardinstallation enthalten. Die Programme <strong>setfacl</strong> und <strong>getfacl</strong> für die Bearbeitung von ACLs müssen dagegen nachinstalliert werden <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>acl</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install acl </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install acl </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Benutzung">Benutzung<a class="headerlink" href="#Benutzung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Aktivieren-im-Dateisystem">Aktivieren im Dateisystem<a class="headerlink" href="#Aktivieren-im-Dateisystem">¶</a></h3><p>
Bei den <a class="internal" href="./dateisystem.html">Dateisystemen</a> JFS und XFS können ACLs standardmäßig gesetzt werden. Bei den unter Linux üblichen Dateisystemen ext3, ext4 und Reiserfs müssen ACLs erst explizit aktiviert werden. Dies geschieht durch die Option <code class="notranslate">-o acl</code> beim <a class="internal" href="./mount.html">Einbinden</a> der Partition oder direkt in <a class="internal" href="./fstab.html">/etc/fstab</a>.
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Seit Ubuntu 12.04 gehört <code class="notranslate">acl</code> bei den Dateisystemen ext3 und ext4 zu den Default-Optionen und braucht deshalb auch bei diesen nicht mehr explizit aktiviert zu werden.
</p></div></div><pre class="notranslate">/dev/sda5  /home  ext3  defaults,nodev,acl 0 2</pre><p>
Mit <code class="notranslate">noacl</code> statt <code class="notranslate">acl</code> kann man die Nutzung von ACLs explizit verbieten.</p><p>Bei ext2 und ext3 kann man auch im Dateisystem selbst eintragen, dass es mit ACL-Unterstützung gemountet werden soll:</p><div class="bash"><div class="contents"><pre class="notranslate">tune2fs -o acl /dev/sda5
tune2fs -l /dev/sda5 </pre></div></div><p>
</p><pre class="notranslate">...
Default mount options:    acl
...</pre><p>Wenn in der <strong>/etc/fstab</strong> unter dem betreffenden Dateisystem die Optionen <code class="notranslate">acl</code> oder <code class="notranslate">noacl</code> stehen, so haben diese Vorrang über den Eintrag im Dateisystem selbst.</p><p>Der Eintrag im Dateisystem kann mit folgendem Befehl entfernt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">tune2fs -o acl /dev/sda5
tune2fs -l /dev/sda5 </pre></div></div><p>
</p><pre class="notranslate">...
Default mount options:    (none)
...</pre></div><div class="section_2"><h3 id="Bearbeiten-von-ACLs">Bearbeiten von ACLs<a class="headerlink" href="#Bearbeiten-von-ACLs">¶</a></h3><p>
Die ACL-Verwaltung läuft über zwei Programme:</p><ul><li><p><strong>setfacl</strong> dient zum Setzen und Löschen von ACLs</p></li><li><p><strong>getfacl</strong> dient zum Auslesen von ACLs</p></li></ul><p>
Wie bei den klassischen Unixrechten, können auch ACLs für eine Datei nur vom Besitzer der jeweiligen Datei gesetzt werden, nicht von anderen Nutzern. Darüber hinaus funktionieren die Befehle <a class="internal" href="./ls.html">ls</a> und <a class="internal" href="./chmod.html">chmod</a> weiterhin, wenn auch leicht verändert. Die Struktur von ACLs sowie ihre Anwendungsweise wird im Folgenden erklärt.</p></div></div><div class="section_1"><h2 id="ACLs-fuer-Dateien-und-Verzeichnisse">ACLs für Dateien und Verzeichnisse<a class="headerlink" href="#ACLs-fuer-Dateien-und-Verzeichnisse">¶</a></h2><p>
Hier wird beschrieben, wie ACLs für einzelne Dateien und Verzeichnisse gesetzt werden.</p><div class="section_2"><h3 id="Motivation">Motivation<a class="headerlink" href="#Motivation">¶</a></h3><p>
Die klassischen Unixrechte <sup><a href="#source-3">[3]</a></sup> erlauben nur Unterscheidung der Zugriffsrechte für den Besitzer, die besitzende Gruppe und Anderen ("other"). Will man genau einer weiteren Person Rechte auf eine Datei erteilen, muss man eine Gruppe anlegen, in der genau die Benutzer enthalten sind, die die Rechte bekommen sollen. Für jede gewünschte Kombination von Benutzern benötigt man also eine eigene Gruppe, was unpraktikabel ist.</p></div><div class="section_2"><h3 id="Aufbau-einer-ACL">Aufbau einer ACL<a class="headerlink" href="#Aufbau-einer-ACL">¶</a></h3><p>
ACLs lösen das Problem, indem man beliebigen weiteren Personen und Gruppen die Zugriffsrechte (lesen, schreiben, ausführen bzw. <code class="notranslate">rwx</code>) erteilen kann. ACLs erlauben die Rechtevergabe an folgende Parteien:</p><ul><li><p>genau ein Besitzer</p></li><li><p>benannte Benutzer</p></li><li><p>genau eine besitzende Gruppe</p></li><li><p>benannte Gruppe</p></li><li><p>Andere</p></li></ul><p>
Der Besitzer, die besitzende Gruppe und Andere sind die gleichen wie bei den klassischen Unixrechten. Neu sind keine, eine oder mehrere benannte Benutzer und benannte Gruppen.</p></div><div class="section_2"><h3 id="Setzen-und-Loeschen-von-ACLs">Setzen und Löschen von ACLs<a class="headerlink" href="#Setzen-und-Loeschen-von-ACLs">¶</a></h3><p>
Setzen von Rechten für Benutzer und Gruppen:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -m u:BENUTZER:-,g:GRUPPE:RECHTE,... DATEI ... </pre></div></div><p>Man beachte, dass mehrere Rechtevergaben durch Kommas getrennt aufgelistet werden können. Folgende Regeln gelten:</p><ul><li><p>Das <code class="notranslate">u</code> steht für einen User. Ist BENUTZER = "", dann werden die Rechte für den Dateibesitzer gesetzt.</p></li><li><p>Das <code class="notranslate">g</code> steht für eine Gruppe. Ist GRUPPE = "", dann werden die Rechte für die besitzende Gruppe gesetzt.</p></li><li><p>Das <code class="notranslate">o</code> steht für Andere ("other"). </p></li><li><p>Das <code class="notranslate">m</code> steht für die Maske (<a class="crosslink" href="#maske">Erklärung</a> weiter unten). </p></li><li><p>Die Rechte sind wie bei chmod: <code class="notranslate">r</code>, <code class="notranslate">w</code> oder <code class="notranslate">x</code>, oder <code class="notranslate">-</code> für keine Rechte. Mit dem großen <code class="notranslate">X</code> wie bei chmod kann man x-Rechte setzen, falls es ein Verzeichnis ist oder für jemanden schon ein x-Bit gesetzt ist.</p></li></ul><p>
Entfernen einzelner Einträge in der ACL:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -x u:BENUTZER,g:GRUPPE,... DATEI ... </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Beim Löschen einzelner Einträge einer ACL wird die <a class="crosslink" href="#maske">Maske</a> (s. unten) neu berechnet. Dabei können unbeabsichtigt benannte Benutzer und Gruppen Rechte zugeteilt bekommen. Das Neuberechnen der Maske kann man mit Option <code class="notranslate">-n</code> verhindern.
</p></div></div><p>Entfernen der gesamten ACL, so dass nur die klassischen Unixrechte zurückbleiben:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -b DATEI ... </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
</p><ul><li><p><code class="notranslate">u:</code> kann weggelassen werden. Der darauf folgende String wird dann automatisch als benannter Benutzer interpretiert. </p></li><li><p>Beim Bearbeiten einzelner gleichartiger Dateien <em>oder</em> gleichartiger Verzeichnisse muss man die <a class="crosslink" href="#maske">Maske</a> nicht beachten. Sie wird dann automatisch richtig gesetzt.</p></li></ul></div></div><div class="section_3"><h4 id="Beispiel">Beispiel<a class="headerlink" href="#Beispiel">¶</a></h4><p>
Der Nutzer <code class="notranslate">anton</code> erstellt Dateien und lässt seine Kollegen in der Gruppe <code class="notranslate">schreiber</code> lesen. Als Beispiel sei folgende Datei gegeben.</p><div class="bash"><div class="contents"><pre class="notranslate">ls -l roman.txt </pre></div></div><pre class="notranslate">-rw-r--r--  1 anton schreiber 825 2010-01-01 00:00 roman.txt </pre><p>Sie hat keine ACL, aber man kann die Zugriffsrechte in ACL-Form abrufen.</p><div class="bash"><div class="contents"><pre class="notranslate">getfacl roman.txt </pre></div></div><pre class="notranslate"># file: roman.txt
# owner: anton
# group: schreiber
user::rw-
group::r--
other::r--</pre><p>Da (noch) keine ACLs gesetzt sind, entspricht die Ausgabe im Prinzip der oben gezeigten von <code class="notranslate">ls -l</code>, lediglich mit einer anderen Darstellung.</p><p>Anton möchte verhindern, dass sein Chef, der ebenfalls in der Gruppe <code class="notranslate">schreiber</code> ist, die Datei lesen kann. Gleichzeitig möchte er den Lektoren die Möglichkeit geben, seine Datei zu korrigieren.</p><p>Jetzt werden dem Nutzer <code class="notranslate">chef</code> alle Rechte genommen und der Gruppe <code class="notranslate">lektoren</code> die Schreib- und Leserechte eingeräumt.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -m u:chef:-,g:lektoren:rw roman.txt </pre></div></div><p>Die Ausgabe von getfacl sieht jetzt so aus:</p><pre class="notranslate"># file: roman.txt
# owner: anton
# group: schreiber
user::rw-
user:chef:---
group::r--
group:lektoren:rw
mask::rw-
other::r--</pre><p>Wie man sieht, werden die ACLs für den Chef und die Lektoren jetzt angezeigt.</p><p>Die Ausgabe von <code class="notranslate">ls -l</code> sieht jetzt so aus:</p><pre class="notranslate">-rw-rw-r--+ 1 anton schreiber 825 2010-01-01 00:00 roman.txt </pre><p>Das "+" zeigt an, dass ACLs vorhanden sind. Welche dies sind, sieht man aber über <code class="notranslate">ls</code> nicht.</p><p><a class="crosslink anchor" href="#prio" id="prio"></a>
</p></div></div></div><div class="section_1"><h2 id="Prioritaeten">Prioritäten<a class="headerlink" href="#Prioritaeten">¶</a></h2><p>
Welcher Eintrag für die Zugriffsrechte entscheidend ist, bestimmen folgende Regeln:</p><ul><li><p>Die ACL wird von oben nach unten abgearbeitet.</p></li><li><p>Die erste zutreffende Regel gilt.</p></li></ul><p>
Beispiel:</p><pre class="notranslate"># file: roman.txt
# owner: anton
# group: schreiber
user::rw-
user:chef:---
user:anton:r--
group::r--
group:lektoren:rw
mask::rw-
other::r--</pre><p>Anton ist der Besitzer der Datei. Für ihn gelten die Rechte des Besitzers <code class="notranslate">user::rw-</code>. Der Eintrag <code class="notranslate">user:anton:r--</code> folgt später und wird daher ignoriert.</p><p>Der Chef sei in der besitzenden Gruppe <code class="notranslate">schreiber</code>, welche lesen darf (<code class="notranslate">group::r--</code>). Trotzdem hat der Chef überhaupt keinen Zugriff, weil er weiter oben als benannter Benutzer ohne Rechte (<code class="notranslate">user:chef:---</code>) eingetragen ist.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Beim teilweisen oder vollständigen Entfernen von ACLs können unbeabsichtigt Rechte (wieder)erteilt werden, wenn ACLs zum <em>Entziehen</em> von Rechten gebraucht wurden. Wenn z.B. ein Eintrag für einen benannten Benutzer ohne Zugriffsrechte mit entfernt wird, dann kann der betreffende Benutzer u.U. über seine Mitgliedschaft in der besitzenden Gruppe wieder Zugriffsrechte bekommen. Der Eintrag für die besitzende Gruppe wird dabei nämlich nicht entfernt, weil er ja zu den Standard-Unixrechten gehört.
</p></div></div><p><a class="crosslink anchor" href="#maske" id="maske"></a>
</p></div><div class="section_1"><h2 id="Maske">Maske<a class="headerlink" href="#Maske">¶</a></h2><p>
Die Maske legt die maximalen Rechte fest, die ein anderer Benutzer als der Besitzer oder eine Gruppe haben kann. Das heißt, wenn ein Eintrag eine Gruppe die Lese- und Schreibrechte einräumt, die Maske aber nur Leserechte vorsieht, dann hat diese Gruppe auch nur Leserechte. Ein (für die Praxis sinnloses) Beispiel:</p><pre class="notranslate"># file: roman.txt
# owner: anton
# group: schreiber
user::rw-
user:chef:rw-			#effective:r--
group::rwx			#effective:r-x
group:lektoren:-wx		#effective:--x
mask::r-x
other::---</pre><p>Der Befehl getfacl gibt die effektiven Rechte aus, wenn die Rechte durch die Maske eingeschränkt wurden. Die Maske kann auf 4 verschiedene Weisen berechnet bzw. gesetzt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl    -m RECHTELISTE ...           # automatisch berechnen
setfacl -n -m RECHTELISTE ...           # nicht verändern
setfacl    -m m::MASKE,RECHTELISTE ...  # manuell setzen
chmod g=MASKE                           # manuell setzen </pre></div></div><ul><li><p>Wenn nicht anders angegeben, wird die ACL beim Modifizieren der ACL automatisch so angepasst, dass sie die Rechte der neuen Einträge nicht einschränkt. Anders ausgedrückt: Die Maske ist die Vereinigungsmenge der Rechte der Gruppen und der benannten Benutzer.</p></li><li><p>Mit der Option <code class="notranslate">-n</code> wird die Maske nicht verändert. Wenn die Datei noch keine ACL hat, wird die Maske gleich der Gruppenrechte gesetzt.</p></li><li><p>Die Maske kann durch <code class="notranslate">m::MASKE</code> explizit gesetzt werden. </p></li><li><p>Die Maske wird auch mit chmod gesetzt (wenn hiermit Rechte für die Unix-Gruppe eingetragen werden, wirkt die Änderung bei Dateien mit ACL statt dessen auf die Maske), was aufgrund der Fähigkeiten von chmod sehr praktisch ist.</p></li><li><p>Ändern von Rechten für die Unix-Gruppe ist bei Dateien mit ACL nicht mit chmod möglich, sondern nur mit setfacl. </p></li><li><p>Das Programm getfacl zeigt sowohl die Rechte der Unix-Gruppe, als auch die Maske, und die effektiven Rechte durch Anwendung der Maske.</p></li></ul><p>
Wie man mit den Masken umgeht, ist in diesem Artikel in den jeweiligen Kapiteln beschrieben.</p><p>Wenn die ACL ganz entfernt wird, dann werden die Gruppenrechte gleich den effektiven Rechte der besitzenden Gruppe gesetzt, also der Maske geschnitten mit den Rechten der besitzenden Gruppe.</p><p>Zum Verständnis: Der Grund für diese Konstuktion ist Kompatibilität von alten Programmen. Manche Programme müssen kurz alle fremden Zugriffe auf einzelne Dateien verhindern, und benutzen dafür chmod. Diese erzielen automatisch auch bei zusätzlichen ACL-Rechten die beabsichtigte Wirkung, indem das vermeintliche Aussperren der Gruppe in Wahrheit die Maske setzt, und darüber effektiv sowohl die Gruppe, als auch auch alle mit ACL freigegebenen anderen Nutzer und Gruppen aussperrt. Die Programme erhalten auch von ls die erwartete Rückmeldung, dass die Änderung durchgeführt wurde.</p></div><div class="section_1"><h2 id="Shellbefehle">Shellbefehle<a class="headerlink" href="#Shellbefehle">¶</a></h2><p>
Einige Shellbefehle ändern bei Anwesenheit von ACLs ihr Verhalten geringfügig. Sie können aber trotzdem unverändert weiter benutzt werden.</p><div class="section_2"><h3 id="bash">bash<a class="headerlink" href="#bash">¶</a></h3><p>
Der Befehl <strong>test</strong> bzw. <code class="notranslate">[</code> kann prüfen, ob eine Datei für den aktuellen Prozess lesbar, schreibbar oder ausführbar ist.</p><div class="bash"><div class="contents"><pre class="notranslate">[ -r DATEI ]
[ -w DATEI ]
[ -x DATEI ] </pre></div></div><p>Diese Befehle funktionieren auch mit ACLs richtig, weil sie die effektiven Rechte prüfen.</p></div><div class="section_2"><h3 id="ls">ls<a class="headerlink" href="#ls">¶</a></h3><p>
<code class="notranslate">ls -l</code> zeigt mit dem "+" nach den Unixrechten an, dass die Datei ACLs hat.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Das Anzeigen der Anwesenheit von ACLs durch ein "+" ist nicht auf allen unixähnlichen Plattformen implementiert. Es kann daher passieren, dass ACLs dort übersehen werden.
</p></div></div><p>Außerdem zeigt <code class="notranslate">ls</code> statt der Gruppenberechtigung die <a class="crosslink" href="#maske">Maske</a> an. Das kann irreführend sein. Ein extremes Beispiel:</p><pre class="notranslate">-rw-rwx---+ 1 anton schreiber 825 2010-01-01 00:00 roman.txt 
    ^^^   ^

# file: roman.txt
# owner: anton
# group: schreiber
user::rw-
user:chef:---        # keine Rechte!
group::---           # keine Rechte!
group:lektoren:---   # keine Rechte!
mask::rwx
other::---</pre><p>Die Maske ist <code class="notranslate">rwx</code>. Trotzdem hat in diesem Beispiel niemand aus den Gruppen und den benannten Benutzern irgendwelche Rechte.</p><p>Umgekehrt bedeutet eine Maske <code class="notranslate">---</code>, dass niemand aus den Gruppen und den benannten Benutzern effektiv irgendwelche Rechte hat, obwohl Einträge vorhanden sein können.</p></div><div class="section_2"><h3 id="chmod">chmod<a class="headerlink" href="#chmod">¶</a></h3><p>
chmod bearbeitet bei Dateien mit ACLs nicht die Gruppenrechte, sondern die <a class="crosslink" href="#maske">Maske</a>.</p><div class="bash"><div class="contents"><pre class="notranslate"># Bei Dateien ohne ACL:
chmod g=RECHTE	        # setzt die Rechte der besitzenden Gruppe

# Bei Dateien mit ACL:
chmod g=RECHTE	        # setzt die Maske 
setfacl -m m::RECHTE	# ebenso
setfacl -m g::RECHTE    # setzt die Rechte der besitzenden Gruppe </pre></div></div><p>Ansonsten steht die gesamte Syntax von chmod unverändert zur Verfügung. Insbesondere das große "X" zum Setzen des x-Bits (nur bei Verzeichnissen oder wenn andere x-Bits gesetzt sind) ist sehr nützlich.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wenn man irgendwo in einem Verzeichnisbaum ACLs benutzt, weiß man nicht, ob chmod die Gruppenrechte oder falls vorhanden die Maske ändert. In diesem Fall kann es sinnvoll sein, die Rechte immer mit setfacl statt chmod zu setzen.
</p></div></div></div><div class="section_2"><h3 id="chown-chgrp">chown, chgrp<a class="headerlink" href="#chown-chgrp">¶</a></h3><p>
<a class="internal" href="./chown.html">chown</a> und <a class="internal" href="./chgrp.html">chgrp</a> funktionieren unverändert. Die Besitzer und besitzenden Gruppen werden korrekt in der Ausgabe von getfacl hinter <code class="notranslate">#</code> angegeben und beim Dateizugriff mit der richtigen <a class="crosslink" href="#prio">Priorität</a> berücksichtigt.</p></div><div class="section_2"><h3 id="mv-cp">mv, cp<a class="headerlink" href="#mv-cp">¶</a></h3><p>
Die Befehle <a class="internal" href="./cp.html">cp</a> mit der Option <code class="notranslate">-p</code> und <a class="internal" href="./mv.html">mv</a> setzen ACLs der Zieldatei richtig. Wenn das nicht geht, weil z.B. das Zieldateisystem keine ACLs unterstützt, wird eine Warnung ausgegeben.</p></div><div class="section_2"><h3 id="umask-touch-mkdir-mknod-mkfifo">umask, touch, mkdir, mknod, mkfifo<a class="headerlink" href="#umask-touch-mkdir-mknod-mkfifo">¶</a></h3><p>
Beim Anlegen von Dateien (und Verzeichnissen und Fifos und Gerätedateien) wird <code class="notranslate">umask</code> ignoriert und durch eine etwaige Default-ACL in einem Verzeichnis ersetzt. Näheres s. <a class="crosslink" href="#vererbung">Vererbung von ACLs und Default-ACLs</a>.</p><p><a class="crosslink anchor" href="#vererbung" id="vererbung"></a>
</p></div></div><div class="section_1"><h2 id="Vererbung-von-ACLs-und-Default-ACLs">Vererbung von ACLs und Default-ACLs<a class="headerlink" href="#Vererbung-von-ACLs-und-Default-ACLs">¶</a></h2><p>
Hier wird beschrieben, wie die ACL und Default-ACL für ein Verzeichnis gesetzt wird, das von mehreren Benutzern gemeinsam genutzt werden soll.</p><div class="section_2"><h3 id="Motivation-2">Motivation<a class="headerlink" href="#Motivation-2">¶</a></h3><p>
Angenommen man benötigt ein Verzeichnis, indem mehrere Benutzer Dateien anlegen und wechselseitig bearbeiten. Der Einfachheit halber legen wir dazu eine Gruppe an, in der alle berechtigten Benutzer Mitglied sind.</p><p>Die Berechtigungen neuer Dateien hängt von dem erstellenden Prozess ab (Benutzer, Gruppe, umask). Damit auch die Kollegen die Dateien schreiben können, muss jeder Benutzer:</p><ul><li><p>neu angelegte Dateien mit chgrp der gemeinsamen Gruppe zuweisen (außer die Gruppe des schreibenden Prozesses ist schon die gemeinsame Gruppe). </p></li><li><p>mit chmod der Gruppe die Lese- und Schreibberechtigung erteilen (außer seine umask ist schon richtig gesetzt). </p></li></ul><p>
Die Benutzer müssen den Vorgang manuell durchführen und werden ihn oft vergessen. Dann müssen die anderen Benutzer dem Verursacher oder dem Administrator hinterher laufen, damit dieser die Rechte geraderückt.</p><p>Durch Setzten des sgid-Bits des Arbeitsverzeichnisses bewirkt man, dass automatisch neue Dateien und Unterverzeichnisse die Gruppe des Verzeichnisses annehmen und Unterverzeichnisse das sgid-Bit gesetzt bekommen. Die Überprüfung und Korrektur der Berechtigungen muss allerdings noch manuell erfolgen. Diesen Missstand kann man mit Default-ACLs teilweise beheben.</p></div><div class="section_2"><h3 id="Aufbau-einer-Default-ACL">Aufbau einer Default-ACL<a class="headerlink" href="#Aufbau-einer-Default-ACL">¶</a></h3><p>
Default-ACLs sind Vorlagen für ACLs neu angelegter Dateien und Unterverzeichnisse. Nur Verzeichnisse können eine Default-ACL enthalten. So bewirkt man, dass die Berechtigungen für neu angelegte Dateien und Unterverzeichnisse nicht vom erstellenden Prozess abhängen, sondern eine Eigenschaft des Verzeichnisses sind. Default-ACLs sehen aus wie ACLs, nur enthalten sie zusätzlich ein <code class="notranslate">d:</code> am Anfang.</p><p>Eine Default-ACL enthält immer:</p><ul><li><p>Rechte für den Besitzer</p></li><li><p>Rechte für die besitzende Gruppe</p></li><li><p>Rechte für Andere</p></li></ul><p>
Daneben kann sie enthalten:</p><ul><li><p>Rechte für ein oder mehrere benannte Benutzer</p></li><li><p>Rechte für ein oder mehrere benannte Gruppen</p></li><li><p>Vorgabe für die Maske</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Setzen-und-Loeschen-von-Default-ACLs">Setzen und Löschen von Default-ACLs<a class="headerlink" href="#Setzen-und-Loeschen-von-Default-ACLs">¶</a></h3><p>
Das Setzen und Löschen der Default-ACLs geschieht wie bei den ACLs mit setfacl. Dabei setzt man entweder die Option <code class="notranslate">-d</code> oder man fügt vor die einzelnen Rechte ein <code class="notranslate">d:</code> ein.</p><div class="bash"><div class="contents"><pre class="notranslate">#Beide Befehle modifizieren die Default ACL für einen Benutzer und eine Gruppe
setfacl -dm u:BENUTZERNAME:RECHTE,g:GRUPPE:RECHTE VERZEICHNIS ...
setfacl -m d:u:BENUTZERNAME:RECHTE,d:g:GRUPPE:RECHTE VERZEICHNIS ... </pre></div></div><p>Lässt man die Pflichteinträge in der Default-ACL für Besitzer, besitzende Gruppe und Andere weg, dann werden sie gleich den entsprechenden Einträgen in der ACL gesetzt.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
</p><ul><li><p>Sowohl in der ACL eines Verzeichnisses als auch in der Default-ACL sollen alle Parteien mit r-Recht auch das x-Recht haben. Dann bekommen das Verzeichnis und neue Unterverzeichnisse und Dateien automatisch übliche und sinnvolle Rechte zugeordnet.</p></li><li><p>Beim Bearbeiten einzelner gleichartiger Verzeichnisse muss man die <a class="crosslink" href="#maske">Maske</a> weder in der ACL noch in der Default-ACL beachten. Sie wird dann automatisch richtig gesetzt.</p></li><li><p>Die Verwendung des sgid-Bits zum Vererben der Gruppenzugehörigkeit kann weiterhin verwendet werden.</p></li></ul></div></div><p>Entfernen einzelner Einträge in der Default-ACL. Ggf. muss auch hier die Option <code class="notranslate">-n</code> benutzt werden, um die Neuberechnung der Maske zu unterbinden.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -x -d u:BENUTZER,g:GRUPPE,... DATEI ...
setfacl -x    d:u:BENUTZER,d:g:GRUPPE,... DATEI ... </pre></div></div><p>Mit dem folgenden Befehl wird die Default-ACL entfernt.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -k DATEI ... </pre></div></div></div><div class="section_2"><h3 id="Dateien-und-Verzeichnisse-neu-anlegen">Dateien und Verzeichnisse neu anlegen<a class="headerlink" href="#Dateien-und-Verzeichnisse-neu-anlegen">¶</a></h3><p>
Neu angelegte Unterverzeichnisse bekommen als ACL die Default-ACL des Oberverzeichnisses zugeordnet. Zusätzlich erben sie die Default-ACL als eigene Default-ACL.</p><p>Neu angelegte Dateien bekommen als ACL die Default-ACL des Oberverzeichnisses zugeordnet, wobei das x-Bit gesondert bearbeitet wird. Legt man ohne ACLs Dateien an, so haben sie das x-Bit nicht gesetzt, obwohl die umask dies eigentlich vorsieht. Sonst wäre die neue Datei ungewollt ausführbar. Mit ACLs wird ebenso dafür gesorgt, dass neue Dateien nicht ausführbar sind, indem das x-Bit vom Besitzer, der Maske und Anderen gelöscht wird. Die Maske wirkt wie gesagt auf benannte Benutzer und alle Gruppen, so dass deren Einträge unverändert bleiben können.</p><p>Bei Bedarf kann man natürlich mit chmod oder setfacl die Datei ausführbar machen.</p><div class="section_3"><h4 id="Beispiel-2">Beispiel<a class="headerlink" href="#Beispiel-2">¶</a></h4><p>
Der Benutzer Anton richtet ein Arbeitsverzeichnis ein und will dort mit der Gruppe der Lektoren Dateien bearbeiten. Die Default-ACL legt fest, welche Dateien und Unterverzeichnisse zugeordnet bekommen. Die Maske wird hier neu berechnet.</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir common
setfacl -m g:lektoren:rwx,o::rx common
setfacl -d -m g:lektoren:rwx,o::rx common
getfacl common </pre></div></div><pre class="notranslate"># file: common
# owner: anton
# group: schreiber
user::rwx
group::r-x
group:lektoren:rwx
mask::rwx
other::r-x
default:user::rwx            # aus ACL übernommen
default:group::r-x           # aus ACL übernommen
default:group:lektoren:rwx
default:mask::rwx            # berechnet aus Rechten der Gruppe der Lektoren und besitzende Gruppe
default:other::r-x</pre><p>Unterverzeichnisse bekommen die gleiche ACL und Default-ACL wie die Default-ACL des Oberverzeichnisses.</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir common/subdir
getfacl common/subdir/ </pre></div></div><pre class="notranslate"># file: common/subdir/
# owner: anton
# group: schreiber
user::rwx
group::r-x
group:lektoren:rwx
mask::rwx
other::---
default:user::rwx
default:group::r-x
default:group:lektoren:rwx
default:mask::rwx
default:other::r-x</pre><p>Bei neu angelegten Dateien wird das x-Bit gelöscht.</p><div class="bash"><div class="contents"><pre class="notranslate">touch common/roman.txt
getfacl common/roman.txt  </pre></div></div><pre class="notranslate"># file: common/roman.txt
# owner: anton
# group: schreiber
user::rw-      # Hier wurde das x-Bit automatisch entfernt.
group::r-x			#effective:r--
group:lektoren:rwx		#effective:rw-
mask::rw-      # Hier wurde das x-Bit automatisch entfernt.
other::r--     # Hier wurde das x-Bit automatisch entfernt.</pre><p>Im obigen Beispiel sieht man, wie der Besitzer des Arbeitsverzeichnis, einer anderen Gruppe Schreibzugriff auf seine neu angelegten Dateien gewährt hat.</p><p>Angenommen Lothar aus der Gruppe <code class="notranslate">lektoren</code> hätte eine Datei angelegt. Der Benutzer Anton hätte keinen Zugriff darauf, außer Lesezugriff als "other". Die Berechtigung der neuen Datei kann er nicht ändern, weil er nicht der Benutzer ist. Um sicherzustellen, dass er von Anfang an Lese- und Schreibzugriff auf neue Dateien der Lektoren hat, hätte er in die Default-ACL zusätzlich sich selbst oder seine Gruppe eintragen müssen.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -d -m u:anton:rwx common
setfacl -d -m g:schreiber:rwx common </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wenn der Besitzer eines Arbeitsverzeichnisses Dateien bearbeiten können will, die andere angelegt haben, dann muss er sich selbst als benannter Benutzer oder benannte Gruppe in die Default-ACL mit den gewünschten Rechten eintragen.
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Default-ACLs verhindern, dass Anwender neue Dateien <em>versehentlich</em> mit den falschen Rechten anlegen. Sie können aber nicht verhindern, dass Anwender <em>absichtlich</em> die Rechte auf neuen Dateien ändern und Unsinn machen.
</p></div></div></div></div><div class="section_2"><h3 id="Dateien-ins-Zielverzeichnis-verschieben-und-kopieren">Dateien ins Zielverzeichnis verschieben und kopieren<a class="headerlink" href="#Dateien-ins-Zielverzeichnis-verschieben-und-kopieren">¶</a></h3><p>
Es gibt 4 Möglichkeiten, Dateien in einem Verzeichnis mit Default-ACL anzulegen:</p><ol class="arabic"><li><p>Komplett neu anlegen: </p><div class="bash"><div class="contents"><pre class="notranslate">touch VERZEICHNIS/Datei </pre></div></div><p> oder durch Abspeichern aus einer Anwendung ins entsprechende Verzeichnis mit einem noch nicht existierenden Dateinamen. Wie oben beschrieben, werden die ACLs dabei komplett durch Default-ACL bestimmt.</p></li><li><p>Verschieben und Verlinken existierender Dateien: </p><div class="bash"><div class="contents"><pre class="notranslate">mv Datei VERZEICHNIS
ln Datei VERZEICHNIS </pre></div></div><p> oder durch Drag&amp;Drop in einem Dateimanager in der grafischen Benutzeroberfläche. Die Datei behält die ursprüngliche Rechte / ACL bei, vorausgesetzt die Aktion findet im gleichen Dateisystem statt. In beiden Fällen wird die existierende Datei mit ihren Rechten nur im Zielverzeichnis verlinkt.</p></li><li><p>Kopieren: </p><div class="bash"><div class="contents"><pre class="notranslate">cp Datei VERZEICHNIS </pre></div></div><p> oder durch Drag&amp;Drop z.B. in Nautilus mit 
<span class="key">Strg</span> -Taste gedrückt. Die ACL wird durch die Default-ACL bestimmt, da die Zieldatei neu angelegt wird. Ausnahme: Die Maske der Zieldatei entspricht dem Gruppenrecht bzw. Maske der Quelldatei.</p></li><li><p>Kopieren mit Beibehalten der Rechte: </p><div class="bash"><div class="contents"><pre class="notranslate">cp -p Datei VERZEICHNIS </pre></div></div><p> Die Zieldatei hat exakt die gleichen Rechte/ACL wie die Quelldatei.</p></li></ol><p>
Wenn das Zielverzeichnis ein gemeinsames Arbeitsverzeichnis sein soll, in dem mehrere Benutzer auf die Dateien von anderen Benutzern Zugriff haben sollen, dann wird es trotz Verwendung von ACLs wahrscheinlich zu Problemen kommen: Benutzer werden neue Dateien in ihrem Homeverzeichnis editieren und dann ins gemeinsame Arbeitsverzeichnis verschieben.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Benutzer müssen angewiesen werden, entweder Dateien im Arbeitsverzeichnis neu anzulegen oder ihre Dateien ins Arbeitsverzeichnis zu kopieren und nicht zu verschieben. Außerdem könnte man ggf. die umask der Benutzer so setzen, dass ihre neuen Dateien automatisch für die Gruppe lesbar oder schreibbar sind (vorletzte Stelle 0 oder 2, aber nicht 7). Dann wäre sichergestellt, dass beim Kopieren ins Zielverzeichnis die Maske der Zieldatei automatisch richtig gesetzt wird.
</p></div></div><p><a class="crosslink anchor" href="#baeume" id="baeume"></a>
</p></div></div><div class="section_1"><h2 id="Verzeichnisbaeume">Verzeichnisbäume<a class="headerlink" href="#Verzeichnisbaeume">¶</a></h2><p>
Man kann ACLs nicht nur für einzelne Dateien und Verzeichnisse setzen. Man kann ACLs auch gleichzeitig für Dateien und Verzeichnisse und (rekursiv mit dem Parameter <code class="notranslate">-R</code>) für komplette Verzeichnisbäume einschließlich bereits <em>bestehender</em> Dateien setzen. So kann man ausgewählten Benutzern Zugriff auf bestehende Verzeichnisbäume ermöglichen und durcheinander geratene Rechte aufräumen. Wenn Benutzer neue Unterverzeichnisse und Dateien mit vorgeschriebenen Zugriffsrechten anlegen können sollen, kann man allen Verzeichnissen auch eine Default-ACL geben.</p><p>Hier wird beschrieben, wie man mit setfacl am Beispiel eines bestehenden Verzeichnisbaumes effektiv ACLs und Default-ACLs gleichzeitig für Verzeichnisse und Dateien setzt.</p><div class="section_2"><h3 id="Problem">Problem<a class="headerlink" href="#Problem">¶</a></h3><p>
Um mit setfacl gleichzeitig in Verzeichnissen <em>und</em> Dateien mit wenig Aufwand im Sinne des Erfinders ACLs zu setzen, bedarf es einer Erklärung, die leider nicht in den Manpages oder anderer Doku zu finden ist.</p><p>Normalerweise möchte man Unterverzeichnissen sowohl r- als auch x-Rechte zuordnen und Dateien nur r-Rechte. (Ausnahme: ausführbare Dateien, die auch nachher ausführbar sein sollen) Man möchte aber nicht mit <code class="notranslate">find ... -exec setfacl ...</code> separate Aufrufe für Verzeichnisse und für normale Dateien machen, sondern nur einen.</p><p>Die nächste Frage ist, wie setzt man die Maske? Wenn man die Maske automatisch berechnen lässt, wird sie auch bei normalen Dateien das x-Bit enthalten und alle benannten Benutzer und Gruppen können die Datei ausführen, was ja nicht erwünscht ist. Die Maske vorgeben geht auch nicht, weil normale Dateien und Verzeichnisse unterschiedliche Masken haben müssen und man dann zwei Aufrufe machen müsste.</p><p>Wenn man Vererbung von ACLs nutzen möchte, muss man Default-ACLs anlegen. Anders als in der ACL, kann man bedenkenlos die Maske automatisch setzen, denn sie gilt ja nur für Verzeichnisse und kann eh nicht mit chmod gesetzt werden.</p><p>Diese Rahmenbedingungen führen dazu, dass Benutzer sich unnötigerweise Skripte zum Setzen der ACLs zusammenstückeln basteln oder irrtümlich erteilte x-Rechte mühsam wieder wegnehmen müssen.</p></div><div class="section_2"><h3 id="Setzen-von-ACLs-in-Verzeichnisbaeumen">Setzen von ACLs in Verzeichnisbäumen<a class="headerlink" href="#Setzen-von-ACLs-in-Verzeichnisbaeumen">¶</a></h3><p>
Im folgenden Beispiel soll ähnlich wie unter <a class="crosslink" href="#vererbung">Vererbung von ACLs und Default-ACLs</a> beschrieben folgende Rechteverteilung hergestellt werden:</p><ul><li><p>Die bestehenden Besitztümer und Rechte sind durcheinander geraten und sollen korrigiert werden.</p></li><li><p>Der Autor Anton aus der Gruppe der Schreiber will der Gruppe von Lektoren Lese- und Schreibrechte erteilen.</p></li><li><p>Der Chef soll einen Zugriff bekommen.</p></li><li><p>Anton und seine Kollegen aus der Gruppe der Schreiber sollen neue Dateien der Lektoren lesen können.</p></li><li><p>Die Standard-Unixberechtigungen sollen vereinheitlicht werden. </p></li></ul><p>
1. Vorbereitung: Wechsel des Besitzes</p><p>Wenn ein Verzeichnisbaum von mehreren Benutzern bearbeitet worden ist, gehören die Dateien möglicherweise verschiedenen Nutzern. Dann muss man als Root die Dateien einem einzelnen Besitzer zuordnen, der dann die ACLs setzen kann. Ggf. müssen alte ACLs entfernt werden.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo chown -R USER:GRUPPE /home/USER/VERZEICHNIS
setfacl -R -b /home/USER/VERZEICHNIS </pre></div></div><p>Wenn die bestehenden Besitzverhältnisse jedoch beibehalten werden sollen, dann müssen die Aufrufe von setfacl durch die verschiedenen Benutzer (umständlich) oder am besten gleich als root erfolgen.</p><p>2. Schritt: Setzen der ACLs</p><p>Zuerst setzt man mit der Option <code class="notranslate">-R</code> die ACL rekursiv für den Verzeichnisbaum. In der ACL setzt man - jeweils wenn nötig - die Rechte für:</p><ul><li><p>Besitzer</p></li><li><p>benannte User, </p></li><li><p>die besitzende Gruppe,</p></li><li><p>benannte Gruppen und</p></li><li><p>Andere</p></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p> * In der ACL sollen alle Gruppen und benannten Benutzer mit r-Recht auch das x-Recht auf Verzeichnisse und ausführbare Dateien haben. Das erreicht man mit einem großen <code class="notranslate">X</code> in setfacl. Dabei wird x-Recht gesetzt, wenn es ein Verzeichnis ist oder bereits jemand anders auf diese Datei das x-Recht hat.
</p></div></div><p>Der fertige Befehl mit allen Arten von ACL-Einträgen sieht z.B. so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -R -m u::rwX,u:chef:-,g::rX,g:schreiber:rX,g:lektoren:rwX,o::rX VERZEICHNIS </pre></div></div><p>Man lässt hier die Maske automatisch berechnen. Sie wird dann richtig gesetzt sein.</p><p>3. Schritt: Setzen der Default-ACLs</p><p>Nur wenn Vererbung von ACLs auf neue Verzeichnisse und Dateien gewünscht wird, benötigt man Default-ACLs. Dann benötigt man einen zweiten Aufruf, weil - anders als bei ACLs - die Maske in den Default-ACLs automatisch berechnet werden soll.</p><p>In der Default-ACL setzt man - jeweils wenn nötig - die Rechte für:</p><ul><li><p>den Besitzer</p></li><li><p>benannte User, </p></li><li><p>die besitzende Gruppe,</p></li><li><p>benannte Gruppen und</p></li><li><p>Andere.</p></li></ul><p>
Die Einträge für den Besitzer, die besitzende Gruppe und Andere können weggelassen werden, wenn sie gleich den eben gesetzten ACL-Einträgen sein sollen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
</p><ul><li><p>In der Default-ACL sollen <em>alle</em> Gruppen und Benutzer mit r-Recht auch das x-Recht haben. Neue Dateien werden trotzdem keine unerwünschten x-Rechte bekommen.</p></li><li><p>Statt einem kleinen <code class="notranslate">x</code> kann man auch ein großes <code class="notranslate">X</code> nehmen. Daher kann man die Rechte aus der eben gesetzten ACL in die Befehlszeile hineinkopieren.</p></li></ul></div></div><p>Der fertige Befehl mit allen Arten von Default-ACL-Einträgen sieht z.B. so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -R -d -m u::rwx,u:chef:-,g::rx,g:schreiber:rx,g:lektoren:rwx,o::rx VERZEICHNIS </pre></div></div><p>Man lässt hier die Maske automatisch berechnen. Sie wird dann richtig gesetzt sein.</p><p>Zur besseren Übersicht sind hier die ACL- und Default-ACL-Einträge aus den beiden Kommandozeilen untereinander aufgelistet:</p><pre class="notranslate">u::rwx
u:chef:-
g::rx
g:schreiber:rx
g:lektoren:rwx
o::rx

d:u::rwx      
d:u:chef:-
d:g::rx
d:g:schreiber:rx
d:g:lektoren:rwx
d:o::rx </pre><p>Mit diesem Vorgehen (und nur so) kann man auf einfache Weise fast immer die Rechte wie benötigt setzen.</p><p>In wenigen Ausnahmefällen muss man manuell mit setfacl Masken und ACLs in ausgewählten Dateien setzen oder eine Nutzung von Default-ACLs funktioniert nicht wie gewünscht:</p><ul><li><p>Falls einige der Gruppen oder benannten Mitglieder x-Rechte auf Dateien oder Verzeichnisse benötigen und andere nicht.</p></li><li><p>Falls man Verzeichnisse mit exotischen Rechten wie <code class="notranslate">r--</code> oder <code class="notranslate">--x</code> haben möchte.</p></li><li><p>Falls Dateien und Verzeichnisse unterschiedliche Rechte haben sollen.</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Nachtraegliches-bertragen-der-ACL-auf-Unterordner">Nachträgliches Übertragen der ACL auf Unterordner<a class="headerlink" href="#Nachtraegliches-bertragen-der-ACL-auf-Unterordner">¶</a></h3><p>
Um die Berechtigungen eines Ordners auf bereits bestehende Unterordner zu übertragen kann folgender Befehl verwendet werden.</p><div class="bash"><div class="contents"><pre class="notranslate">getfacl VERZEICHNIS | setfacl -R -M- VERZEICHNIS </pre></div></div><p>Hier werden erst die Berechtigungen des Verzeichnis ausgelesen und gleich wieder als rekursive (<code class="notranslate">-R</code>) Berechtigungen gesetzt.</p></div><div class="section_2"><h3 id="Zusammenfassung">Zusammenfassung<a class="headerlink" href="#Zusammenfassung">¶</a></h3><p>
Das obige Beispiel mit allen möglichen Aktionen sieht zusammengefasst so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo chown -R USER:GRUPPE /home/USER/VERZEICHNIS
setfacl -R -b /home/USER/VERZEICHNIS
setfacl -R    -m u::rwX,u:chef:-,g::rX,g:schreiber:rX,g:lektoren:rwX,o::rX VERZEICHNIS 
setfacl -R -d -m u::rwx,u:chef:-,g::rx,g:schreiber:rx,g:lektoren:rwx,o::rx VERZEICHNIS  </pre></div></div><p>Angenommen sei der Fall, Dateibesitzer, Gruppenzugehörigkeiten und Standard-Unixberechtigungen sind schon richtig und es soll nur eine benannte Gruppe mit Lese- und Schreibrechtenrechten hinzugefügt werden. Außerdem wollen der Besitzer und seine Kollegen, die Schreiber, selbst neue Dateien der fremden Gruppe lesen können.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -R    -m g:schreiber:rx,g:lektoren:rwx VERZEICHNIS 
setfacl -R -d -m g:schreiber:rx,g:lektoren:rwx VERZEICHNIS </pre></div></div><p>
Zum Abschluss noch ein ganz einfaches Beispiel, wo nur einer benannten Gruppe Leserechte erteilt werden soll.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl -R    -m g:lektoren:rx VERZEICHNIS
setfacl -R -d -m g:lektoren:rx VERZEICHNIS </pre></div></div></div></div><div class="section_1"><h2 id="Sichern-und-Wiederherstellen-von-ACLs">Sichern und Wiederherstellen von ACLs<a class="headerlink" href="#Sichern-und-Wiederherstellen-von-ACLs">¶</a></h2><p>
Man kann ACLs ganzer Verzeichnisbäume in eine Textdatei sichern und später wiederherstellen.</p><div class="bash"><div class="contents"><pre class="notranslate">getfacl -R -n VERZEICHNIS &gt; acl.txt </pre></div></div><p>Neben den ACLs werden hinter Kommentarzeichen <code class="notranslate">#</code> auch Dateiname, Besitzer und besitzende Gruppe sowie suid-, sgid- und sticky-Bits ausgegeben. Die ACLs einschließlich dieser Zusatzinformationen können mit dem folgenden Befehl wieder gesetzt werden. setfacl übernimmt dabei die gleichen Funktionen wie chown, chgrp und chmod. Voraussetzung ist natürlich, dass man der Besitzer der Dateien oder Root ist.</p><div class="bash"><div class="contents"><pre class="notranslate">setfacl --restore=acl.txt </pre></div></div><p>Diese Funktionalität ist ganz praktisch, wenn man Dateien auf andere Dateisysteme oder in Archivdateien speichern will, die keine ACLs erlauben.</p></div><div class="section_1"><h2 id="Weiteres-zu-ACLs">Weiteres zu ACLs<a class="headerlink" href="#Weiteres-zu-ACLs">¶</a></h2><p>
Die beiden Befehle setfacl und getfacl können noch mehr:</p><ul><li><p>Symlinks verfolgen oder nicht.</p></li><li><p>Zum Kopieren von ACLs die Ausgabe von getfacl nach setfacl eingeben.</p></li><li><p>Dateien ohne ACLs ignorieren.</p></li></ul><p>
Weitere Informationen findet man in der <a class="internal" href="./man.html">Manpages</a> zu setfacl und getfacl und über ACLs im Allgemeinen in der Manpage zu ACLs:</p><div class="bash"><div class="contents"><pre class="notranslate">man setfacl
man getfacl
man acl </pre></div></div><p><a class="crosslink anchor" href="#probleme" id="probleme"></a>
</p></div><div class="section_1"><h2 id="Probleme-mit-ACLs">Probleme mit ACLs<a class="headerlink" href="#Probleme-mit-ACLs">¶</a></h2><p>
Probleme mit ACLs an sich gibt es eigentlich nicht. ACLs und deren Zusammenspiel mit den klassischen Unixrechten sind konservativ implementiert worden, d.h. mit minimalen Einschränkungen auf Funktionalität und Sicherheit.</p><p>Vielmehr ist das Problem, dass Shellbefehle und Anwenderprogramme nicht mit ihnen umgehen können.</p><ul><li><p><code class="notranslate">find ... -ls</code> druckt anders als <code class="notranslate">ls -l</code> keine Hinweise auf die Existenz von ACLs aus.</p></li><li><p>Archivierungsprogramme wie <a class="internal" href="./tar.html">tar</a> speichern keine ACLs in ihren Archiven ab. Man kann das Problem umgehen, indem man mit <code class="notranslate">getfacl -R</code> die ACLs in eine Datei speichert und diese ebenso archiviert. Bei Bedarf kann man mit <code class="notranslate">setfacl --restore=FILE</code> die Rechte wiederherstellen.</p></li><li><p>Anwenderprogramme: Öffnet man eine mit einer ACL versehene Datei mit einem Editor und speichert diese unter anderem Namen wieder ab, so ist die ACL ebenfalls weg. Dies kann ggf. verhindert werden, indem man im übergeordneten Verzeichnis eine Default-ACL setzt. </p></li><li><p>Viele <a class="internal" href="./dateimanager.html">Dateimanager</a>, darunter <a class="internal" href="./nautilus.html">Nautilus</a>, <a class="internal" href="./thunar.html">Thunar</a> und <a class="internal" href="./pcmanfm.html">PCManFM</a>, können ACLs nicht korrekt anzeigen. Die <a class="internal" href="./kde.html">KDE</a>-Dateimanager <a class="internal" href="./konqueror.html">Konqueror</a> und der neuere <a class="internal" href="./dolphin.html">Dolphin</a> zeigen ACLs jedoch korrekt an. </p></li><li><p>Programme zur Überprüfung der Dateirechte und der Sicherheit des Betriebssystems prüfen u.U. nicht die ACLs. Es wäre daher möglich, unerkannt mit ACLs das System zu kompromittieren, ohne dass es jemandem auffällt.</p></li></ul><p>
</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.mathematik.hu-berlin.de/~ccafm/lehre_BZQ_Numerik/allg/rechte.shtml" rel="nofollow">Zugriffsrechte von Dateien</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> </p></li><li><p><a class="interwiki interwiki-pdf" href="http://www.mathematik.hu-berlin.de/~ccafm/lehre_BZQ_Numerik/allg/fs_acl-de.pdf">Einführung in Access Control Lists unter Linux</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Einführung von Andreas Grünbacher (PDF)</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./acl/a/revision/909278.html">Diese Revision</a> wurde am 24. September 2016 01:24 von <a href="https://ubuntuusers.de/user/march/">march</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./acl.html">ACL</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>