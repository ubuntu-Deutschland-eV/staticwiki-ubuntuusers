<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>rsync › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./rsync.html">rsync</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/rsync">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./rsync/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./rsync/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./rsync/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./rsync/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./rsync/a/backlinks.html">rsync</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a>, <em>optional</em> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./paketquellen_freischalten.html">Bearbeiten von Paketquellen</a>, <em>optional</em> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Anwendung">Anwendung
</a><ol class="arabic"><li><a class="crosslink" href="#Optionen">Optionen
</a></li><li><a class="crosslink" href="#Wichtige-Hinweise">Wichtige Hinweise
</a></li></ol></li><li><a class="crosslink" href="#Beispiele">Beispiele
</a><ol class="arabic"><li><a class="crosslink" href="#Vorab-zur-Syntax">Vorab zur Syntax
</a></li><li><a class="crosslink" href="#Sicherung-von-lokalem-Rechner-auf-entfernten-Rechner">Sicherung von lokalem Rechner auf entfer...</a></li><li><a class="crosslink" href="#Sicherung-von-entferntem-Rechner-auf-lokalen-Rechner">Sicherung von entferntem Rechner auf lok...</a></li><li><a class="crosslink" href="#Sicherung-innerhalb-des-Systems">Sicherung innerhalb des Systems
</a></li><li><a class="crosslink" href="#Verzeichnisse-von-der-Sicherung-ausschliessen">Verzeichnisse von der Sicherung ausschli...</a></li><li><a class="crosslink" href="#Differentielle-Sicherung-des-Systems">Differentielle Sicherung des Systems
</a></li><li><a class="crosslink" href="#Lokales-Verlinken-ganzer-Verzeichnisstraenge">Lokales Verlinken ganzer Verzeichnissträ...</a></li></ol></li><li><a class="crosslink" href="#Grafische-Benutzeroberflaechen">Grafische Benutzeroberflächen
</a><ol class="arabic"><li><a class="crosslink" href="#Grsync">Grsync
</a></li><li><a class="crosslink" href="#LuckyBackup">LuckyBackup
</a></li><li><a class="crosslink" href="#Unison">Unison
</a></li></ol></li><li><a class="crosslink" href="#rsync-als-Daemon">rsync als Daemon
</a><ol class="arabic"><li><a class="crosslink" href="#rsyncd-munged-Wiederherstellen-gesicherter-Symlinks">rsyncd-munged - Wiederherstellen gesiche...</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/terminal.png" class="image-left" src="./_/e81889fd6e485dd32e1cde611eabc18abced7993.png"/>
<strong>rsync</strong> ist ein Programm, um Dateien zwischen lokalen oder über das Netzwerk erreichbaren Pfaden abzugleichen. Dabei werden zunächst die Größe und die Änderungszeit der Dateien in Quelle und Ziel verglichen ("Quick Check"-Algorithmus), so dass nur die Dateien behandelt werden müssen, bei denen es Änderungen gegeben hat. Sind Quelle und Ziel lokale Pfade, werden die betroffenen Dateien normal kopiert. Wenn auf Quelle oder Ziel aber per <a class="internal" href="./ssh.html">SSH</a> oder über einen speziellen rsync-daemon zugegriffen wird, nutzt rsync zusätzlich noch einen speziellen Delta-Transfer-Algorithmus, so dass nur die geänderten Teile der Dateien über das Netzwerk transportiert werden müssen.</p><p>Aufgrund dieser Eigenschaften ist rsync sehr gut geeignet, um <a class="internal" href="./backup.html">Sicherungen</a> durchzuführen. Für regelmäßige automatisierte Sicherungen eignen sich Programme wie <a class="internal" href="./rsnapshot.html">rsnapshot</a> oder <a class="internal" href="./back_in_time.html">Back In Time</a>, die ihrerseits wieder rsync verwenden. Wenn man allerdings Verzeichnisse zwischen zwei Systemen wie Laptop und Desktop-Rechner synchronisieren möchte, sind Programme wie <a class="internal" href="./unison.html">Unison</a> besser geeignet.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
rsync ist im gleichnamigen Paket enthalten, welches standardmäßig unter Ubuntu installiert ist. Sollte das Programm fehlen, lässt es sich wie folgt installieren<sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>rsync</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install rsync </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install rsync </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Anwendung">Anwendung<a class="headerlink" href="#Anwendung">¶</a></h2><p>
Die Syntax des Befehls im Terminal <sup><a href="#source-3">[3]</a></sup> sieht folgendermaßen aus:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] QUELLE(N) ZIEL </pre></div></div><p>Anstelle des Platzhalters <code class="notranslate">QUELLE</code> gibt man den Ort an aus dem gelesen werden soll und das <code class="notranslate">ZIEL</code> bestimmt den Ort in den rsync zu kopieren hat. Gibt man nur einen Parameter an, so wird dieser als Ziel interpretiert und es gilt das aktuelle Verzeichnis als Quelle.</p><div class="section_2"><h3 id="Optionen">Optionen<a class="headerlink" href="#Optionen">¶</a></h3><p>
Es ist empfehlenswert, die Option <code class="notranslate">-a</code> immer zu benutzen, um alle Rechte und Eigentümer der Quelldatei auf dem Zielmedium zu übernehmen:  
</p><ul><li><p><code class="notranslate">-a</code> fasst folgende Optionen zusammen: </p><ul><li><p><code class="notranslate">-r</code> kopiert Unterverzeichnisse </p></li><li><p><code class="notranslate">-l</code> kopiert symbolische Links </p></li><li><p><code class="notranslate">-p</code> behält Rechte der Quelldatei bei </p></li><li><p><code class="notranslate">-t</code> behält Zeiten der Quelldatei bei, </p></li><li><p><code class="notranslate">-g</code> behält Gruppenrechte der Quelldatei bei </p></li><li><p><code class="notranslate">-o</code> behält Besitzrechte der Quelldatei bei (nur root) </p></li><li><p><code class="notranslate">-D</code> behält Gerätedateien der Quelldatei bei (nur root) </p></li></ul></li></ul><p>
</p><p>
</p><table><tr class="titel"><td colspan="2">Weitere Optionen </td></tr><tr class="kopf"><td>Option </td><td> Wirkung </td></tr><tr><td> <code class="notranslate">-u</code> </td><td> überspringt Dateien, die im Ziel neuer sind als in der Quelle </td></tr><tr class="highlight"><td><code class="notranslate">-v</code> </td><td> zeigt während des Synchronisierens alle ausgeführten Schritte an  </td></tr><tr><td> <code class="notranslate">-x</code> </td><td> berücksichtigt nur Objekte, die sich im gleichen Dateisystem befinden  </td></tr><tr class="highlight"><td><code class="notranslate">-P</code> </td><td> aktiviert folgende Optionen: <br/> <code class="notranslate">--progress</code> Fortschrittsanzeige beim Transfer anzeigen <br/> <code class="notranslate">--partial</code> Fortsetzung des Transfers bei Abbruch  </td></tr><tr><td> <code class="notranslate">-n</code> </td><td> simuliert nur was passieren würde ("dry run") </td></tr><tr class="highlight"><td><code class="notranslate">--bwlimit</code> </td><td> z.B. <code class="notranslate">--bwlimit=30</code> limitiert die Bandbreite, die genutzt werden soll (Hilfreich, da rsync sonst die komplett verfügbare Bandbreite in Anspruch nimmt und sonstige Anwendungen damit blockiert)   </td></tr><tr><td> <code class="notranslate">-z</code> </td><td> aktiviert die Komprimierung für die Datenübertragung (diese Option ist sinnvoll, wenn zwischen Quelle und Ziel eine langsame Verbindung besteht) </td></tr><tr class="highlight"><td><code class="notranslate">-e</code> </td><td> wählt die remote shell aus, die meisten werden <a class="internal" href="./ssh.html">SSH</a> nutzen. Also <code class="notranslate">-e ssh</code> </td></tr><tr class="highlight"><td><code class="notranslate">-E</code> </td><td> behält die Ausführbarkeit von Dateien bei </td></tr><tr><td> <code class="notranslate">--exclude=Muster</code> </td><td> schließt ein bestimmtes Muster von der Sicherung aus </td></tr><tr class="highlight"><td><code class="notranslate">--exclude=ORDNER1 --exclude=ORDNER2</code> </td><td> schließt ORDNER1 und ORDNER2 von der Sicherung aus </td></tr><tr><td> <code class="notranslate">--delete</code> </td><td> vergleicht Quellverzeichnisse und Zielverzeichnisse und sorgt dafür, dass Dateien, die im Quellverzeichnis nicht (mehr) vorhanden sind, im Zielverzeichnis gelöscht werden. Dies kann dazu führen, dass man ungewollt Dateien löscht, die man aber noch in der Sicherung behalten möchte. </td></tr><tr class="highlight"><td><code class="notranslate">-b</code> </td><td> sorgt dafür, dass durch die Option <code class="notranslate">--delete</code>  gelöschte sowie alle veränderten Objekte gesichert werden (siehe dazu folgende Option <code class="notranslate">--backup-dir=</code>) </td></tr><tr><td> <code class="notranslate">--backup-dir=Verzeichnis</code> </td><td> gibt ein Verzeichnis für die gelöschten und geänderten Objekte an, siehe Option <code class="notranslate">-b</code> </td></tr><tr class="highlight"><td><code class="notranslate">-c</code> </td><td> aktiviert einen Dateivergleich basierend auf Checksumme und nicht auf Größe und Timestamp. Die eigentlich Checksummenbildung dauert deutlich länger als der Vergleich Größe und Timestamp; andererseits werden überflüssige Kopiervorgänge (z.B. bei nur geändertem Timestamp) vermieden.  </td></tr><tr><td> <code class="notranslate">--iconv</code> </td><td> sorgt für eine Konvertierung der Dateinamen zwischen Systemen mit verschiedenen Codepages. Dieser Parameter kann erforderlich werden, wenn Dateien mit z.B. Umlauten im Namen übertragen werden. </td></tr><tr class="highlight"><td><code class="notranslate">-h</code>, <code class="notranslate">--human-readable</code> </td><td> verwandelt Zahlen in den log Dateien und auf stdout in ein besser für Menschen lesbares Format. Große Zahlen werden zu K (kilobytes), M (megabytes), oder G (gigabytes). Wenn diese Option angegeben wird ist K (1000), M (1000*1000), und G (1000*1000*1000). Wenn diese Option doppelt angegeben ist (-hh) wird mit 1024 anstelle von 1000 gerechnet. </td></tr><tr><td> <code class="notranslate">-H</code> </td><td> Hardlinks werden berücksichtigt </td></tr><tr class="highlight"><td><code class="notranslate">--stats</code> </td><td> zeigt einen ausführlicheren Report am Ende einer Übertragung an. </td></tr><tr><td> <code class="notranslate">--size-only</code> </td><td> sorgt dafür, dass Dateien mit gleicher Dateigröße übersprungen werden, unabhängig davon, ob sie sich in anderen Eigenschaften unterscheiden. Hilfreich bei Sicherungen auf Datenträger mit den Dateisystemen FAT oder NTFS, welche die unter Linux für die Verwaltung der Besitz- und Zugriffsrechte verwendete <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Access_Control_List">UNIX-FACL</a> nicht unterstützen (<a class="internal" href="./windows-partitionen_einbinden.html#Generelle-Einschraenkungen">weitere Einschränkungen</a>).  </td></tr><tr><td> <code class="notranslate">--progress</code> </td><td> zeigt den Fortschritt des Kopiervorganges an. </td></tr></table><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Für weitere Optionen und ausführlichere Erklärungen die <a class="internal" href="./man.html">Manpage</a> oder Hilfe mit <code class="notranslate">rsync -h</code> aufrufen. 
</p></div></div></div><div class="section_2"><h3 id="Wichtige-Hinweise">Wichtige Hinweise<a class="headerlink" href="#Wichtige-Hinweise">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Vor dem Ausführen von rsync muss man sicher sein, die korrekten Parameter und Verzeichnisse angegeben zu haben. Fahrlässige Handhabung kann zu Datenverlust führen.</p><p>Kopiert man das gesamte <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a>, so werden auch private Daten, wie die privaten Schlüssel von <a class="internal" href="./ssh.html">SSH</a> und <a class="internal" href="./gnupg.html">GnuPG</a> kopiert. 
</p></div></div><p>rsync kann nur das kopieren, wozu der Nutzer auch <a class="internal" href="./rechte.html">Rechte</a> hat, z.B. bei</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -a /etc ZIEL </pre></div></div><p>kann es zu Problemen kommen. Falls nicht alles kopiert wird, kann man versuchen, von "Hand" die Daten mit <a class="internal" href="./cp.html">cp</a> bzw. <code class="notranslate">scp</code> zu kopieren oder man gibt sich durch das vorangestellte <code class="notranslate">sudo</code> Root-Rechte.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync -a /etc ZIEL </pre></div></div><p>Vorsicht ist geboten, wenn man versucht, Konten wechselseitig zu sichern. Man sollte darauf achten, dass man nicht das Backup von A auf B wieder auf A kopiert.</p><p>Nicht zuletzt bedeutet die Option <code class="notranslate">--delete</code> wirklich <span class="underline">delete</span>! Sind in dem Zielverzeichnis andere Daten, werden sie ins Backup-Verzeichnis geschoben oder auch gelöscht!</p></div></div><div class="section_1"><h2 id="Beispiele">Beispiele<a class="headerlink" href="#Beispiele">¶</a></h2><p>
</p><div class="section_2"><h3 id="Vorab-zur-Syntax">Vorab zur Syntax<a class="headerlink" href="#Vorab-zur-Syntax">¶</a></h3><p>
Bei allen Angaben zur Quelle und/oder des Ziels ist zu beachten, die slashes richtig zu setzen. Folgendes Beispiel soll dies verdeutlichen:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -a /boot/grub /data/backup </pre></div></div><p>erzeugt einen Unterordner <strong>/grub</strong> in <strong>/data/backup</strong>, weil <span class="underline">kein</span> slash hinter <strong>/boot/grub</strong> steht. Das heißt, dass die Daten nicht in <strong>/data/backup</strong> gespeichert werden, sondern in <strong>/data/backup/grub</strong>.</p><p>Wird der Befehl so</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -a /boot/grub/ /data/backup </pre></div></div><p>angewendet wird kein Unterordner beim Ziel erzeugt, da nun ein slash hinter <strong>/boot/grub/</strong> steht. Das heißt, dass alle Daten von <strong>/boot/grub/</strong> tatsächlich in das Verzeichnis <strong>/data/backup</strong> geschrieben werden. Folgende zwei Befehle sollen dies nochmals unterstreichen, da beide exakt das gleiche abgleichen und kopieren:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -a /boot/grub /data/backup
rsync -a /boot/grub/ /data/backup/grub </pre></div></div></div><div class="section_2"><h3 id="Sicherung-von-lokalem-Rechner-auf-entfernten-Rechner">Sicherung von lokalem Rechner auf entfernten Rechner<a class="headerlink" href="#Sicherung-von-lokalem-Rechner-auf-entfernten-Rechner">¶</a></h3><p>
In diesem Beispiel soll ein lokales <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> (<strong>/home/benutzer</strong>) auf einen zweiten Rechner mit dem Namen <code class="notranslate">example.com</code> gesichert werden, zu dem man per <a class="internal" href="./ssh.html">SSH</a> Zugang hat.</p><p>Dazu benötigt man die Option <code class="notranslate">-a</code>, damit alle Rechte erhalten bleiben. <code class="notranslate">-v</code> ist immer gut, damit man sieht, was passiert. Der Parameter <code class="notranslate">-z</code> verringert die Datenmenge, die übertragen werden muss, und <code class="notranslate">-e</code> wird benötigt, um SSH anzugeben. Außerdem sollte man den Parameter <code class="notranslate">--numeric-ids</code> verwenden, damit die UID des Besitzers nicht an den entfernten Rechner angepasst wird und man die Dateien später mit der gleichen Benutzerkennung zurückkopieren kann (UIDs beginnen bei Ubuntu ab 1000, während andere Distributionen mit 500 starten). Also sieht der Befehl so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync --numeric-ids -avze ssh /home/benutzer benutzer@example.com:/backups </pre></div></div><p>
Dies würde eine Kopie von <strong>/home/benutzer</strong> vom lokalen Rechner zum entfernten Rechner ins Verzeichnis <strong>/backups</strong> kopieren.</p></div><div class="section_2"><h3 id="Sicherung-von-entferntem-Rechner-auf-lokalen-Rechner">Sicherung von entferntem Rechner auf lokalen Rechner<a class="headerlink" href="#Sicherung-von-entferntem-Rechner-auf-lokalen-Rechner">¶</a></h3><p>
In diesem Beispiel soll das Verzeichnis <strong>/var/www</strong> vom Rechner <code class="notranslate">example.com</code> auf den lokalen Rechner gesichert werden. Außerdem sollen alle Dateien, die in <strong>/var/www</strong> gelöscht wurden, nachdem die letzte Sicherung erstellt wurde, lokal ebenfalls gelöscht werden, nachdem man sie noch ein letztes Mal sichert.</p><p>Es werden wieder dieselben Optionen wie vorher genommen sowie <code class="notranslate">--delete</code> für das Löschen und <code class="notranslate">-b</code> für die Backups gelöschter und veränderter Dateien. Diese Backups finden sich später in dem mit <code class="notranslate">--backup-dir</code> angegebenen Verzeichnis. Der Befehl sieht dann so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync --delete -avzbe ssh benutzer@example.com:/var/www /home/benutzer/webserver --backup-dir=~/old </pre></div></div><p>
Sollen dem SSH-Befehl weitere Optionen angehängt werden, z.B. <code class="notranslate">-i</code>, um einen abweichenden Private-Key bei der Anmeldung zu übergeben, muss der SSH-Befehl in einfache Anführungszeichen gesetzt werden, etwa so:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync --delete -avzbe 'ssh -i /pfad/zur/id_rsa' benutzer@example.com:/var/www /home/benutzer/webserver --backup-dir=~/old </pre></div></div><p>
Der Pfad zu dem Private-Key File muss dabei absolut sein. Dann den ganzen Befehl mit <a class="internal" href="./cron.html">Cron</a> zeitgesteuert automatisieren und die Angst vor einer defekten Festplatte oder versehentlich gelöschten Daten ist vorbei.</p><div class="section_3"><h4 id="Gesamtes-System-mit-root-Rechten">Gesamtes System mit root-Rechten<a class="headerlink" href="#Gesamtes-System-mit-root-Rechten">¶</a></h4><p>
Um ein komplettes System zu sichern, sind meist <a class="internal" href="./sudo.html">root</a>-Rechte nötig. Es ist jedoch aus Sicherheitsgründen davon abzuraten, dem Benutzer <strong>root</strong> einen direkten SSH-Zugang zu gewähren. Stattdessen legt man einen <a class="internal" href="./benutzer_und_gruppen.html#Benutzer-hinzufuegen">neuen Benutzer</a> wie <strong>rsyncbenutzer</strong> an, welcher aus Sicherheitsgründen ausschließlich für <code class="notranslate">rsync</code> verwendet wird. Auch für diesen Benutzer ist die <a class="internal" href="./ssh.html#Authentifizierung-ueber-Public-Keys">SSH-Authentifizierung</a> in seiner noch zu erzeugenden Datei <strong>~/.ssh/authorized_keys</strong> anzuhängen.</p><p>Anschließend erlaubt man diesem durch die <a class="internal" href="./sudo/konfiguration.html">sudo-Konfiguration</a>, mit root-Rechten ausschließlich das Programm <code class="notranslate">rsync</code> aufrufen zu dürfen. Man kann dabei auch die Passwortabfrage unterdrücken, da bereits SSH für die Authentifizierung sorgt. Es wird dazu folgendes am Ende der Datei <strong>/etc/sudoers</strong> mittels <code class="notranslate">visudo</code> eingefügt, wie im Artikel zur Konfiguration beschrieben:
</p><pre class="notranslate">rsyncbenutzer ALL = NOPASSWD: /usr/bin/rsync </pre><p>Anschließend ist zu beachten, dass man nicht <code class="notranslate">rsync</code> mit <code class="notranslate">sudo</code> aufruft, sondern wie in folgendem Beispiel dessen Pfad auf <code class="notranslate">sudo rsync</code> setzt, da <code class="notranslate">sudo</code> auf dem SSH-Server und nicht dem SSH-Client aufgerufen werden muss:
</p><div class="bash"><div class="contents"><pre class="notranslate">rsync --rsync-path="sudo rsync" --delete -avzbe ssh rsyncbenutzer@example.com:/ /home/benutzer/serverbackup --backup-dir=~/old </pre></div></div></div><div class="section_3"><h4 id="Abgleich-von-Dateien-zwischen-Rechnern-mit-unterschiedlichen-Zeichensaetzen">Abgleich von Dateien zwischen Rechnern mit unterschiedlichen Zeichensätzen<a class="headerlink" href="#Abgleich-von-Dateien-zwischen-Rechnern-mit-unterschiedlichen-Zeichensaetzen">¶</a></h4><p>
Werden Daten zwischen Systemen mit verschiedenen Zeichensätzen übertragen, werden Dateien mit Sonderzeichen im Dateinamen im Zielverzeichnis möglicherweise falsch benannt. Abhilfe schafft hier (seit rsync 3.0.0) der Parameter <code class="notranslate">--iconv</code>, mit dem die Sonderzeichen zwischen den unterschiedlichen Zeichensätzen konvertiert werden können. Der Parameter erwartet als Werte die Codepages des lokalen und des Remote-Systems. Sollen beispielsweise Dateien mit Sonderzeichen im Dateinamen von einem System mit Codepage 1252 auf den lokalen Rechner (UTF-8) übertragen werden, lautet der Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync --iconv=UTF-8,CP1252 -avze ssh benutzer@example.com:/var/www /home/benutzer/webserver </pre></div></div><p>Hierbei werden die Dateinamen aus <strong>/var/www</strong> vom Rechner <code class="notranslate">rechner.de</code> beim Übertragen auf den lokalen Rechner in das Verzeichnis <strong>/home/benutzer/webserver</strong> von Codepage 1252 nach UTF-8 umgewandelt.</p></div></div><div class="section_2"><h3 id="Sicherung-innerhalb-des-Systems">Sicherung innerhalb des Systems<a class="headerlink" href="#Sicherung-innerhalb-des-Systems">¶</a></h3><p>
Man kann neben dem Transfer über das Netzwerk rsync natürlich auch nutzen, um ein Backup auf eine andere interne oder externe (dies ist zu bevorzugen) Festplatte zu tätigen. Möchte man zum Beispiel alle Benutzerverzeichnisse sichern, so kann man dies mit</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync -av --progress --delete /home /media/Backup/ </pre></div></div><p>
bewerkstelligen.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Obiger Befehl überprüft nur, ob die Dateigröße und der Zeitstempel identisch sind. Bei beschädigten Dateien, die z.B. durch einen Hardwarefehler verursacht wurden, kann es aber sein, dass die Dateigröße und der Zeitstempel noch identisch sind, aber nicht der Inhalt der Datei. Um auch solche Dateien zu erkennen, sollte man - wenn man mit beschädigten Dateien rechnet - die Option <code class="notranslate">-c</code> bzw. <code class="notranslate">--checksum</code> oder die Option <code class="notranslate">-I</code> bzw. <code class="notranslate">--ignore-times</code> verwenden. Beide Optionen benötigen allerdings wesentlich mehr Zeit, weswegen man dies nur im Notfall einsetzen sollte.
</p></div></div><p>Beispiel mit Überprüfung der Prüfsummen:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync -avc --progress --delete /home /media/Backup/ </pre></div></div><p>Beispiel mit der Option <code class="notranslate">--ignore-times</code>:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync -avI --progress --delete /home /media/Backup/ </pre></div></div><p>Bei der Option <code class="notranslate">-c</code> werden nur diese Dateien kopiert, die sich auch wirklich verändert haben. Bei der Option <code class="notranslate">-I</code> werden grundsätzlich alle Dateien noch einmal kopiert. Dies kann sinnvoll sein, wenn man z.B. bei einem Datenträger, der auf magnetischer Aufzeichnung basiert, auch die Magnetinformationen der Bits auffrischen möchte. Bei Flashspeicher ist dagegen von der Option <code class="notranslate">-I</code> abzuraten, da sie unnötig die Speicherzellen mit zusätzlichen Schreibzyklen belastet.</p></div><div class="section_2"><h3 id="Verzeichnisse-von-der-Sicherung-ausschliessen">Verzeichnisse von der Sicherung ausschließen<a class="headerlink" href="#Verzeichnisse-von-der-Sicherung-ausschliessen">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Pfadangaben in diesem Kapitel gehen davon aus, dass die Option <code class="notranslate">--relative</code> (<code class="notranslate">-R</code>) <span class="underline">nicht</span> verwendet wird. Ansonsten sind die Pfadangaben und die Anwendung auf einzelne Pfade entsprechend anzupassen!
</p></div></div><p>Mit dem Parameter <code class="notranslate">--exclude</code> können Verzeichnisse von der Bearbeitung ausgeschlossen werden. Dabei sind einige Dinge zu beachten. Zunächst bedeutet es einen Unterschied, ob die Angabe der Quellen mit einem <code class="notranslate">/</code> am Ende erfolgt, oder nicht. Außerdem ist zu beachten, dass bei absoluten Pfaden immer die Quelle als Bezugspunkt interpretiert wird. Wenn also Daten vom Verzeichnis <strong>/home/user/daten/</strong> nach <strong>/home/user/backup/</strong> gesichert werden sollen und dabei das Verzeichnis <strong>/home/user/daten/temp/</strong> nicht berücksichtigt werden soll, muss der Befehl so aussehen:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] --exclude=/temp/ /home/user/daten/ /home/user/backup/ </pre></div></div><p>
Das per exclude bezeichnete Verzeichnis <strong>/temp/</strong> ist kein absoluter Pfad, sondern wird relativ zur sogenannten "Wurzel des Transfers" interpretiert. Da die Quellenangabe mit einem <code class="notranslate">/</code> erfolgt in diesem Beispiel also <strong>/home/user/daten/</strong> .</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
Die Wurzel des Transfers findet man, indem man von der Quelle alles <strong>nach</strong> dem letzten <code class="notranslate">/</code> entfernt.</p><p>Beispiele:</p><ul><li><p>Quelle: <code class="notranslate">/home/user/daten/</code> Wurzel: <code class="notranslate">/home/user/daten/</code></p></li><li><p>Quelle: <code class="notranslate">/home/user/daten</code> Wurzel: <code class="notranslate">/home/user/</code></p></li><li><p>Quelle: <code class="notranslate">/</code> Wurzel: <code class="notranslate">/</code></p></li><li><p>Quelle: <code class="notranslate">/home</code> Wurzel: <code class="notranslate">/</code></p></li><li><p>Quelle: <code class="notranslate">/home/</code> Wurzel: <code class="notranslate">/home/</code></p></li></ul><p>
</p></div></div><p>Soll dagegen <strong>/home/user/daten</strong> nach <strong>/home/user/backup/daten</strong> gesichert werden, und <strong>/home/user/daten/temp/</strong> nicht berücksichtigt werden, ist die Syntax wie folgt:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] --exclude=/daten/temp/ /home/user/daten /home/user/backup/ </pre></div></div><p>
Sollen alle Ordner, die <strong>temp</strong> heißen, ausgeschlossen werden, müsste der Befehl wie folgt lauten:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] --exclude=temp/ /home/user/daten/ /home/user/backup/ </pre></div></div><p>Dies funktioniert auch, wenn kein <code class="notranslate">/</code> am Ende der Quelle angegeben wurde. In dem Fall ist aber zu beachten, dass auch das angelegte Verzeichnis gefiltert werden kann, sodass der folgende Befehl keine Übertragung bewirkt:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] --exclude=daten/ /home/user/daten /home/user/backup/ </pre></div></div><p>Möchte man außerdem "incremental backups" von <a class="internal" href="./sbackup.html">sbackup</a> von der Sicherung ausnehmen, so müsste der Befehl z.B. so aussehen:</p><div class="bash"><div class="contents"><pre class="notranslate">rsync [OPTIONEN] --exclude=/daten/temp/ --exclude=*.inc /home/user/daten /home/user/backup/ </pre></div></div><p>Mehrere auszuschließende Ordner kann man auch in eine Datei speichern und dann beim Aufruf per <code class="notranslate">--exclude-from=DATEI</code> übergeben. Dazu ein praktisches Beispiel, wie eine exclude-Datei aussehen könnte (Achtung: Die Reihenfolge der Einträge in der Datei ist wichtig und die Wurzel des Transfers findet wie oben beschrieben Anwendung!):</p><pre class="notranslate">- Downloads
- Dropbox
+ .config
+ .gconf
+ .gnome2
+ .local
- .*</pre><p>
Angenommen, man möchte das ganze Homeverzeichnis sichern, jedoch einige Verzeichnisse ausschließen und andere einschließen, dann führt die o.a. Datei zu folgendem Ergebnis:</p><ul><li><p>die Verzeichnisse <strong>~/Downloads</strong>, <strong>~/Dropbox</strong> und alle versteckten Verzeichnisse <strong>~/.*</strong> werden nicht gesichert</p></li><li><p>von den versteckten Verzeichnissen sollen aber dennoch <strong>~/.config</strong>, <strong>~/.gconf</strong>, <strong>~/.gnome2</strong> und <strong>~/.local</strong> gesichert werden.</p></li></ul><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Es ist auch möglich, den Ausschluss über Dateien in dem Oberordner der auszuschließenden Dateien und Ordner zu regeln. Siehe dazu die Option <code class="notranslate">--cvs-exclude</code> in der <a class="internal" href="./manpage.html">Manpage</a>.
</p></div></div></div><div class="section_2"><h3 id="Differentielle-Sicherung-des-Systems">Differentielle Sicherung des Systems<a class="headerlink" href="#Differentielle-Sicherung-des-Systems">¶</a></h3><p>
Bei einem Linux-<a class="internal" href="./dateisystem.html">Dateisystem</a> ist eine schnelle Sicherung des gesamten Systems möglich, bei welcher nur geänderte Ordner und Dateien gesichert werden müssen. Unveränderte Dateien werden dann einfach per <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Hardlink">Hardlink</a> gespeichert, bereits gelöschte Dateien weggelassen. Der Vergleichsordner wird mit der Option <code class="notranslate">--link-dest=</code> angegeben. Das kann die erste, aber auch die letzte Sicherung sein - sowie jede beliebige dazwischen. Bei der letzten ist gewöhnlich am wenigsten zu sichern. Ein vollständiges Systembackup mit allen gewöhnlich nützlichen Optionen gemäß der <a class="internal" href="./man.html">Manpage</a> könnte beispielsweise so aussehen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync --delete --stats -PSvahHAXx --log-file=rsync.log --exclude='/media/*/**' --exclude='/proc/**' --exclude='/sys/**' --exclude='/tmp/**' --link-dest=/media/deinname/medium/backup/rsync-alt /boot / /home /media/deinname/medium/backup/rsync </pre></div></div><p>
</p><ul><li><p>Gesichert werden die Ordner <strong>/boot</strong>, <strong>/</strong> sowie <strong>/home</strong> in den Ordner <strong>rsync</strong>, auch wenn sie auf eigenen Partitionen liegen. </p></li><li><p>Der Vergleichsordner <strong>rsync-alt</strong> muss bereits mit einem Backup befüllt sein, damit durch Differenz weniger Dateien gesichert werden müssen. Bei der Erstsicherung bleibt er einfach leer.</p></li><li><p><code class="notranslate">-H</code> erhält Hardlinks als solche und <code class="notranslate">-A</code> erhält <a class="internal" href="./acl.html">ACL</a> (spezielle Dateirechte). Großes <code class="notranslate">-X</code> sichert erweiterte Attribute mit.</p></li><li><p><code class="notranslate">--exclude=</code> sowie <code class="notranslate">-x</code> schließt einige temporäre Dateien sowie andere <a class="internal" href="./datenträger.html">Datenträger</a> aus. Details zu den genauen Unterschieden von ein- bis dreifachen <code class="notranslate">*</code> befinden sich in der <a class="internal" href="./man.html">Manpage</a>. Vereinfacht ausgedrückt ergreift <code class="notranslate">*</code> nur sichtbare Ordner und Dateien, aber nicht den Ordner selbst, <code class="notranslate">**</code> ergreift auch unsichtbare Inhalte eines Ordners, aber ebenfalls nicht den Ordner selbst. <code class="notranslate">***</code> ergreift ebenfalls einen Ordner einschließlich versteckter Elemente darin, aber dieses Mal auch einschließlich dem Ordner selbst.</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Lokales-Verlinken-ganzer-Verzeichnisstraenge">Lokales Verlinken ganzer Verzeichnisstränge<a class="headerlink" href="#Lokales-Verlinken-ganzer-Verzeichnisstraenge">¶</a></h3><p>
Die einfachste Methode zum Verlinken ganzer Verzeichnisstränge mittels <a class="internal" href="./ln.html#Hardlinks">Hardlinks</a> ist <code class="notranslate">cp -al QUELLE ZIEL</code>. Will man jedoch rsync wegen dessen erweiterter Funktionalität dazu nutzen, kann die bereits im obigen Beispiel <a class="internal" href="./rsync.html#Differentielle-Sicherung-des-Systems">Differentielle Sicherung des Systems</a> gezeigte Option <code class="notranslate">--link-dest</code> verwendet werden:</p><pre class="notranslate">rsync -ax --link-dest=/pfad/zur/QUELLE QUELLE/ ZIEL</pre><p>Mit diesem Befehl legt rsync Hardlinks aller Dateien der Quelle im Ziel an, weil <code class="notranslate">--link-dest</code> statt eines älteren Zielverzeichnisses den Pfad zur Quelle enthält. Alle dortigen, mit ihren Pendants in der Quelle identischen Dateien werden nicht kopiert, sondern im Ziel hart verlinkt. Da <strong>/pfad/zur/QUELLE</strong> und <strong>QUELLE/</strong> auf dasselbe Verzeichnis zeigen und somit zwangsläufig alle dortigen Dateien identisch sind, werden <em>alle</em> Dateien verlinkt statt kopiert.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
</p><ul><li><p>Die so verlinkten Dateien werden <em>nicht</em> in der Ausgabe der Optionen <code class="notranslate">-v</code> und <code class="notranslate">--stats</code> angezeigt. Sie werden dennoch verlinkt. Ggf. sollte man das nachträglich kontrollieren.</p></li><li><p><code class="notranslate">--link-dest</code> muss den gesamten, absoluten Pfad zur Quelle enthalten, sonst meldet rsync, dass das Verzeichnis nicht existiert. </p></li></ul></div></div><p><a class="crosslink anchor" href="#GUI" id="GUI"></a>
</p></div></div><div class="section_1"><h2 id="Grafische-Benutzeroberflaechen">Grafische Benutzeroberflächen<a class="headerlink" href="#Grafische-Benutzeroberflaechen">¶</a></h2><p>
<img alt="./grsync1.png" class="image-right" src="./_/f632c03279eb4e19c60e387e39b2a16434257a7f.png"/>
</p><div class="section_2"><h3 id="Grsync">Grsync<a class="headerlink" href="#Grsync">¶</a></h3><p>
Zum bequemeren Sichern kann man unter GNOME, Xfce und LXDE die grafische Benutzeroberfläche <a class="external" href="http://www.opbyte.it/grsync/" rel="nofollow">Grsync</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> installieren <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>grsync</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install grsync </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install grsync </pre></div></div><p>
</p></div></div><p>Anschließend findet man bei Ubuntu-Varianten mit einem Anwendungsmenü einen Programmstarter unter <em>"Systemwerkzeuge -&gt; Grsync"</em>.</p><p><img alt="./grsync2.png" class="image-right" src="./_/020aea06c1826da2e685d8fb4e89f881930a804b.png"/></p><p>Nach dem Start des Programms erscheinen die <em>"Standard-Optionen"</em>. Dort sollte man weitere Eigenschaften der Dateien und Ordner zur Sicherung aktivieren: <em>"Zugriffsrechte erhalten"</em>, <em>"Besitzer erhalten"</em> sowie <em>"Gruppe erhalten"</em>. Insbesondere wenn andere Benutzer oder Systemdateien mit gesichert werden sollen. Für manche Dateien können <a class="internal" href="./sudo.html#root-bei-grafischen-Programmen">Root-</a>Rechte nötig sein. Diese Optionen sind nur wirksam, wenn auf dem Ziel ein Linux-<a class="internal" href="./dateisystem.html#Warum-braucht-Linux-ein-spezielles-Dateisystem">Dateisystem</a> wie <a class="internal" href="./ext.html#ext4">ext4</a> benutzt wird, ansonsten werden sie ignoriert.</p><p>Unter <em>"Advanced options"</em> finden sich weitere Einstellungen. Teilweise erscheinen Erläuterungen (Tooltips) zu den Optionen, wenn man den Mauszeiger darüber hält. Außerdem lassen sich individuelle Optionen eingeben, die rsync unterstützt. Im Bild zu sehen ist die Eingabe <code class="notranslate">--exclude=.*</code>, die den Effekt hat, dass alle Konfigurationsdateien ausgeschlossen werden. Das mag beispielsweise bei einer Neuinstallation sinnvoll sein.</p></div><div class="section_2"><h3 id="LuckyBackup">LuckyBackup<a class="headerlink" href="#LuckyBackup">¶</a></h3><p>
<a class="internal" href="./luckybackup.html">luckyBackup</a> eignet sich gleichermaßen für Einsteiger und Fortgeschrittene. Mit der auf der Grafikbibliothek Qt basierenden Oberfläche lassen sich die vielfältigen Optionen von rsync bequem per Mausklick zusammenstellen, ohne dass die Kommandozeile bemüht werden muss. Über Profile können Umfang, Ziel und Ausführungszeitpunkt einer Sicherung den eigenen Wünschen angepasst werden.</p></div><div class="section_2"><h3 id="Unison">Unison<a class="headerlink" href="#Unison">¶</a></h3><p>
<a class="internal" href="./unison.html">Unison</a> ist ein komfortables Programm, das ebenfalls das Protokoll von rsync nutzt. Es bietet eine grafische Oberfläche und erlaubt den Abgleich von Verzeichnissen in beide Richtungen.</p></div></div><div class="section_1"><h2 id="rsync-als-Daemon">rsync als Daemon<a class="headerlink" href="#rsync-als-Daemon">¶</a></h2><p>
Rsync kann auch als Dienst (Daemon) betrieben werden, der dann auf Port <code class="notranslate">873</code> auf eingehende Verbindungen lauscht. Das Gespann aus rsync-Client und rsync-Daemon ist effektiver, als den entfernten Server per <a class="internal" href="./samba.html">SAMBA</a> oder <a class="internal" href="./nfs.html">NFS</a> einzubinden und auf diesen Freigaben gemountete Verzeichnisse mit rsync "lokal" zu arbeiten. Um rsync in diesem Modus zu betreiben, wird eine Datei <strong>/etc/rsyncd.conf</strong> benötigt. Beispiel:</p><pre class="notranslate">use chroot = true
hosts allow = 192.168.0.0/24

transfer logging = true
log file = /var/log/rsyncd.log
log format = %h %o %f %l %b

[share]
comment = Public Share
path = /home/share
read only = no
list = yes
uid = nobody
gid = nogroup</pre><p>
Da ein privilegierter Port (&lt; <code class="notranslate">1025</code>) genutzt wird, muss der Aufruf des rsync-Daemons mit Root-Rechten erfolgen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo rsync --config=/etc/rsyncd.conf --daemon --no-detach </pre></div></div><p>
Testen kann man nun die Erreichbarkeit des Dienstes mit:</p><ul><li><p><code class="notranslate">rsync server-ip::</code> oder</p></li><li><p><code class="notranslate">rsync server-ip::share</code></p></li></ul><p>
In der Ausgabe werden damit die rsync-Freigaben des Daemons aufgelistet. Bei Problemen kann man in das Logfile schauen. Dieses wird in der <strong>rsyncd.conf</strong> definiert, z.B. als <strong>/var/log/rsyncd.log</strong>. Wer genaueres über die Anwendung des Daemon wissen will, findet auf <a class="external" href="http://www.jveweb.net/en/archives/2011/01/running-rsync-as-a-daemon.html" rel="nofollow">Juan Valencia's website</a> eine gute Beschreibung. Der Daemon kann zwar so ad hoc verwendet werden, wird aber üblicherweise per <a class="internal" href="./xinetd.html">xinetd</a> in das System eingebunden.
</p><ul><li><p>Zum Einbinden von rsync in xinetd wird die Datei <strong>/etc/default/rsync</strong> benötigt: </p><pre class="notranslate">RSYNC_ENABLE=inetd
RSYNC_NICE='10'
RSYNC_IONICE='-c3'</pre></li><li><p>xinetd für rsync in <strong>/etc/xinetd.d/rsync</strong> konfigurieren: </p><pre class="notranslate">service rsync
{
    disable = no
    socket_type = stream
    wait = no
    user = root
    server = /usr/bin/rsync
    server_args = --daemon
    log_on_failure += USERID
    flags = IPv6
}</pre></li><li><p>xinetd starten: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo service xinetd restart </pre></div></div><p> </p></li></ul><p>
Diese Beispielkonfiguration ist komplett ohne Benutzer-Authentifizierung, d.h. jeder im angegebenen Netzwerk hat Zugriff. Zu beachten ist, dass die Verbindung zu einem rsync-Dameon eine andere Syntax hat. Auszug aus der Manpage, normaler Aufruf:</p><pre class="notranslate">  rsync [OPTION...] [USER@]HOST:SRC... [DEST]</pre><p>und so zu einem rsync-Daemon:
</p><pre class="notranslate">  rsync [OPTION...] [USER@]HOST::SRC... [DEST]
  rsync [OPTION...] rsync://[USER@]HOST[:PORT]/SRC... [DEST]</pre><p>Die beiden "::" machen hier den Unterschied! Besser zu merken ist sicherlich das vorangestellte Netzwerkprotokoll "<code class="notranslate">rsync://</code>".</p><div class="section_2"><h3 id="rsyncd-munged-Wiederherstellen-gesicherter-Symlinks">rsyncd-munged - Wiederherstellen gesicherter Symlinks<a class="headerlink" href="#rsyncd-munged-Wiederherstellen-gesicherter-Symlinks">¶</a></h3><p>
Aus Sicherheitsgründen werden bei <strong>rsyncd</strong> (rsync als Daemon) bei der Sicherung mit <a class="internal" href="./sudo.html">Root-Rechten</a> mit der dann standardmäßig aktivierten Option <code class="notranslate">use  chroot = true</code> vorhandene <a class="internal" href="./symlink.html">Symlinks</a> mit dem vorangestellten Zusatz <strong>/rsyncd-munged/</strong> während der Übertragung unwirksam gemacht, um interne Angreifer nicht auf falsche und gefährliche Ziele verlinken zu lassen. Nach einem einfachen Wiederherstellen einer Datenübertragung mit z.B.</p><div class="bash"><div class="contents"><pre class="notranslate">rsync -auve ssh root@IP:/PFAD_DER_SICHERUNG/ /PFAD_DES_ZIELS </pre></div></div><p>müssen die Links noch angepasst werden. Dazu gibt es z.B. das Script <a class="interwiki interwiki-github" href="https://github.com/cub-uanic/rsync/blob/master/support/munge-symlinks">munge-symlinks</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>, das allen Symlinks den Wert <strong>/rsyncd-munged/</strong> voranstellt oder diese nach der Übertragung der Wiederherstellung sicher wieder entfernen kann, da die Schutzfunktion der rsync-Implementierung nach der Übertragung erfüllt ist und die Ordner-Prefixe wieder entfernt werden sollten, um die Symlinks wieder zu aktivieren.</p><p>Den Hinweis zum Script sowie weitere Informationen zur Thematik befinden sich in der <a class="internal" href="./man.html">Manpage</a> von rsync und rsyncd.conf in den Abschnitten zu den Schlagwörtern "munge" und "chroot".</p><p>Wenn man den eigenen Nutzern am Zielsystem der Dateien vertraut, kann man diesen Sicherheitsmechanismus durch die rsync-Option <code class="notranslate">--no-munge-links</code> oder einen festen Eintrag <code class="notranslate">munge symlinks = no</code> in der Datei <strong>/etc/rsyncd.conf</strong> deaktivieren.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://rsync.samba.org/" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Rsync">Rsync</a></p></li><li><p><a class="external" href="http://ctaas.de/rsync.htm" rel="nofollow">ctaas.de/rsync.htm</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - übersichtliches &amp; leicht anpassbares Skript zur Sicherung mit rsync nach dem Großvater-Vater-Sohn Generationenprinzip.</p></li><li><p><a class="interwiki interwiki-youtube" href="https://www.youtube.com/watch?v=d5fa1cEcgG8">Sicheres Backup, rsync, ssh und LUKS im Team</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Vortrag von Richard Albrecht, CLT 2016</p></li><li><p><a class="external" href="http://www.opbyte.it/grsync/" rel="nofollow">Grsync</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - grafische Oberfläche</p></li><li><p><a class="external" href="http://www.linux-user.de/ausgabe/2006/04/090-rsync/" rel="nofollow">Dateien abgleichen mit rsync</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Artikel LinuxUser, 04/2006</p></li><li><p><a class="internal" href="./skripte/backup_mit_rsync.html">Skripte/Backup mit rsync</a> - fertiges Skript für die Datensicherung </p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./rsync/a/revision/946014.html">Diese Revision</a> wurde am 4. Januar 2018 14:26 von <a href="https://ubuntuusers.de/user/jones79/">jones79</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./rsync.html">rsync</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>