<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>pm-utils › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./pm-utils.html">pm-utils</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/pm-utils">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./pm-utils/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./pm-utils/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./pm-utils/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./pm-utils/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./pm-utils/a/backlinks.html">pm-utils</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./editor.html">Einen Texteditor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./energiesparmodi_mit_acpi.html">Energiesparmodi mit ACPI</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./uswsusp.html">Einsatz von uswsusp</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="./sudo.html">Root-Rechte</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Das-Paket-pm-utils">Das Paket pm-utils
</a><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#pm-utils-Hooks">pm-utils - Hooks
</a></li><li><a class="crosslink" href="#SUSPEND-und-RESUME-mit-pm-utils">SUSPEND- und RESUME mit pm-utils
</a></li></ol></li><li><a class="crosslink" href="#Vorbereitung-Entscheidung-Zieldefinition">Vorbereitung, Entscheidung, Zieldefinition...</a><ol class="arabic"><li><a class="crosslink" href="#Sind-SUSPEND-HIBERNATE-moeglich">Sind SUSPEND/HIBERNATE möglich?
</a></li><li><a class="crosslink" href="#Was-ist-das-Ziel">Was ist das Ziel?
</a></li></ol></li><li><a class="crosslink" href="#Einrichtung">Einrichtung
</a><ol class="arabic"><li><a class="crosslink" href="#STD-auf-SWAP-Partition">STD auf SWAP-Partition
</a></li><li><a class="crosslink" href="#STD-auf-separater-Partition">STD auf separater Partition
</a></li><li><a class="crosslink" href="#Sonderfaelle">Sonderfälle
</a></li></ol></li><li><a class="crosslink" href="#Fehlersuche">Fehlersuche
</a><ol class="arabic"><li><a class="crosslink" href="#Log-Datei-var-log-pm-suspend-log">Log-Datei /var/log/pm-suspend.log
</a></li><li><a class="crosslink" href="#SUSPEND-und-oder-RESUME-funktioniert-nicht">SUSPEND und/oder RESUME funktioniert nic...</a></li><li><a class="crosslink" href="#Module-vor-SUSPEND-entladen-nach-RESUME-wieder-laden">Module vor SUSPEND entladen, nach RESUME...</a></li><li><a class="crosslink" href="#Dienste-vor-SUSPEND-stoppen-nach-RESUME-wieder-starten">Dienste vor SUSPEND stoppen, nach RESUME...</a></li><li><a class="crosslink" href="#ACPI-abgeschaltet">ACPI abgeschaltet
</a></li><li><a class="crosslink" href="#Grafikkartentreiber-und-Desktop-Effekte">Grafikkartentreiber und Desktop-Effekte
</a></li><li><a class="crosslink" href="#SUSPEND-und-RESUME-stufenweise-testen">SUSPEND und RESUME stufenweise testen
</a></li><li><a class="crosslink" href="#STD-wird-ausgefuehrt-kein-RESUME">STD wird ausgeführt, kein RESUME
</a></li><li><a class="crosslink" href="#Nach-RESUME-kein-Ton-Intel-HDA">Nach RESUME kein Ton (Intel HDA)
</a></li><li><a class="crosslink" href="#Nach-RESUME-kein-Netzwerk">Nach RESUME kein Netzwerk
</a></li><li><a class="crosslink" href="#Neustart-bei-Hibernate">Neustart bei Hibernate
</a></li><li><a class="crosslink" href="#Debug-Modus-verwenden">Debug-Modus verwenden
</a></li><li><a class="crosslink" href="#Eigene-Hooks-erstellen">Eigene Hooks erstellen
</a></li><li><a class="crosslink" href="#Bildschirm-nach-5-10-min-wieder-schwarz">Bildschirm nach 5-10 min wieder schwarz
</a></li><li><a class="crosslink" href="#STR-wird-nach-wenigen-Sekunden-unterbrochen">STR wird nach wenigen Sekunden unterbroc...</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><strong>pm-utils</strong> steht für <strong>P</strong>ower<strong>M</strong>anagement<strong>-Utils</strong>. Dieses Paket ist bis Ubuntu 14.10 Standard für den Wechsel in unterschiedliche Energiesparmodi.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ab <a class="internal" href="./15.04.html">Ubuntu 15.04</a> wird <a class="internal" href="./systemd.html">systemd</a> für den Wechsel der Energiesparmodi verwendet. Dadurch sind viele Funktionen von pm-utils nicht mehr nutzbar.
</p></div></div><p>Das Paket <strong>pm-utils</strong> beinhaltet (hauptsächlich) Skripte, die SUSPEND- und RESUME-Vorgänge (siehe auch <a class="internal" href="./energiesparmodi_mit_acpi.html">Energiesparmodi mit ACPI</a>) ausführen. Dabei können die pm-utils-Skripte direkt (in einer Shell) oder indirekt (vom gnome-power-manager unter GNOME, bzw. von kpowersave / powerdevil unter KDE) im Auftrag von HAL aufgerufen werden <sup><a href="#source-4">[4]</a></sup>. Die pm-utils-Skripte greifen automatisch auf <a class="internal" href="./uswsusp.html">uswsusp</a> zurück, sofern das Paket <strong>uswsusp</strong> <sup><a href="#source-5">[5]</a></sup> installiert ist und nicht explizit auf Kernel-Methoden zurückgegriffen werden sollte.</p><p>Die PowerManagement-Funktionen des Pakets pm-utils sollten ohne weiteres Zutun des Benutzers funktionieren. Ist dies nicht der Fall, so liegt es sehr häufig an den fehlerhaften Treibern oder an einer fehlerhaften Konfiguration des Systems. STR (=Suspend-to-RAM) und STD (=Suspend-to-Disc) funktionieren auf einem frisch installierten Ubuntu-System und auf Systemen, in denen nicht die aktuellste Hardware verbaut ist, häufiger als auf Systemen, die die neueste bzw. spezielle Hardware beinhalten oder im Laufe der Zeit Änderungen erfahren haben. Beispiele:</p><ul><li><p>auf derselben Hardware sind mehrere Linux-Installationen (mit mehreren SWAP-Partitionen) vorhanden, wobei nicht alle SWAP-Partitionen in allen Linux-Installationen aktiviert sein müssen</p></li><li><p>die SWAP-Partition(en) wurden vergrößert oder verkleinert</p></li><li><p>Arbeitsspeicher wurde hinzugefügt oder ausgebaut</p></li></ul><p>
Durch solche Veränderungen am System kann es passieren, dass die zunächst ermittelten Werte über die SWAP-Partition, deren Größe usw. nicht mehr korrekt sind. Damit funktioniert STR oder/und STD dann nicht mehr.</p><p>Andererseits funktionieren STR und/oder STD auf anderen Systemen von Anfang an nicht, weil z.B. spezielle Hardware, die Ärger verursacht, verbaut ist.</p><p>Die Gründe und die Fehlerursachen für nicht funktionierende Energiesparmodi sind sehr vielfältig. Dieser Artikel sollte helfen, diese Fehlerursachen zu finden und zu beheben. Dazu muss ein wenig ausgeholt werden. Zuerst werden das Paket pm-utils, dessen Bestandteile (die pm-utils-Hooks) und der grundsätzliche Ablauf von SUSPEND und RESUME mit pm-utils erläutert. Im darauf folgenden Abschnitt ist erklärt, wie man herausfinden kann, welche Energiesparmodi auf dem eigenen System möglich sind. Anschließend wird erklärt, wie man STR und/oder STD einrichtet. Das letzte Kapitel behandelt Fehlersuche, Aktivierung des DEBUG-Modus u.ä.</p><div class="section_1"><h2 id="Das-Paket-pm-utils">Das Paket pm-utils<a class="headerlink" href="#Das-Paket-pm-utils">¶</a></h2><p>
</p><div class="section_2"><h3 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h3><p>
pm-utils ist in der Standardinstallation immer enthalten. Bei einer Minimalinstallation oder anderen Ubuntu-Varianten muss ggf. das folgende Paket installiert werden <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>pm-utils</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install pm-utils </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install pm-utils </pre></div></div><p>
</p></div></div><p>
Die Dokumentation findet man unter <strong>/usr/share/doc/pm-utils</strong>.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Das Paket <strong>pm-utils</strong> sollte nie entfernt werden, da sonst Energiesparfunktionen nicht mehr genutzt werden können!
</p></div></div><p>Mit pm-utils werden u.a. folgende Verzeichnisse und Dateien installiert. Dunkler hinterlegt sind die Namen der Dateien und Verzeichnisse, die vom Benutzer verwendet werden bzw. deren Inhalte von Benutzer verändert werden dürfen. Heller hinterlegt sind die Dateien und Verzeichnisse, die man nur dann braucht, wenn man sich mit Details beschäftigen möchte.
</p><table><tr><td style="background-color: #E2C890"> <strong>Datei/Verzeichnis</strong> </td><td style="background-color: #E2C890"><strong>Beschreibung/Inhalt</strong> </td></tr><tr><td style="background-color: #DDDDDD; width: 30%"> <strong>/etc/pm/config.d/</strong> </td><td> Verzeichnis, in dem Konfigurationsdateien abgelegt werden können, mit denen dann die Standardeinstellungen aus <strong>/usr/lib/pm-utils/</strong> überschrieben werden. </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/etc/pm/power.d/</strong> </td><td> Das Verzeichnis für die eigenen Hooks für Energiesparmodi , in denen kein SUSPEND gemacht wird. </td></tr><tr><td style="background-color: #DDDDDD"> <strong>/etc/pm/sleep.d</strong> </td><td> Das Verzeichnis für die eigenen Hooks für Suspend-Energiesparmodi. </td></tr><tr><td style="background-color: #DDDDDD"> <strong>/usr/bin/pm-is-supported</strong> </td><td> Programm, mit dem geprüft werden kann, welche SUSPEND-Modi erreichbar sind </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/defaults</strong> </td><td> Standard-Einstellungen für pm-utils </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/functions</strong> </td><td> Funktionen, die von pm-utils-Skripten verwendet werden </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/bin/pm-action</strong> </td><td> Das Skript, dass die Arbeit verrichtet </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/power.d/</strong> </td><td> Das Verzeichnis mit den Hooks für Energiesparmodi , in denen kein SUSPEND gemacht wird. Zum Beispiel, anacron stoppen, wenn Notebook nicht am Netz ist, sondern vom Akku mit Spannung versorgt wird. </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/sleep.d/</strong> </td><td> Das Verzeichnis mit den Hooks für Suspend-Energiesparmodi. </td></tr><tr style="background-color: #F9EAAF"><td colspan="2"> <strong> zusätzlich im Paket enthalten</strong> </td></tr><tr><td style="background-color: #DDDDDD"> <strong>/etc/pm/config.d/00sleep_module</strong> </td><td> Datei, in die Benutzer Module eintragen sollten, die entladen und geladen werden sollen</td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/module.d/</strong> </td><td> In diesem Verzeichnis existieren Dateien <strong>kernel</strong>, <strong>tuxonice</strong>, <strong>uswsusp</strong>, mit den Definitionen der Funktionen, die bei der entsprechenden SUSPEND &amp; RESUME-Methode angewendet werden. Die Variable <code class="notranslate">$SLEEP_MODULE</code> definiert, welche der SUSPEND &amp; RESUME-Methoden <code class="notranslate">kernel, tuxonice, uswsusp</code> gilt. Voreinstellung ist <code class="notranslate">kernel</code>. </td></tr><tr><td style="background-color: #EEEEEE"> <strong>/usr/lib/pm-utils/pm-functions</strong> </td><td> <strong>pm-functions</strong> enthält  nur die Funktionalitäten für pm-utils-"Frontends" <code class="notranslate">pm-action</code>, <code class="notranslate">pm-is-supported</code>, <code class="notranslate">pm-powersave</code>. Die Datei <strong>functions</strong> wird auch von pm-utils-Hooks verwendet.</td></tr></table><p>
</p></div><div class="section_2"><h3 id="pm-utils-Hooks">pm-utils - Hooks<a class="headerlink" href="#pm-utils-Hooks">¶</a></h3><p>
"Hooks" sind pm-utils-Skripte, die bei SUSPEND- und RESUME-Vorgängen abgearbeitet werden:
</p><ul><li><p>beim SUSPEND-Vorgang werden die Hooks abhängig von der SUSPEND-Art mit dem Parameter <code class="notranslate">suspend</code> respektive <code class="notranslate">hibernate</code> in der alphabetischen Reihenfolge aufgerufen.</p></li><li><p>beim RESUME-Vorgang werden die Hooks in der umgekehrten Reihenfolge abgearbeitet, wobei sie beim <code class="notranslate">RESUME_from_STR</code> mit dem Parameter <code class="notranslate">resume</code> aufgerufen werden, beim <code class="notranslate">RESUME_from_STD</code> hingegen mit dem Parameter <code class="notranslate">thaw</code>.</p></li></ul><p>Die Parametrierung der Aufrufe ermittelt <code class="notranslate">pm-action</code> automatisch ohne Zutun des Benutzers.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Eigene Hooks werden in den Verzeichnissen <strong>/etc/pm/sleep.d</strong> bzw. <strong>/etc/pm/power.d</strong> gespeichert. Ein Beispiel-Hook ist weiter unten im Kapitel <a class="crosslink" href="#Eigene-Hooks-erstellen">Eigene Hooks erstellen</a> enthalten.</p><p>Mehr Informationen befinden sich in der Datei <strong>/usr/share/doc/pm-utils/HOWTO.hooks</strong>.
</p></div></div></div><div class="section_2"><h3 id="SUSPEND-und-RESUME-mit-pm-utils">SUSPEND- und RESUME mit pm-utils<a class="headerlink" href="#SUSPEND-und-RESUME-mit-pm-utils">¶</a></h3><p>
</p><div class="section_3"><h4 id="SUSPEND-Vorgaenge-mit-pm-utils">SUSPEND-Vorgänge mit pm-utils<a class="headerlink" href="#SUSPEND-Vorgaenge-mit-pm-utils">¶</a></h4><p>
</p><ul><li><p>Beim Auswählen von <em>"Bereitschaft"</em> im GNOME-Abmeldemenü wird das Skript <strong>/usr/sbin/pm-suspend</strong> aufgerufen.</p></li><li><p>Beim Auswählen von <em>"Ruhezustand"</em> im GNOME-Abmeldemenü wird das Skript <strong>/usr/sbin/pm-hibernate</strong> aufgerufen.</p></li><li><p>Künftig wird womöglich eine dritte Schaltfläche vorhanden sein, mit der man in einen Hybrid-Energiesparmodus wechseln können wird, sogenannter SUSPEND-HYBRID-Modus. Dabei würde das Skript <strong>/usr/sbin/pm-suspend-hybrid</strong> aufgerufen werden.</p></li></ul><p>
Diese Skripte können auch manuell ausgeführt werden, wobei alle Befehle/Skripte Root-Rechte<sup><a href="#source-6">[6]</a></sup> benötigen:</p><ul><li><p><strong>/usr/sbin/pm-suspend</strong></p></li><li><p><strong>/usr/sbin/pm-hibernate</strong></p></li><li><p><strong>/usr/sbin/pm-suspend-hybrid</strong></p></li></ul><p>
Dies sind allerdings "nur" symbolische Links auf das Skript <strong>/usr/lib/pm-utils/bin/pm-action</strong>, das die eigentliche Arbeit verrichtet. Das Skript <strong>pm-action</strong> erkennt aus dem Aufruf (über die o.g. symbolischen Links) heraus, ob es von <strong>/usr/sbin/pm-suspend</strong> oder von <strong>/usr/sbin/pm-hibernate</strong> aufgerufen wurde. Daraufhin arbeitet das Skript die Hooks ab, indem sie in der entsprechenden Reihenfolge mit dem Parameter <code class="notranslate">suspend</code> bzw. <code class="notranslate">hibernate</code> aufgerufen werden. Anschließend wird der Rechner in den Schlaf geschickt.</p><p>Bei STD wird das Image auf die SUSPEND-Partition geschrieben:
</p><ul><li><p>STD über Userspace: Wenn uswsusp installiert ist UND in keinem der aufgerufenen pm-utils-Skripte <code class="notranslate">HIBERNATE_METHOD="kernel"</code> gesetzt ist, dann gilt <code class="notranslate">HIBERNATE_METHOD="autodetect"</code>. Das Skript pm-suspend findet <strong>/usr/sbin/s2disk</strong> bzw. <strong>/sbin/s2disk</strong> und setzt <code class="notranslate">HIBERNATE_METHOD="userspace"</code>. Dabei wird die uswsusp-Konfiguration (standardmäßig) aus der Datei <strong>/etc/uswsusp.conf</strong> gelesen.</p></li><li><p>STD über Kernelspace: Wenn uswsusp <span class="underline">nicht</span> installiert ist ODER in mindestens einem der augerufenen pm-utils-Skripte <code class="notranslate">HIBERNATE_METHOD="kernel"</code> gesetzt ist, dann wird auf Kernelspace zurückgegriffen, indem folgende Befehle (automatisch) abgesetzt werden:</p></li></ul><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">echo -n "platform" &gt; /sys/power/disk 
echo -n "disk" &gt; /sys/power/state  </pre></div></div></div><div class="section_3"><h4 id="RESUME-Vorgang-mit-pm-utils">RESUME-Vorgang mit pm-utils<a class="headerlink" href="#RESUME-Vorgang-mit-pm-utils">¶</a></h4><p>
RESUME aus STR (S3) ist ein relativ einfacher Vorgang, in dem, vereinfacht gesagt, im Wesentlichen die Hardware-Komponenten mit Spannung versorgt werden, und der Rechner in den Arbeitszustand versetzt wird.</p><p>Nachdem ein "Wake-up-Event" erkannt wurde, prüft das BIOS, ob RESUME_from_STR oder ein normaler Boot-Prozess gestartet werden soll. Wenn RESUME_from_STR erkannt wird, startet das BIOS den "Kernel-Wake-up-code". Die Hooks werden dabei, wie oben erwähnt, in der umgekehrten Reihenfolge abgearbeitet. Die entladenen Module werden ggf. wieder geladen, die angehaltenen Dienste ggf. wieder gestartet. Bei Notebooks wird noch die Hintergrundbeleuchtung eingeschaltet etc.</p><p>RESUME aus STD (S4) ist ein etwas komplexerer Vorgang. Der Rechner bootet. Da das BIOS keinen Resume_from_STR erkannt hat, startet GRUB zuerst "ganz normal". Der Kernel liest die Boot-Parameter aus <strong>/boot/grub/menu.lst</strong>. Die initrd wird geladen, und an dieser Stelle kann (muss) der Kernel erkennen, dass der Rechner aus STD (S4) erwacht. Aus den Kernel-Parametern und/oder der initrd erfährt der Kernel, auf welcher Partition ein SUSPEND-Image vorhanden sein könnte. Wird nun kein SUSPEND-Image gefunden, so startet das System "normal weiter". Wird aber ein SUSPEND-Image gefunden, so wird dieses Image geladen und der RESUME_from_STD-Vorgang wird eingeleitet. Dabei wird der Inhalt des Images in den Arbeitsspeicher (zurück)geschrieben und die Hooks in der umgekehrten Reihenfolge abgearbeitet. Die entladenen Module werden wieder geladen, die angehaltenen Dienste wieder gestartet. Bei Notebooks wird noch die Hintergrundbeleuchtung eingeschaltet etc.</p></div></div></div><div class="section_1"><h2 id="Vorbereitung-Entscheidung-Zieldefinition">Vorbereitung, Entscheidung, Zieldefinition<a class="headerlink" href="#Vorbereitung-Entscheidung-Zieldefinition">¶</a></h2><p>
Zuerst muss man herausfinden, welche Energiesparmodi erreicht werden können. Will man zum Beispiel STD erreichen, das System STD aber im aktuellen Zustand nicht unterstützt, so muss man zuerst das System in die Lage versetzen, STD erreichen zu können. Erst dann ist es sinnvoll, die Einrichtung von STD zu starten.</p><div class="section_2"><h3 id="Sind-SUSPEND-HIBERNATE-moeglich">Sind SUSPEND/HIBERNATE möglich?<a class="headerlink" href="#Sind-SUSPEND-HIBERNATE-moeglich">¶</a></h3><p>
Für diese Prüfung verwendet man das Skript <strong>pm-is-supported</strong> aus dem Paket pm-utils, dass i.d.R. vorinstalliert ist.</p><ul><li><p>In einer Konsole diesen Einzeiler eingeben:</p><div class="bash"><div class="contents"><pre class="notranslate">echo; for i in --suspend --hibernate --suspend-hybrid; do pm-is-supported $i &amp;&amp; echo "$(echo $i | tr [:lower:] [:upper:] | tr -d -) is supported"; done; echo </pre></div></div></li></ul><p>
</p><ul><li><p>Alternativ: dieses Skript speichern, ausführbar machen und ausführen (läuft auch als nicht privilegierter Benutzer):</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash </span>

<span class="c1"># check if we can test acpi power states with pm-is-supported </span>
<span class="k">if</span> ! which pm-is-supported <span class="m">1</span>&gt;/dev/null 
<span class="k">then</span> 
   <span class="nb">echo</span> 
   <span class="nb">echo</span> <span class="s2">"pm-is-supported not found"</span> 
   <span class="nb">echo</span> <span class="s2">"Please install the package pm-utils if not installed"</span> 
   <span class="nb">echo</span> 
   <span class="nb">echo</span> <span class="s2">"Otherwise check \$PATH"</span> 
   <span class="nb">echo</span> <span class="s2">"pm-is-supported should be in /usr/bin/"</span> 
   <span class="nb">echo</span> 
   <span class="nb">exit</span> <span class="m">1</span>  
<span class="k">fi</span> 

<span class="c1"># a new line </span>
<span class="nb">echo</span> 

<span class="c1"># check POWER MANAGEMENT MODES </span>
<span class="c1"># for MODE in suspend hibernate suspend-hybrid </span>
<span class="c1"># do </span>
<span class="c1">#    pm-is-supported --$MODE &amp;&amp; echo "Kernel supports $(echo $MODE | tr [:lower:] [:upper:] ) " </span>
<span class="c1"># done </span>

pm-is-supported --suspend         <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Kernel supports SUSPEND (SUSPEND to RAM)"</span> 
pm-is-supported --hibernate       <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Kernel supports HIBERNATE (SUSPEND to DISK)"</span> 
pm-is-supported --suspend-hybrid  <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"Kernel supports HYBRID-SUSPEND (to DISK &amp; to RAM)"</span> 
<span class="c1"># a new line </span>
<span class="nb">echo</span> 

<span class="nb">exit</span> <span class="m">0</span> 
</pre></div>
</td></tr></table></div></li></ul><p>
Die Ausgabe nennt die möglichen Energiesparmodi, die das System im aktuellen Zustand erreichen kann.</p></div><div class="section_2"><h3 id="Was-ist-das-Ziel">Was ist das Ziel?<a class="headerlink" href="#Was-ist-das-Ziel">¶</a></h3><p>
Nachdem festgestellt wurde, ob und welche Energiesparmodi erreicht werden können, muss man die Entscheidung treffen, ob diese Energiesparmodi über Kernelspace oder Userspace (zum Beispiel mit Hilfe von <code class="notranslate">uswsusp</code>) erreicht werden sollen.</p><div class="section_3"><h4 id="Suspend-To-RAM">Suspend_To_RAM<a class="headerlink" href="#Suspend-To-RAM">¶</a></h4><p>
STR kann mit Hilfe von <code class="notranslate">pm-suspend</code> aus den pm-utils über den Kernelspace erreicht werden. Für die Alternative mit uswsusp im Userspace wird das dazu gehörige Programm <code class="notranslate">s2ram</code> genutzt.</p></div><div class="section_3"><h4 id="Suspend-To-Disk">Suspend_To_Disk<a class="headerlink" href="#Suspend-To-Disk">¶</a></h4><p>
Will man STD einrichten, so muss man sich u.U. zuerst entscheiden, wohin das SUSPEND-Image (der Inhalt des Arbeitsspeichers) vor dem Einschlafen des Rechners geschrieben werden soll. Wenn vorhanden verwendet Ubuntu dafür standardmäßig die SWAP-Partition.
Wenn ein Teil des Arbeitsspeichers im Betrieb schon dorthin ausgelagert ist, muss der erhalten bleiben, darf also nicht einfach durch das STD-Image überschrieben werden. Für STD muss die SWAP-Partition also immer groß genug sein, um den gesamten genutzten virtuellen Speicherbereich aufnehmen zu können.</p><p>Hat man keine SWAP-Partition im System (z.B. weil man großen Arbeitsspeicher hat) und möchte man trotzdem STD nutzen, so kann eine separate SUSPEND-Partition erstellt werden. Z.Zt. ist keine Lösung bekannt, wie man das SUSPEND-Image alternativ wie z.B. bei Windows auch <a class="internal" href="./swap.html#Swap-als-Datei">in eine Datei schreiben</a> kann.</p><p>Die Angabe über die Partition, auf die das SUSPEND-Image geschrieben wird, findet man an mehreren Stellen:</p><ul><li><p>In der Datei <strong>/etc/initramfs-tools/conf.d/resume</strong></p><ul><li><p>Dabei kann sowohl der Partitionsname verwendet werden (<code class="notranslate">RESUME=/dev/sda2</code>), als auch der <a class="internal" href="./uuid.html">UUID</a>-Identifier der Partition (z.B: <code class="notranslate">RESUME=UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</code>). Der UUID-Identifier ist eindeutig fuer jedes Gerät. Laufwerksbuchstaben dagegen koennen leicht wechseln, beispielsweise bei Verwendung von Wechselplatten und USB-Sticks, aber auch bei Umhängen der Festplatte an einen anderen Controller oder "Um-Jumpern" einer IDE-Platte von Master zu Slave oder umgekehrt. Deswegen wird die Verwendung des UUID-Identifiers empfohlen, da weniger fehleranfällig.</p></li><li><p>Jedes Mal, wenn initrd neu erzeugt bzw. aktualisiert wird (zum Beispiel bei der Installation eines neuen Kernels), wird diese Datei gelesen und die Angabe in initrd geschrieben.</p></li><li><p>Diese Datei ist oft die Fehlerursache, weil diese Datei i.d.R. <span class="underline">nicht</span> vom Benutzer aktualisiert wird, wenn die SWAP-Partition aufgrund eines Platten-Umbaus, -Einbaus oder -Ausbaus, oder im Rahmen einer Um-Partitionierung eine neue Bezeichnung erhält! </p></li></ul></li></ul><p>
</p><ul><li><p>In der Datei <strong>/etc/uswsusp.conf</strong></p><ul><li><p>Diese Datei wird bei der Installation des Pakets <strong>uswsusp</strong> erstellt und mit Benutzer-Angaben befüllt, wenn die Konfiguration des Pakets uswsusp <span class="underline">nicht</span> abgebrochen wird. Ansonsten steht irgendein Wert darin! Man kann diese Datei manuell anpassen oder "halb-automatsich" durch den Aufruf </p><div class="bash"><div class="contents"><pre class="notranslate">sudo dpkg-reconfigure uswsusp </pre></div></div><p> mit neuem Inhalt befüllen. Empfohlen wird hierzu die Lektüre der <a class="internal" href="./man.html">Manpage</a> zu uswsusp oder des Wiki-Artikels <a class="internal" href="./uswsusp.html">uswsusp</a> <sup><a href="#source-5">[5]</a></sup>.</p></li></ul></li></ul><p>
</p><ul><li><p>Kernel-Bootparameter in der GRUB-Konfiguration</p><ul><li><p>Häufig funktioniert das Resume nur, wenn auch in der GRUB-Konfigurationsdatei eingetragen ist, wo das Resume-Speicherabbild gespeichert ist. Diese Eintragung fehlt oft, so dass nach einem Hibernate der Rechner einen ganz normalen Neustart durchfuehrt. Auch wenn bei dieser Eintragung der Laufwerksbuchstabe/Partitionsnummer, beispielsweise <code class="notranslate">resume=/dev/sda2</code>, angegeben werden kann, wird empfohlen, die eindeutige Partitionskennung in der Form <code class="notranslate">resume=UUID=xxxxxxxxxxxxxx</code> zu verwenden (s.o.). In <a class="internal" href="./grub.html#GRUB-konfigurieren">GRUB Legacy</a> wird dazu in <strong>/boot/grub/menu.lst</strong> <code class="notranslate">#defoptions</code> ergänzt. Für <a class="internal" href="./grub_2/konfiguration.html">GRUB 2</a> ergänzt man stattdessen die Variable GRUB_CMDLINE_LINUX_DEFAULT in <strong>/etc/default/grub</strong>. Zum Schluss lässt man die GRUB-Konfiguration mit diesen Änderungen aktualisieren: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-grub </pre></div></div></li></ul></li></ul><p>
Die o.g. Dateien sind nun kontrolliert und man weiß, wo man bei der Einrichtung hinlangen muss.</p></div></div></div><div class="section_1"><h2 id="Einrichtung">Einrichtung<a class="headerlink" href="#Einrichtung">¶</a></h2><p>
Nachdem oben festgestellt wurde, dass</p><ul><li><p>der gewünschte Energiesparmodus (STR und/oder STD) erreicht werden kann und</p></li><li><p>ob Kernelspace oder Userspace genutzt werden soll</p></li></ul><p>
kann man nun mit der Einrichtung anfangen.</p><div class="section_2"><h3 id="STD-auf-SWAP-Partition">STD auf SWAP-Partition<a class="headerlink" href="#STD-auf-SWAP-Partition">¶</a></h3><p>
Hat man nur eine SWAP-Partition und keine Fehler im System (Standard), d.h. die SWAP-Partition ist korrekt definiert und aktiv, dann sollte man so verfahren:</p><ol class="arabic"><li><p>Partitionsname der SWAP-Partition z.B. aus der Ausgabe von</p><div class="bash"><div class="contents"><pre class="notranslate">sudo fdisk -l | grep Swap | awk '{print $1}' </pre></div></div><p> ablesen</p></li><li><p>Partitionsname bzw. UUID der SWAP-Partition z.B. aus <strong>/etc/fstab</strong> ablesen: </p><div class="bash"><div class="contents"><pre class="notranslate">grep swap /etc/fstab </pre></div></div></li><li><p>UUID der SWAP-Partition ("/dev/xxxy" von oben) aus der Ausgabe </p><div class="bash"><div class="contents"><pre class="notranslate">ls -l /dev/disk/by-uuid </pre></div></div><p> ablesen.</p></li><li><p>Die abgelesenen Informationen sollten übereinstimmen! Sonst bei <a class="crosslink" href="#Sonderfaelle">Sonderfälle</a> unten weitermachen</p></li><li><p>Überprüfen, ob die gewünschten Angaben schon in den entsprechenden Dateien (korrekt) eingetragen sind (siehe oben). Am wichtigsten ist dabei die Datei <strong>/etc/initramfs-tools/conf.d/resume</strong>. Wenn nicht, dann die Angaben in die entsprechenden Dateien schreiben bzw. korrigieren (und ggf. die GRUB-Konfiguration aktuallisieren).</p></li><li><p>initrd aktualisieren: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-initramfs -u </pre></div></div></li><li><p>System neu starten und STD testen.</p></li><li><p>Wenn Fehler auftreten, dann bei <a class="crosslink" href="#Fehlersuche">Fehlersuche</a> weitermachen.</p></li></ol><p>
Der folgende Einzeiler fasst die Schritte 1. bis 4. zusammen und liefert Partitions-Namen ("/dev/xxxy") und UUID, wenn alles in Ordnung ist (andernfalls manuell überprüfen):</p><div class="bash"><div class="contents"><pre class="notranslate">dev=$(tail -n 1 /proc/swaps | awk '{print $1}'); uuid=$(ls -l /dev/disk/by-uuid/ | grep $(awk -F/ '{print $3}' &lt;&lt;&lt;"$dev") 2&gt; /dev/null | awk -F' ' '{print $9}'); echo "Partition: $dev; UUID: $uuid" </pre></div></div><p>Der gleiche Einzeiler ohne den <code class="notranslate">awk</code>:</p><div class="bash"><div class="contents"><pre class="notranslate">dev=$(tail -n 1 /proc/swaps | cut -d" " -f1 | cut -d/ -f3); uuid=$(ls -l /dev/disk/by-uuid/ | grep $dev | cut -d" " -f9); echo "Partition: /dev/${dev}; UUID: $uuid" </pre></div></div></div><div class="section_2"><h3 id="STD-auf-separater-Partition">STD auf separater Partition<a class="headerlink" href="#STD-auf-separater-Partition">¶</a></h3><p>
Salopp gesagt: In diesem Fall ist man (sehr) fortgeschrittener Anwender, man kennt sich gut aus und man weiß i.d.R, was man hat und was man will. Folgendes ist zu tun (analog zu weiter oben):</p><ol class="arabic"><li><p>Ggf. zuerst eine SUSPEND-Partition erstellen</p></li><li><p>Partitionsname aus der Ausgabe von </p><div class="bash"><div class="contents"><pre class="notranslate">sudo fdisk -l </pre></div></div><p> ablesen</p></li><li><p>Partitionsname bzw. UUID-Identifier der Partition aus <strong>/etc/fstab</strong> ablesen</p></li><li><p>UUID-Identifier aus der Ausgabe von </p><div class="bash"><div class="contents"><pre class="notranslate">ls -l /dev/disk/by-uuid </pre></div></div><p> ablesen (Vergleich mit Ausgabe von <code class="notranslate">sudo fdisk –l</code>)</p></li><li><p>Überprüfen, ob die gewünschten Angaben schon in den entsprechenden Dateien (korrekt) eingetragen sind (siehe oben). Am wichtigsten ist dabei die Datei <strong>/etc/initramfs-tools/conf.d/resume</strong>. Wenn nicht, dann die Angaben in die entsprechenden Dateien schreiben bzw. korrigieren (und ggf. die GRUB-Konfiguration aktuallisieren).</p></li><li><p>initrd aktualisieren: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-initramfs –u </pre></div></div></li><li><p>System neu starten und STD testen.</p></li><li><p>Wenn Fehler auftreten, dann bei <a class="crosslink" href="#Fehlersuche">Fehlersuche</a> weitermachen.</p></li></ol><p>
</p></div><div class="section_2"><h3 id="Sonderfaelle">Sonderfälle<a class="headerlink" href="#Sonderfaelle">¶</a></h3><p>
Auf einem System können <span class="underline">mehrere SWAP-Partitionen</span> existieren, so zum Beispiel wenn mehrere Linux-Installationen mit jeweils separater SWAP-Partition vorhanden sind oder auch wenn <a class="internal" href="./zram.html">zRam</a> verwendet wird. Nicht jede SWAP-Partition muss zur Verwendung aktiviert sein. Das ist zum Beispiel dann der Fall, wenn der Eintrag zu SWAP-Partition(en) in <a class="internal" href="./fstab.html">fstab</a> nicht korrekt ist, oder wenn aus Umbau-Maßnahmen mehrere SWAP-Partitionen vorhanden sind, aber nur eine verwendet wird. Vom aktuellen Ubuntu 16.04 werden im Ggs. dazu auch nicht in der <strong>fstab</strong> eingetragene SWAP-Partitionen verwendet.</p><p>Die UUID-Bezeichner für alle aktiven SWAP-Partitionen, die tatsächlich im Einsatz (aktiv) sind, kann man so herausfinden:</p><div class="bash"><div class="contents"><pre class="notranslate">cat /proc/swaps # zeigt die aktiven SWAP-Partitionen an
ls -l /dev/disk/by-uuid/ # zeigt die Zuordnung Partitionen &lt;=&gt; UUID-Identifier </pre></div></div><p>Man sucht sich nun die "richtige" SWAP-Partition heraus und <a class="crosslink" href="#Suspend-To-Disk">verwendet</a> diese. Dabei ist es höchstwahrscheinlich auch nötig, diese wie oben beschrieben als Kernel-Bootparameter in der GRUB-Konfiguration anzugeben. Außerdem hat man nun womöglich einen ganz anderen Fehler entdeckt, den es zu beheben gilt.</p></div></div><div class="section_1"><h2 id="Fehlersuche">Fehlersuche<a class="headerlink" href="#Fehlersuche">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>In der Datei "/etc/default/grub" steht typischerweise bei dem Wert GRUB_CMDLINE_LINUX_DEFAULT eingetragen "quiet splash". Das unterdrückt Bootmeldungen und zeigt einen graphischen Splashscreen an. Wird dieser Eintrag geändert in "noplymouth", verschwindet der Splashscreen und alle Bootmeldungen werden sichtbar. Das ist gelegentlich hilfreich, um zu sehen, wo es "hakt".
</p></div></div><div class="section_2"><h3 id="Log-Datei-var-log-pm-suspend-log">Log-Datei /var/log/pm-suspend.log<a class="headerlink" href="#Log-Datei-var-log-pm-suspend-log">¶</a></h3><p>
Die Log-Datei für pm-utils ist <strong>/var/log/pm-suspend.log</strong>. Diese Datei wird bei jeder Einleitung eines SUSPEND-Vorgangs geleert und neu beschrieben. In dieser Datei wird sowohl der SUSPEND-, als auch der RESUME-Vorgang protokolliert. Hat man nach einem missglückten SUSPEND-RESUME-Vorgang Veränderungen vorgenommen, so kann man eine Kopie der Log-Datei <strong>/var/log/pm-suspend.log</strong> speichern um sie mit ihrem Nachfolger zu vergleichen.</p><p>Aussagekräftiger wird diese Datei, wenn man den SUSPEND auf der Konsole startet und davor der Variable $PM_DEBUG den Wert <strong>true</strong> zuweist:</p><div class="bash"><div class="contents"><pre class="notranslate">export PM_DEBUG=true </pre></div></div></div><div class="section_2"><h3 id="SUSPEND-und-oder-RESUME-funktioniert-nicht">SUSPEND und/oder RESUME funktioniert nicht<a class="headerlink" href="#SUSPEND-und-oder-RESUME-funktioniert-nicht">¶</a></h3><p>
Das kann viele Ursachen haben. Einige davon sind oben angesprochen. Für die einzelnen Ursachen sind die Maßnahmen in den entsprechenden nachfolgenden Unterkapiteln beschrieben. An dieser Stelle sind noch weitere Fehlerursachen beschrieben, die in manchen Fällen SUSPEND und RESUME verhindern:</p><table><tr><td style="text-align: center; background-color: #E2C890"> <strong>Fehlerursache - Kategorie</strong> </td><td colspan="6" style="text-align: center; background-color: #E2C890"> <strong>Beschreibung von Maßnahmen</strong> </td></tr><tr><td style="background-color: #F9EAAF"> <a class="crosslink" href="#Module-vor-SUSPEND-entladen-nach-RESUME-wieder-laden">Module</a> </td><td> Module, die beim SUSPEND entladen und beim RESUME wieder geladen werden müssen. <br/><strong>Beispiele:</strong> WLAN-Karten, Netzwerk-Karten, Bluetooth-Geräte, USB-Geräte, ... </td></tr><tr><td style="background-color: #F9EAAF"> <a class="crosslink" href="#Dienste-vor-SUSPEND-stoppen-nach-RESUME-wieder-starten">Dienste</a> </td><td> Manche Dienste verhindern das Entladen von Modulen. Daher müssen Dienste beim SUSPEND gestoppt und beim RESUME wieder gestartet werden. <br/><strong>Beispiel:</strong> USV-Dienst verhindert das Entladen von USB-Modulen </td></tr><tr><td style="background-color: #F9EAAF"> <a class="crosslink" href="#Grafikkartentreiber-und-Desktop-Effekte">Grafik</a> </td><td> Bei bestimmten Grafik-Einstellungen kann es vorkommen, dass SUSPEND ebenso nicht möglich ist.<br/><strong>Beispiele:</strong>
<ul><li><p>radeon statt fglrx verwenden</p></li><li><p>Nvidia-Treiber Version 180:</p><ul><li><p>durch andere Version ersetzen</p></li><li><p>In <strong>xorg.conf</strong> eintragen:</p></li></ul></li></ul><pre class="notranslate">Option          "NvAGP"       "1"</pre>
<ul><li><p>die Option <code class="notranslate">"NoDRI"</code> aus <strong>xorg.conf</strong> enfernen </p></li></ul></td></tr><tr><td style="background-color: #F9EAAF"> <a class="crosslink" href="#STD-wird-ausgefuehrt-kein-RESUME">SWAP-Einstellung falsch</a> </td><td> Verschiebt man die SWAP-Partition, ohne den Eintrag in der Konfigurationsdatei für RESUME anzupassen, so kann der Kernel das STD-Image nicht finden. </td></tr><tr><td style="background-color: #F9EAAF"> <a class="crosslink" href="#ACPI-abgeschaltet">ACPI abgeschaltet</a> </td><td> Manche Systeme booten nur dann, wenn ACPI abgeschaltet wird (acpi=off, dann ist die Nutzung von ACPI-Energiesparmodi nicht möglich), oder das BIOS aktualisiert wird. </td></tr><tr><td style="background-color: #F9EAAF"> Hardware-Besonderheiten </td><td> Bei manchen Systeme kann der Linux-Kernel nicht fehlerfrei direkt die Energiesparmodi steuern, durch Verwendung der entsprechenden BIOS-Funktionen (siehe <a class="internal" href="./bootoptionen.html#Energiespar-Bootoptionen">Energiespar-Bootoptionen</a> können diese Modi aber u.U. trotzdem (indirekt) umgeschaltet werden. </td></tr></table><p>
</p></div><div class="section_2"><h3 id="Module-vor-SUSPEND-entladen-nach-RESUME-wieder-laden">Module vor SUSPEND entladen, nach RESUME wieder laden<a class="headerlink" href="#Module-vor-SUSPEND-entladen-nach-RESUME-wieder-laden">¶</a></h3><p>
In der Regel ist es ausreichend, <a class="internal" href="./kernelmodule.html">Kernelmodule</a> für die problematische Hardware automatisch vor SUSPEND entladen und während RESUME neu laden zu lassen. Die Module, die häufiger Ärger bereiten können, sind die Module für:</p><ul><li><p>WLAN-Karten und USB-WLAN-Sticks: <strong>*802*</strong>, <strong>ndiswrapper</strong>, ...</p></li><li><p>LAN-Karten: <strong>forcedeth</strong>, <strong>*8139*</strong>, ...</p></li><li><p>USB- und Firewire-Module: <strong>ehci-hcd</strong>, <strong>uhci-hcd</strong>, <strong>*usb*</strong>, <strong>*1394</strong>, ...</p></li><li><p>Bluetooth- und TV-Karten: <strong>ivtv</strong>, <strong>bttv</strong>, <strong>btusb</strong>, ...</p></li></ul><p>
Mit dem folgenden Einzeiler kann man sich die "üblichen Verdächtigen" anzeigen lassen:</p><div class="bash"><div class="contents"><pre class="notranslate">lsmod | grep -iE '802|ndiswr|forced|8139|hci|usb|1394|hid|..tv' </pre></div></div><p>Diese Liste erhebt allerdings keinen Anspruch auf Vollständigkeit.</p><p>Die benötigte Datei <strong>/etc/pm/config.d/00sleep_module</strong> muss oft zunächst noch erstellt und anschließend ausführbar gemacht werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo touch /etc/pm/config.d/00sleep_module               # Datei erstellen
sudo chmod +x /etc/pm/config.d/00sleep_module            # ausführbar machen </pre></div></div><p>Hat man herausgefunden, dass die Module <strong>ehci-hcd uhci-hcd usbcore forcedeth</strong> SUSPEND (und/oder RESUME verhindern), bearbeitet man die Datei mit einem Texteditor <sup><a href="#source-3">[3]</a></sup> und fügt folgende Zeilen ein:</p><pre class="notranslate"># USB-Kernelmodule und forcedeth (Netzwerkkarte) machen Aerger bei SUSPEND &amp; RESUME mit pm-utils
# daher sollen sie automatisch ent- und geladen werden
SUSPEND_MODULES="$SUSPEND_MODULES ehci-hcd uhci-hcd usbcore forcedeth" </pre><p>Durch die o.g. Zuweisung werden diejenigen Module, die bereits an einer anderen Stelle in der Variable SUSPEND_MODULES hinterlegt wurden, nicht überschrieben. Nachdem diese Datei erstellt wurde, testet man SUSPEND und RESUME. In der Tabelle unten sind die Module aufgelistet, die in der jeweiligen Ubuntu-Version bei einem oder mehreren Benutzern SUSPEND (und RESUME) verhinderten.</p><table><tr><td style="text-align: center; background-color: #E2C890"> <strong>Version</strong> </td><td style="text-align: center; background-color: #E2C890"> <strong>Module</strong> </td><td style="text-align: center; background-color: #E2C890"> <strong>Weiteres</strong> </td></tr><tr><td style="background-color: #F9EAAF"> <strong>Ubuntu 10.10</strong> </td><td> xhci_hcd tpm_tis r8187se </td><td> <strong>xhci_hcd:</strong> Treiber für <a class="external" href="http://www.linux-magazin.de/NEWS/Specs-fuer-XHCI-sind-online" rel="nofollow">eXtensible Host Controller</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> USB 1.0 - 3.0 <br/><strong>tpm_tis:</strong> Treiber für <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Trusted_Platform_Module">TPM-Chip</a>, voraussichtlich ab Kernel 2.6.37 gefixt <br/><strong>r8187se:</strong> Treiber für eine Notebook-WLAN-Karte von Realtek </td></tr><tr><td style="background-color: #F9EAAF"> <strong>Ubuntu 10.04</strong> </td><td> xhci </td><td> <strong>xhci:</strong> Treiber für <a class="external" href="http://www.linux-magazin.de/NEWS/Specs-fuer-XHCI-sind-online" rel="nofollow">eXtensible Host Controller</a> USB 1.0 - 3.0 </td></tr><tr><td style="background-color: #F9EAAF"> <strong>Ubuntu 8.04</strong> </td><td> ehci-hcd uhci-hcd usbcore forcedeth ivtv ohci1394 ieee1394 bttv </td><td> </td></tr></table><p>
Diese Liste kann als "Start-Liste" benutzt werden. Wenn SUSPEND und RESUME klappen, dann kann man ein Modul nach dem anderen aus der o.g. Liste entfernen, und SUSPEND und RESUME wieder testen, bis man den/die Übeltäter gefunden hat. Es schadet natürlich nicht, wenn man zu Testzwecken alle Module (für alle Versionen) in einer eigenen SUSPEND_MODULES-Liste aufführt. Dies erreicht man, indem man die folgende Ausgabe:</p><div class="bash"><div class="contents"><pre class="notranslate">cat /proc/modules | cut -d " " -f1 | xargs </pre></div></div><p>
in die oben genannte Datei kopiert. Oder man lässt diese Liste so wie sie ist, da der Zeitgewinn nur minimal ist, wenn man ein oder zwei Module weniger als erforderlich entladen und neu laden lässt. Selbstverständlich erhebt diese Liste keinen Anspruch auf Vollständigkeit.</p><p>Falls jemand einen oder mehrere weitere Module entdeckt, die entladen und neu geladen werden müssen, damit SUSPEND und RESUME klappen, bitte die Liste für die entsprechende Version vervollständigen! Dabei sollen nur diejenigen Module eingetragen werden, bei denen es sichergestellt ist, dass sie SUSPEND und RESUME tatsächlich verhindern.</p><p>Bei Ubuntu 10.04 auf älteren ASUS-Boards mit PS/2-Anschlüssen war es beispielsweise offenbar erforderlich, im BIOS die Funktion <code class="notranslate">USB Legacy Support</code> abzuschalten. Dies war natürlich nur sinnvoll, falls man eine PS/2-Tastatur benutzt. Weitere Details dazu findet man auf <a class="interwiki interwiki-bug" href="https://launchpad.net/bugs/212660">Launchpad</a> und im <a class="crosslink post" href="https://forum.ubuntuusers.de/post/1699512/">Forum</a> und speziell zu Ubuntu 10.04 <a class="crosslink post" href="https://forum.ubuntuusers.de/post/2570901/">hier</a>.</p><p>Eine gute Anleitung, um solche Module aufzuspüren, ist hier zu finden: 
<a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/DebuggingKernelSuspend#%22resume-trace%22%20debugging%20procedure%20for%20finding%20buggy%20drivers">"resume-trace" debugging procedure for finding buggy drivers</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Mehr Informationen befinden sich in der Datei <strong>/usr/share/doc/pm-utils/HOWTO.modules</strong>.
</p></div></div></div><div class="section_2"><h3 id="Dienste-vor-SUSPEND-stoppen-nach-RESUME-wieder-starten">Dienste vor SUSPEND stoppen, nach RESUME wieder starten<a class="headerlink" href="#Dienste-vor-SUSPEND-stoppen-nach-RESUME-wieder-starten">¶</a></h3><p>
Mit den Diensten, die nach dem RESUME nicht funktionieren, sollte man analog zu den Kernelmodulen verfahren:</p><ul><li><p>Zuerst herausfinden, welcher Dienst gestoppt und wieder gestartet werden muss</p></li><li><p>Einen <a class="crosslink" href="#pm-utils-Hooks">Hook</a> unter Verwendung des <a class="crosslink" href="#Eigene-Hooks-erstellen">Beispiel-Hooks</a> (siehe unten) erstellen</p></li></ul><p>
</p></div><div class="section_2"><h3 id="ACPI-abgeschaltet">ACPI abgeschaltet<a class="headerlink" href="#ACPI-abgeschaltet">¶</a></h3><p>
Aus mehreren Gründen kann es vorkommen, dass entweder alle oder nur bestimmte ACPI-Funktionen abgeschaltet sind. Dies kann entweder im BIOS oder über Kernelparameter erreicht werden. Daher sollten unter <sup><a href="#source-4">[4]</a></sup> die <a class="internal" href="./energiesparmodi_mit_acpi.html#S3-im-BIOS-aktivieren">BIOS-Einstellungen</a> und <a class="internal" href="./energiesparmodi_mit_acpi.html#ACPI-Kernelparameter">ACPI-Kernelparameter</a> kontrolliert werden.</p></div><div class="section_2"><h3 id="Grafikkartentreiber-und-Desktop-Effekte">Grafikkartentreiber und Desktop-Effekte<a class="headerlink" href="#Grafikkartentreiber-und-Desktop-Effekte">¶</a></h3><p>
</p><div class="section_3"><h4 id="Nvidia">Nvidia<a class="headerlink" href="#Nvidia">¶</a></h4><p>
Es wurde mehrmals festgestellt, dass der Nvidia-Treiber in der Version 180 SUSPEND verhindert. In diesem Fall sollte der Treiber durch eine ältere Version ersetzt werden.</p></div><div class="section_3"><h4 id="ATI">ATI<a class="headerlink" href="#ATI">¶</a></h4><p>
Oft wird berichtet, dass SUSPEND funktioniert, wenn <strong>radeon</strong> statt <strong>fglrx</strong> verwendet wird.</p></div><div class="section_3"><h4 id="Desktop-Effekte">Desktop-Effekte<a class="headerlink" href="#Desktop-Effekte">¶</a></h4><p>
Manchmal wird berichtet, dass SUSPEND funktioniert, nachdem Desktop-Effekte abgeschaltet werden.</p></div></div><div class="section_2"><h3 id="SUSPEND-und-RESUME-stufenweise-testen">SUSPEND und RESUME stufenweise testen<a class="headerlink" href="#SUSPEND-und-RESUME-stufenweise-testen">¶</a></h3><p>
Zur Fehlersuche ist es ratsam, stufenweise vorzugehen. Das bedeutet, dass man zuerst den <a class="internal" href="./xserver.html">XServer</a> beendet und SUSPEND von einer Konsole aus startet. Wenn das funktioniert, dann startet man SUSPEND aus X heraus.</p><p>SUSPEND und RESUME ohne X (aus RUNLEVEL 1) testen: 
</p><ol class="arabic"><li><p>Von Desktop abmelden</p></li><li><p>Mit 
<span class="key">Strg</span>  + 
<span class="key">Alt</span>  + 
<span class="key">F1</span>  zu einer virtuellen Konsole wechseln </p></li><li><p>Anmelden</p></li><li><div class="bash"><div class="contents"><pre class="notranslate">sudo init 1 </pre></div></div></li><li><p>SUSPEND oder HIBERNATE starten: </p><div class="bash"><div class="contents"><pre class="notranslate">/usr/sbin/pm-suspend </pre></div></div><p> oder </p><div class="bash"><div class="contents"><pre class="notranslate">/usr/sbin/pm-hibernate </pre></div></div><p> </p></li><li><p>Anschließend RESUME einleiten, indem der Rechner wieder eingeschaltet wird.</p></li></ol><p>
Man kann das auch testen, indem man nicht (mit <code class="notranslate">sudo init 1</code>) in den RUNLEVEL 1 wechselt, sondern direkt nach der Anmeldung in der Konsole mit <code class="notranslate">sudo /usr/sbin/pm-suspend</code> bzw. <code class="notranslate">sudo /usr/sbin/pm-hibernate</code> den SUSPEND-Vorgang startet.</p></div><div class="section_2"><h3 id="STD-wird-ausgefuehrt-kein-RESUME">STD wird ausgeführt, kein RESUME<a class="headerlink" href="#STD-wird-ausgefuehrt-kein-RESUME">¶</a></h3><p>
Der Rechner wird in den Schlaf versetzt. Nach dem Wiedereinschalten startet das System "normal". Meistens liegt es daran, dass die Angabe zur "SUSPEND &amp; RESUME-Partition" an einer oder mehreren der folgenden Stellen falsch ist:</p><ul><li><p><strong>/etc/initramfs-tools/conf.d/resume</strong> (und damit auch in initrd)</p></li><li><p><strong>/etc/uswsusp.conf</strong></p></li><li><p><strong>/boot/grub/menu.lst</strong></p></li></ul><p>
Eventuell sind die Angaben sogar korrekt, nur das abschließende <code class="notranslate">sudo update-initramfs -u</code> wurde vergessen. Weiter oben unter <a class="crosslink" href="#Suspend-To-Disk">Suspend_To_Disk</a> ist beschrieben, wie man feststellen kann, welche Partition die richtige ist, und wie man die Angaben dazu aktualisiert.</p></div><div class="section_2"><h3 id="Nach-RESUME-kein-Ton-Intel-HDA">Nach RESUME kein Ton (Intel HDA)<a class="headerlink" href="#Nach-RESUME-kein-Ton-Intel-HDA">¶</a></h3><p>
Intel HDA ist eine Definition von Intel für integrierte Soundlösungen. Auf unterschiedlichen Mainboards kommen unterschiedliche Chipsätze zum Einsatz. Das bedeutet, das der "Intel HDA"-Treiber eine ganze Gruppe von Soundchips unterstützt. Derzeit funktioniert diese Gruppe von Soundchips nicht richtig mit dem Kernel 2.6.24-15/16. Die Bugs sind in Launchpad immer noch offen, und viele Anwender sind davon betroffen. Meistens funktionieren die Chips selber ohne Probleme mit diesem Kernel, aber nur bis zum SUSPEND. Sie werden beim RESUME nicht richtig aufgeweckt, aber vom System als wieder aktiviert erkannt. Die <code class="notranslate">lspci</code>-Ausgabe zeigt die Soundchips als aktiv an, und die Systemprotokolle zeigen nichts ungewöhnliches.</p><p>Lösung für dieses Problem: Mit dem folgenden Befehl den Chipsatz herausfinden.</p><div class="bash"><div class="contents"><pre class="notranslate">aplay -l </pre></div></div><p>
Das Ergebnis könnte so aussehen:</p><pre class="notranslate">aplay -l 
**** Liste von PLAYBACK Geräten ****
Karte 0: Intel [HDA Intel], Gerät 0: ALC268 Analog [ALC268 Analog]
  Untergeordnete Geräte: 0/1
  Untergeordnetes Gerät '0: subdevice #0</pre><p>
Im Beispiel oben ist <code class="notranslate">ALC268</code> der gesuchte Begriff. Mit:</p><div class="bash"><div class="contents"><pre class="notranslate">zless /usr/share/doc/alsa-base/driver/ALSA-Configuration.txt.gz </pre></div></div><p>
nach dem Chipsatz (im Beispiel oben <code class="notranslate">ALC268</code>) suchen. Das Ergebnis könnte so aussehen:</p><pre class="notranslate">ALC268
          3stack        3-stack model
          toshiba       Toshiba A205
          acer          Acer laptops
          dell          Dell OEM laptops (Vostro 1200)
          zepto         Zepto laptops
          test          for testing/debugging purpose, almost all controls can
                        adjusted.  Appearing only when compiled with
                        $CONFIG_SND_DEBUG=y
          auto          auto-config reading BIOS (default)</pre><p>
Auf Acer-Notebooks wäre <code class="notranslate">acer</code> der gesuchte Begriff. In den Dateien <strong>/etc/modprobe.d/snd-hda-intel.modprobe</strong> und <strong>/etc/modprobe.d/alsa-base</strong> muss folgende Zeile eingetragen werden:</p><pre class="notranslate">options snd-hda-intel model=acer</pre><p>
Im Forum wird oft die Anweisung gegeben, in der Datei <strong>/etc/default/acpi-support</strong> noch folgende Änderung vorzunehmen:</p><pre class="notranslate"># Add services to this list to stop them before suspend and restart them in
# the resume process.
STOP_SERVICES="alsa"</pre><p>
Dies dürfte sich allerdings auf SUSPEND &amp; RESUME mit pm-utils nicht auswirken, da pm-utils die Dateien aus dem Paket <strong>acpi-support</strong> nicht verwendet. Möchte man aber sowohl pm-utils als auch acpi-support für SUSPEND &amp; RESUME nutzen, so sollte die Änderung in  <strong>/etc/default/acpi-support</strong> vorgenommen werden.</p><p>Anschließend muss man die Dienste neu starten, ggf. Module entladen und neu laden. Wenn´s nicht klappt, einen Neustart durchführen.</p><p>Weitere Informationen zu diesem Problem können dem Thread <a class="crosslink topic" href="https://forum.ubuntuusers.de/topic/nach-standby-kein-ton-mehr/">Nach Standby kein Ton mehr</a> im Forum entnommen werden.</p></div><div class="section_2"><h3 id="Nach-RESUME-kein-Netzwerk">Nach RESUME kein Netzwerk<a class="headerlink" href="#Nach-RESUME-kein-Netzwerk">¶</a></h3><p>
Als Erstes soll man herausfinden, welche Kernel-Module für die vorhandenen Netzwerk-Schnittstellen zuständig sind. Dies kann man mit dem folgenden Befehl erreichen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo lshw -C network </pre></div></div><p>
Die Ausgabe soll ungefähr so aussehen:</p><pre class="notranslate">  *-network               
       Beschreibung: Wireless interface
       (...)
  *-network               
       Beschreibung: Ethernet interface
       Produkt: VT6102 [Rhine-II]
       Hersteller: VIA Technologies, Inc.
       (...)
       Konfiguration: autonegotiation=on broadcast=yes driver=via-rhine driverversion=1.5.1 duplex=full ip=192.168.0.62 latency=64 link=yes maxlatency=8 mingnt=3 multicast=yes port=MII speed=100Mbit/s
       Ressourcen: irq:23 ioport:4800(Größe=256) memory:d9300400-d93004ff</pre><p>
Das Kernelmodul sieht man in der Zeile "Konfiguration" (in diesem Fall <strong>driver=via-rhine</strong>). Man soll noch herausfinden, wie das entsprechende Modul tatsächlich heißt, in diesem Fall z.B. so:</p><pre class="notranslate">$ lsmod | grep rhine
via_rhine              27653  0 
mii                    13654  1 via_rhine</pre><p>
Man sieht, dass in diesem Fall die Namen von Treiber und Modul sich leicht unterscheiden. Den Modulname trägt man in die oben beschriebene Datei <strong>/etc/pm/config.d/00sleep_module</strong> ein:</p><pre class="notranslate">SUSPEND_MODULES="$SUSPEND_MODULES via_rhine"</pre><p>
Wichtig dabei ist, dass der Network-Manager vor SUSPEND gestoppt und nach RESUME wieder gestartet wird. Dies wird im Skript <strong>/etc/pm/sleep.d/50_network_suspend.sh</strong> implementiert:</p><pre class="notranslate">#!/bin/sh
# /etc/pm/sleep.d/50_network_suspend.sh

case "${1}" in
    hibernate|suspend)
	service network-manager stop ;;
    resume|thaw)
        service network-manager start ;;
esac</pre></div><div class="section_2"><h3 id="Neustart-bei-Hibernate">Neustart bei Hibernate<a class="headerlink" href="#Neustart-bei-Hibernate">¶</a></h3><p>
Manche Geräte starten sofort neu, oder reagieren auf jede Taste, nachdem sie in den Ruhezustand (S4) geschaltet wurden. Dieses Problem kann gelöst werden, indem man die pm-utils anweist, stattdessen ein Shutdown-Signal zu verwenden:</p><ol class="arabic"><li><p>Datei <strong>/usr/lib/pm-utils/defaults</strong> öffnen</p></li><li><p>Die Zeile </p><pre class="notranslate"># HIBERNATE_MODE="platform"</pre><p> einkommentieren.</p></li><li><p>Anstelle von <code class="notranslate">platform</code> hier <code class="notranslate">shutdown</code> eintragen.</p></li><li><p>Datei als "/etc/pm/config.d/defaults" speichern.</p></li></ol><p>
Auch ein <code class="notranslate">reboot</code> ist möglich, falls gewünscht.</p></div><div class="section_2"><h3 id="Debug-Modus-verwenden">Debug-Modus verwenden<a class="headerlink" href="#Debug-Modus-verwenden">¶</a></h3><p>
Den Debug-Modus schaltet man auf diese Weise ein:</p><div class="bash"><div class="contents"><pre class="notranslate">echo 1 | sudo tee /sys/power/pm_trace </pre></div></div><p>
Die gezielte Suche nach den Modulen oder Geräten, die Ärger bei SUSPEND und RESUME verursachen, ist nach diesem Schema durchzuführen:</p><ol class="arabic"><li><p>Ggf. vom Desktop (KDE, GNOME, ...) abmelden</p></li><li><p>mit 
<span class="key">Strg</span>  + 
<span class="key">Alt</span>  + 
<span class="key">F1</span>  in eine virtuelle Konsole wechseln</p></li><li><p>Anmelden</p></li><li><p>Debug-Modus aktivieren: </p><div class="bash"><div class="contents"><pre class="notranslate">echo 1 | sudo tee /sys/power/pm_trace </pre></div></div></li><li><p>SUSPEND oder HIBERNATE starten: </p><div class="bash"><div class="contents"><pre class="notranslate">/usr/sbin/pm-suspend </pre></div></div><p> oder </p><div class="bash"><div class="contents"><pre class="notranslate">/usr/sbin/pm-hibernate </pre></div></div></li><li><p>Das System geht in SUSPEND über.</p></li><li><p>Wenn der Ruhezustand eingekehrt ist, dann RESUME einleiten durch Drücken der Power-Taste.</p></li><li><p>RESUME startet</p></li></ol><p>
Wenn der RESUME-Vorgang durchgelaufen ist, dann den Rechner ausschalten und neu starten (booten). Zwischen dem Erreichen des Ruhezustands und dem aktuellen Zeitpunkt (Neustart) darf nicht mehr Zeit als 2 bis 3 Minuten vergehen! Da in die Hardware-Uhr (real-time clock, RTC) geschrieben wird, werden beim nächsten Start des Systems höchstwahrscheinlich <a class="internal" href="./dateisystemcheck.html">Dateisystemchecks</a> durchgeführt. Nicht verunsichern lassen - einfach abwarten!</p><ol class="arabic"><li><p>Sobald das System gestartet ist, mit 
<span class="key">Strg</span>  + 
<span class="key">Alt</span>  + 
<span class="key">F1</span>  zu einer virtuelle Konsole wechseln</p></li><li><p>Anmelden</p></li><li><div class="bash"><div class="contents"><pre class="notranslate">cd /tmp
dmesg &gt; dmesg.txt
grep "hash matches" dmesg.txt &gt; dmesg_hash_matches.txt </pre></div></div></li><li><p>Die Dateien <strong>/tmp/dmesg.txt</strong> und <strong>/tmp/dmesg_hash_matches.txt</strong> können nun bei der Fehlersuche verwendet und im Forum gepostet werden.</p></li></ol><p>
Ist die Datei <strong>/tmp/dmesg_hash_matches.txt</strong> nicht leer, so hat man entweder direkt den Modulnamen oder aber zumindest einen Hinweis auf das entsprechende Gerät. Der Modulname sollte nun in die Liste der Module eingefügt werden, die vor SUSPEND entladen und während RESUME neu geladen werden sollten. Details dazu <a class="crosslink" href="#Module-vor-SUSPEND-entladen-nach-RESUME-wieder-laden">weiter oben</a>.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Mehr Informationen befinden sich in der Datei <strong>/usr/share/doc/pm-utils/README.debugging</strong>.
</p></div></div><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Man kann auch das Original der Datei <strong>/usr/lib/pm-utils/pm-action</strong> speichern (z.B. als <strong>/usr/lib/pm-utils/pm-action.bak</strong>) und dann Änderungen an dieser Datei vornehmen, z.B. <code class="notranslate">set -x</code> in der zweiten Zeile im Skript eintragen. Dann wird ersichtlich, was das Skript macht, da jeder Aufruf/Befehl inkl. Ergebnis ausgegeben wird.
</p></div></div></div><div class="section_2"><h3 id="Eigene-Hooks-erstellen">Eigene Hooks erstellen<a class="headerlink" href="#Eigene-Hooks-erstellen">¶</a></h3><p>
Für den sehr unwahrscheinlichen Fall, dass man selbst Hooks erstellen muss, hier das Beispiel <strong>/usr/lib/pm-utils/sleep.d/05led</strong>. Daraus ist ersichtlich, dass beim Betreten von STR und STD <code class="notranslate">echo "7 blink" &gt;/proc/acpi/ibm/led</code>, beim Wiedererwachen hingegen <code class="notranslate">echo "7 off" &gt;/proc/acpi/ibm/led</code> aufgerufen wird. Nach dem Erstellen muss der Hook noch ausführbar gemacht werden.</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="o">[</span> -f /proc/acpi/ibm/led <span class="o">]</span> <span class="o">||</span> <span class="nb">exit</span> <span class="m">0</span>

<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> in
	hibernate<span class="p">|</span><span class="nb">suspend</span><span class="o">)</span>
		<span class="o">{</span> <span class="nb">echo</span> <span class="s2">"7 blink"</span> &gt;/proc/acpi/ibm/led <span class="p">;</span> <span class="o">}</span> <span class="m">2</span>&gt;/dev/null
		<span class="p">;;</span>
	thaw<span class="p">|</span>resume<span class="o">)</span> 
		<span class="o">{</span> <span class="nb">echo</span> <span class="s2">"7 off"</span> &gt;/proc/acpi/ibm/led <span class="p">;</span> <span class="o">}</span> <span class="m">2</span>&gt;/dev/null
		<span class="p">;;</span>
	*<span class="o">)</span>
		<span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">exit</span> <span class="nv">$?</span>
</pre></div>
</td></tr></table></div></div><div class="section_2"><h3 id="Bildschirm-nach-5-10-min-wieder-schwarz">Bildschirm nach 5-10 min wieder schwarz<a class="headerlink" href="#Bildschirm-nach-5-10-min-wieder-schwarz">¶</a></h3><p>
Nach Bereitschaft oder Ruhezustand kann die Bereitschaftszeit zurückgesetzt sein, etwa bei Xubuntu oder Lubuntu 14.04. Das führt dazu, dass die Zeit bis zum schwarzen Bildschirm, je nach Voreinstellung, zu kurz gesetzt ist. Mögliche Lösungen werden in <a class="internal" href="./bildschirmschoner.html#Bildschirm-nach-5-10-min-schwarz">Bildschirmschoner</a> vorgestellt.</p></div><div class="section_2"><h3 id="STR-wird-nach-wenigen-Sekunden-unterbrochen">STR wird nach wenigen Sekunden unterbrochen<a class="headerlink" href="#STR-wird-nach-wenigen-Sekunden-unterbrochen">¶</a></h3><p>
Der Rechner startet den Bereitschaftsmodus, wird aber nach einer, bzw. nach wenigen Sekunden "aus dem Schlaf gerissen" und läuft normal weiter. Dies passiert immer dann, wenn ein Gerät ein Aufwachsignal sendet. Nun kann man, wie oben beschrieben, die entsprechenden Module vor dem Bereitschaftsmodus entladen und danach wieder laden, oder man entzieht dem entsprechenden Gerät die Erlaubnis, den Rechner aus dem Bereitschaftsmodus zu wecken.</p><p>Zuerst werden alle Geräte aufgelistet, welche ein Aufwachsignal senden können:</p><div class="bash"><div class="contents"><pre class="notranslate">nl /proc/acpi/wakeup </pre></div></div><p>
</p><pre class="notranslate">     1	Device	S-state	  Status   Sysfs node
     2	SMB0	  S4	*disabled  pci:0000:00:03.2
     3	NMAC	  S5	*disabled
     4	PBB0	  S4	*disabled  pci:0000:00:09.0
     5	HDAC	  S4	*disabled  pci:0000:00:08.0
     6	XVR0	  S4	*disabled
     7	P0P5	  S4	*disabled
     8	P0P6	  S4	*disabled
     9	P0P7	  S4	*disabled  pci:0000:00:16.0
    10	P0P8	  S4	*disabled
    11	P0P9	  S4	*disabled  pci:0000:00:18.0
    12	XVR1	  S4	*disabled
<strong class="highlighted">    13	USB0	  S3	*enabled   pci:0000:00:04.0
    14	USB2	  S3	*enabled   pci:0000:00:04.1
    15	US15	  S3	*enabled   pci:0000:00:06.0
    16	US12	  S3	*enabled   pci:0000:00:06.1
    17	SLPB	  S4	*enabled   platform:PNP0C0E:00</strong></pre><p>
Am Beispiel ist zu erkennen, dass Zeile 13-17 Aufwachsignale senden dürfen (<code class="notranslate">*enabled</code>) während Geräte von Zeile 1 bis 12 keine Aufwachsignale senden dürfen (<code class="notranslate">*disabled</code>).</p><p>Um jetzt herauszufinden welches Gerät den Bereitschaftsmodus unterbricht, deaktiviert man ein Gerät nach dem anderen und testet jeweils danach den Bereitschaftsmodus. Hierzu werden alle Geräte nacheinander auf <code class="notranslate">*disabled</code> gesetzt bis das "schuldige Gerät" gefunden wurde.</p><p>In den permanenten root-Modus wechseln:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo -i </pre></div></div><p>Nun deaktiviert man das erste Gerät
</p><div class="bash"><div class="contents"><pre class="notranslate">echo USB0 &gt; /proc/acpi/wakeup </pre></div></div><p>
und kontrolliert das Ergebnis mit:
</p><div class="bash"><div class="contents"><pre class="notranslate">nl /proc/acpi/wakeup </pre></div></div><p>
</p><pre class="notranslate">     1	Device	S-state	  Status   Sysfs node
     2	SMB0	  S4	*disabled  pci:0000:00:03.2
     3	NMAC	  S5	*disabled
     4	PBB0	  S4	*disabled  pci:0000:00:09.0
     5	HDAC	  S4	*disabled  pci:0000:00:08.0
     6	XVR0	  S4	*disabled
     7	P0P5	  S4	*disabled
     8	P0P6	  S4	*disabled
     9	P0P7	  S4	*disabled  pci:0000:00:16.0
    10	P0P8	  S4	*disabled
    11	P0P9	  S4	*disabled  pci:0000:00:18.0
    12	XVR1	  S4	*disabled
<strong class="highlighted">    13	USB0	  S3	*disabled   pci:0000:00:04.0</strong>
    14	USB2	  S3	*enabled   pci:0000:00:04.1
    15	US15	  S3	*enabled   pci:0000:00:06.0
    16	US12	  S3	*enabled   pci:0000:00:06.1
    17	SLPB	  S4	*enabled   platform:PNP0C0E:00</pre><p>Nun muss der Bereitschaftsmodus getestet werden. Ist der Bereitschaftsmodus immer noch nicht permanent, so deaktivert man testweise das nächste Gerät. Sobald das entsprechende Gerät gefunden wurde, ergänzt man einfach die Datei <strong>/etc/rc.local</strong> um folgenden Zeile:
(USB0 ist hier nur das Bespiel, bitte entsprechendes Geräte (DEVICE) eintragen):
</p><div class="bash"><div class="contents"><pre class="notranslate">echo USB0 &gt; /proc/acpi/wakeup </pre></div></div><p>
Zum Schluss muss dann noch die Root-Shell verlassen werden:</p><div class="bash"><div class="contents"><pre class="notranslate">exit </pre></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://pm-utils.freedesktop.org/wiki/" rel="nofollow">pm-utils Wiki auf freedesktop.org</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://hal.freedesktop.org/quirk/quirk-suspend-index.html" rel="nofollow">HAL Sleep Quirks</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="crosslink topic" href="https://forum.ubuntuusers.de/topic/pm-suspend-in-hardy-perfekt-in-lucid-nur-1x-r/">Lucid USB verhindert kernel-suspend</a></p></li><li><p><a class="external" href="https://wiki.archlinux.org/index.php/Power_management/Suspend_and_hibernate#Instantaneous_wakeups_from_suspend" rel="nofollow">Instantaneous wakeups from suspend</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p>Anleitungen im Ubuntu-Wiki:</p><ul><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/DebuggingKernelSuspend">DebuggingKernelSuspend</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/DebuggingGNOMEPowerManager">DebuggingGNOMEPowerManager</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/DebuggingACPI">DebuggingACPI</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/UnderstandingSuspend">UnderstandingSuspend</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul></li><li><p>Sonstiges:</p><ul><li><p><a class="interwiki interwiki-opensuse" href="https://de.opensuse.org/Fehlersuche_in_ACPI_Suspend">Fehlersuche in ACPI Suspend auf opensuse.org</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="external" href="http://en.opensuse.org/Pm-utils" rel="nofollow">Über pm-utils bei opensuse</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://de.opensuse.org/Pm-utils" rel="nofollow">Über pm-utils bei opensuse</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="internal" href="./skripte/auto_suspend.html">Automatischer SUSPEND für SSH-Server</a> mit pm-utils</p></li><li><p><a class="external" href="http://www.loggn.de/linux-xbmc-aus-bereitschaftsmodus-per-mce-fernbedienung-aufwecken/" rel="nofollow">XBMC aus Bereitschaftsmodus per MCE-Fernbedienung aufwecken</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="external" href="http://www.loggn.de/linux-probleme-nach-dem-bereitschaftsmodus-fernbedienung-netzwerk-und-sound-funktionieren-nicht/" rel="nofollow">Probleme nach dem Bereitschaftsmodus – Fernbedienung, Netzwerk und Sound funktionieren nicht</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./pm-utils/a/revision/939697.html">Diese Revision</a> wurde am 5. Mai 2017 21:26 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./pm-utils.html">pm-utils</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>