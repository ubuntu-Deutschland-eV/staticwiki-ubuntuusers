<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>WLAN_Router › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./wlan_router.html">WLAN Router</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/WLAN_Router">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./wlan_router/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./wlan_router/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./wlan_router/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./wlan_router/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./wlan_router/a/backlinks.html">WLAN Router</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./sudo.html">root-Rechte</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Voraussetzungen">Voraussetzungen
</a><ol class="arabic"><li><a class="crosslink" href="#Hardware">Hardware
</a></li><li><a class="crosslink" href="#Software">Software
</a></li></ol></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a><ol class="arabic"><li><a class="crosslink" href="#hostapd">hostapd
</a></li><li><a class="crosslink" href="#Programmparameter">Programmparameter
</a></li><li><a class="crosslink" href="#interfaces">interfaces
</a></li><li><a class="crosslink" href="#dnsmasq">dnsmasq
</a></li><li><a class="crosslink" href="#Funktionspruefung">Funktionsprüfung
</a></li></ol></li><li><a class="crosslink" href="#Instant-AP-Skript">Instant-AP Skript
</a><ol class="arabic"><li><a class="crosslink" href="#Koexistenz-mit-dem-Network-Manager">Koexistenz mit dem Network-Manager
</a></li><li><a class="crosslink" href="#Variante-fuer-LAN-auf-WLAN">Variante für LAN auf WLAN
</a></li></ol></li><li><a class="crosslink" href="#Netzwerkbruecke">Netzwerkbrücke
</a></li><li><a class="crosslink" href="#Systemlog-abfragen">Systemlog abfragen
</a></li><li><a class="crosslink" href="#Ereignisse-auswerten">Ereignisse auswerten
</a></li><li><a class="crosslink" href="#Zusatzinformationen">Zusatzinformationen
</a><ol class="arabic"><li><a class="crosslink" href="#Freie-DNS">Freie DNS
</a></li></ol></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a><ol class="arabic"><li><a class="crosslink" href="#Fonera-WLAN-Router">Fonera WLAN-Router
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/Oxygen/network-wireless.png" class="image-left" src="./_/2fd78933de5881757f459a5c16d53ba1cb390b3a.png"/>
Um einen Ubuntu-Rechner als WLAN-Access-Point und Router zu verwenden, wird nachfolgend die Konfiguration aufbauend auf den Artikeln <a class="internal" href="./router.html">Router</a>, <a class="internal" href="./dnsmasq.html">Dnsmasq</a> und der Konfigurationsdatei <a class="internal" href="./interfaces.html">/etc/network/interfaces</a> beschrieben. Die Konfiguration kann sowohl auf Desktop-Systemen mit grafischer Oberfläche als auch mit einer Serverversion vorgenommen werden.</p><p>Wer eine einfache und schnelle Lösung für zwischendurch sucht, um z.B. ein Android-Smartphone über WLAN mit dem Internet zu verbinden, sollte den Abschnitt <a class="crosslink" href="#Koexistenz-mit-dem-Network-Manager">Instant-AP-Skript - Koexistenz mit dem Network-Manager</a> beachten.</p><p>Ab <a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> ist dies auch über den <a class="internal" href="./network-manager.html">Network-Manager</a> und mit WPA(2)-Verschlüsselung möglich. Es wird allerdings ein <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Ad-hoc-Netz">Ad-Hoc-Netzwerk</a> erzeugt. Entsprechende Konfigurationsmöglichkeiten und Hinweise sind im Artikel <a class="internal" href="./internetverbindungsfreigabe.html">Internetverbindungsfreigabe</a> beschrieben.</p><p>Zusätzliche Konfigurationsbeispiele, unter anderem für einen WLAN-Repeater, einen WLAN-Router mit separatem Gast-Netzwerk oder auch einen <a class="internal" href="./tor.html">Onion-Router</a>, sind in <a class="internal" href="./skripte/wlan-accesspoint_konfigurationen.html">Skripte/WLAN-Accesspoint Konfigurationen</a> beschrieben. Diese können unter Ubuntu oder z.B. auch auf dem RaspberryPI™ mit <a class="external" href="http://www.raspbian.org/" rel="nofollow">Raspbian</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> eingesetzt werden.</p><div class="section_1"><h2 id="Voraussetzungen">Voraussetzungen<a class="headerlink" href="#Voraussetzungen">¶</a></h2><p>
</p><div class="section_2"><h3 id="Hardware">Hardware<a class="headerlink" href="#Hardware">¶</a></h3><p>
Die WLAN-Hardware und der verfügbare Treiber müssen bestimmte Voraussetzungen erfüllen, um den benötigten Access-Point im Master-Modus überhaupt aktivieren zu können. Dazu zählen beispielsweise WLAN-Karten, die durch den Treiber <strong>hostap</strong> (für Prism2/2.5/3 Chipsatz basierende Karten) unterstützt werden oder solche, die mit dem aktuellen mac80211/nl80211-Subsystem arbeiten.</p><p>Eine Übersicht geeigneter Systemtreiber und WLAN-Karten findet man auf <a class="external" href="http://www.linuxwireless.org/en/users/Drivers" rel="nofollow">Linuxwireless.org</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> und entsprechend in <a class="internal" href="./wlan/karten.html">WLAN/Karten</a>.</p><p>Abfrage dazu mittels <a class="internal" href="./iw.html">iw</a>:
</p><div class="bash"><div class="contents"><pre class="notranslate">iw list </pre></div></div><p>
Erfolgt eine lange Ausgabe mit den Eigenschaften der erkannten WLAN-Karte, dann wird diese durch <em>hostapd</em> unterstützt. Wichtig sind noch die Angaben <strong>AP</strong> und <strong>AP/VLAN</strong> unter <code class="notranslate">Supported interface modes:</code> bei der Ausgabe.</p><pre class="notranslate">...
	Supported interface modes:
		 * IBSS
		 * managed
		 * AP
		 * AP/VLAN
		 * WDS
		 * monitor
		 * mesh point
	software interface modes (can always be added):
		 * AP/VLAN
		 * monitor
...</pre><p>Wird stattdessen folgendes angezeigt, so unterstützt der verwendete Treiber <em>hostapd</em> nicht.
</p><pre class="notranslate">nl80211 not found.</pre><p>Auch wenn eine entsprechende Unterstützung angezeigt wird, kann es bei bestimmten Chipsätzen, insbesondere von Realtek, Probleme geben, da der Treiber oder die Hardware selbst das bei dieser Konfiguration erforderliche MAC- und Packet-Forwarding nicht unterstützt. Der Accesspoint selbst wird zwar initialisiert, es findet jedoch keinerlei Datenübertragung statt. In der oben verlinkten Tabelle auf linuxwireless.org ist daher in der entsprechenden Spalte der Tabelle ein Fragezeichen eingetragen.</p><p>Aktuelle USB WLAN-Sticks mit Atheros-Chipsätzen, die z.B. mit den Treibern <a class="external" href="http://www.linuxwireless.org/en/users/Drivers/ath9k_htc" rel="nofollow">ath9k_htc</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> oder <a class="external" href="http://www.linuxwireless.org/en/users/Drivers/carl9170" rel="nofollow">carl9170</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> arbeiten, erfordern eine Kernelversion 3.x und <strong>hostapd</strong> Version 0.7.3. oder höher, damit der Access-Point erstellt werden kann.</p><p>Windowstreiber unter <a class="internal" href="./wlan/ndiswrapper.html">Ndiswrapper</a> unterstützen diese Funktion nicht. Mit Ndiswrapper kann nur ein Ad-Hoc-Netzwerk aufgebaut werden.</p></div><div class="section_2"><h3 id="Software">Software<a class="headerlink" href="#Software">¶</a></h3><p>
Zusätzlich benötigt werden <sup><a href="#source-4">[4]</a></sup>:</p><ul><li><p><strong>hostapd</strong> (<em>universe</em>, der IEEE 802.11 AP/IEEE 802.1X <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/IEEE_802.1X">Authenticator</a>. Erzeugt den WLAN Access-Point.)</p></li><li><p><strong>dnsmasq</strong> (<em>universe</em>, ein DHCP- und DNS-Cache, siehe auch <a class="internal" href="./dnsmasq.html">Dnsmasq</a> und <a class="internal" href="./router.html">Router</a>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install hostapd dnsmasq </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install hostapd dnsmasq </pre></div></div><p>
</p></div></div></div></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Bei Desktop-Systemen mit grafischer Oberfläche muss die Netzwerkverwaltung über den <a class="internal" href="./network-manager.html">Network-Manager</a> (NM) deaktiviert werden. Über einen Rechtsklick <img alt="rechte Maustaste" class="image-default" src="./_/aa516ca8be74ff7de9b706b8ffc7a88e87e17fb5.png"/> auf das NM-Symbol im Panel ist die Verwaltung der LAN- und WLAN-Verbindungen zu deaktivieren, um die Konfiguration über die <a class="internal" href="./interfaces.html">/etc/network/interfaces</a> zu ermöglichen. Der Manager sollte ansonsten vollständig deinstalliert werden, um Konflikte zu vermeiden.</p><p>Die Konfigurationsdateien können mit einem Editor <sup><a href="#source-1">[1]</a></sup> und Root-Rechten <sup><a href="#source-3">[3]</a></sup> bearbeitet werden. Hier im Beispiel wird die Internetverbindung über LAN (<code class="notranslate">eth0</code>) aufgebaut, die WLAN-Schnittstelle hat die Bezeichnung <code class="notranslate">wlan0</code>.</p><div class="section_2"><h3 id="hostapd">hostapd<a class="headerlink" href="#hostapd">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ab Ubuntu 10.04 muss die Datei <strong>/etc/init.d/hostapd</strong> nicht mehr umgeschrieben werden. Der Dienst (Daemon) muss nur noch in <strong>/etc/default/hostapd</strong> aktiviert werden.</p><p>Auch die Datei <strong>/etc/hostapd.conf</strong> muss nicht mehr manuell anlegt werden. Die Konfigurationsdateien liegen alle unter <strong>/etc/hostapd/</strong>.
</p></div></div><p>
Nach der Installation aller erforderlichen Programmpakete muss zunächst die Datei <strong>/etc/init.d/hostapd</strong> bearbeitet werden. Nur zwei Einträge sind an beliebiger Stelle einzufügen:</p><pre class="notranslate">DAEMON_CONF="/etc/hostapd.conf"   # Verweis auf die Konfigurationsdatei
RUN_DAEMON=yes                    # aktiviert hostapd bei Systemstart
...</pre><p><strong>hostapd</strong> bietet eine Vielzahl an Konfigurationsmöglichkeiten an, auf die hier im Detail nicht eingegangen werden kann. Eine komplette Beschreibung findet man in der Dokumentation unter <strong>/usr/share/doc/hostapd/examples/hostapd.conf.gz</strong>.</p><p>In der Beispielkonfiguration wird eine sichere <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/WPA2">WPA2-AES</a>-Verschlüsselung verwendet. <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Wired_Equivalent_Privacy">WEP</a>, <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Wi-Fi_Protected_Access">WPA1-TKIP</a> oder ein gemischter Modus WPA1/2 sind ebenfalls möglich. WEP ist veraltet, unsicher und sollte nicht mehr verwendet werden. WPA1-TKIP und gemischter Modus sind nur bedingt zu empfehlen. Nur WPA2-AES bietet eine sehr hohe Sicherheit.</p><p>Basiskonfiguration in der Datei <strong>/etc/hostapd.conf</strong> <sup><a href="#source-1">[1]</a></sup>:</p><pre class="notranslate"># Schnittstelle und Treiber
interface=wlan0
driver=nl80211

# WLAN-Konfiguration
ssid=WLAN_AP-SSID
channel=1

# ESSID sichtbar
ignore_broadcast_ssid=0

# Ländereinstellungen
country_code=DE
ieee80211d=1

# Übertragungsmodus
hw_mode=g

# Optionale Einstellungen
# supported_rates=10 20 55 110 60 90 120 180 240 360 480 540

# Draft-N Modus aktivieren (optional, nur für entsprechende Karten)
# ieee80211n=1

# Übertragungsmodus / Bandbreite 40MHz
# ht_capab=[HT40+][SHORT-GI-40][DSSS_CCK-40]

# Beacons
beacon_int=100
dtim_period=2

# MAC-Authentifizierung
macaddr_acl=0

# max. Anzahl der Clients
max_num_sta=20

# Größe der Datenpakete/Begrenzung
rts_threshold=2347
fragm_threshold=2346

# hostapd Log Einstellungen
logger_syslog=-1
logger_syslog_level=2
logger_stdout=-1
logger_stdout_level=2

# temporäre Konfigurationsdateien
dump_file=/tmp/hostapd.dump
ctrl_interface=/var/run/hostapd
ctrl_interface_group=0

# Authentifizierungsoptionen 
auth_algs=3

# wmm-Funktionalität
wmm_enabled=0

# Verschlüsselung / hier rein WPA2
wpa=2
rsn_preauth=1
rsn_preauth_interfaces=wlan0
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP

# Schlüsselintervalle / Standardkonfiguration
wpa_group_rekey=600
wpa_ptk_rekey=600
wpa_gmk_rekey=86400

# Zugangsschlüssel (PSK) / hier in Klartext (ASCII)
wpa_passphrase=1234567890abcdefghijklmn</pre><p>Das WPA-Kennwort muss mindestens 8 Zeichen und darf maximal 63 Zeichen (ASCII) bzw. 64 Zeichen (hex-Code) lang sein. <a class="internal" href="./wlan/sonderzeichen.html">Sonderzeichen</a> wie beispielsweise deutsche Umlaute sind problematisch, da die Kompatibilität zwischen verschiedenen Betriebssystemen nicht mehr gewährleistet ist und sollten vermieden werden.</p><p>Folgende Zeichen sind in der SSID und im Zugangsschlüssel erlaubt:
</p><pre class="notranslate">a-z A-Z 0-9 ! " # $ % &amp; '( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~</pre><p>Hilfsmittel zur Erzeugung von Zugangsschlüsseln: <a class="internal" href="./wlan/wpa_supplicant.html#Schluessel">WPA-Schlüssel</a> und <a class="external" href="http://darkvoice.dyndns.org/wlankeygen/" rel="nofollow">Schlüsselgenerator</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/>.</p></div><div class="section_2"><h3 id="Programmparameter">Programmparameter<a class="headerlink" href="#Programmparameter">¶</a></h3><p>
Mögliche Startparameter zeigt:</p><div class="bash"><div class="contents"><pre class="notranslate">hostapd -h </pre></div></div><p>
Konfiguration testen:</p><div class="bash"><div class="contents"><pre class="notranslate">hostapd -dd /etc/hostapd.conf </pre></div></div></div><div class="section_2"><h3 id="interfaces">interfaces<a class="headerlink" href="#interfaces">¶</a></h3><p>
Konfiguration der <strong>/etc/network/interfaces</strong>:</p><pre class="notranslate"># loopback-Interface nicht löschen
auto lo
iface lo inet loopback

# LAN / automatische Konfiguration über DHCP
auto eth0
iface eth0 inet dhcp

# WLAN mit statischer Konfiguration
auto wlan0
iface wlan0 inet static
address 192.168.3.1
netmask 255.255.255.0
broadcast 192.168.3.255

# vorhandene Regeln und Ketten zuerst löschen (Restart-Funktionalität)
up /sbin/iptables -F
 up /sbin/iptables -X
  up /sbin/iptables -t nat -F

# Maskieren der LAN-Schnittstelle, Port-Forwarding &amp; Nat aktivieren
up iptables -A FORWARD -o eth0 -i wlan0 -s 192.168.0.0/24 -m conntrack --ctstate NEW -j ACCEPT
 up iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
  up iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE 
   up sysctl -w net.ipv4.ip_forward=1 

# hostapd und dnsmasq neu starten
   up /etc/init.d/hostapd restart
    up /etc/init.d/dnsmasq restart</pre><p>Sollte die feste / statische IP für den Adapter wlan0 nicht vergeben werden, kann es hilfreich sein den Aufruf auto wlan0 aus der Konfiguration von <strong>/etc/network/interfaces</strong> zu entfernen.</p></div><div class="section_2"><h3 id="dnsmasq">dnsmasq<a class="headerlink" href="#dnsmasq">¶</a></h3><p>
Basiskonfiguration der <strong>/etc/dnsmasq.conf</strong>:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak     # Originaldatei vorab sichern </pre></div></div><p>
Inhalt:</p><pre class="notranslate"># DHCP-Server aktiv für Interface
interface=wlan0

# DHCP-Server nicht aktiv für Interface
no-dhcp-interface=eth0

# IP-Adressbereich / Lease-Time
dhcp-range=interface:wlan0,192.168.3.20,192.168.3.200,infinite</pre><p>
Feste IP für die angeschlossenen Clients vergeben (optional). Die Konfiguration erfolgt über die <strong>/etc/dnsmasq.conf</strong>
</p><pre class="notranslate">dhcp-host=&lt;MAC-Adresse&gt;,&lt;Name&gt;,&lt;IP-Adresse&gt;,infinite
dhcp-host=&lt;MAC-Adresse&gt;,&lt;IP-Adresse&gt;,infinite
dhcp-host=&lt;Rechnername&gt;,&lt;IP-Adresse&gt;,infinite</pre></div><div class="section_2"><h3 id="Funktionspruefung">Funktionsprüfung<a class="headerlink" href="#Funktionspruefung">¶</a></h3><p>
Nun startet man das Netzwerk neu, beobachte die Terminalausgabe und überprüft anschließend die Konfiguration:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/networking restart </pre></div></div><p>
Fehlerfreie Ausgabe nach einem Neustart der Netzwerkkonfiguration:</p><pre class="notranslate"># die automatisch konfigurierte LAN-Verbindung über DHCP ist hier weitestgehend ausgeblendet
...
DHCPREQUEST of 192.168.178.24 on eth0 to 255.255.255.255 port 67
DHCPACK of 192.168.178.24 from 192.168.178.1
bound to 192.168.178.24 -- renewal in 416998 seconds.
net.ipv4.ip_forward = 1
 * Stopping advanced IEEE 802.11 management hostapd
   ...done.
 * Starting advanced IEEE 802.11 management hostapd
   ...done.
 * Restarting DNS forwarder and DHCP server dnsmasq
   ...done.</pre><p> 
Erfolgreiche Konfiguration der Schnittstelle für das hier gezeigte Beispiel:</p><div class="bash"><div class="contents"><pre class="notranslate">ifconfig
iwconfig </pre></div></div><p>
Ausgabe:</p><pre class="notranslate">...
mon.wlan0 Link encap:UNSPEC  Hardware Adresse 00-01-36-0E-44-C4-30-30-00-00-00-00-00-00-00-00  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metrik:1
          RX packets:3935 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          Kollisionen:0 Sendewarteschlangenlänge:1000 
          RX bytes:286055 (286.0 KB)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  Hardware Adresse 00:01:36:0e:44:c4  
          inet Adresse:192.168.3.1  Bcast:192.168.3.255  Maske:255.255.255.0
          inet6-Adresse: fe80::201:36ff:fe0e:44c4/64 Gültigkeitsbereich:Verbindung
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metrik:1
          RX packets:1018 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1200 errors:0 dropped:0 overruns:0 carrier:0
          Kollisionen:0 Sendewarteschlangenlänge:1000 
          RX bytes:197229 (197.2 KB)  TX bytes:929548 (929.5 KB)</pre><p>
</p><pre class="notranslate">wlan0     IEEE 802.11bg  Mode:Master  Frequency:2.412 GHz  Tx-Power=20 dBm   
          Retry  long limit:7   RTS thr=2347 B   Fragment thr=2346 B   
          Power Management:off
          
mon.wlan0  IEEE 802.11bg  Mode:Monitor  Tx-Power=20 dBm   
          Retry  long limit:7   RTS thr=2347 B   Fragment thr=2346 B   
          Power Management:off</pre><p>
Die erzeugten Filtertabellen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo iptables -t filter -n -L -v </pre></div></div><p>
Ausgabe für die Kette "<em>FORWARD</em>"</p><pre class="notranslate">Chain FORWARD (policy ACCEPT 12 packets, 912 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  wlan0  eth0    192.168.0.0/24       0.0.0.0/0           ctstate NEW 
    7   532 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           ctstate RELATED,ESTABLISHED</pre><div class="bash"><div class="contents"><pre class="notranslate">sudo iptables -t nat -n -L -v </pre></div></div><p>
Ausgabe für die Kette "<em>POSTROUTING</em>":</p><pre class="notranslate">Chain POSTROUTING (policy ACCEPT 180 packets, 17217 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   37  2734 MASQUERADE  all  --  *      eth0    0.0.0.0/0            0.0.0.0/0 </pre><p>
Nach erfolgreicher Konfiguration sollte der Access Point bei einem manuellen Scan auf den Clients angezeigt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo iwlist scan </pre></div></div><p>
Ausgabe:</p><pre class="notranslate">Cell 01 - Address: 00:01:36:0E:44:C4
          ESSID:"WLAN_AP-SSID"
          Protocol:IEEE 802.11bg
          Mode:Master
          Frequency:2.412 GHz (Channel 1)
          Quality:87/100  Signal level:-40 dBm  Noise level:-96 dBm
          Encryption key:on
          Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 6 Mb/s
                    9 Mb/s; 12 Mb/s; 18 Mb/s; 24 Mb/s; 36 Mb/s
                    48 Mb/s; 54 Mb/s
          Extra:bcn_int=100
          Extra:atim=0
          IE: IEEE 802.11i/WPA2 Version 1
          Group Cipher : CCMP
          Pairwise Ciphers (1) : CCMP
          Authentication Suites (1) : PSK</pre><p>
Nun kann ein Verbindungsversuch gestartet werden.</p><p><img alt="./Netzwerk02_Instant01.png" class="image-right" src="./_/f58d1af683a52b480b1627a736c05fe3c88e8c4a.png"/></p></div></div><div class="section_1"><h2 id="Instant-AP-Skript">Instant-AP Skript<a class="headerlink" href="#Instant-AP-Skript">¶</a></h2><p>
Über ein  <a class="internal" href="./shell/bash-skripting-guide_für_anfänger.html">Bash-Skript</a> kann ein WLAN Access-Point erzeugt und die vorhandene Internetverbindung über LAN durchgereicht werden. Dies ist bei Desktopsystemen sehr praktisch, da die benötigte Konfiguration über den Network-Manager beibehalten werden kann. Die Datei <strong>/etc/network/interfaces</strong> muss dazu nicht verändert werden. <strong>hostapd</strong> ist wie beschrieben einzurichten. So kann "zwischendurch" schnell mal ein WLAN-AP erstellt werden.</p><p>Das Skript verwendet <a class="internal" href="./dnsmasq.html">dnsmasq-base</a> zur Konfiguration. Manuelle Änderungen im Skript wie die verwendeten Schnittstellen und IP-Adressen werden für <strong>dnsmasq</strong> automatisch übernommen bzw. gemäß der getroffenen Einstellungen generiert.</p><p>Alle hier verwendeten <a class="internal" href="./dienste.html">Dienste</a> wie hostapd werden durch das jeweilige Skript gestartet und auch wieder beendet. Werden diese Dienste nicht direkt bei Systemstart benötigt, so sollte man diese grundsätzlich deaktivieren, um ungewollte Systemfunktionen zu vermeiden.</p><p>Dienst bei Systemstart deaktivieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-rc.d hostapd disable  </pre></div></div><div class="section_2"><h3 id="Koexistenz-mit-dem-Network-Manager">Koexistenz mit dem Network-Manager<a class="headerlink" href="#Koexistenz-mit-dem-Network-Manager">¶</a></h3><p>
Eine zusätzliche vereinfachte <a class="crosslink post" href="https://forum.ubuntuusers.de/post/4876767/">Variante</a> des Skripts ermöglicht es, die Basisverbindung über den Network-Manager aufzubauen. So kann die Ethernet- oder z.B. auch UMTS/GPRS Verbindungen weiterhin über den NM verwaltet werden. Nur WLAN wird durch das Skript gesteuert.</p></div><div class="section_2"><h3 id="Variante-fuer-LAN-auf-WLAN">Variante für LAN auf WLAN<a class="headerlink" href="#Variante-fuer-LAN-auf-WLAN">¶</a></h3><p>
Dieses Skript bietet erweiterte Optionen für die Konfiguration speziell für Ethernet-Verbindungen und z.B. den Aufbau einer transparenten Netzwerkbrücke zwischen LAN und WLAN. Der Network-Manager wird allerdings deaktiviert, UMTS/GPRS Verbindungen können so nicht genutzt werden.</p><p><a class="internal" href="./dnsmasq.html">Dnsmasq</a> kann ebenfalls verwendet und muss dann wie bereits beschrieben nachinstalliert werden. Die erforderliche Startoption lautet <code class="notranslate">-D</code>. Eine Beispielkonfiguration der <strong>/etc/dnsmasq.conf</strong> ist im Skript hinterlegt und braucht nur übernommen zu werden. Manuelle Änderungen im Skript wie die verwendeten Schnittstellen und IP-Adressen sind zu berücksichtigen.</p><p>Skript mit einem Editor <sup><a href="#source-1">[1]</a></sup> oder über Terminal anlegen und ausführbar machen <sup><a href="#source-2">[2]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">touch instant_AP.sh
chmod +x instant_AP.sh </pre></div></div><p>
Folgenden Inhalt einfügen:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">## Instant WLAN Access-Point</span>
<span class="c1">## elektronenblitz63 ubuntuusers.de 2012</span>
<span class="c1">## published under GPL v3</span>
<span class="c1">##</span>
<span class="c1">## Version 1.6.0 vom 31.Januar 2012</span>
<span class="c1"># Bridged-Modus möglich </span>
<span class="c1"># kleinere Fehler beseitigt</span>
<span class="c1"># Ausgaben verbessert</span>
<span class="c1">#</span>
<span class="c1">## Version 1.5.2 vom 12.November 2011</span>
<span class="c1"># voreingestellte freie DNS geändert</span>
<span class="c1"># Restart des Network-Managers erst bei -stop</span>
<span class="c1"># entferne iptables-Filter bei -stop</span>
<span class="c1">##</span>
<span class="c1">## Beispielkonfiguration der dnsmasq.conf</span>
<span class="c1">##</span>
<span class="c1"># # DHCP-Server dnsmasq aktiv für Interface</span>
<span class="c1">#</span>
<span class="c1"># interface=wlan0</span>

<span class="c1">## DHCP-Server dnsmasq nicht aktiv für Interface</span>
<span class="c1">#</span>
<span class="c1"># no-dhcp-interface=eth0</span>

<span class="c1"># # IP-Adressbereich / Lease-Time</span>
<span class="c1"># dhcp-range=192.168.3.20,192.168.3.25,infinite</span>
<span class="c1">#</span>
<span class="c1">## Ende Beispielkonfiguration dnsmasq.conf</span>

<span class="c1">## freie Variablen</span>

<span class="c1">## Konfiguration der Ethernet-Schnittstelle </span>
<span class="c1">## LAN statisch (Standard ist automatisch über DHCP) / Startoption [-f]</span>
<span class="nv">laniface</span><span class="o">=</span>eth0
<span class="nv">laddress</span><span class="o">=</span><span class="m">192</span>.168.178.6
<span class="nv">lbroadcast</span><span class="o">=</span><span class="m">192</span>.168.178.255
<span class="nv">lnetmask</span><span class="o">=</span><span class="m">255</span>.255.255.0
<span class="nv">lgateway</span><span class="o">=</span><span class="m">192</span>.168.178.1
<span class="nv">lmacaddress</span><span class="o">=</span><span class="m">00</span>:12:79:c0:49:ae
<span class="c1">#</span>
<span class="c1">## Konfiguration der WLAN-Schnittstelle</span>
<span class="c1">## WLAN statisch</span>
<span class="nv">wlaniface</span><span class="o">=</span>wlan0
<span class="nv">waddress</span><span class="o">=</span><span class="m">192</span>.168.3.1
<span class="nv">wbroadcast</span><span class="o">=</span><span class="m">192</span>.168.3.255
<span class="nv">wnetmask</span><span class="o">=</span><span class="m">255</span>.255.255.0
<span class="nv">iptablemask</span><span class="o">=</span><span class="m">192</span>.168.0.0/24

<span class="c1">### manuelle DNS (drei DNS Einträge, 1xDomain und 1xSearch sind möglich)</span>
<span class="c1"># Beispiel</span>
<span class="c1"># dns="nameserver 192.168.178.1 nameserver 192.168.178.1 nameserver 192.168.178.1 domain fritz.box search fritz.box"</span>
<span class="nv">dns</span><span class="o">=</span><span class="s2">"nameserver 8.8.4.4 nameserver 8.8.8.8 nameserver 213.73.91.35"</span> 

<span class="c1">## dnsmasq-base Konfiguration</span>
<span class="c1"># DHCP-Adresspool umfasst x-Adressen</span>
<span class="nv">ipaddresses</span><span class="o">=</span><span class="m">10</span>

<span class="c1"># Basisadresse DHCP-Adresspool (WLAN-IP + X)</span>
<span class="nv">wlanbaseip</span><span class="o">=</span><span class="m">1</span>

<span class="c1"># Lease-Time</span>
<span class="nv">leasetime</span><span class="o">=</span>infinite

<span class="c1">## MAC-Adresse (optional) (Startoption [-m])</span>
<span class="nv">lmacaddress</span><span class="o">=</span><span class="m">00</span>:12:79:c0:49:ae

<span class="c1">## Pause vor LAN-Verbindungstest</span>
<span class="nv">pause</span><span class="o">=</span><span class="m">4</span>

<span class="c1">## Proxyserver (squid)</span>
<span class="nv">proxy</span><span class="o">=</span><span class="s2">"squid"</span>

<span class="c1">## Proxy Server auf Port x (squid 3128 / tinyproxy 3128 / polipo 8123)</span>
<span class="nv">proxyport</span><span class="o">=</span><span class="m">3128</span>

<span class="c1">## Bridge-Konfiguration</span>
<span class="c1">## vor Ubuntu 11.x - /usr/sbin/brctl</span>
<span class="c1">## ab Ubuntu 11.x - /sbin/brctl</span>
<span class="nv">br_util</span><span class="o">=</span>/sbin/brctl
<span class="nv">bridge0</span><span class="o">=</span>br0
<span class="nv">brdelay</span><span class="o">=</span><span class="m">5</span>
<span class="nv">brstp</span><span class="o">=</span><span class="m">0</span>

<span class="c1">## Steuerung Dienste</span>
<span class="c1">## alt</span>
<span class="c1"># hostapdrestart="/etc/init.d/hostapd"</span>
<span class="c1">## neu</span>
<span class="nv">hostapdservice</span><span class="o">=</span><span class="s2">"service hostapd"</span>

<span class="c1">## Ende freie Variablen</span>
<span class="c1">##</span>
<span class="c1"># Skript</span>
<span class="c1">#</span>
<span class="nv">pingout</span><span class="o">=</span><span class="s2">""</span>

<span class="c1">## aut. Adressberechnung DHCP-Range für dnsmasq</span>
<span class="c1">## gemäß Vorgabe WLAN-Schnittstelle</span>
<span class="nv">ipaddresses</span><span class="o">=</span>$<span class="o">[</span><span class="nv">$ipaddresses</span>+<span class="nv">$wlanbaseip</span><span class="o">]</span>
 <span class="nv">baseendaddr</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$waddress</span><span class="s2"> | tr -s . "</span> <span class="s2">" | awk {'print </span><span class="nv">$4</span><span class="s2">'}`"</span>
  <span class="nv">basestartaddr</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$waddress</span><span class="s2"> | tr -s . "</span> <span class="s2">" | awk {'print </span><span class="nv">$1</span><span class="s2">,</span><span class="nv">$2</span><span class="s2">,</span><span class="nv">$3</span><span class="s2">'} | tr -s "</span> <span class="s2">" .`"</span>
   <span class="nv">endaddr</span><span class="o">=</span><span class="s2">"</span><span class="nv">$basestartaddr</span><span class="s2">""."</span>$<span class="o">[</span><span class="nv">$startaddr</span>+<span class="nv">$ipaddresses</span><span class="o">]</span>
    <span class="nv">startaddr</span><span class="o">=</span><span class="s2">"</span><span class="nv">$basestartaddr</span><span class="s2">""."</span>$<span class="o">[</span><span class="nv">$baseendaddr</span>+<span class="nv">$wlanbaseip</span><span class="o">]</span>

<span class="nv">pingout</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">A</span><span class="o">=</span><span class="m">1</span>
<span class="nv">B</span><span class="o">=</span><span class="m">0</span>
<span class="nv">D</span><span class="o">=</span><span class="m">0</span>
<span class="nv">P</span><span class="o">=</span><span class="m">0</span>
<span class="nv">Br</span><span class="o">=</span><span class="m">0</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-h"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="nb">echo</span> Verwendung: instant_AP.sh <span class="o">[</span>-start<span class="o">]</span> <span class="o">[</span>-restart<span class="o">]</span> <span class="o">[</span>-stop<span class="o">]</span> <span class="o">[</span>-D<span class="o">]</span> <span class="o">[</span>-d<span class="o">]</span> <span class="o">[</span>-f<span class="o">]</span> <span class="o">[</span>-m<span class="o">]</span> <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>-B<span class="o">]</span>
<span class="nb">echo</span> Syntax:
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh  wie [-d] startet mit Standardparametern (DHCP)"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -f statische LAN-Konfiguration"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -f -m  statische LAN-Konfiguration, MAC-Änderung"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -D verwendet dnsmasq.conf und nicht dnsmasq-base"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -start -f statische LAN-Konfiguration"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -restart -f statische LAN-Konfiguration"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh  -B Bridged-Modus ohne DHCP-Server. Dynamische und Statische Schnittstellenparameter werden ignoriert"</span>
<span class="nb">echo</span> <span class="s2">"sudo ./instant_AP.sh -stop beendet den AP"</span>
<span class="nb">echo</span> <span class="s2">"Ende"</span>
 <span class="nb">exit</span>
<span class="k">fi</span>

<span class="k">while</span> <span class="nb">getopts</span> <span class="s2">":DdfmhPB"</span> OPTION <span class="p">;</span> <span class="k">do</span>
 <span class="k">case</span> <span class="nv">$OPTION</span> in
  D<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"vewende dnsmasq.conf und nicht dnsmasq-base"</span><span class="p">;</span> <span class="nv">D</span><span class="o">=</span><span class="m">1</span><span class="p">;;</span>
  d<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"konfiguriere LAN über DHCP"</span><span class="p">;</span> <span class="nv">A</span><span class="o">=</span><span class="m">1</span><span class="p">;;</span>
  f<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"konfiguriere LAN statisch"</span><span class="p">;</span> <span class="nv">A</span><span class="o">=</span><span class="m">2</span><span class="p">;;</span>
  m<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"MAC-Change LAN ein"</span><span class="p">;</span> <span class="nv">B</span><span class="o">=</span><span class="m">1</span><span class="p">;;</span>
  P<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Portumleitung für Proxy-Server Port"</span> <span class="nv">$proxyport</span> <span class="s2">"aktiviert"</span><span class="p">;</span> <span class="nv">P</span><span class="o">=</span><span class="m">1</span><span class="p">;;</span>
  B<span class="o">)</span> <span class="nb">echo</span> <span class="s2">"Bridge-Modus aktiviert"</span><span class="p">;</span> <span class="nv">Br</span><span class="o">=</span><span class="m">1</span><span class="p">;;</span>
 <span class="k">esac</span>
  <span class="k">done</span>

<span class="nb">echo</span> <span class="s2">"starte gewählte Konfiguration ..."</span>
 sleep <span class="m">2</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$Br</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">A</span><span class="o">=</span><span class="m">3</span>
 <span class="nb">echo</span> <span class="s2">"Bridge-Mode aktiviert - Sonstige Parameter für Schnittstelleneinstellungen werden ignoriert"</span>
  <span class="k">fi</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> !<span class="o">=</span> <span class="s2">"-start"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span> <span class="s2">"stoppe alle Dienste, und Verbindungen, lösche Itables-Filter ..."</span>

<span class="c1"># Konfiguration löschen</span>
/sbin/iptables -F
 /sbin/iptables -X
  /sbin/iptables -t nat -F

<span class="nv">defgw</span><span class="o">=</span><span class="s2">"`route -n | grep UG | awk {'print </span><span class="nv">$2</span><span class="s2">'}`"</span>
 /sbin/route del default gw <span class="nv">$defgw</span> <span class="nv">$laniface</span>
   <span class="nb">echo</span> <span class="s1">''</span> <span class="p">|</span> tee /etc/resolv.conf

<span class="nv">$hostapdservice</span> stop 
 /sbin/ifconfig <span class="nv">$wlaniface</span> down
  sleep <span class="m">1</span>
  /sbin/iwconfig <span class="nv">$wlaniface</span> mode managed
   sleep <span class="m">1</span>
   /sbin/ifconfig <span class="nv">$laniface</span> down
    sleep <span class="m">1</span>
     /usr/bin/killall dnsmasq
      /sbin/sysctl -w net.ipv4.ip_forward<span class="o">=</span><span class="m">0</span>
       /sbin/modprobe -rfv iptable_nat ipt_MASQUERADE xt_conntrack iptable_filter   

<span class="c1">## Bridge löschen</span>
/sbin/ifconfig <span class="nv">$bridge0</span> down
 sleep <span class="m">1</span>
  <span class="nv">$br_util</span> delif <span class="nv">$bridge0</span> <span class="nv">$laniface</span>
   <span class="nv">$br_util</span> delif <span class="nv">$bridge0</span> <span class="nv">$wlaniface</span>
    <span class="nv">$br_util</span> delbr <span class="nv">$bridge0</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"-stop"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span>
  <span class="nb">echo</span> <span class="s2">"reaktiviere Network-Manager."</span>
   service network-manager start
    service network-manager restart
<span class="nb">echo</span> <span class="s2">"WLAN Access-Point Konfiguration beendet."</span>
 <span class="nb">exit</span>
  <span class="k">fi</span>
 <span class="k">fi</span>

<span class="c1">## MAC-Adresse abgleichen</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$B</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nv">currentmac</span><span class="o">=</span><span class="s2">"`ifconfig </span><span class="nv">$laniface</span><span class="s2"> | grep Adresse | awk {'print </span><span class="nv">$6</span><span class="s2">'}`"</span>
  <span class="nb">echo</span> Schnittstelle <span class="nv">$laniface</span>, MAC-Adresse: <span class="nv">$currentmac</span> 
   <span class="nb">echo</span> Vorgabe: <span class="nv">$lmacaddress</span>

 <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$currentmac</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$lmacaddress</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
   <span class="nb">echo</span> Übereinstimmende MAC-Adresse 
<span class="k">else</span>
   /sbin/ifconfig <span class="nv">$laniface</span> down
 /sbin/ip link <span class="nb">set</span> dev <span class="nv">$laniface</span> addr <span class="nv">$lmacaddress</span>

<span class="nv">currentmac</span><span class="o">=</span><span class="s2">"`ifconfig </span><span class="nv">$laniface</span><span class="s2"> | grep Adresse | awk {'print </span><span class="nv">$6</span><span class="s2">'}`"</span>
 <span class="nb">echo</span> versuche MAC-Adresse zu ändern ...
  <span class="nb">echo</span> Schnittstelle <span class="nv">$laniface</span>, MAC-Adresse: <span class="nv">$currentmac</span> 

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$currentmac</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"</span><span class="nv">$lmacaddress</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span> Änderung der MAC-Adresse erfolgreich! 
  <span class="k">else</span>
 <span class="nb">echo</span> Änderung der MAC-Adresse nicht erfolgreich!
<span class="nb">echo</span> fahre fort ...
<span class="k">fi</span>
 <span class="k">fi</span>
  <span class="k">fi</span>

<span class="c1"># Grundkonfiguration </span>
<span class="nb">echo</span> beende Network-Manager
 service network-manager stop
  <span class="nb">echo</span> <span class="s2">"starte alle Dienste, und Verbindungen ..."</span>

<span class="c1"># LAN aut.m über DHCP nur wenn kein Bridged-Mode gewählt</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$Br</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">]</span> <span class="p">&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$A</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span> <span class="s2">"starte automatische LAN-Verbindung ..."</span>
  /sbin/dhclient <span class="nv">$laniface</span>
<span class="k">fi</span>

<span class="c1"># LAN statisch nur wenn kein Bridged-Mode gewählt</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$Br</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">]</span> <span class="p">&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$A</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"2"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"starte statische LAN-konfiguration ..."</span>
   /sbin/ifconfig <span class="nv">$laniface</span> down
    sleep <span class="m">2</span>
     /sbin/ifconfig <span class="nv">$laniface</span> <span class="nv">$laddress</span> broadcast <span class="nv">$lbroadcast</span> netmask <span class="nv">$lnetmask</span>
      sleep <span class="m">2</span>
       <span class="nb">echo</span>

<span class="nb">echo</span> setze Gateway und Route ...
 /sbin/route add default gw <span class="nv">$lgateway</span> <span class="nv">$laniface</span>
  sleep <span class="m">1</span>
   <span class="nb">echo</span>

<span class="nb">echo</span> setze DNS
<span class="nb">echo</span> <span class="s1">'# erzeugt durch instant_AdHoc.sh'</span> <span class="p">|</span> tee /etc/resolv.conf
 <span class="nb">echo</span> <span class="nv">$dns</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">'print $1,$2'</span><span class="o">}</span> <span class="p">|</span> tee -a /etc/resolv.conf
  <span class="nb">echo</span> <span class="nv">$dns</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">'print $3,$4'</span><span class="o">}</span> <span class="p">|</span> tee -a /etc/resolv.conf
   <span class="nb">echo</span> <span class="nv">$dns</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">'print $5,$6'</span><span class="o">}</span> <span class="p">|</span> tee -a /etc/resolv.conf 
    <span class="nb">echo</span> <span class="nv">$dns</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">'print $7,$8'</span><span class="o">}</span> <span class="p">|</span> tee -a /etc/resolv.conf
     <span class="nb">echo</span> <span class="nv">$dns</span> <span class="p">|</span> awk <span class="o">{</span><span class="s1">'print $9,$10'</span><span class="o">}</span> <span class="p">|</span> tee -a /etc/resolv.conf
 <span class="k">fi</span>
 sleep <span class="nv">$pause</span>

<span class="c1">## Vorbereitung Bridge</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$Br</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>

<span class="c1">## vorhandene Schnittstellenkonfiguration löschen</span>
/sbin/ifconfig <span class="nv">$wlaniface</span> down
 sleep <span class="m">1</span>
  /sbin/ifconfig <span class="nv">$wlaniface</span> up
   sleep <span class="m">1</span>
    /sbin/ifconfig <span class="nv">$wlaniface</span> <span class="m">0</span>.0.0.0
     sleep <span class="m">1</span>
     /sbin/ifconfig <span class="nv">$laniface</span> down
      sleep <span class="m">1</span>
       /sbin/ifconfig <span class="nv">$laniface</span> up
        sleep <span class="m">1</span>

<span class="c1">## Bridge anlegen</span>
 <span class="nv">$br_util</span> addbr <span class="nv">$bridge0</span>
  <span class="nv">$br_util</span> addif <span class="nv">$bridge0</span> <span class="nv">$laniface</span>
   <span class="nv">$br_util</span> stp <span class="nv">$bridge0</span> <span class="nv">$brstp</span>
    <span class="nv">$br_util</span> setfd <span class="nv">$bridge0</span> <span class="nv">$brdelay</span>
     sleep <span class="m">2</span>

<span class="c1">## Dienste steuern</span>
service dnsmasq stop
 <span class="nb">echo</span> <span class="s2">"fordere IP-Adresse für Bridge an ..."</span>
  /sbin/dhclient <span class="nv">$bridge0</span>
   <span class="nv">$hostapdservice</span> restart
    <span class="nv">$br_util</span> addif <span class="nv">$bridge0</span> <span class="nv">$wlaniface</span>
<span class="k">else</span>

<span class="c1">## ohne Bridge-Mode</span>
<span class="c1">## WLAN-Schnittstelle statisch konfigurieren</span>
<span class="nb">echo</span> <span class="s2">"WLAN-Schnittstelle initialisieren ..."</span>
 /sbin/ifconfig <span class="nv">$laniface</span> up
  sleep <span class="m">1</span>
   /sbin/ifconfig <span class="nv">$wlaniface</span> <span class="nv">$waddress</span> broadcast <span class="nv">$wbroadcast</span> netmask <span class="nv">$wnetmask</span>
    <span class="nv">$hostapdservice</span> restart
     <span class="nb">echo</span>
<span class="nb">echo</span> <span class="s2">"starte IP-Forward, Masquerading und NAT"</span>
/sbin/iptables -A FORWARD -o <span class="nv">$laniface</span> -i <span class="nv">$wlaniface</span> -s <span class="nv">$iptablemask</span> -m conntrack --ctstate NEW -j ACCEPT
 /sbin/iptables -A FORWARD -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
  /sbin/iptables -t nat -A POSTROUTING -o <span class="nv">$laniface</span> -j MASQUERADE 
   /sbin/sysctl -w net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span> 
<span class="k">fi</span>

<span class="c1">## dnsmasq-base starten</span>
<span class="nb">echo</span>
 <span class="nb">echo</span> starte dnsmasq-base
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$D</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"0"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span> DHCP-Range dnsmasq-base - Startadresse: <span class="nv">$startaddr</span> Endadresse: <span class="nv">$endaddr</span>
  /usr/sbin/dnsmasq -i <span class="nv">$wlaniface</span> -I <span class="nv">$laniface</span> -F <span class="nv">$startaddr</span>,<span class="nv">$endaddr</span>,<span class="nv">$leasetime</span>
   <span class="nb">echo</span>
<span class="k">else</span>
 
<span class="c1">## dnsmasq neu starten</span>
<span class="nb">echo</span> <span class="s2">"verwende dnsmasq.conf"</span>
 /etc/init.d/dnsmasq restart
  <span class="nb">echo</span> fertig ...
<span class="k">fi</span>

<span class="c1">## Portumleitung für Squid Proxyserver</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$P</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 /sbin/iptables -t nat -A PREROUTING -i <span class="nv">$wlaniface</span> -p tcp --dport <span class="m">80</span> -j REDIRECT --to-port <span class="nv">$proxyport</span>

<span class="c1">## optional Port 443 HTTPS</span>
<span class="c1">#  /sbin/iptables -t nat -A PREROUTING -i $wlaniface -p tcp --dport 443 -j REDIRECT --to-port $proxyport</span>

    <span class="nb">echo</span> <span class="s2">"Port 80 (HTTP) "</span> <span class="nv">$wlaniface</span> <span class="s2">"auf Port </span><span class="nv">$proxyport</span><span class="s2"> umgeleitet ("</span><span class="nv">$proxy</span> <span class="s2">"Proxyserver)"</span>
   <span class="nb">echo</span> <span class="s2">"Starte"</span> <span class="nv">$proxy</span> <span class="s2">"Proxyserver ..."</span>
 sleep <span class="m">2</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$proxy</span><span class="s2">"</span> !<span class="o">=</span> <span class="s2">"squid"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 /etc/init.d/<span class="nv">$proxy</span> restart
  <span class="k">else</span>
   service squid start -n
 <span class="k">fi</span>
<span class="k">fi</span>

<span class="c1">## Ausgabe der aktuellen Konfiguration</span>
 <span class="nb">echo</span> <span class="s2">"DNS-Konfiguration"</span>
  cat /etc/resolv.conf
   <span class="nb">echo</span>
    /sbin/route -n
     <span class="nb">echo</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$Br</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
 <span class="nb">echo</span> <span class="s2">"Konfiguration Bridge:"</span>
  <span class="nv">$br_util</span> show
   <span class="nb">echo</span>
    /sbin/ifconfig <span class="nv">$bridge0</span> <span class="p">|</span> egrep <span class="s1">'Link|inet Adresse'</span>
     <span class="nb">echo</span>
<span class="k">fi</span>
 <span class="nb">echo</span> <span class="s2">"Konfiguration LAN:"</span>
  /sbin/ifconfig <span class="nv">$laniface</span> <span class="p">|</span> egrep <span class="s1">'Link|inet Adresse'</span>
   <span class="nb">echo</span>
    <span class="nb">echo</span> <span class="s2">"Konfiguration WLAN:"</span>
     /sbin/ifconfig <span class="nv">$wlaniface</span> <span class="p">|</span> egrep <span class="s1">'Link|inet Adresse'</span>
      <span class="nb">echo</span>
       /sbin/iwconfig <span class="nv">$wlaniface</span> <span class="p">|</span> egrep <span class="s1">'IEEE|Power|Mode'</span>
        <span class="nb">echo</span>      
         /sbin/iwconfig mon.<span class="nv">$wlaniface</span>

<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</td></tr></table></div><p>Die verwendeten Schnittstellen für LAN und WLAN, sowie die gewünschten IP-Adressen sind ggf. noch anzupassen. Alle erforderlichen Parameter können im Deklarationsblock des Skripts geändert werden.</p><p>Im Terminal <sup><a href="#source-2">[2]</a></sup> als <strong>root</strong> <sup><a href="#source-3">[3]</a></sup> kann das Skript nun mit verschiedenen Parametern aufgerufen werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ./instant_AP.sh [-start|-restart|-stop]
sudo ./instant_AP.sh                    # startet mit automatischer Konfiguration (wie [-start])
sudo ./instant_AP.sh -start             # startet alle Verbindungen und Dienste mit automatischer Konfiguration
sudo ./instant_AP.sh -restart           # erneuert alle Verbindungen und Dienste mit automatischer Konfiguration
sudo ./instant_AP.sh -stop              # beendet alle Verbindungen und Dienste </pre></div></div><p>
Zusätzliche Optionen für eine statische Konfiguration der LAN-Schnittstelle und eine Änderung der MAC-Adresse sind möglich, sollte dies für eine Verbindung erforderlich sein. Das Skript gibt entsprechende Rückmeldungen. Am Ende wird die Konfiguration der LAN- und WLAN-Schnittstelle sowie die Routingtabelle zur Funktionsprüfung ausgegeben.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ./instant_AP.sh [-start|-restart|-stop] [-D] [-d] [-f] [-m] [-h] [-P] [-B]
sudo ./instant_AP.sh -h                # gibt eine Hilfe zur Syntax aus
sudo ./instant_AP.sh -f                # startet LAN mit statischer Konfiguration
sudo ./instant_AP.sh -P                # startet Proxyserver Squid
sudo ./instant_AP.sh -start -d -m      # startet LAN mit automatischer Konfiguration und ändert die MAC-Adresse
sudo ./instant_AP.sh -start -m -f      # startet LAN mit statischer Konfiguration und ändert die MAC-Adresse
sudo ./instant_AP.sh -restart -m       # erneuert alle Verbindungen mit automatischer Konfiguration und ändert die MAC-Adresse (andere Schreibweise)
sudo ./instant_AP.sh -restart -fm      # erneuert alle Verbindungen mit statischer Konfiguration und und ändert die MAC-Adresse (andere Schreibweise)
sudo ./instant_AP.sh -D                # verwendet dnsmasq.conf und nicht dnsmasq-base (erweiterte Konfiguration dnsmasq)
sudo ./instant_AP.sh -B                # transparenter Bridged-Mode wird aktiviert (Eintrag ''bridge=br0'' in der /etc/hostapd.conf erforderlich) </pre></div></div><p>
Die Optionen können beliebig kombiniert werden. Bei Option <code class="notranslate">-df</code> wird eine statische Konfiguration, und bei <code class="notranslate">-fd</code> eine dynamische Konfiguration der LAN-Schnitstelle ausgeführt, also immer die zuletzt angegebene Option verwendet. Parameter <code class="notranslate">-stop</code> erfortert keine Option, bzw. ignoriert diese.</p><p>Eine dazu passende Anleitung zur Konfiguration des Proxyservers Squid findet sich in <a class="internal" href="./internetverbindungsfreigabe.html#Proxyserver">Internetverbindungsfreigabe - Proxyserver</a>.</p><p>Nachdem das Skript und alle Dienste beendet, sowie die Einstellungen zurückgesetzt wurden, kann wieder der Network-Manager verwendet werden.</p></div></div><div class="section_1"><h2 id="Netzwerkbruecke">Netzwerkbrücke<a class="headerlink" href="#Netzwerkbruecke">¶</a></h2><p>
Sofern die WLAN-Hardware dies unterstützt, kann eine <a class="internal" href="./netzwerkbrücke.html">Brücke</a> (sog. Bridging) zwischen LAN und WLAN hergestellt werden um einen gemeinsamen IP-Adressbereich für das lokale Netzwerk verwenden zu können. Die Basiskonfiguration ist in <a class="internal" href="./router.html">Router</a> beschieben. Die Verbindung ist "transparent", d.h. alle angeschlossenen Geräte verhalten sich so, als wären sie direkt miteinander verbunden.</p><p>Die Hard- und Firmware der WLAN-Karte muss dies allerdings unterstützen, ansonsten funktioniert die Brücke nicht und der Adressbereich muss dann für LAN und WLAN getrennt werden. Atheros basierende Karten, z.B. AR5008 mit dem Kernelmodul <a class="external" href="http://www.linuxwireless.org/en/users/Drivers/ath9k" rel="nofollow">ath9k</a>, unterstützen diese Funktion.</p><p>Neben der beschriebenen statischen Konfiguration für die Brücke in der <a class="internal" href="./interfaces.html">interfaces</a> muss <strong>hostapd</strong> und <strong>dnsmasq</strong> entsprechend konfiguriert werden. <strong>dnsmasq</strong> wird nur benötigt, wenn die Verbindung über DSL-Modem aufgebaut wird und kein anderer DHCP-Server vorgeschaltet ist (Router).</p><p>Folgendes Paket muss zunächst installiert <sup><a href="#source-4">[4]</a></sup> werden:</p><ul><li><p><strong>bridge-utils </strong> (Dienstprogramme zur Konfiguration einer Netzwerkbrücke)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install bridge-utils  </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install bridge-utils  </pre></div></div><p>
</p></div></div><p>
Einstellungen für das oben verwendete Beispiel:<br/>Konfiguration der Brücke in der <strong>/etc/network/interfaces</strong></p><pre class="notranslate"># loopback-Interface nicht löschen
auto lo
iface lo inet loopback

# Netzwerkbrücke
auto br0
iface br0 inet static
address 192.168.3.1
netmask 255.255.255.0
broadcast 192.168.3.255
bridge_ports eth1
bridge_fd 0                  # Einstellungen testen, Verzögerung (forward-delay) ggf. erhöhen
bridge_stp no                # Einstellungen testen und ggf. auf 'yes' setzen</pre><p>Die WLAN-Schnittstelle, hier <em>wlan0</em>, muss nicht in der Konfiguration der Bridge angegeben werden, dies erledigt <em>hostapd</em>. Das ist auch nur möglich, wenn sich die WLAN-Karte bereits im Master-Modus befindet.</p><p>Einstellung der <strong>/etc/hostapd.conf</strong>
</p><pre class="notranslate">...
interface=wlan0
bridge=br0
driver=nl80211
...</pre><p>Optional die Konfiguration der <strong>/etc/dnsmasq.conf</strong>
</p><pre class="notranslate"># DHCP-Server nicht aktiv für Interface
no-dhcp-interface=eth0        # Internetverbindung  
no-dhcp-interface=eth1        # lokales Netzwerk
no-dhcp-interface=wlan0       # lokales WLAN

# DHCP-Server aktiv für Interface
interface=br0

# IP-Adressbereich / Lease-Time
dhcp-range=interface:br0,192.168.3.20,192.168.3.200,infinite
...</pre></div><div class="section_1"><h2 id="Systemlog-abfragen">Systemlog abfragen<a class="headerlink" href="#Systemlog-abfragen">¶</a></h2><p>
Ereignisse zu <strong>hostapd</strong> und <strong>dnsmasq</strong> werden im Systemlogbuch unter <strong>/var/log/syslog</strong> abgelegt und könne mit einem entsprechenden Filter ausgelesen werden:</p><div class="bash"><div class="contents"><pre class="notranslate">cat /var/log/syslog | egrep 'hostapd|dnsmasq' </pre></div></div></div><div class="section_1"><h2 id="Ereignisse-auswerten">Ereignisse auswerten<a class="headerlink" href="#Ereignisse-auswerten">¶</a></h2><p>
Um Ereignisse wie das An- oder Abmelden eines Clients auszuwerten, kann <code class="notranslate">hostapd_cli</code> verwendet werden.</p><div class="bash"><div class="contents"><pre class="notranslate">man hostapd_cli </pre></div></div><p><code class="notranslate">hostapd_cli</code> als Daemon starten und bei entsprechenden Ereignissen ein Skript abarbeiten. Beispiel:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo hostapd_cli -p /var/run/hostapd -i [Interface] -a /Pfad/Skript -B </pre></div></div><p>
Das Controllinterface und WLAN-Interface wie z.B <code class="notranslate">wlan0</code> bitte entsprechend anpassen. Die Einstellung für das Controllinterface, hier der Standard <em>/var/run/hostapd</em>, wird in der Datei <strong>/etc/hostapd.conf</strong> festgelegt.</p><p>Einfaches Beispiel des aufgerufenen Skripts, um die Ereignisse in einer Protokolldatei abzulegen:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">## Ereignisse in Textdatei speichern</span>
<span class="nb">echo</span> <span class="nv">$*</span> &gt;&gt; /Pfad/Dateiname
</pre></div>
</td></tr></table></div><p>
Ereignisse, wenn sich z.B. ein Client verbindet oder trennt, werden mit Angabe der Schnittstelle und der MAC-Adresse des Clients übergeben:</p><pre class="notranslate">[Interface] AP-STA-CONNECTED [MAC-Adresse]
[Interface] AP-STA-DISCONNECTED [MAC-Adresse]</pre></div><div class="section_1"><h2 id="Zusatzinformationen">Zusatzinformationen<a class="headerlink" href="#Zusatzinformationen">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Private_IP-Adresse">IP-Adressen</a> in lokalen Netzwerken</p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Wireless_Local_Area_Network#Frequenzen_und_Kan.C3.A4le">Frequenzeinstellungen</a> </p></li><li><p><a class="external" href="http://www.iso.org/iso/english_country_names_and_code_elements" rel="nofollow">ISO Ländercodes</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p>
</p><div class="section_2"><h3 id="Freie-DNS">Freie DNS<a class="headerlink" href="#Freie-DNS">¶</a></h3><p>
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Domain_Name_System">DNS</a></p></li><li><p><a class="external" href="http://www.friendly-board.de/forum/freie-dns-server-t552.html" rel="nofollow">Liste freier DNS auf www.friendly-board.de</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="external" href="http://wiki.ak-zensur.de/index.php/Unzensierte_DNS_Server" rel="nofollow">Liste freier DNS auf wiki.ak-zensur.de</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul><p>
</p></div></div><div class="section_1"><h2 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Fonera-WLAN-Router">Fonera WLAN-Router<a class="headerlink" href="#Fonera-WLAN-Router">¶</a></h3><p>
Die erste Version des <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/La_Fonera">Fonera-Routers</a> verhindert, dass ein per WLAN verbundener Client im (Heim-)Netzwerk erkannt wird. Das kann durch das Einspielen einer alternativen Firmware umgangen werden. Zuerst muss freeWLAN auf der Fonera installiert werden, dazu den Anweisungen des <a class="external" href="http://trac.freewlan.info/wiki/Documentation/Installation.html#Howtoinstalltheadd-ons" rel="nofollow">freeWLAN-Wikis</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> folgen.</p><p>Wenn dies geschehen ist, im Webbrowser die Adresse <code class="notranslate">http://169.254.255.1</code> eingeben, zum Tab <em>"Advanced"</em> wechseln und den Punkt <em>"Network Settings"</em> auswählen. Dort findet man die Einstellung <em>"Private Wireless IP Settings"</em>. Nun noch <em>"Yes"</em> auswählen und etwas warten.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://w1.fi/hostapd/" rel="nofollow">hostapd</a> Homepage <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.linuxwireless.org/en/users/Documentation/hostapd" rel="nofollow">hostapd Dokumentation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> auf linuxwireless.org</p></li><li><p><a class="internal" href="./internet_und_netzwerk.html">Internet und Netzwerk</a> und <a class="internal" href="./netzwerk.html">Netzwerk</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> - Übersichten zu verschiedenen Netzwerkthemen</p></li><li><p><a class="internal" href="./router.html">Router</a></p></li><li><p><a class="internal" href="./heimnetzwerk.html">Heimnetzwerk</a> - Daten in einem lokalen Netzwerk (LAN) austauschen</p></li><li><p><a class="internal" href="./wlan.html">WLAN</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Übersichtsartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./wlan_router/a/revision/927198.html">Diese Revision</a> wurde am 28. Dezember 2016 11:23 von <a href="https://ubuntuusers.de/user/elektronenblitz63/">elektronenblitz63</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./wlan_router.html">WLAN Router</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>