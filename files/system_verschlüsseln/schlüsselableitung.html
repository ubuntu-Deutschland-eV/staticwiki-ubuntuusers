<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>System_verschlüsseln/Schlüsselableitung › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../system_verschlüsseln/schlüsselableitung.html">Schlüsselableitung</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/System_verschlüsseln/Schlüsselableitung">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../system_verschlüsseln/schlüsselableitung/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../system_verschlüsseln/schlüsselableitung/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../system_verschlüsseln/schlüsselableitung/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../system_verschlüsseln/schlüsselableitung/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../system_verschlüsseln/schlüsselableitung/a/backlinks.html">Schlüsselableitung</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="../xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="../trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../ubuntu_installation.html">Ubuntu installieren</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../internetzugang.html">Internetverbindung einrichten</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="../partitionierung.html">Festplatten in Partitionen einteilen</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="../skripte/gerät_mit_pseudozufallszahlen_überschreiben.html">Gerät mit Pseudozufallszahlen überschreiben</a></p></li><li><p><a class="crosslink anchor" href="#source-7" id="source-7"></a> <a class="internal" href="../luks.html">Verschlüsselte Partitionen mit LUKS</a></p></li><li><p><a class="crosslink anchor" href="#source-8" id="source-8"></a> <a class="internal" href="../luks/schlüsselableitung.html">LUKS-Schlüsselableitung</a></p></li><li><p><a class="crosslink anchor" href="#source-9" id="source-9"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorbereitungen">Vorbereitungen
</a><ol class="arabic"><li><a class="crosslink" href="#Partitionierung">Partitionierung
</a></li><li><a class="crosslink" href="#Verschluesselung-der-Partitionen">Verschlüsselung der Partitionen
</a></li><li><a class="crosslink" href="#Formatierung-der-Partitionen">Formatierung der Partitionen
</a></li></ol></li><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Ins-verschluesselte-System-wechseln">Ins verschlüsselte System wechseln
</a><ol class="arabic"><li><a class="crosslink" href="#Software-installieren">Software installieren
</a></li><li><a class="crosslink" href="#etc-crypttab-editieren">/etc/crypttab editieren
</a></li><li><a class="crosslink" href="#Kernel-Initramfs-aktualisieren">Kernel-Initramfs aktualisieren
</a></li></ol></li></ol></li><li><a class="crosslink" href="#Beenden-Neustart">Beenden/Neustart
</a></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a><ol class="arabic"><li><a class="crosslink" href="#Workaround-ab-Ubuntu-15-04-mit-systemd">Workaround ab Ubuntu 15.04 mit systemd
</a></li></ol></li></ol></div><p>Das Ubuntu-System lässt sich ab Ubuntu 12.10 bereits automatisch bei der <a class="internal" href="../installation.html">Installation</a> verschlüsseln. Mit dieser Anleitung wird Ubuntu stattdessen manuell, ebenso bis auf die Boot-Partition, die nur den Kernel und Bootloader enthält, in verschlüsselten Partitionen installiert, wodurch man mehr Einfluss auf die <a class="internal" href="../partitionierung.html">Partitionierung</a> hat. Es wird die <a class="internal" href="../luks/schlüsselableitung.html">LUKS-Schlüsselableitung</a> eingesetzt, da mit dieser beim Start nur eine Passworteingabe nötig ist und der <a class="internal" href="../energiesparmodi_mit_acpi.html#ACPI-SUSPEND-Modi-S0-S1-S2-S3-S4-S5">Ruhezustand (S4)</a> noch funktioniert.</p><p>Sollte mehr als eine Partition für Ubuntu verwendet werden (z.B. eine separate Home-Partition), ein zusätzliches Betriebssystem auf der Festplatte bereits installiert sein oder nachträglich installiert werden, ist die Variante auf Basis von <a class="internal" href="../lvm.html">LVM</a>, die unter <a class="internal" href="../system_verschlüsseln.html">System verschlüsseln</a> ausführlich beschrieben wird, vorzuziehen. Mit dieser ist es auch im Gegenteil zu der hier beschriebenen möglich, nachträglich die internen Partitionsgröße zu verändern oder weitere hinzuzufügen oder zu löschen.</p><p>Das hier erörterte Verfahren ist weniger flexibel, funktioniert aber ohne <a class="internal" href="../lvm.html">LVM</a>.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ohne ein sicheres Kennwort nutzt die stärkste Verschlüsselung nicht! Wie man Passwörter am besten wählt, steht hier: <a class="internal" href="../sicherheits_1x1.html#Passwoerter">Sicherheits 1x1</a>
</p></div></div><div class="section_1"><h2 id="Vorbereitungen">Vorbereitungen<a class="headerlink" href="#Vorbereitungen">¶</a></h2><p>
Wenn sich auf dem Computer schon ein Betriebssystem (wie beispielsweise Windows, Mac OS oder ein anderes Linux-System) oder wichtige Daten befinden, sollte von den wichtigen Daten unbedingt eine Sicherung erstellt werden. Wie bei jeder Veränderung am Computer kann immer auch etwas schiefgehen.</p><p>Zur Installation wird die normale Desktop-CD benötigt. Diese einfach booten <sup><a href="#source-1">[1]</a></sup>. Nachdem das Live-System geladen wurde, jedoch nicht das Installationsprogramm ausführen. Es wird zwingend eine funktionierende Internetverbindung <sup><a href="#source-2">[2]</a></sup> benötigt, da Programme nachinstalliert werden müssen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle folgenden Befehle benötigen <a class="internal" href="../sudo.html">Root-Rechte</a>. Man sollte also mit <strong>sudo -s</strong> Root-Status erlangen!
</p></div></div><div class="section_2"><h3 id="Partitionierung">Partitionierung<a class="headerlink" href="#Partitionierung">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Änderungen an Partitionen können <span class="underline">nicht</span> mehr rückgängig gemacht werden! 
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p><strong>/dev/sdX1</strong>, <strong>/dev/sdX2</strong> bzw. <strong>/dev/sdX3</strong> müssen im folgenden immer durch die tatsächlichen Bezeichnung der Partitionen ersetzt werden!</p><p>Außerdem ist zu beachten, dass ohne eine <a class="internal" href="../partitionierung/grundlagen.html#Primaere-Partitionen-erweiterte-Partition-und-logische-Laufwerke">erweiterte Partition</a> nicht mehr als eine zusätzliche neben den dreien von Ubuntu vorhanden sein können.
</p></div></div><p>Es werden mindestens drei Partitionen benötigt <sup><a href="#source-5">[5]</a></sup>:
</p><ul><li><p><strong>/dev/sdX1</strong> (ext4)</p><ul><li><p>Boot-Partition (unverschlüsselt)</p></li><li><p>Größe: mindestens 200 MB (mehr ist im Regelfall aber nicht nötig)</p></li></ul></li><li><p><strong>/dev/sdX2</strong> (unformatiert)</p><ul><li><p>verschlüsselte <a class="internal" href="../swap.html">Swap-Partition</a></p></li><li><p>Größe: ca. 1,3fache des RAMs (bei weniger als 512 MB Arbeitsspeicher das 2fache)</p></li></ul></li><li><p><strong>/dev/sdX3</strong> (unformatiert)</p><ul><li><p>verschlüsselte Root-Partition</p></li><li><p>Größe: üblicherweise der verfügbare Rest, aber mindestens 8 GB</p></li></ul></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Tipp: Die Boot-Partition (unverschlüsselt) wird so groß erstellt (z.B. 5 GB), dass ein ISO-Image der gewünschten Ubuntu Distribution (gleiche Architektur!) großzügig drauf Platz findet. Dann wird wie <a class="internal" href="../grub_2/skripte.html#Beispiel-Ubuntu-Iso">hier</a> beschrieben das ISO-Image in grub2 eingebunden.  Falls man nun irgendwann Probleme mit dem Vollverschlüsselten System hat, kann man beim Booten in grub2 stattdessen das ISO Live System starten und damit Diagnose und Reparaturen des Vollverschlüsselten System ausführen.
</p></div></div><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Man sollte sich vorab darüber informieren, ob der Rechner mit einem <a class="internal" href="../efi_bootmanagement.html">EFI Bootmanagement</a> versehen ist und wie die Festplatte(n) <a class="internal" href="../grub_2/grundlagen.html">formatiert</a> wurden! Weitere Informationen stehen unter <a class="internal" href="../efi_grundlagen.html">EFI Grundlagen</a> zur Verfügung!
</p></div></div><p>
Bei EFI-Systemen ist zu beachten, dass auf jeden Fall neben der unverschlüsselten Boot-Partition noch eine unverschlüsselte <a class="internal" href="../grub_2/grundlagen.html#Mit-EFI">EFI-Partition</a> anzulegen ist. Eine Alternative wäre die Nutzung des BIOS-Kompatibilitätsmodus <strong>CSM</strong>. Zum weiteren Vorgehen bei vorhandenem <a class="internal" href="../efi_bootmanagement.html">EFI Bootmanagement</a> für verschlüsselte Systeme mit Schlüsselableitung kann man sich auch an den EFI-Hinweisen der Anleitung <a class="internal" href="../system_verschlüsseln.html">System verschlüsseln</a> ohne Schlüsselableitung orientieren. Insbesondere ist darauf zu achten, dass die EFI-Partition als solche gekennzeichnet sowie dass sie beim <a class="crosslink" href="#Ins-verschluesselte-System-wechseln">chroot</a> berücksichtigt wird.</p></div><div class="section_2"><h3 id="Verschluesselung-der-Partitionen">Verschlüsselung der Partitionen<a class="headerlink" href="#Verschluesselung-der-Partitionen">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Es ist aus Sicherheitsgründen empfehlenswert, die Partitionen einmal mit Zufallszahlen zu überschreiben, vor allen Dingen, wenn vorher auf diesen unverschlüsselte Daten gespeichert waren. <sup><a href="#source-6">[6]</a></sup> Ansonsten sind unter Umständen viele Dateien nach dem Verschlüsseln noch auslesbar.
</p></div></div><p>Daraufhin wird die root Partitionen verschlüsselt und mit den Namen <strong>root</strong> geöffnet <sup><a href="#source-7">[7]</a></sup>.</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Sollte eine niedrigere Schlüssellänge oder ein anderer Verschlüsselungsalgorithmus bevorzugt werden, müssten die Befehle entsprechend angepasst werden<sup><a href="#source-7">[7]</a></sup>.
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">cryptsetup luksFormat -c aes-xts-plain64 -s 512 -h sha512 -y /dev/sdX3
cryptsetup luksOpen /dev/sdX3 root </pre></div></div><p>Anschließend wird die Swap-Partition mit einem von der Root-Partition abgeleiteten Schlüssel <sup><a href="#source-8">[8]</a></sup> erstellt und geöffnet:
</p><div class="bash"><div class="contents"><pre class="notranslate">/lib/cryptsetup/scripts/decrypt_derived root | cryptsetup luksFormat -c aes-xts-plain64 -s 512 -h sha512 -y /dev/sdX2
/lib/cryptsetup/scripts/decrypt_derived root | cryptsetup luksOpen /dev/sdX2 swap </pre></div></div></div><div class="section_2"><h3 id="Formatierung-der-Partitionen">Formatierung der Partitionen<a class="headerlink" href="#Formatierung-der-Partitionen">¶</a></h3><p>
Aufgrund von Problemen mit dem Live-CD-Installer müssen die verschlüsselten Partitionen vorher manuell formatiert werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">mkfs.ext4 /dev/mapper/root
mkswap /dev/mapper/swap </pre></div></div></div></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
<img alt="Partitionierung.png" class="image-right" src="../_/d87500d00d8e7a355b2708932e47e7ff96a052ad.png"/></p><p>Danach wird das Installationsprogramm gestartet <sup><a href="#source-1">[1]</a></sup> und mit diesem bis <a class="internal" href="../ubuntu_installation.html#Schritt-4-Auswahl-der-Partition-Partitionierung">Schritt 4</a> fortgefahren, bei dem die <em>"manuelle Partitionierung"</em> ausgewählt wird.</p><p>Im nächsten Installationspunkt werden die folgenden Partitionen jeweils mit einem Doppelklick auf die entsprechenden Einträge konfiguriert. Die Swap-Partition braucht nicht ausgewählt zu werden, da sie automatisch erkannt wird.</p><ul><li><p><strong>/dev/sdX1</strong></p><ul><li><p>Boot-Partition</p></li><li><p>Dateisystem: <strong>ext4</strong></p></li><li><p>Formatieren: ja</p></li><li><p>Einhängepunkt: <strong>/boot</strong></p></li></ul></li><li><p><strong>/dev/mapper/root</strong></p><ul><li><p>Root-Partition</p></li><li><p>Dateisystem: <strong>ext4</strong> oder gewünschtes <a class="internal" href="../dateisystem.html#Linux-Dateisysteme">Linux-Dateisystem</a></p></li><li><p>Formatieren: ja</p></li><li><p>Einhängepunkt: <strong>/</strong></p></li></ul></li></ul><p>Danach wird gemäß Anleitung <sup><a href="#source-1">[1]</a></sup> mit der Installation fortgefahren, jedoch nach dem Abschluss der Installation <span class="underline">nicht neugestartet</span>.</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Sollte parallel Windows installiert und mit <a class="internal" href="../truecrypt.html">Truecrypt</a> verschlüsselt worden sein, wird <a class="internal" href="../grub.html">GRUB</a> in die Boot-Partition <strong>/dev/sdX1</strong> anstelle des MBRs installiert. Das wird im <a class="internal" href="../ubuntu_installation.html#Schritt-7-berpruefung-und-Auswahl-Speicherort-Bootloader">Installations-Punkt 7</a> unter <em>Erweitert</em> eingestellt. Dort wird anstelle von <strong>hd0</strong> die Boot-Partition ausgewählt. GRUB erscheint dann, sobald die Taste Escape im Truecrypt-Bootloader gedrückt wird.
</p></div></div><div class="section_2"><h3 id="Ins-verschluesselte-System-wechseln">Ins verschlüsselte System wechseln<a class="headerlink" href="#Ins-verschluesselte-System-wechseln">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle folgenden Befehle müssen in ein und demselben Terminal <sup><a href="#source-4">[4]</a></sup> ausgeführt werden.
</p></div></div><p>
Um die nötigen Anpassungen vorzunehmen, wird mittels <a class="internal" href="../chroot.html">chroot</a> in das eigentliche, verschlüsselte System gewechselt. Das geschieht durch die Eingabe der folgenden Befehle:
</p><div class="bash"><div class="contents"><pre class="notranslate">mount /dev/mapper/root /mnt
mount /dev/sdX1 /mnt/boot
mount -o rbind /dev /mnt/dev
mount -t proc proc /mnt/proc
mount -t sysfs sys /mnt/sys
cp /etc/resolv.conf /mnt/etc/resolv.conf
chroot /mnt /bin/bash </pre></div></div><div class="section_3"><h4 id="Software-installieren">Software installieren<a class="headerlink" href="#Software-installieren">¶</a></h4><p>
Die benötigten Pakete werden mit diesem Befehl <sup><a href="#source-4">[4]</a></sup> installiert: 
</p><div class="bash"><div class="contents"><pre class="notranslate">apt-get install cryptsetup </pre></div></div></div><div class="section_3"><h4 id="etc-crypttab-editieren">/etc/crypttab editieren<a class="headerlink" href="#etc-crypttab-editieren">¶</a></h4><p>
Zuerst muss die <a class="internal" href="../uuid.html">UUID</a> der Root- und Swap-Partition ermittelt werden. Das geschieht mit folgenden Befehlen:
</p><div class="bash"><div class="contents"><pre class="notranslate">blkid /dev/sdX3
blkid /dev/sdX2 </pre></div></div><p>Daraufhin wird mit dieser Eingabe die nötige Zeile in <strong>/etc/crypttab</strong> eingefügt, wobei <code class="notranslate">&lt;..._VOLUME_ID&gt;</code> vorher durch die ermittelte UUID (ohne Anführungszeichen!) ersetzt werden muss (jeweils ohne die spitzen Klammern):
</p><div class="bash"><div class="contents"><pre class="notranslate">echo "root UUID=&lt;SDX3_ROOT_VOLUME_ID&gt; none luks" &gt;&gt; /etc/crypttab
echo "swap UUID=&lt;SDX2_SWAP_VOLUME_ID&gt; root luks,keyscript=/lib/cryptsetup/scripts/decrypt_derived" &gt;&gt; /etc/crypttab </pre></div></div><p>Anschließend kann man prüfen<sup><a href="#source-9">[9]</a></sup>, ob auch wirklich alles korrekt eingetragen wurde und gegebenenfalls nachbessern. Ein Beispiel mit nicht repräsentativen UUIDs: </p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span># &lt;target name&gt;	&lt;source device&gt;		&lt;key file&gt;	&lt;options&gt;
root UUID=c9e6aab5-e3a0-43e9-a594-4bcf1b61e7c1 none luks
swap UUID=d09e29f2-9882-457d-b4f0-42f12aebdd3b root luks,keyscript=/lib/cryptsetup/scripts/decrypt_derived
</pre></div>
</td></tr></table></div><div class="section_4"><h5 id="Ab-Ubuntu-15-04">Ab Ubuntu 15.04<a class="headerlink" href="#Ab-Ubuntu-15-04">¶</a></h5><p>
Zusätzlich zu obigen Schritten sind aufgrund <a class="internal" href="../systemd.html">systemd</a> folgende Schritte nötig, da die Schlüsselableitung sonst nicht mehr funktioniert (vgl. dazu <a class="external" href="http://lists.freedesktop.org/archives/systemd-devel/2014-July/021418.html" rel="nofollow">systemd-Mailingliste</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> , <a class="interwiki interwiki-debianbug" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=618862">Debian Bug-Tracker</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> und <a class="crosslink post" href="https://forum.ubuntuusers.de/post/7520688/">hier im Forum</a>).</p><p>Falls es sich um eine <a class="internal" href="../swap.html">Swap</a>-Partition handelt, wendet man die zusätzlichen Änderungen unter <a class="crosslink" href="#Workaround-ab-Ubuntu-15.04-mit-systemd">Workaround</a> ab Ubuntu 15.04 mit systemd an, für alle anderen Partitionen benutzt man die nun folgende Anleitung.</p><p>Entsprechend <a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/encryptedZfs#ZFS_on_LUKS_Installation">ZFS on LUKS Installation</a> im Abschnitt "Create /etc/initramfs-tools/conf.d/cryptroot Entries" legt man zunächst eine Kopie des Skriptes der Schlüsselableitung im <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Initramfs">Initramfs</a> an:
</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir /etc/initramfs-tools/scripts/luks
cp /lib/cryptsetup/scripts/decrypt_derived /etc/initramfs-tools/scripts/luks/get.root_crypt.decrypt_derived </pre></div></div><p>
Anschließend wird in dieser Kopie anstatt der Variable <code class="notranslate">$1</code> jeweils nochmal der zur <code class="notranslate">&lt;SDX3_ROOT_VOLUME_ID&gt;</code> gehörende <code class="notranslate">&lt;target name&gt;</code> eingetragen - im folgenden Beispiel wieder <code class="notranslate">root</code>:
</p><div class="bash"><div class="contents"><pre class="notranslate">sed -i s/\$1/root/g /etc/initramfs-tools/scripts/luks/get.root_crypt.decrypt_derived </pre></div></div><p>
Der Befehl ist also unverändert zu übernehmen, lediglich das obige <code class="notranslate">target</code> namens <code class="notranslate">root</code> ist hier einzusetzen oder ggf. an den eigenen Namen anzupassen.</p><p>Zuletzt ist noch die Datei <code class="notranslate">cryptroot</code> anzulegen. Dazu führt man folgende Befehle, welche anzupassen sind, aus:
</p><div class="bash"><div class="contents"><pre class="notranslate">echo "target=root,source=UUID=&lt;SDX3_ROOT_VOLUME_ID&gt;,key=none" &gt;&gt; /etc/initramfs-tools/conf.d/cryptroot
echo "target=data,source=UUID=&lt;DATA_VOLUME_ID&gt;,keyscript=/scripts/luks/get.root_crypt.decrypt_derived" &gt;&gt; /etc/initramfs-tools/conf.d/cryptroot </pre></div></div><p>
In der ersten Zeile wird im Beispiel wieder wie oben das Beispiel <code class="notranslate">root</code> für <code class="notranslate">&lt;target name&gt;</code> eingetragen sowie die UUID <code class="notranslate">&lt;SDX3_ROOT_VOLUME_ID&gt;</code> entsprechend ihrem tatsächlichen Wert eingesetzt. Im zweiten Befehl wird die Partition, welche durch die Schlüsselableitung geöffnet werden soll, eingetragen - in diesem Beispiel unter dem Namen <code class="notranslate">data</code>, wenn also entsprechend die Partition unter dem Namen <code class="notranslate">data</code> (auch nochmal nachzusehen im Verzeichnis <code class="notranslate">/dev/mapper</code>) entschlüsselt wurde. Hier ist ebenfalls mittels <code class="notranslate">blkid</code> dessen <code class="notranslate">&lt;DATA_VOLUME_ID&gt;</code> entsprechend einzusetzen.</p><p>Alternativ kann man auch die, zumindest im Wesentlichen, fertig formulierte und getestete Anleitung aus der <a class="crosslink post" href="https://forum.ubuntuusers.de/post/8190363/">Diskussion zum Wikiartikel</a> verwenden. Allerdings ist diese auch nicht weniger aufwendig, nicht robuster und es kann für manche Benutzer der Schlüsselableitung nachteilig sein, weil man dabei für jede Partition nur dasselbe Passwort verwenden kann anstatt tatsächlich einen neuen Schlüssel abzuleiten.</p><p>Abschließend wird mit den nun folgenden Abschnitten dieser Anleitung fortgefahren.</p></div></div><div class="section_3"><h4 id="Kernel-Initramfs-aktualisieren">Kernel-Initramfs aktualisieren<a class="headerlink" href="#Kernel-Initramfs-aktualisieren">¶</a></h4><p>
Um die Änderungen an der crypttab zu übernehmen, muss noch
</p><div class="bash"><div class="contents"><pre class="notranslate">update-initramfs -u -k all </pre></div></div><p>
ausgeführt werden.</p></div></div></div><div class="section_1"><h2 id="Beenden-Neustart">Beenden/Neustart<a class="headerlink" href="#Beenden-Neustart">¶</a></h2><p>
Mit den beiden folgenden Befehlen wird die Chroot-Umgebung geschlossen und das System neugestartet. Beim Bootvorgang sollte dann nach dem Passwort gefragt werden.
</p><div class="bash"><div class="contents"><pre class="notranslate">exit
sync
reboot </pre></div></div><p>
Sollte einem dabei ein Fehler unterlaufen sein, kann man den Chroot jederzeit genauso oder - minimal abweichend - mittels <a class="internal" href="../chroot/live-cd.html#Einrichtung">chroot/Live-CD</a> durchführen. Der Hinweis dort zum Initramfs ist bei beiden Variationen bei jeder Wiederholung zu beachten.</p></div><div class="section_1"><h2 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Workaround-ab-Ubuntu-15-04-mit-systemd">Workaround ab Ubuntu 15.04 mit systemd<a class="headerlink" href="#Workaround-ab-Ubuntu-15-04-mit-systemd">¶</a></h3><p>
Ohne suspend-to-disk Support kann die <a class="internal" href="../swap.html">Swap</a>-Partition mit Einwegschlüsseln verwendet werden. Diese Methode kommt ohne das Script <strong>decrypt_derived</strong> aus und funktioniert daher auch mit systemd ab Ubuntu 15.04 - ohne obige Zusatzschritte ab Ubuntu 15.04.</p><p>Es wird eine freie Swap-Partition benötigt, z.B. unter <code class="notranslate">/dev/sda2</code>.</p><p>Die Kennung der Partition (PARTUUID) wird mit <code class="notranslate">blkid</code> ermittelt, auch eindeutige Bezeichner unter /dev/disk/by-id und /dev/disk/by-path können verwendet werden.
</p><ul><li><p>/dev/sda3 ist als Bezeichner nicht verwendbar!</p></li><li><p>die UUID ist ebenfalls nicht verwendbar (ändert sich bei jeden Neustart)</p></li></ul><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Verwendung von einem nicht 100% eindeutigen Bezeichner z.B. von <code class="notranslate">/dev/sda2</code> führt mit hoher Wahrscheinlichkeit irgendwann zu einem kompletten Datenverlust, wenn z.B. beim Starten mal ein anderer Datenspeicher als <code class="notranslate">sda</code> benannt wird!
</p></div></div><p>Eintrag der in der <strong>/etc/crypttab</strong> für die Swap Partition:
</p><pre class="notranslate">swap PARTUUID="xxxxx-xxx-xxx-xxxx" /dev/urandom swap,cipher=aes-cbc-essiv:sha256,size=256</pre><p>
<code class="notranslate">/dev/urandom</code> ist dabei der Einmalschlüssel.</p><p>Update der initramfs
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-initramfs -u -k all </pre></div></div><p>Der Eintrag in der <a class="internal" href="../fstab.html">fstab</a>:
</p><pre class="notranslate">/dev/mapper/swap none swap sw 0 0</pre><p>Nach dem Neustart kann mit
</p><div class="bash"><div class="contents"><pre class="notranslate">ls -la /dev/mapper/
sudo cryptsetup status /dev/mapper/swap </pre></div></div><p>
gepüft werden, ob der das verschlüsselte Swap-Gerät verfügbar ist, und mit
</p><div class="bash"><div class="contents"><pre class="notranslate">swapon -s
top </pre></div></div><p>
ob es verwendet wird.
Quelle: <a class="external" href="https://wiki.archlinux.org/index.php/Dm-crypt/Swap_encryption" rel="nofollow" title="https://wiki.archlinux.org/index.php/Dm-crypt/Swap_encryption">https://wiki.archlinux.org/index.php/Dm-crypt/Swap_encryption</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p><p></p></div></div></div>
<p class="meta">
<a href="../system_verschlüsseln/schlüsselableitung/a/revision/940630.html">Diese Revision</a> wurde am 8. Mai 2017 23:47 von <a href="https://ubuntuusers.de/user/ubot/">ubot</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../system_verschlüsseln.html">System verschlüsseln</a></li>
<li><a href="../system_verschlüsseln/schlüsselableitung.html">Schlüsselableitung</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>