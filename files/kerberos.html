<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Kerberos › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./kerberos.html">Kerberos</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Kerberos">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./kerberos/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./kerberos/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./kerberos/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./kerberos/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./kerberos/a/backlinks.html">Kerberos</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./sudo.html">Root-Rechte</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Voraussetzungen">Voraussetzungen
</a></li><li><a class="crosslink" href="#Installation-Server">Installation - Server
</a><ol class="arabic"><li><a class="crosslink" href="#Benutzer-anlegen">Benutzer anlegen
</a></li><li><a class="crosslink" href="#Dienste-anlegen">Dienste anlegen
</a></li></ol></li><li><a class="crosslink" href="#Installation-Client">Installation - Client
</a><ol class="arabic"><li><a class="crosslink" href="#Sonderfall-automatische-Anmeldung">Sonderfall: automatische Anmeldung
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/service.png" class="image-left" src="./_/afb6c1869d3e3412cb022363511bce77dccf937a.png"/>
Der Begriff Kerberos steht sowohl für ein Protokoll als auch dessen Implementierung und ermöglicht eine sichere Authentifizierung in einer unsicheren Umgebung. Der Name bezieht sich auf den <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Kerberos_(Mythologie)">Höllenhund</a>, der in der griechischen Mythologie den Ein- bzw. den Ausgang der Unterwelt bewacht.</p><p>Das Protokoll basiert auf dem <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Needham-Schroeder-Protokoll">Needham-Schroeder-Protokoll</a> von 1978 und  beschreibt ein Verfahren zum Austausch von Schlüsseln zwischen gleichberechtigten Partnern (Client, Server) und einer dritten gesicherten Instanz, dem Kerberos Server (oder mehreren Servern). Das Protokoll unterscheidet bei der Authentifizierung zwischen Host, Dienst und Benutzer. Die aktuelle Kerberos Version 5 wurde 2005 als <a class="external" href="http://tools.ietf.org/html/rfc4120:RFC" rel="nofollow">RFC 4120</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> veröffentlicht.</p><p>Es existieren aktuell vier konkurrierende Implementierungen:
</p><ul><li><p><a class="external" href="http://web.mit.edu/Kerberos/" rel="nofollow">MIT Kerberos</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.h5l.org/" rel="nofollow">Heimdal Kerberos</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.gnu.org/s/shishi/" rel="nofollow">Shishi Kerberos</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Active_Directory">Active Directory</a> - diese umfasst nicht nur Kerberos Funktionalitäten, sondern implementiert auch LDAP</p></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Um den Artikel einfach zu halten, wird im Folgenden nur auf die MIT Kerberos Implementierung eingegangen.
</p></div></div><div class="section_1"><h2 id="Voraussetzungen">Voraussetzungen<a class="headerlink" href="#Voraussetzungen">¶</a></h2><p>
Bevor ein Kerberos-Server in Betrieb genommen werden kann müssen zwei Voraussetzungen geschaffen werden.</p><ul><li><p>NTP-Server: Kerberos arbeitet mit Tickets, welche ein absolutes "Verfallsdatum" haben. Driften die Uhren der beteiligten Verbindungspartner zu stark auseinander (MIT-Standard: 5 Min), kommt keine Verbindung zu Stande.</p></li><li><p>DNS-Server: Kerberos arbeitet mit <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Domain#Fully_Qualified_Domain_Name_.28FQDN.29">FQDN</a> (z.B. <code class="notranslate">host1.realm.some.domain</code>). Alle beteiligten Verbindungspartner müssen sowohl im Forward- als auch im Reverse-Lookup aufgelöst werden können.</p></li></ul><p>
</p></div><div class="section_1"><h2 id="Installation-Server">Installation - Server<a class="headerlink" href="#Installation-Server">¶</a></h2><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Sicherheit eines Kerberos-Netzwerkes basiert vollständig auf der Sicherheit des Kerberos-Servers. Erlangt ein Angreifer Root-Rechte bzw. -zugriff auf die Schlüssel-Datenbank des Kerberos, kann dieser beliebige Berechtigungen ausstellen, kennt die Schlüssel für eventuelle Verschlüsselungen usw. Dieser "Mangel" ist durch das Design bedingt. Das MIT empfiehlt als Gegenmaßnahme, den/die Kerberos Server entsprechend dieser Anforderung zu sichern. Dazu gehört:</p><ul><li><p>Am besten nur dedizierte Kerberos Server, damit so wenig wie irgend möglich (weitere) Dienste auf dem Rechner laufen. Vor allem keine Dienste, die als Benutzer <code class="notranslate">root</code> laufen oder das Erlangen von Root-Rechten ermöglichen.</p></li><li><p>Das Gerät sollte physikalisch in einem gesicherten Bereich stehen.</p></li><li><p>Es sollten nur Accounts für den Kerberos-Admin geben.</p></li><li><p>Das OS sollte auf dem aktuellsten Patch-Stand sein (unter Ubuntu: keine Pakete aus <code class="notranslate">backports</code> oder <code class="notranslate">proposed</code>)</p></li></ul><p>
Quellen: <a class="external" href="http://www.ornl.gov/~jar/HowToKerb.html" rel="nofollow">Kerberos installation help</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> , <a class="crosslink" href="http://ikhaya.ubuntuusers.de/2011/11/23/erneute-warnung-vor-proposed-paketquellen/">Erneute Warnung vor „proposed“-Paketquellen</a>
</p></div></div><ul><li><p><strong>krb5-kdc</strong></p></li><li><p><strong>krb5-admin-server</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install krb5-kdc krb5-admin-server </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install krb5-kdc krb5-admin-server </pre></div></div><p>
</p></div></div><p>Nach der Installation erfolgt ein geführter Konfigurationsdialog. Der übernimmt die wichtigsten Einstellungen. Die fertige Konfiguration findet sich dann unter <strong>/etc/krb5kdc/kdc.conf</strong></p><pre class="notranslate">[kdcdefaults]
    kdc_ports = 750,88

[realms]
    my.realm.root = {
        database_name = /var/lib/krb5kdc/principal
        admin_keytab = FILE:/etc/krb5kdc/kadm5.keytab
        acl_file = /etc/krb5kdc/kadm5.acl
        key_stash_file = /etc/krb5kdc/stash
        kdc_ports = 750,88
        max_life = 10h 0m 0s
        max_renewable_life = 7d 0h 0m 0s
        master_key_type = des3-hmac-sha1
        supported_enctypes = aes256-cts:normal arcfour-hmac:normal des3-hmac-sha1:normal des-cbc-crc:normal des:normal des:v4 des:norealm des:onlyrealm des:afs3
        default_principal_flags = +preauth
    }</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Unter Ubuntu wird der MIT-Kerberos <span class="underline">ohne</span> Standard-Benutzer/Admin angelegt. Man muss initial einen Realm-Admin anlegen.
</p></div></div><p>Dies geschieht mit folgendem Befehl:
</p><pre class="notranslate">sudo krb5_newrealm</pre><p>
Hier muss ein Passwort vergeben werden, das möglichst komplex sein sollte und das nicht vergessen werden darf.</p><div class="section_2"><h3 id="Benutzer-anlegen">Benutzer anlegen<a class="headerlink" href="#Benutzer-anlegen">¶</a></h3><p>
Existiert noch kein Adminuser für einen Realm oder will man die Anmeldung am Kerberos umgehen (Password vergessen...), erlangt mit folgendem Befehl zugriff auf die Kerberos Admin Konsole.</p><pre class="notranslate">sudo kadmin.local</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Der gezeigte Befehl kann <span class="underline">nur lokal</span> an einem Kerberos-Server ausgeführt werden. Ein ordnungsgemäß konfigurierter Kerberos benötigt diese Möglichkeit zur Administration <span class="underline">nicht</span>.
</p></div></div><p>
Im Normalfall kann man von jedem Rechner, der sich dem Kerberos-Realm angeschlossen hat, wie folgt Zugriff auf die Admin-Konsole erlangen:</p><pre class="notranslate">kadmin -p principal-name</pre><p>
Einmal in der Admin-Konsole kann wie folgt ein Benutzer angelegt werden:</p><pre class="notranslate">addprinc simple_user          #legt einen normalen Benutzer
addprinc some_new_admin/admin #legt einen Admin-Benutzer an</pre><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Es kann prinzipiell jeder Name für einen Admin vergeben werden. Es hat sich jedoch als sinnvoll herausgestellt, alle Admins in eigene Instanzen (der Teil nach dem Slash) zu packen. Diese Instanz "/admin" kann dann als "Gruppe" gebraucht werden, um ihr über ACLs entsprechende Kerberos-Berechtigungen zuzuweisen.
</p></div></div><p>Der Benutzer "some_new_admin/admin" besitzt noch keine Berechtigung auf dem Kerberos. Dies wird durch die Datei <strong>/etc/krb5kdc/kadm5.acl</strong> gesteuert.</p><pre class="notranslate">*/admin@my.realm.root     *    #gewährt allen Benutzern der Instanz admin alle Rechte
myadmin@my.realm.root     *    #gewährt dem Benutzer myadmin alle Rechte
untrust@my.realm.root ADMCI    #entzieht alle Rechter außer das Listing-Recht von Benutzer untrust</pre><p>
</p><table><tr class="titel"><td colspan="2"> Mögliche ACL Rechte </td></tr><tr class="kopf"><td> Recht </td><td> Beschreibung </td></tr><tr><td> a </td><td> Erlaubt das Hinzufügen von Principals oder Policies.  </td></tr><tr><td> A </td><td> Verbietet das Hinzufügen von Principals oder Policies.  </td></tr><tr><td> d </td><td> Erlaubt das Löschen von Principals oder Policies.  </td></tr><tr><td> D </td><td> Verbietet das Löschen von Principals oder Policies.  </td></tr><tr><td> m </td><td> Erlaubt das Modifizieren von Principals oder pPolicies.  </td></tr><tr><td> M </td><td> Verbietet das Modifizieren von Principals oder Policies.  </td></tr><tr><td> c </td><td> Erlaubt das Ändern des Passworts für Principals.  </td></tr><tr><td> C </td><td> Verbietet das Ändern des Passworts für Principals.  </td></tr><tr><td> i </td><td> Erlaubt das Abfragen der Datenbank. </td></tr><tr><td> I </td><td> Verbietet das Abfragen der Datenbank. </td></tr><tr><td> l </td><td> Erlaubt das Auflisten aller Principals oder Policies. </td></tr><tr><td> L </td><td> Verbietet das Auflisten aller Principals oder Policies. </td></tr><tr><td> s </td><td> Erlaubt das explizite setzen eines Keys für einen Principal.  </td></tr><tr><td> S </td><td> Verbietet das explizite setzen eines Keys für einen Principal. </td></tr></table></div><div class="section_2"><h3 id="Dienste-anlegen">Dienste anlegen<a class="headerlink" href="#Dienste-anlegen">¶</a></h3><p>
Neben einzelnen Benutzern verwaltet Kerberos auch Dienste. Diese werden ebenfalls über Principals abgebildet. Angelegt werden sie wie folgt:</p><pre class="notranslate">kadmin -p some_new_admin/admin
addprinc -randkey nfs/server.my.realm.root
addprinc -randkey cifs/server.my.realm.root
addprinc -randkey nfs/client.my.realm.root
addprinc -randkey cifs/client.my.realm.root
addprinc -randkey nfs/some-other-client.my.realm.root
addprinc -randkey cifs/some-other-client.my.realm.root</pre><p>In diesem Beispiel sind am Kerberos nun Principals für den Dienst CIFS und NFS auf den Rechnern <em>"server"</em>, <em>"client"</em>, <em>"some-other-client"</em> hinterlegt. Welche Rollen diese Rechner später einnehmen, spielt für Kerberos keine Rolle. Es ist durchaus möglich, dass der Rechner <em>"client.my.realm.root"</em> einen CIFS-Server stellt und sich <em>"server.my.realm.root"</em> darauf verbindet. Dieses Erzeugen und Speichern der Keys hat auch im ersten Schritt keine sicherheitsrelevanten Konsequenzen. Erst wenn die Keys manuell auf dem entsprechenden Client hinterlegt werden, kann dieser die Keys auch benutzen.</p></div></div><div class="section_1"><h2 id="Installation-Client">Installation - Client<a class="headerlink" href="#Installation-Client">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wenn auf dem Kerberos Server auch Dienste laufen, die sich gegenüber Kerberos authentifizieren, wird auch die Client-Komponente benötigt.
</p></div></div><ul><li><p><strong>krb5-user</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install krb5-user </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install krb5-user </pre></div></div><p>
</p></div></div><p>Sollen sich an dem Client auch Benutzer über Kerberos authentifizieren, wird noch die PAM-Komponente benötigt.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Beim Einrichten von libpam-krb5 sollte man immer eine aktive "Notfall"-Konsole mit Admin-Rechten offen habe. Ist die Kerberos Server/Client-Konfiguration fehlerhaft, kann man sich u.U nicht mehr am System anmelden.
</p></div></div><ul><li><p><strong>krb5-user</strong></p></li><li><p><strong>libpam-krb5 </strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install krb5-user libpam-krb5  </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install krb5-user libpam-krb5  </pre></div></div><p>
</p></div></div><p>
Sollte es sich bei dem Client um ein Gerät handeln, das nicht permanent den Kerberos-Server zur Verfügung hat, benötigt man noch das folgende Paket, um die User-Credentials lokal zu cachen. Dies ist ebenfalls im Fehlerfall nützlich, wenn der Kerberos-Server nicht verfügbar ist.</p><ul><li><p><strong>libpam-ccreds</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libpam-ccreds </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install libpam-ccreds </pre></div></div><p>
</p></div></div><p>Nach der Installation wird abermals ein geführter Konfigurationsdialog ausgeführt. Dieser konfiguriert die <strong>/etc/krb5.conf</strong> so, dass eine Anmeldung mit Kerberos prinzipiell möglich sein sollte. In dieser Datei sind eine Reihe von Beispiel-Realms parametriert, die man bedenkenlos löschen kann. Eine aufgeräumte Konfiguration kann so aussehen.</p><pre class="notranslate">[libdefaults]
        default_realm = MY.REALM.ROOT
        krb4_config = /etc/krb.conf
        krb4_realms = /etc/krb.realms
        kdc_timesync = 1
        ccache_type = 4
        forwardable = true
        proxiable = true
[realms]
        MY.REALM.ROOT = {
                kdc = KERBEROS-SERVER
                admin_server = KERBEROS-SERVER
                default_domain = my.realm.root
        }

[domain_realm]

[login]
        krb4_convert = false 
        krb4_get_tickets = false
[logging]
     kdc = SYSLOG:INFO:DAEMON
     admin_server = SYSLOG:INFO:DAEMON
     default = SYSLOG:INFO:DAEMON</pre><p>Man sollte sich nun in einer zweiten Konsole mit einem Kerberos-Benutzer anmelden können.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Kommt keine Benutzer/Gruppen-Synchronisation via LDAP zum Einsatz, muss der Administrator selber dafür Sorge tragen. Damit ein Benutzer über Kerberos authentifiziert werden kann, muss dieser auch in der lokalen <strong>/etc/passwd</strong> hinterlegt sein. Andernfalls kann sich der Benutzer nicht an dem Client anmelden.
</p></div></div><p>Soll der Benutzer sich an dem Client nicht nur anmelden können, sondern auch Dienste benutzen, müssen die entsprechenden Keys hinterlegt werden.</p><pre class="notranslate">sudo kinit some_new_admin/admin
ktadd cifs/client.my.realm.root
ktadd nfs/client.my.realm.root</pre><p>Ab diesem Moment ist es möglich, NFS und CIFS-Shares ohne User-Credentials einzubinden (mounten) und den Zugriff von jedem durch Kerberos authentifizierten Benutzer zu gestatten.</p><div class="section_2"><h3 id="Sonderfall-automatische-Anmeldung">Sonderfall: automatische Anmeldung<a class="headerlink" href="#Sonderfall-automatische-Anmeldung">¶</a></h3><p>
Manchmal ist es nötig, einen Rechner ohne Authentifizierung zur Verfügung zu stellen. Als Beispiele sind HTPCs oder Terminal-Rechner in Ausstellungsräumen zu nennen. Für diesen Zweck gibt es diverse Mechanismen unter Ubuntu. Soll ein solcher Rechner auch in einem Kerberos Netz betrieben werden, kommt es darauf an, ob die benutze Login-Variante in den PAM-Prozess eingreift oder einfach ein gespeichertes Password durchreicht. Bei letzterer Variante ist kein Eingriff nötig, da der "User" gegenüber Kerberos wie jeder normale Benutzer authentifiziert wird (mit dem gespeicherten Passwort). Einige <a class="internal" href="./displaymanager.html">Displaymanager</a> (z.B NoDM) umgehen bei einer automatischen Anmeldung einfach die PAM-Authentifizierung bzw. richten eine eigene PAM-Kette ein, die kein Passwort erfordert.</p><p>Ist man sich nicht sicher, ob eine gültige Kerberos-Umgebung vorliegt, kann man das mittels folgendem Befehl prüfen:</p><pre class="notranslate">klist</pre><p>Liefert dieser Befehl die Meldung "No credentials cache found", existiert keine gültige Kerberos Umgebung.</p><p>Um eine Kerberos-Umgebung ohne Passwort zu bekommen, benötigt man den Schlüssel des Principals auf dem Client. Dieser sollte in einer benutzerbezogenen Keytab abgelegt werden, da die Datei <strong>/etc/krb5.keytab</strong> nur Root zugänglich ist.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Mit den folgenden Befehlen legt man das Secret eines Benutzers auf einem "ungeschützten" Ort. Diese Information kann jeder extrahieren und zur Authentifizierung nutzen.
</p></div></div><pre class="notranslate">sudo -u autologinuser kadmin -p some_new_admin/admin
addprinc -randkey autologinuser
ktadd -k /home/autologinuser/.keytab autologinuser</pre><p>Um eine Kerberos Umgebung zu initialisieren, führt muss man einfach <code class="notranslate">kinit</code> mit der Keytab und dem Benutzernamen auf.</p><pre class="notranslate">/usr/bin/kinit -k -t /home/autologinuser/.keytab autologinuser@MY.REALM.ROOT</pre><p>Dieser Befehl kann in einem Startskript (z.B. <strong>/home/autologinuser/.xsession</strong>) hinterlegt werden.</p><p>Soll das System sehr lange laufen, kann es passieren, dass die Tickets ablaufen. Standartmäßig ist der KDC auf 10 Stunden Ticket-Lebenzeit und maximal 7 Tage "Wiederbelebung" eingestellt. Entweder erhöht man diese Werte in der <strong>/etc/krb5kdc/kdc.conf</strong> oder man legt auf Clientseite einen Cronjob an, welchen eine Erneuerung der Tickets anstößt. Dazu einfach in der User-Crontab folgende Zeile anlegen:
</p><pre class="notranslate">0 * * * * /usr/bin/kinit -R</pre></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Kerberos_(Informatik)">Kerberos</a> - Wikipedia</p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/Kerberos">Ubuntu Community Documentation - Kerberos</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/12.04/serverguide/C/kerberos.html">Ubuntu 12.04 Serverguide Kerberos</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p>Weitere Artikel zum Thema:</p><ul><li><p><a class="internal" href="./kerberos/nfs_mit_kerberos_sichern.html">Kerberos/NFS_mit_Kerberos_sichern</a></p></li><li><p><a class="internal" href="./kerberos/activedirectory.html">Kerberos/ActiveDirectory</a></p></li><li><p><a class="internal" href="./kerberos/ldap.html">Kerberos/LDAP</a></p></li></ul></li><li><p><a class="internal" href="./serverdienste.html">Serverdienste</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Übersichtsartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./kerberos/a/revision/940533.html">Diese Revision</a> wurde am 8. Mai 2017 22:32 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./kerberos.html">Kerberos</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>