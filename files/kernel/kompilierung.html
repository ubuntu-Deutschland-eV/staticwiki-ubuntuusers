<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Kernel/Kompilierung › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../kernel/kompilierung.html">Kompilierung</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Kernel/Kompilierung">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../kernel/kompilierung/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../kernel/kompilierung/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../kernel/kompilierung/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../kernel/kompilierung/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../kernel/kompilierung/a/backlinks.html">Kompilierung</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="../xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../metapakete.html">Linux-Metapakete: welche Version?</a> </p></li></ol></div></div><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Kurzanleitung-fuer-einen-einfachen-Standardkernel">Kurzanleitung für einen einfachen Standard...</a></li><li><a class="crosslink" href="#Kernel-Konfiguration-veraendern">Kernel-Konfiguration verändern
</a></li><li><a class="crosslink" href="#Tipps-und-Hintergrundinfos">Tipps und Hintergrundinfos
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Manchmal benötigt man einen angepassten <a class="internal" href="../kernel.html">Kernel</a> mit zusätzlichen Funktionen, oder ein normalerweise dynamisch zu ladender Treiber soll fest eingebaut werden. Dann kann man sich einen eigenen Kernel aus den Quellcode kompilieren.</p><p>Gründe, einen eigenen Kernel zu kompilieren: 
</p><ul><li><p>man ist ein Kernel-Entwickler oder -Tester</p></li><li><p>man möchte den Kernel auf eine spezielle Art kompilieren (z.B. um experimentelle Funktionen zu nutzen)</p></li><li><p>man besitzt Hardware, die der offizielle Ubuntu-Kernel nicht unterstützt</p></li><li><p>man ist einfach nur neugierig</p></li></ul><p> 
Gründe, einen eigenen Kernel nicht zu kompilieren: 
</p><ul><li><p>Wenn man nur einen Treiber kompilieren möchte, reicht es, die entsprechenden <a class="interwiki interwiki-packages" href="http://packages.ubuntu.com/linux-headers">linux-headers</a>-Pakete zu installieren.</p></li><li><p>Man weiß nicht so recht, was man tut und braucht Hilfe, wenn etwas schief läuft. Abhängig vom gemachten Fehler kann es nötig sein, das System neu zu installieren.</p></li></ul><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Wenn man einen selbstkompilierten Kernel verwendet, ist es sehr schwierig, bei Problemen Hilfe zu bekommen. Man kann zum Beispiel keinen Fehlerbericht auf <a class="internal" href="../launchpad.html">Launchpad</a> erstellen.
</p></div></div><div class="section_1"><h2 id="Kurzanleitung-fuer-einen-einfachen-Standardkernel">Kurzanleitung für einen einfachen Standardkernel<a class="headerlink" href="#Kurzanleitung-fuer-einen-einfachen-Standardkernel">¶</a></h2><p>
Es werden die von Ubuntu bereitgestellten Kernel-Quellen verwendet, ein deb-Paket gebaut und installiert. Detaillierte Erklärungen und weiterführende Möglichkeiten werden in späteren Abschnitten aufgezeigt.</p><div class="section_2"><h3 id="Vorbereitung">Vorbereitung<a class="headerlink" href="#Vorbereitung">¶</a></h3><p>
Notwendige Pakte installieren.
</p><ul><li><p><strong>linux-source</strong> (Kernel-Quellen von Ubuntu)</p></li><li><p><strong>build-essential</strong> (diverse Tools zum Kompilieren, ...)</p></li><li><p><strong>kernel-package</strong> (Tool zum Erstellen von Kernel-deb-Paketen)</p></li><li><p><strong>libssl-dev</strong> (OpenSSL Entwicklungsbibliotheken)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="../_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="../apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install linux-source build-essential kernel-package libssl-dev </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install linux-source build-essential kernel-package libssl-dev </pre></div></div><p>
</p></div></div><p>Nach der Installation befinden sich die Kernelquellen im Verzeichnis <strong>/usr/src</strong>, z.B.:</p><pre class="notranslate">drwxr-xr-x 4 root root 4096 Mär 22 13:54 /usr/src/linux-source-ver3.2.1
lrwxrwxrwx 1 root root   45 Mär 20 01:07 /usr/src/linux-source-ver3.2.1.tar.bz2 -&gt; linux-source-3.2.1/linux-source-3.2.1.tar.bz2</pre><p>Alle weiteren Befehlseingaben im gesamten Artikel werden als normaler Benutzer im eigenen <strong>HOME</strong>-Verzeichnis getätigt und bedürfen nicht dem vorangestellten <a class="internal" href="../sudo.html">sudo</a>-Befehl (siehe auch <a class="crosslink" href="#root-und-fakeroot:">Tipps und Hintergrundinfos</a>). 
Damit das Kompilieren der Kernelpakete das eigene Homeverzeichnis nicht "zumüllt", empfiehlt sich das Anlegen eines neuen Unterordners namens <strong>kernel</strong>.</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir kernel </pre></div></div><p>Abschließend wechselt man in das neue Unterverzeichnis
</p><div class="bash"><div class="contents"><pre class="notranslate">cd kernel </pre></div></div><p>Der folgende Aufruf entpackt die Kernel-Quellen in einen eigenen Unterordner namens <strong>linux-source-versionXYZ</strong> im aktuellen Verzeichnis
</p><div class="bash"><div class="contents"><pre class="notranslate">tar xvjf /usr/src/linux-*tar.bz2 </pre></div></div><p>Nun wechselt man in das neue Verzeichnis
</p><div class="bash"><div class="contents"><pre class="notranslate">cd linux-source* </pre></div></div></div><div class="section_2"><h3 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h3><p>
Konfiguration des aktuell laufenden Kernels für den neuen Kernel übernehmen:
</p><div class="bash"><div class="contents"><pre class="notranslate">cp /boot/config-`uname -r` .config </pre></div></div><p>Dieser Aufruf setzt eventuelle neuen Optionen entsprechend der Vorschläge der Kernel-Entwickler.
</p><div class="bash"><div class="contents"><pre class="notranslate">yes "" | make oldconfig </pre></div></div></div><div class="section_2"><h3 id="Bauen">Bauen<a class="headerlink" href="#Bauen">¶</a></h3><p>
Folgender Befehl "baut" den Kernel und verpackt anschließend alles Notwendige in Debian-Pakete (<strong>.deb</strong>). 
</p><div class="bash"><div class="contents"><pre class="notranslate">make-kpkg --initrd buildpackage </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Ausführung von make-kpkg kann mehrere Stunden in Anspruch nehmen und nimmt in der normalen Konfiguration ca. 5 GiB Festplattenplatz in Anspruch. Eine schnellere Festplatte (<a class="internal" href="../ssd.html">SSD</a> ist zu bevorzugen) kann den Kompiliervorgang deutlich beschleunigen. Aktuelle Prozessoren ab 1,5 GHz aufwärts sind ausreichend. Für den aktuellen Standardkernel (3.8.xx) braucht der Kompiliervorgang auf einem Intel Core i5 Prozessor mit der Standardkonfiguration ca. 45min und ca. 4,8 GiB Festplattenspeicher.
</p></div></div><p>Nun sollten im übergeordneten Verzeichnis folgende Dateien (Versionsnummern variieren natürlich) vorhanden sein.
</p><div class="bash"><div class="contents"><pre class="notranslate">cd ..
ls -l </pre></div></div><p>
</p><pre class="notranslate">-rw-r--r--  1 user user   7121212 Apr  3 08:41 linux-doc-3.5.7.7_3.5.7.7-10.00.Custom_all.deb
-rw-r--r--  1 user user   8091536 Apr  3 06:09 linux-headers-3.5.7.7_3.5.7.7-10.00.Custom_i386.deb
-rw-r--r--  1 user user  43954508 Apr  3 07:07 linux-image-3.5.7.7_3.5.7.7-10.00.Custom_i386.deb
-rw-r--r--  1 user user 717180814 Apr  3 08:05 linux-image-3.5.7.7-dbg_3.5.7.7-10.00.Custom_i386.deb
-rw-r--r--  1 user user      2134 Apr  3 08:42 linux-manual-3.5.7.7_3.5.7.7-10.00.Custom_all.deb
drwxrwxr-x 26 user user      4096 Apr  3 08:41 linux-source-3.5.0
-rw-r--r--  1 user user  84241398 Apr  3 08:41 linux-source-3.5.7.7_3.5.7.7-10.00.Custom_all.deb
-rw-rw-r--  1 user user      1070 Apr  2 10:27 linux-source-3.5.7.7_3.5.7.7-10.00.Custom.dsc
-rw-rw-r--  1 user user      3957 Apr  3 08:43 linux-source-3.5.7.7_3.5.7.7-10.00.Custom_i386.changes
-rw-rw-r--  1 user user 107826129 Apr  2 10:26 linux-source-3.5.7.7_3.5.7.7-10.00.Custom.tar.gz</pre></div><div class="section_2"><h3 id="Exkurs-Bootmenue">Exkurs: Bootmenü<a class="headerlink" href="#Exkurs-Bootmenue">¶</a></h3><p>
Folgende Erläuterung ist sehr wichtig, falls der gebaute Kernel nicht funktioniert und auf den vorherigen Kernel zurückgegriffen werden muss.
</p><ul><li><p>Die Installation eines neuen Kernels lässt andere, insbesondere den vor der Installation, aktuellsten Kernel unangetastet. In dem Fall, dass der neue Kernel nicht funktioniert, kann auf eine frühere Version zurückgegriffen werden.</p></li><li><p>In neueren Versionen von Ubuntu wird die Auswahl der installierten Kernel während des Bootvorgangs oft verborgen. Im Bootmenü (<a class="internal" href="../grub_2.html">Grub 2</a>) wird an erster Stelle nur der Kernel mit der höchsten Versionsnummer angezeigt. Abhängig von der Ubuntu-Version wird hierbei die konkrete Bezeichnung des Kernels (inkl. Versionsnummer) oder nur <em>"Ubuntu"</em> angezeigt.</p></li><li><p>Weitere installierte Kernel (also frühere Versionen) werden im zweiten Menüpunkt mit der Bezeichnung <em>"Erweiterte Optionen für Ubuntu"</em> oder <em>"Frühere Kernelversionen"</em> angezeigt.</p></li><li><p>Bei einigen Systemen wird der Bootloader <a class="internal" href="../grub_2.html">Grub 2</a> nicht oder nur sehr kurz angezeigt. In diesem Fall sollte während des <a class="internal" href="../bootvorgang.html">Bootvorgangs</a> im richtigen Moment die Tasten 
<span class="key">↑</span>  oder 
<span class="key">↓</span>  gedrückt werden, um das Menü anzuzeigen.</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Kernel-installieren-und-testen">Kernel installieren und testen<a class="headerlink" href="#Kernel-installieren-und-testen">¶</a></h3><p>
Den Kernel installieren
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo dpkg -i linux-image-3.5.7.7_3.5.7.7-10.00.Custom_i386.deb </pre></div></div><p>Nun muss das System neu gestartet werden. Im Normalfall sollte beim nächsten <a class="internal" href="../bootvorgang.html">Bootvorgang</a> der Bootmanager selbstständig den selbstgebauten Kernel auswählen.</p><p>Um zu überprüfen welcher Kernel gerade (z.B. vor und nach dem Neustart) aktiv ist, dient folgender Befehl.
</p><div class="bash"><div class="contents"><pre class="notranslate">uname -a </pre></div></div></div></div><div class="section_1"><h2 id="Kernel-Konfiguration-veraendern">Kernel-Konfiguration verändern<a class="headerlink" href="#Kernel-Konfiguration-veraendern">¶</a></h2><p>
Die "Konfiguration" des Kernels sind Einstellungen die das Bauen bzw. die Zusammensetzung des Kernels beeinflussen. Es ist möglich <a class="internal" href="../kernelmodule.html">Kernelmodule</a> (z.B. Treiber) zu entfernen, hinzuzufügen oder fest einzubauen. Außerdem lassen sich bestimmte Funktionalitäten und Fähigkeiten (z.B. das Rotieren des <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Framebuffer">Framebuffers</a>) aktivieren und deaktivieren.</p><div class="section_2"><h3 id="config">.config<a class="headerlink" href="#config">¶</a></h3><p>
Die Konfiguration ist in einer einzelnen Datei festgehalten. Normalerweise befindet sich diese Datei im Stammverzeichnis der Kernelquellen. Mit dem <a class="crosslink" href="#Schnell-und-Einfach">obigen Einführungsbeispiel</a> also im Pfad: <strong>/usr/src/linux-source*/.config</strong></p><p>Verschiedene Varianten dieser Datei können für den Bau des eigenen Kernels auf folgende Arten erzeugt werden. Die Kommandos müssen alle im Stammverzeichnis der Kernelquellen ausgeführt werden, weil sich an diesem Ort die Datei <strong>.config</strong> befindet und modifiziert bzw. angelegt wird.</p><ul><li><p>die Konfiguration des aktuell laufenden Kernels als Ausgangsbasis verwenden: </p><div class="bash"><div class="contents"><pre class="notranslate">cp /boot/config-`uname -r` .config </pre></div></div></li><li><p>Falls die <strong>.config</strong> von einer älteren Kernelversion stammt, kann man die Konfiguration für die aktuelle Version aktualisieren. Dabei wird nach den Einstellungen für die neuen Kerneloptionen gefragt. </p><div class="bash"><div class="contents"><pre class="notranslate">make oldconfig </pre></div></div></li><li><p>Um im vorherigen Fall die Abfragen der neuen Kerneloptionen zu unterbinden und statt dessen die empfohlenen Antworten automatisch mit Ja zu beantworten: </p><div class="bash"><div class="contents"><pre class="notranslate">yes "" | make oldconfig  </pre></div></div></li><li><p>Dieses Kommando (seit Kernel 2.6.32) erzeugt eine Konfiguration mit den vom System gerade verwendeten Modulen. Dabei werden alle benutzten Module als Modul erstellt. </p><div class="bash"><div class="contents"><pre class="notranslate">make localmodconfig </pre></div></div></li><li><p>Alternativ können auch alle Module fest in den Kernel einkompiliert werden. </p><div class="bash"><div class="contents"><pre class="notranslate">make localyesconfig </pre></div></div></li></ul><p>
Die Konfigurationsdatei manuell mit einem Texteditor zu verändern ist nicht empfehlenswert und auch wenig praktisch. Im folgenden Abschnitt wird ein bequemerer Weg beschrieben.</p></div><div class="section_2"><h3 id="Konfigurations-Werkzeuge">Konfigurations-Werkzeuge<a class="headerlink" href="#Konfigurations-Werkzeuge">¶</a></h3><p>
Um die Konfiguration (also die Datei <strong>.config</strong>) im Detail zu verändern, existieren verschiedene Werkzeuge, welche sich in ihrer grundlegenden Funktion nicht unterscheiden, sondern nur in der Darstellung und der Handhabung der Konfigurationsdatei.</p><p>Die einzelnen Werkzeuge nutzen verschiedene Zusatzbibliotheken welche ggf. mit der <a class="internal" href="../paketverwaltung.html">Paketverwaltung</a> noch installiert werden müssen. Im Folgenden eine Auflistung der Werkzeuge mit kurzer Erläuterung und den notwendigen Paketen.</p><p>
</p><table><tr class="kopf"><td>Werkzeug </td><td> Beschreibung </td><td> Paket </td></tr><tr><td> <code class="notranslate">make menuconfig</code> </td><td> <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/ncurses">ncurses</a> basierte Oberfläche zur Verwendung im Terminal </td><td> <strong>libncurses5-dev</strong> </td></tr><tr><td> <code class="notranslate">make gconfig</code> </td><td> GTK-Oberfläche </td><td> <strong>libglade2-dev</strong> </td></tr><tr><td> <code class="notranslate">make xconfig</code> </td><td> Qt-Oberfläche, komfortabler als gconfig da vollwertige GUI-Oberfläche </td><td> <strong>libqt4-dev</strong> </td></tr><tr><td> <code class="notranslate">make nconfig</code> </td><td> komfortablere <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/ncurses">ncurses</a>-basierte Oberfläche ab Kernel 2.6.35 </td><td> <strong>libncurses5-dev</strong> </td></tr><tr><td> <code class="notranslate">make config</code> </td><td> Zeilen-orientierte Oberfläche für die Konsole welche ohne zusätzliche Abhängigkeiten auskommt </td><td> </td></tr></table><p>Nach dem Beenden der Konfiguration kann, wie im <a class="crosslink" href="#Bauen">Einführungsabschnitt</a> beschrieben, der build-Prozess angestoßen werden.</p><p>Weitere Infos und Tipps zu <strong>make</strong> sind im Abschnitt <a class="crosslink" href="#Tipps-zu-make">Tipps zu make</a> zu finden.</p></div></div><div class="section_1"><h2 id="Tipps-und-Hintergrundinfos">Tipps und Hintergrundinfos<a class="headerlink" href="#Tipps-und-Hintergrundinfos">¶</a></h2><p>
</p><div class="section_2"><h3 id="root-und-fakeroot">root und fakeroot<a class="headerlink" href="#root-und-fakeroot">¶</a></h3><p>
In Foren und einigen Kernelbau-Anleitungen hält sich immer noch die Meinung, man müsse den Kernel als <a class="internal" href="../sudo.html">root</a> oder mit <code class="notranslate">fakeroot</code> bauen. Für keinen der in diesem Artikel beschriebenen Schritte sind <a class="internal" href="../sudo.html">root-Rechte</a> erforderlich! Bei Ausnahmen wird dieses explizit erwähnt. Auch die Verwendung des Kommandos <code class="notranslate">fakeroot</code> oder der <code class="notranslate">make-kpkg</code>-Option <code class="notranslate">--rootcmd</code> ist für diese Schritte nicht erforderlich. Die manpage zu <code class="notranslate">make-kpkg</code> ist hierzu leider nicht mehr aktuell (<a class="external" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=704116" rel="nofollow">BugReport</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>).
Nur zur Installation des selbstgebauten Kernels als deb-Paket werden root-Rechte benötigt.
Aus Sicherheitsgründen sollte der Kernel immer als einfacher Benutzer ohne root-Rechte gebaut werden.</p></div><div class="section_2"><h3 id="schnelleres-Bauen">schnelleres Bauen<a class="headerlink" href="#schnelleres-Bauen">¶</a></h3><p>
Auf Multikern- und Multiprozessorsystemen kann <code class="notranslate">make-kpkg</code> die Option <code class="notranslate">-j</code> und einer folgenden Nummer mitgegeben werden. Diese Option legt fest, wie viele Jobs <code class="notranslate">make-kpkg</code> gleichzeitig laufen lässt. Als Wert wird hier die Anzahl der Prozessorkerne bzw. bei Hyperthreading-Systemen die zweifache Anzahl empfohlen.</p><p>Die Anzahl der vorhandenen CPUs lässt sich mit folgendem Befehl ermitteln:
</p><div class="bash"><div class="contents"><pre class="notranslate">lscpu </pre></div></div><p>
Mit folgendem Befehl kann man herausfinden, ob Hyperthreading genutzt wird:
</p><div class="bash"><div class="contents"><pre class="notranslate">if [ "$(grep -c processor /proc/cpuinfo)" -gt "$(grep "cores" /proc/cpuinfo | grep -o "[[:digit:]]" | uniq)" ]; then echo "Hyperthreading aktiviert"; else echo "Kein Hyperthreading"; fi </pre></div></div><p>Hat man zum Beispiel einen Computer mit 6 Kernen und Hyperthreading ( = 12 parallele Jobs), so kann der Befehl wie folgt lauten:
</p><div class="bash"><div class="contents"><pre class="notranslate">make-kpkg -j12 --append-to-version +text-zum-kernel+ --initrd buildpackage </pre></div></div></div><div class="section_2"><h3 id="ohne-initial-ramdisk">ohne initial ramdisk<a class="headerlink" href="#ohne-initial-ramdisk">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ohne initial ramdisk wird das System unter Umständen nicht mehr starten und sollte daher nur unter ganz bestimmten Umständen weggelassen werden.
</p></div></div><p>Der Begriff <strong>initrd</strong> wird im Bereich der aktuellen Linux-Varianten als Synonym für <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/initramfs">initramfs</a> verwendet. Ältere Linux-Varianten verwendeten noch <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/initrd">initrd</a>. Bei beiden Techniken handelt es sich um eine sogenannte "Inital RAM-Disc". Es ist ein temporäres Dateisystem im Arbeitsspeicher und beinhaltet Treiber und Dienstprogramme, welche während des <a class="internal" href="../bootvorgang.html">Bootprozess</a> benötigt werden, um den eigentlichen Kernel zu laden.</p><p>Um diesen Schritt auszulassen ist es notwendig die Treiber bzw. Module für das Root-Dateisystem und den eigenen Festplattenkontroller fest in den Kernel einzukompilieren. Dann kann die Option <code class="notranslate">--initrd</code> beim Aufruf von <code class="notranslate">make-kpkg</code> weggelassen werden. Herauszufinden, welche Module hier notwendig sind ist sehr komplex und wird daher an dieser Stelle nicht weiter erläutert.</p></div><div class="section_2"><h3 id="Kernelbezeichnung-erweitern">Kernelbezeichnung erweitern<a class="headerlink" href="#Kernelbezeichnung-erweitern">¶</a></h3><p>
Mit der <code class="notranslate">make-kpkg</code>-Option <code class="notranslate">--append-to-version</code> ist es möglich der Bezeichnung des selbstgebauten Kernels eine eigene Information hinzuzufügen.</p><div class="bash"><div class="contents"><pre class="notranslate">make-kpkg --append-to-version +12+ --initrd buildpackage </pre></div></div><p>Diese Bezeichnung wirkt sich beispielsweise auf die erzeugten deb-Pakete und die Einträge im Boot-Menü aus.</p><pre class="notranslate">linux-image-3.5.7.7_3.5.7.7-10.00.Custom_i386.deb</pre><p>wird zu</p><pre class="notranslate">linux-image-3.5.7.7+12+_3.5.7.7-10.00.Custom_i386.deb</pre></div><div class="section_2"><h3 id="Kernelgroesse-pruefen">Kernelgröße prüfen<a class="headerlink" href="#Kernelgroesse-pruefen">¶</a></h3><p>
Um zu überprüfen, ob der selbstgebaute Kernel größer oder kleiner als der alte ist, schaut man sich im Verzeichnis  <strong>/boot/</strong> die installierten Kernel-Abbilder an. Diese Dateien beginnen mit <strong>vmlinuz</strong>.</p></div><div class="section_2"><h3 id="Tipps-zu-make">Tipps zu make<a class="headerlink" href="#Tipps-zu-make">¶</a></h3><p>
</p><ul><li><p>Es empfiehlt sich, ein Backup der Konfiguration außerhalb des Quellcode-Verzeichnisses anzulegen, z.B.: </p><div class="bash"><div class="contents"><pre class="notranslate">cp .config ../config.variante </pre></div></div></li><li><p>Eine Liste aller verfügbaren Make-Kommandos erhält man mit </p><div class="bash"><div class="contents"><pre class="notranslate">make help </pre></div></div></li><li><p>Weitere Informationen über die Kommandos zum Konfigurieren des Linux Kernels findet man in den Kernel-Quellen in der Datei <strong>Documentation/kbuild/kconfig.txt</strong>.</p></li></ul><p>
</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/Kernel/Compile">Kernel/Compile</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Original Ubuntu-Kernel mit eigenen Änderungen selbst kompilieren</p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/Kernel/BuildYourOwnKernel">BuildYourOwnKernel</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/CustomRestrictedModules">CustomRestrictedModules</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - restricted-modules selbst bauen</p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/KernelCustomBuild">KernelCustomBuild</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Fragen und Antworten zur Kernel-Kompilierung</p></li><li><p><a class="interwiki interwiki-ubuntu" href="https://wiki.ubuntu.com/KernelTeam/KernelGitGuide">KernelGitGuide</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Einführung in Git für den Kernel</p></li></ul><p>
</p><ul><li><p><a class="external" href="http://debian-handbook.info/browse/de-DE/stable/" rel="nofollow">Das Debian Administrationshandbuch</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p><ul><li><p><a class="external" href="http://debian-handbook.info/browse/de-DE/stable/sect.kernel-compilation.html" rel="nofollow">Kapitel 8.10. Einen Kernel kompilieren</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul></li><li><p><a class="interwiki interwiki-heise" href="https://www.heise.de/-1402386">Linux-Kernel maßgeschneidert</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Nutzung von localmodconfig</p></li><li><p><a class="external" href="http://kernel.org/" rel="nofollow">kernel.org: The Linux Kernel Archives</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://kernelnewbies.org/" rel="nofollow">Kernelnewbies Wiki</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.kroah.com/lkn/" rel="nofollow">Linux Kernel in a Nutshell</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - kostenloses und freies Ebook über das Konfigurieren und Kompilieren des Kernels</p></li><li><p><a class="external" href="http://kernel-seeds.org/settings-00.html" rel="nofollow">Kernel-Seeds.org</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - (unvollständige) Zusammenfassung der Kerneloptionen</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../kernel/kompilierung/a/revision/940607.html">Diese Revision</a> wurde am 8. Mai 2017 23:34 von <a href="https://ubuntuusers.de/user/ubot/">ubot</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../kernel.html">Kernel</a></li>
<li><a href="../kernel/kompilierung.html">Kompilierung</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>