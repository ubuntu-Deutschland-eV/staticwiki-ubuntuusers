<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>SQLAlchemy › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./sqlalchemy.html">SQLAlchemy</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/SQLAlchemy">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./sqlalchemy/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./sqlalchemy/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./sqlalchemy/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./sqlalchemy/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./sqlalchemy/a/backlinks.html">SQLAlchemy</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Einen Terminal öffnen</a></p></li></ol></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Alternative-Installation">Alternative Installation
</a></li><li><a class="crosslink" href="#Datenbankanbindung-installieren">Datenbankanbindung installieren
</a></li></ol></li><li><a class="crosslink" href="#Benutzung">Benutzung
</a><ol class="arabic"><li><a class="crosslink" href="#Engine">Engine
</a></li><li><a class="crosslink" href="#Tabellen-anlegen-und-Metadaten">Tabellen anlegen und Metadaten
</a></li><li><a class="crosslink" href="#SQL-Expression-Language">SQL Expression Language
</a></li><li><a class="crosslink" href="#ORM">ORM
</a></li><li><a class="crosslink" href="#Weitere-Dokumentation">Weitere Dokumentation
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="sa_logo.gif" class="image-left" src="./_/ab62f5aeabae48aea520fd085bce66ef4e11adc9.gif"/>
<a class="external" href="http://www.sqlalchemy.org/" rel="nofollow">SQLAlchemy</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Objektrelationale_Abbildung">Objekt-relationaler Mapper</a> (ORM) und eine SQL-Werkzeugsammlung für <a class="internal" href="./python.html">Python</a>.</p><p>SQLAlchemy legt sich dabei als Zwischenschicht zwischen die Anwendung und die relationale Datenbank. Der Vorteil ist dabei, dass sich via SQLAlchemy alle unterstützten Datenbanken einheitlich ansprechen lassen, da die Unterschiede in den SQL-Dialekten durch das Programm „ausgeglichen“ werden. Das ORM-Modul gilt als extrem leistungsfähig und ermöglicht auch komplexe „Mappings“ zwischen einer Datenbank und Python-Objekten.</p><p>SQLAlchemy unterstützt eine Reihe von relationalen Datenbanken, wie z.B. <a class="internal" href="./sqlite.html">SQLite</a>, <a class="internal" href="./mysql.html">MySQL</a> und <a class="internal" href="./postgresql.html">PostgreSQL</a> aus dem OpenSource Lager, aber auch proprietäre Datenbanken wie Orcale und MS SQL Server finden Unterstützung. Da die Anzahl der unterstützten Datenbanken in der Regel mit jeder Hauptversion von SQLAlchemy steigt, sollte man für weitere Details die jeweilige <a class="crosslink" href="#weitere-Dokumentation">Dokumentation</a> lesen.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
SQLAlchemy ist in den Paketquellen enthalten und für kann Python 3 über</p><ul><li><p><strong>python3-sqlalchemy</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install python3-sqlalchemy </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install python3-sqlalchemy </pre></div></div><p>
</p></div></div><p>bzw. für Python 2.7:</p><ul><li><p><strong>python-sqlalchemy</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install python-sqlalchemy </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install python-sqlalchemy </pre></div></div><p>
</p></div></div><p>installiert werden<sup><a href="#source-1">[1]</a></sup>.</p><p>Optional kann man auch die jeweils passende Dokumentation mit installieren:</p><ul><li><p><strong>python3-sqlalchemy-doc</strong> (<em>universe</em> (für Python 3))</p></li><li><p><strong>python-sqlalchemy-doc</strong> (<em>universe</em> (für Python 2))</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install python3-sqlalchemy-doc python-sqlalchemy-doc </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install python3-sqlalchemy-doc python-sqlalchemy-doc </pre></div></div><p>
</p></div></div><div class="section_2"><h3 id="Alternative-Installation">Alternative Installation<a class="headerlink" href="#Alternative-Installation">¶</a></h3><p>
Da die Version aus den Paketquellen nicht unbedingt die neuste ist bzw. nicht unbedingt die neuste „Unterversion“ ist, so dass unter Umständen Fehlerkorrekturen fehlen, kann man SQLAlchemy alternativ auch über <a class="internal" href="./pip.html">pip</a> installieren.</p></div><div class="section_2"><h3 id="Datenbankanbindung-installieren">Datenbankanbindung installieren<a class="headerlink" href="#Datenbankanbindung-installieren">¶</a></h3><p>
Egal ob man SQLAlchemy über die Paketquellen oder manuell installiert - die entsprechenden Python-Module für die diversen Datenbanken müssen immer nachträglich installiert werden.</p><p>Die Anbindung an SQLite ist seit Python 2.5. - und damit bei allen unterstützen Ubuntu-Versionen - in Python selbst enthalten, so dass hier keine weitere Installation notwendig ist.</p><p>Ansonsten muss man eines oder mehrere der folgenden Pakete nachinstallieren:</p><ul><li><p>für MySQL benötigt man das Paket <strong>python-mysqldb</strong>.</p></li><li><p>für PostgreSQL benötigt man eines der folgenden Pakete: <strong>python-psycopg2</strong></p></li><li><p>für MS SQLServer und Sybase: <strong>python-pymssql</strong> (<em>universe</em>)</p></li></ul><p>
Weitere mögliche Treiber, welche vielleicht nicht in den Ubuntu-Quellen zu finden sind, listet die Seite <a class="external" href="http://www.sqlalchemy.org/docs/core/engines.html#supported-dbapis" rel="nofollow">Supported DB-APIs</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> auf.</p></div></div><div class="section_1"><h2 id="Benutzung">Benutzung<a class="headerlink" href="#Benutzung">¶</a></h2><p>
Wie in der Einleitung bereits erwähnt besteht SQLAlchemy aus mehreren Komponenten, die unabhängig von einander genutzt werden können. Man kann also z.B. auch „nur“ eine „Engine“ oder die „SQL Expression Language“ benutzen, ohne den kompletten ORM importieren zu müssen.</p><p>Alle folgenden Befehle können direkt in der interaktiven Python-Konsole ausgeführt werden, welche man durch den Aufruf von</p><div class="bash"><div class="contents"><pre class="notranslate">python3 </pre></div></div><p>im Terminal öffnet<sup><a href="#source-2">[2]</a></sup>.</p><div class="section_2"><h3 id="Engine">Engine<a class="headerlink" href="#Engine">¶</a></h3><p>
Die <a class="external" href="http://www.sqlalchemy.org/docs/core/connections.html" rel="nofollow">Engine</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>, also die Anbindung an die Datenbank an sich, stellt mit die unterste Ebene der Benutzerschnittstelle von SQLAlchemy dar. Der Vorteil gegenüber einer „gewöhnlichen“ Verbindung ist, dass die Verbindung über SQLAlchemy je nach Notwendigkeit automatisch auf- und abgebaut wird und direkt auch ein Cursor-ähnliches Objekt zur Datenabfrage bereit stellt. Ebenso verwaltet SQLAlchemy automatisch mehrere Verbindungen zu einer Datenbank über den sogenannten „Connection Pool“.</p><p>Die Datenbank wird immer gemäß einem URL-ähnlichen Schema angegeben, das wie folgt aussieht:</p><pre class="notranslate">DATENBANK://NUTZER:PASSWORD@SERVER:PORT/DATENBANKNAME</pre><p>Der Port ist optional und kann weggelassen werden, so lang die Datenbank auf deren Standardport läuft.</p><p>Will sich der Benutzer <code class="notranslate">otto</code> mit dem Passwort <code class="notranslate">normal</code> also z.B. mit einem lokalen MySQL Datenbankserver und der Datenbank Namens <code class="notranslate">test</code> verbinden, so sieht dies so aus:</p><pre class="notranslate">mysql://otto:normal@localhost/test</pre><p>Eine kleine Abweichung gibt es bei SQLite, da SQLite keine Benutzerverwaltung in dieser Form kennt und die Datenbank immer als lokale Datei vorliegt:</p><pre class="notranslate">sqlite:///meine_db.db             #relativer Pfad
sqlite:////pfad/zu/meine_db.db    #absoluter Pfad
sqlite://                         #keine Angaben = In-Memory Datenbank</pre><p>Die Anbindung wird via SQLAlchemy so erzeugt:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'sqlite:///test.db'</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>Natürlich kennt <code class="notranslate">create_engine</code> eine Vielzahl von Optionen und Parametern. Erwähnt werden soll hier aber nur <code class="notranslate">echo=True</code>. Damit gibt sich SQLAlchemy besonders geschwätzig und gibt z.B. alle generierten SQL-Befehle auf Stdout, also in der Regel der Konsole, aus.</p><p>Nun kann über die Execute-Funktion ein SQL-Query abgesetzt werden, z.B.:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ergebnis</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT foo FROM bar WHERE spam = 'egg'"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">erg</span> <span class="ow">in</span> <span class="n">ergebnis</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">erg</span><span class="p">)</span>

<span class="go">(Ausgabe der Ergebnisse)</span>
</pre></div>
</td></tr></table></div></div><div class="section_2"><h3 id="Tabellen-anlegen-und-Metadaten">Tabellen anlegen und Metadaten<a class="headerlink" href="#Tabellen-anlegen-und-Metadaten">¶</a></h3><p>
Egal ob man später das ORM-Modul oder die SQL Expression Language benutzen möchte, das Anlegen von Tabellen erfolgt in beiden Fällen gleich. Dazu speichert das Programm Daten, Schemen etc. zu Tabellen mit Hilfe sogenannter <a class="external" href="http://www.sqlalchemy.org/docs/core/schema.html#describing-databases-with-metadata" rel="nofollow">database metadata</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p><p>Im folgenden Beispiel werden die notwendigen Importe durchgeführt, im aktuellen Verzeichnis die SQLite Datenbanknamens <strong>uude.de</strong> angelegt, die Metadaten an die Engine gebunden und dann eine einfache Tabelle Namens "programme" angelegt, welche aus drei Spalten besteht:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span><span class="p">,</span> <span class="n">MetaData</span><span class="p">,</span> <span class="n">Table</span><span class="p">,</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'sqlite:///uude.db'</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span> <span class="o">=</span> <span class="n">MetaData</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span><span class="o">.</span><span class="n">bind</span> <span class="o">=</span> <span class="n">engine</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tab</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">'programme'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
<span class="gp">... </span><span class="n">Column</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span>
<span class="gp">... </span><span class="n">Column</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span>
<span class="gp">... </span><span class="n">Column</span><span class="p">(</span><span class="s1">'desktop'</span><span class="p">,</span><span class="n">String</span><span class="p">(</span><span class="mi">10</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
<span class="go">2016-05-22 14:55:26,465 INFO sqlalchemy.engine.base.Engine PRAGMA table_info("programme")</span>
<span class="go">2016-05-22 14:55:26,465 INFO sqlalchemy.engine.base.Engine ()</span>
<span class="go">2016-05-22 14:55:26,466 INFO sqlalchemy.engine.base.Engine </span>
<span class="go">CREATE TABLE programme (</span>
<span class="go">	id INTEGER NOT NULL, </span>
<span class="go">	name VARCHAR(20), </span>
<span class="go">	desktop VARCHAR(10), </span>
<span class="go">	PRIMARY KEY (id)</span>
<span class="go">)</span>


<span class="go">2016-05-22 14:55:26,466 INFO sqlalchemy.engine.base.Engine ()</span>
<span class="go">2016-05-22 14:55:26,476 INFO sqlalchemy.engine.base.Engine COMMIT</span>
</pre></div>
</td></tr></table></div><p>Wie man sieht gibt SQLAlchemy durch das Parameter <code class="notranslate">echo=True</code> die abgesetzten SQL-Befehle in der Konsole aus. Der Befehl <code class="notranslate">metadata.create_all()</code> legt dabei letztendlich die Tabelle an. Per Voreinstellung wird dabei immer zuerst automatisch geprüft, ob die Tabelle existiert, d.h. bestehende Daten werden nie gelöscht.</p><p>SQLAlchemy bietet auch die Möglichkeit, eine existierende Tabelle in die Metadaten zu übernehmen. Angenommen, in der gleichen Datenbank gäbe es bereits eine Tabelle "distributionen". Dann würde der Befehl</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tab2</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">'distributionen'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div><p>diese automatisch <code class="notranslate">tab2</code> zuordnen.</p><p>Nach dem Anlegen von Metadaten bzw. der Zuordnung zu einer Variablen sind die einzelnen Spalten einer Datenbank direkt ansprechbar. Im Falle der Tabelle "tab" und der Spalte "id" zum Beispiel so:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">id</span>
<span class="go">Column('id', Integer(), table=&lt;programme&gt;, primary_key=True, nullable=False)</span>
</pre></div>
</td></tr></table></div><p>Das <code class="notranslate">c</code> ist dabei die Kurzform für "Column".</p></div><div class="section_2"><h3 id="SQL-Expression-Language">SQL Expression Language<a class="headerlink" href="#SQL-Expression-Language">¶</a></h3><p>
Die <a class="external" href="http://www.sqlalchemy.org/docs/core/tutorial.html" rel="nofollow">SQL Expression Language</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist, vereinfacht ausgedrückt, die „pythonische“ Variante von SQL. Das heißt es gibt diverse Python-Klassen und Funktionen, die die üblichen SQL-Befehl darstellen. Dies wird im folgenden anhand einiger kurzer Beispiele gezeigt.</p><p>Ausgehend von der <a class="crosslink" href="#Tabellen-anlegen-und-MetaData">weiter oben</a> angelegten Tabelle wird diese mit ein paar Datensätzen befüllt:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ergebnis</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Gedit'</span><span class="p">,</span> <span class="n">desktop</span><span class="o">=</span><span class="s1">'GNOME'</span><span class="p">)</span>
<span class="go">2016-05-22 14:57:47,165 INFO sqlalchemy.engine.base.Engine INSERT INTO programme (name, desktop) VALUES (?, ?)</span>
<span class="go">2016-05-22 14:57:47,165 INFO sqlalchemy.engine.base.Engine ('Gedit', 'GNOME')</span>
<span class="go">2016-05-22 14:57:47,165 INFO sqlalchemy.engine.base.Engine COMMIT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Kate'</span><span class="p">,</span> <span class="n">desktop</span><span class="o">=</span><span class="s1">'KDE'</span><span class="p">)</span>
<span class="go">2016-05-22 14:58:12,056 INFO sqlalchemy.engine.base.Engine INSERT INTO programme (name, desktop) VALUES (?, ?)</span>
<span class="go">2016-05-22 14:58:12,056 INFO sqlalchemy.engine.base.Engine ('Kate', 'KDE')</span>
<span class="go">2016-05-22 14:58:12,057 INFO sqlalchemy.engine.base.Engine COMMIT</span>
<span class="go">&lt;sqlalchemy.engine.result.ResultProxy object at 0x7f1212641c90&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">insert</span><span class="p">(),</span> <span class="p">[</span>
<span class="gp">... </span><span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Evolution'</span><span class="p">,</span> <span class="s1">'desktop'</span><span class="p">:</span> <span class="s1">'GNOME'</span><span class="p">},</span>
<span class="gp">... </span><span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="s1">'KOffice'</span><span class="p">,</span> <span class="s1">'desktop'</span><span class="p">:</span> <span class="s1">'KDE'</span><span class="p">},</span>
<span class="gp">... </span><span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Thunar'</span><span class="p">,</span> <span class="s1">'desktop'</span><span class="p">:</span> <span class="s1">'Xfce'</span><span class="p">}])</span>
<span class="go">2016-05-22 14:59:13,295 INFO sqlalchemy.engine.base.Engine INSERT INTO programme (name, desktop) VALUES (?, ?)</span>
<span class="go">2016-05-22 14:59:13,295 INFO sqlalchemy.engine.base.Engine (('Evolution', 'GNOME'), ('KOffice', 'KDE'), ('Thunar', 'Xfce'))</span>
<span class="go">2016-05-22 14:59:13,295 INFO sqlalchemy.engine.base.Engine COMMIT</span>
<span class="go">&lt;sqlalchemy.engine.result.ResultProxy object at 0x7f1212641f50&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</td></tr></table></div><p>Wie man sieht kennt SQLAlchemy sowohl die explizite (mit <code class="notranslate">connection</code>) und implizite (ohne <code class="notranslate">connection</code>) Ausführung von Befehlen, ebenso kann das Ergebnis, der sogenannte "ResultProxy" einer Variablen zugeordnet werden, wie im ersten Befehl. Außerdem ist zu sehen, dass SQLAlchemy standardmäßig im „Auto-Commit“ Modus arbeitet, bei dem Befehle direkt in der Datenbank ausgeführt werden. Dieses Verhalten lässt sich natürlich durch das Setzen der entsprechenden Option ändern.</p><p>Da die Datenbank nun ein wenig Inhalt erhalten hat, können auch Abfragen durchgeführt werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">desktop</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ergebnis</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="go">2016-05-22 15:00:07,716 INFO sqlalchemy.engine.base.Engine SELECT programme.name, programme.desktop </span>
<span class="go">FROM programme</span>
<span class="go">2016-05-22 15:00:07,716 INFO sqlalchemy.engine.base.Engine ()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">erg</span> <span class="ow">in</span> <span class="n">ergebnis</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">erg</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span> <span class="n">erg</span><span class="p">[</span><span class="s1">'desktop'</span><span class="p">])</span>
<span class="gp">... </span>
<span class="go">Gedit GNOME</span>
<span class="go">Kate KDE</span>
<span class="go">Evolution GNOME</span>
<span class="go">KOffice KDE</span>
<span class="go">Thunar Xfce</span>

<span class="go">#nur GNOME Programme wählen:</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">select</span><span class="p">([</span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">desktop</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">desktop</span> <span class="o">==</span> <span class="s1">'GNOME'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">engine</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="go">2016-05-22 15:01:18,970 INFO sqlalchemy.engine.base.Engine SELECT programme.name, programme.desktop </span>
<span class="go">FROM programme </span>
<span class="go">WHERE programme.desktop = ?</span>
<span class="go">2016-05-22 15:01:18,970 INFO sqlalchemy.engine.base.Engine ('GNOME',)</span>
<span class="go">[(u'Gedit', u'GNOME'), (u'Evolution', u'GNOME')]</span>
</pre></div>
</td></tr></table></div><p>Die Beispiele stellen natürlich nur einen Bruchteil der Funktionalität und Leistungsfähigkeit der SQL Expression Language dar. Viele weitere Beispiele findet man in der weiter oben verlinkten Dokumenation bzw. in dem dort befindlichen Tutorial.</p></div><div class="section_2"><h3 id="ORM">ORM<a class="headerlink" href="#ORM">¶</a></h3><p>
Der Objekt-Relationale Mapper von SQLAlchemy ist eines der leistungsfähigsten Module. Mit seiner Hilfe können Tabellen (bzw. Spalten) von relationalen Datenbanken auf ein Python Objekt bzw. eine Python Klasse „gemappt“ d.h. abgebildet werden. Eine <a class="external" href="http://www.sqlalchemy.org/docs/orm/tutorial.html" rel="nofollow">grundlegenden Einführung</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> in den ORM findet man in der Dokumentation.</p><p>Das Arbeiten mit dem ORM erfolgt grundsätzlich in drei Schritten:
</p><ol class="arabic"><li><p>als erstes wird ein <a class="external" href="http://www.sqlalchemy.org/docs/orm/mapper_config.html" rel="nofollow">Mapper angelegt</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p>dann wird eine sogenannte <a class="external" href="http://www.sqlalchemy.org/docs/orm/session.html" rel="nofollow">Session gestartet</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p>nun können Abfrage gemacht werden, Einträge angelegt werden etc.</p></li></ol><p>
Im folgenden Beispiel wird ein sehr einfaches Mapping angelegt. Der Mapper von SQLAlchemy ist wesentlich leistungsfähiger und unterstützt unter anderem auch Relationen, Rückwärtsreferenzen, Joins, Vererbung etc.</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Programme</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">mapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mapper</span><span class="p">(</span><span class="n">Programme</span><span class="p">,</span> <span class="n">tab</span><span class="p">)</span>
<span class="go">&lt;Mapper at 0x7f1212641850; Programme&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neues_programm</span> <span class="o">=</span> <span class="n">Programme</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neues_programm</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Totem'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neues_programm</span><span class="o">.</span><span class="n">desktop</span> <span class="o">=</span> <span class="s1">'GNOME'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neues_programm</span><span class="o">.</span><span class="n">desktop</span>
<span class="go">'GNOME'</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">neues_programm</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="go">2016-05-22 15:04:11,216 INFO sqlalchemy.engine.base.Engine BEGIN (implicit)</span>
<span class="go">2016-05-22 15:04:11,216 INFO sqlalchemy.engine.base.Engine INSERT INTO programme (name, desktop) VALUES (?, ?)</span>
<span class="go">2016-05-22 15:04:11,216 INFO sqlalchemy.engine.base.Engine ('Totem', 'GNOME')</span>
<span class="go">2016-05-22 15:04:11,217 INFO sqlalchemy.engine.base.Engine COMMIT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">neues_programm</span><span class="o">.</span><span class="n">id</span>
<span class="go">2016-05-22 15:04:57,923 INFO sqlalchemy.engine.base.Engine BEGIN (implicit)</span>
<span class="go">2016-05-22 15:04:57,924 INFO sqlalchemy.engine.base.Engine SELECT programme.id AS programme_id, programme.name AS programme_name, programme.desktop AS programme_desktop </span>
<span class="go">FROM programme </span>
<span class="go">WHERE programme.id = ?</span>
<span class="go">2016-05-22 15:04:57,924 INFO sqlalchemy.engine.base.Engine (6,)</span>
<span class="go">6</span>
</pre></div>
</td></tr></table></div><p>Wie man sieht reicht es, für das Mapping eine leere Klasse anzulegen. Aber natürlich kann man auch das sonst notwendige <code class="notranslate">__init__</code> definieren sowie weitere Funktionen in der Klasse anlegen.</p><p>Abfragen sind so auch möglich:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ergebnis</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Programme</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Programme</span><span class="o">.</span><span class="n">desktop</span> <span class="o">==</span> <span class="s1">'GNOME'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">erg</span> <span class="ow">in</span> <span class="n">ergebnis</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">erg</span><span class="p">)</span>
<span class="gp">... </span>
<span class="go">2016-05-22 15:05:39,091 INFO sqlalchemy.engine.base.Engine SELECT programme.name AS programme_name </span>
<span class="go">FROM programme </span>
<span class="go">WHERE programme.desktop = ?</span>
<span class="go">2016-05-22 15:05:39,091 INFO sqlalchemy.engine.base.Engine ('GNOME',)</span>
<span class="go">(u'Gedit',)</span>
<span class="go">(u'Evolution',)</span>
<span class="go">(u'Totem',)</span>
</pre></div>
</td></tr></table></div><p>Weitere Informationen zu <a class="external" href="http://www.sqlalchemy.org/docs/orm/query.html" rel="nofollow">Abfragen via ORM</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> findet man in der Dokumentation.</p></div><div class="section_2"><h3 id="Weitere-Dokumentation">Weitere Dokumentation<a class="headerlink" href="#Weitere-Dokumentation">¶</a></h3><p>
Alle obigen Beispiele zeigen nur einige wenige Grundlagen von SQLAlchemy. Wer sich näher mit SQLAlchemy beschäftigen möchte, dem sei die sehr gute und ausführliche, offizielle <a class="external" href="http://www.sqlalchemy.org/docs/" rel="nofollow">Dokumentaion</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> empfohlen, welche zwei Tutorials, viele Detailinformationen und Beispiele sowie eine umfassende API-Referenz bietet.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.mapfish.org/doc/tutorials/sqlalchemy.html" rel="nofollow">Einsteiger-taugliches Tutorial</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.rmunn.com/sqlalchemy-tutorial/tutorial.html" rel="nofollow">Ausführlicheres Tutorial</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>, greift auch ein paar fortgeschrittene Themen auf</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./sqlalchemy/a/revision/939993.html">Diese Revision</a> wurde am 6. Mai 2017 18:51 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./sqlalchemy.html">SQLAlchemy</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>