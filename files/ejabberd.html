<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>ejabberd › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./ejabberd.html">ejabberd</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/ejabberd">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./ejabberd/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./ejabberd/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./ejabberd/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./ejabberd/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./ejabberd/a/backlinks.html">ejabberd</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Ausbaufähige Anleitung</h3><div class="contents"><p>
Dieser Anleitung fehlen noch einige Informationen. Wenn Du etwas
verbessern kannst, dann editiere den Beitrag, um die Qualität
des Wikis noch weiter zu verbessern.
</p><hr/><p><strong>Anmerkung:</strong> Die Installation aus den offiziellen Paketquellen müsste überprüft werden. Aber auch die manuelle Installation über den Universal-Installer scheint nicht unproblematisch zu sein (siehe <a class="crosslink post" href="https://forum.ubuntuusers.de/post/6240542/">Diskussion</a>).
</p></div></div><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./paketquellen_freischalten.html">Bearbeiten von Paketquellen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./dienste.html">Serverdienste starten/stoppen</a> </p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="./rechte.html">Rechte für Dateien und Ordner ändern</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a></li><li><a class="crosslink" href="#Internetanbindung">Internetanbindung
</a></li><li><a class="crosslink" href="#Administration">Administration
</a></li><li><a class="crosslink" href="#Alternative-Installation-Universal-Installer">Alternative Installation: Universal-Instal...</a></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="./ejabberd_logo.png" class="image-left" src="./_/867490ca4e66b20031e4be9c778e6d02afd43f72.png"/>
<a class="external" href="http://www.process-one.net/en/ejabberd/" rel="nofollow">Ejabberd</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist einer der am weitesten verbreiteten <a class="internal" href="./xmpp.html">XMPP</a>-Server im Open-Source-Bereich, obwohl er in der ziemlich exotischen Sprache <a class="internal" href="./erlang.html">Erlang</a> geschrieben ist. U.a. setzt sowohl die <a class="external" href="http://jabber.org" rel="nofollow">Jabber-Foundation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> als auch der deutsche Freemail-Anbieter GMX früher auf diese Serversoftware, weil sie auch unter hohen Anforderungen zuverlässig arbeitet. Aber auch für einen kleinen privaten Server eignet sich der ejabberd gut, weil er (meist) ziemlich problemlos einzurichten ist.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Um den Serverdienst zu installieren, reicht es zunächst aus, folgendes Paket inkl. aller Abhängigkeiten zu installieren <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>ejabberd</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install ejabberd </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install ejabberd </pre></div></div><p>
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Das Einzige, worauf man dabei achten sollte ist, dass nur die wirklichen Abhängigkeiten mit installiert werden und nicht alle "empfohlenen" Pakete, denn sonst werden einem auch auf einem Server schnell mal die ganzen X11-Bibliotheken auf die Platte gebracht. Man sollte also genau hinschauen und bei Bedarf die Option <code class="notranslate">--no-install-recommends</code> im Installationsbefehl nutzen. 
</p></div></div><p><a class="crosslink anchor" href="#Konfiguration" id="Konfiguration"></a>
</p></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Um mit dem Server dann auch etwas anfangen zu können, muss man ihn noch kurz konfigurieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo dpkg-reconfigure ejabberd </pre></div></div><p>Als erstes wird man nach dem Namen des Servers gefragt. Dieser muss inkl. der Domain eingegeben werden und der Rechner muss auch über das <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Domain_Name_System">DNS-System</a> unter diesem Namen bekannt sein.</p><p>Als nächstes wird nach einer Admin-ID gefragt. Dabei handelt es sich um eine <a class="internal" href="./xmpp.html#Funktionsweise">Jabber-ID</a> (JID), der administrative Rechte eingeräumt werden. Mit dieser JID kann man sich dann später auch über einen XMPP-Client einloggen. Der Domainteil der JID darf nicht mit angegeben werden, da er ja schon in der vorherigen Frage angegeben wurde.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Sollte ein Fehler wie dieser auftreten:
</p><pre class="notranslate">Can't register admin user "[EMAIL PROTECTED].
Probably ejabberd is configured for serving another hostname.</pre><p>kann Folgendes weiterhelfen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo killall epmd </pre></div></div><p>
</p></div></div><p>Abschließend muss man für diesen Account noch ein Passwort setzen. Damit ist die Konfiguration erstmal fertig und nachdem man den Dienst neu gestartet hat <sup><a href="#source-5">[5]</a></sup>, ist ejabberd einsatzbereit.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/ejabberd restart </pre></div></div></div><div class="section_1"><h2 id="Internetanbindung">Internetanbindung<a class="headerlink" href="#Internetanbindung">¶</a></h2><p>
Damit der Server einwandfrei funktioniert, müssen mindestens folgende TCP-Ports ungefiltert und erreichbar sein: (Nur relevant für Leute, die mit Firewalls und/oder Portforwarding zu tun haben.)</p><ul><li><p><code class="notranslate">5222</code> eingehend, für Client-Verbindungen unverschlüsselt oder TLS-verschlüsselt </p></li><li><p><code class="notranslate">5223</code> eingehend, für SSL-verschlüsselte Clientverbindungen (veraltet) </p></li><li><p><code class="notranslate">5269</code> ein- und ausgehend, für Verbindungen zu anderen Servern </p></li><li><p><code class="notranslate">5280</code> eingehend, für Client-Verbindungen über HTTP-Polling (nützlich für Webapplikationen) </p></li></ul><p>Für einen internen Server ohne Kontakt zu anderen kann man letzteren natürlich auch weglassen.</p></div><div class="section_1"><h2 id="Administration">Administration<a class="headerlink" href="#Administration">¶</a></h2><p>
</p><div class="section_2"><h3 id="Weboberflaeche">Weboberfläche<a class="headerlink" href="#Weboberflaeche">¶</a></h3><p>
In der Standardkonfiguration bietet ejabberd eine Weboberfläche, die über die URL <code class="notranslate">http://serveradresse:5280/admin/</code> zu erreichen ist. Hier kann man sich über die Admin-JID (diesmal komplett mit Domain) und das Passwort einloggen.</p><p>Die Bedienung ist leider ziemlich unintuitiv, weswegen man abgesehen von den Statistikfunktionen vielleicht besser auf die anderen Möglichkeiten zurückgreift.</p></div><div class="section_2"><h3 id="Konfigurationsdatei">Konfigurationsdatei<a class="headerlink" href="#Konfigurationsdatei">¶</a></h3><p>
Die Datei <strong>/etc/ejabberd/ejabberd.cfg</strong> ist das Herzstück der ejabberd-Konfiguration. Diese ist in Erlang-Syntax geschrieben und sieht deshalb etwas gewöhnungsbedürftig aus. Z.B. werden Kommentare durch ein Prozent-Zeichen eingeleitet. Nach jeder Änderung an dieser Datei <sup><a href="#source-4">[4]</a></sup> muss der ejabberd wiederum neu gestartet werden <sup><a href="#source-5">[5]</a></sup>.</p><div class="section_3"><h4 id="Geschlossener-Benutzerkreis">Geschlossener Benutzerkreis<a class="headerlink" href="#Geschlossener-Benutzerkreis">¶</a></h4><p>
Wer nicht über einen leistungsfähigen Server mit breiter Internetanbindung verfügt, möchte z.B. vielleicht nicht jedem ermöglichen, sich auf dem Server zu registrieren, sondern nur ausgewählten Bekannten/Mitarbeitern/Kunden einen Account zur Verfügung stellen. Dafür muss man nur ein <strong>%</strong>-Zeichen von einer in die andere Zeile setzen:</p><pre class="notranslate">% Every username can be registered via in-band registration:
%{access, register, [{allow, all}]}.

% None username can be registered via in-band registration:
{access, register, [{deny, all}]}.</pre><p>Jetzt kann nur noch der Admin neue Benutzerzugänge anlegen. Die automatische Registrierung über den Jabber-Client schlägt fehl.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>In der <strong>ejabberd-Version 2.1.11</strong>, welche in Ubuntu 14.04 LTS in den Paketquellen enthalten ist, ist die Benutzerregistrierung standardmäßig deaktiviert. Der entsprechende Eintrag lautet hier:
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>%% No username can be registered via in-band registration:
%% To enable in-band registration, replace 'deny' with 'allow'
% (note that if you remove mod_register from modules list then users will not
% be able to change their password as well as register).
% This setting is default because it's more safe.
{access, register, [{deny, all}]}.
|}}
</pre></div>
</td></tr></table></div></div></div></div><div class="section_3"><h4 id="Webkonfiguration-einschraenken">Webkonfiguration einschränken<a class="headerlink" href="#Webkonfiguration-einschraenken">¶</a></h4><p>
Die webbasierte Administrationsoberfläche kann man bei Bedarf auf einen anderen Port legen - der Port 5280 wird ja nebenbei auch für HTTP-Polling benutzt - und auch an eine bestimmte Netzwerkschnittstelle binden, z.B. an die Loopback-Schnittstelle. Dafür einfach die folgende Zeile in der <strong>ejabberd.cfg</strong>-Datei suchen... 
</p><pre class="notranslate">  {5280, ejabberd_http,    [http_poll, web_admin]}</pre><p>... und durch folgende ersetzen:</p><pre class="notranslate">  {5280, ejabberd_http,    [http_poll]},
  {5281, ejabberd_http,    [{ip, {127, 0, 0, 1}}, web_admin]}</pre><p>Dabei besonders auf das Komma achten.</p><div class="section_4"><h5 id="Ab-Ubuntu-14-04-LTS">Ab Ubuntu 14.04 LTS<a class="headerlink" href="#Ab-Ubuntu-14-04-LTS">¶</a></h5><p>
Unter Ubuntu 14.04 LTS sieht die Konfiguration etwas anders aus. Um die webbasierte Administrationsoberfläche zu deaktivieren, sucht man folgenden Codeblock, in der Konfigurationsdatei und kommentiert den Eintrag <code class="notranslate">web_admin</code> aus. Auch hier ist auf die korrekte Kommasetzung zu achten.</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>{5280, ejabberd_http, [
                         %%{request_handlers,
                         %% [
                         %%  {["pub", "archive"], mod_http_fileserver}
                         %% ]},
                         %%captcha,
                         http_bind,
                         http_poll %%,
                         %%web_admin
                        ]}
</pre></div>
</td></tr></table></div><p><a class="crosslink anchor" href="#sasl_anon" id="sasl_anon"></a>
</p></div></div><div class="section_3"><h4 id="Anonymer-Login">Anonymer Login<a class="headerlink" href="#Anonymer-Login">¶</a></h4><p>
Manchmal möchte man bestimmten Clients einen temporären anonymen Zugang zum Server bieten, ohne gleich einen Account mit einem Passwort registrieren zu müssen.</p><p>Dafür bietet der ejabberd zwei verschiedene Protokolle an, nämlich <em>sasl_anon</em> und <em>login_anon</em>. <em>login_anon</em> benötigt keine besondere Unterstützung im Client. Es wird einfach jede JID/Passwort-Kombination akzeptiert, sofern die JID nicht von jemandem fest registriert wurde. <em>sasl_anon</em> ist dagegen ein eigenes Protokoll, mit dessen Hilfe der Server dem Client für die Dauer der Verbindung eine einzigartige, zufällige JID zuweist.</p><p>Obwohl der Server von sich aus darauf achtet, dass kein anonymer Benutzer sich eine real existierende JID von jemand anderem unter den Nagel reißt, sollte man anonyme Logins besser auf einen eigenen virtuellen Server auslagern, um Verwirrung zu vermeiden. Dazu ändert man die <em>hosts</em>-Zeile in der <strong>ejabberd.cfg</strong> ab und fügt einen entsprechenden Servernamen hinzu:</p><pre class="notranslate">{hosts, ["jabber-server.tld", "anonymous.jabber-server.tld"]}.</pre><p>Nun fügt man noch einen host-spezifischen Absatz ein, der die Authentifizierung regelt. (Es gibt schon einen auskommentierten Abschnitt, wo verschiedene <em>host_config</em>-Beispiele vorgestellt werden. An dieser Stelle passen die folgenden Zeilen sehr gut hin.)</p><pre class="notranslate">{
host_config, "anonymous.jabber-server.tld", [{auth_method, anonymous},
                                     {allow_multiple_connections, false},
                                     {anonymous_protocol, sasl_anon}]}.</pre><p>An der Stelle von <em>sasl_anon</em> kann man auch <em>login_anon</em> oder <em>both</em> eintragen, wenn man Clients verwenden will, die <em>sasl_anon</em> nicht unterstützen. In diesem Fall muss man je nach Verwendung evtl. auch <em>allow_multiple_connections</em> auf <em>true</em> setzen.</p></div></div><div class="section_2"><h3 id="Kommandozeilen-Werkzeug">Kommandozeilen-Werkzeug<a class="headerlink" href="#Kommandozeilen-Werkzeug">¶</a></h3><p>
Im laufenden Betrieb benutzt man das Kommandozeilenwerkzeug "<code class="notranslate">ejabberdctl</code>" zur Administration <sup><a href="#source-3">[3]</a></sup>.</p><div class="section_3"><h4 id="Benutzer-registrieren-loeschen">Benutzer registrieren/löschen<a class="headerlink" href="#Benutzer-registrieren-loeschen">¶</a></h4><p>
Wenn man die öffentliche Registrierung von JIDs wie oben beschrieben deaktiviert hat, muss man die Benutzerverwaltung selber übernehmen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ejabberdctl register Benutzername Servername Passwort                        # Benutzer hinzufügen
sudo ejabberdctl unregister Benutzername Servername                               # Benutzer löschen </pre></div></div></div><div class="section_3"><h4 id="Backup-der-Benutzerdatenbank">Backup der Benutzerdatenbank<a class="headerlink" href="#Backup-der-Benutzerdatenbank">¶</a></h4><p>
Mit folgenden Befehlen kann man ein Backup der Benutzerdatenbank anlegen bzw. wiederherstellen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ejabberdctl backup Datei                                  # Sicherung anlegen
sudo ejabberdctl restore Datei                                 # Sicherung wiederherstellen </pre></div></div><p>Folgende Befehle funktionieren auch, benutzen aber auch für Menschen lesbare Dateien:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ejabberdctl dump Datei                                 # Sicherung anlegen
sudo ejabberdctl load Datei                                 # Sicherung wiederherstellen </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wenn man keine absoluten Dateinamen benutzt, findet man die Backup-Dateien im Heimatverzeichnis von ejabberd, <strong>/var/lib/ejabberd</strong>. 
</p></div></div></div><div class="section_3"><h4 id="Daten-Import">Daten-Import<a class="headerlink" href="#Daten-Import">¶</a></h4><p>
Wer vorher einen <strong>jabberd1.4</strong>-Server betrieben hat und jetzt umsteigen möchte, kann einzelne Benutzerdatensätze oder komplette Serversätze in ejabberd importieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ejabberdctl import-file /wo/auch/immer/servername.tld/benutzername.xml                # Benutzer importieren
sudo ejabberdctl import-dir /wo/auch/immer/servername.tld                                  # kompletten Serverdatensatz importieren </pre></div></div></div><div class="section_3"><h4 id="Informationen">Informationen<a class="headerlink" href="#Informationen">¶</a></h4><p>
So erfährt man wie viele Benutzer gerade online sind, welche Benutzer online sind bzw. welche Benutzerkonten überhaupt existieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ejabberdctl connected-users-number
sudo ejabberdctl connected-users
sudo ejabberdctl vhost Servername registered-users   ## oder:
sudo ejabberdctl registered-users Servername         ## in neueren Versionen </pre></div></div><p>Für weitere Kommandos sei auf die <a class="internal" href="./man.html">Manpage</a> von <strong>ejabberdctl</strong> verwiesen.</p><p><a class="crosslink anchor" href="#AltInst" id="AltInst"></a>
</p></div></div></div><div class="section_1"><h2 id="Alternative-Installation-Universal-Installer">Alternative Installation: Universal-Installer<a class="headerlink" href="#Alternative-Installation-Universal-Installer">¶</a></h2><p>
Wer aus irgendwelchen Gründen nicht die ejabberd-Version aus den Ubuntu-Repositories verwenden will - weil er vielleicht den Ärger mit den kaputten Erlang-Paketen von Ubuntu Edgy vermeiden will oder in der allerneuesten Version der Software eine unglaublich praktische Funktion entdeckt hat - kann auf den <a class="external" href="http://www.process-one.net/en/ejabberd/downloads/" rel="nofollow">Universal-Installer des ejabberd-Projektes</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> für alle Linux-Distributionen zurückgreifen, der auch schon den Erlang-Interpreter beinhaltet. (Z.B. <a class="external" href="http://www.process-one.net/downloads/ejabberd/1.1.3/ejabberd-1.1.3_1-linux-x86-installer.bin" rel="nofollow">Version 1.1.3</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.)</p><p>Als erstes muss man die Datei <strong>ejabberd-<em>&lt;Version&gt;</em>-installer.bin</strong> herunterladen und ausführbar machen <sup><a href="#source-6">[6]</a></sup>, dann startet man das selbstextrahierende Paket unter genau der Benutzerkennung, unter welcher der Server später laufen soll. Standardmäßig geschieht das durch Anlegen eines Verzeichnisses im <strong>home</strong> des entsprechenden Benutzers bzw. in <strong>/opt</strong>, falls man Root ist (nicht empfohlen). Die Installationsroutine startet mit einer Frage nach der bevorzugten Sprache. Danach darf man der Lizenz (GPL) zustimmen, und es wird nach dem Installationsverzeichnis gefragt. Es folgen die schon im obigen <a class="crosslink" href="#Konfiguration">Konfigurationsabschnitt</a> beschriebenen Fragen nach Domain, Admin-Account, etc. Neu ist die Frage, ob man den Server in einem Cluster aus mehreren Rechnern betreiben will. Das sollte man in den meisten Fällen verneinen.</p><p>Leider versucht das Skript nach beendeter Erstkonfiguration, den Server sofort zu starten, was wegen dem im Folgenden beschriebenen Problem unter Umständen nicht funktioniert und der Installer hängt sich auf. Wenn man aber wartet, bis der Fortschrittsbalken auf 100% steht und die Disk-Aktivität nachlässt, kann man die Routine über 
<span class="key">Strg</span>  + 
<span class="key">C</span>  abbrechen.</p><p>Das Skript <strong>ejabberdctl</strong> im <strong>bin/</strong>-Verzeichnis ist nämlich fehlerhaft, weil es in der #!-Zeile <strong>/bin/sh</strong> als Shell angibt, aber <a class="internal" href="./bash.html">bash</a>-spezifische Erweiterungen nutzt. Da bei Ubuntu die <strong>sh</strong> kein Link auf die <strong>bash</strong>, sondern auf <a class="internal" href="./dash.html">dash</a> ist, muss man also die erste Zeile wie folgt abändern, um das Skript benutzen zu können <sup><a href="#source-4">[4]</a></sup>:</p><pre class="notranslate">#!/bin/bash</pre><p>Ebenfalls im <strong>bin/</strong>-Verzeichnis der ejabberd-Installation finden sich Skripte namens <strong>start</strong> und <strong>stop</strong>, die genau das machen, was ihr Name vermuten lässt, nämlich den Server starten und stoppen.</p><div class="section_2"><div class="section_3"><h4 id="Konfiguration-2">Konfiguration<a class="headerlink" href="#Konfiguration-2">¶</a></h4><p>
Die <strong>ejabberd.cfg</strong>-Datei, zu finden im <strong>conf/</strong>-Verzeichnis, benutzt selbstverständlich dieselbe Syntax wie die aus dem Ubuntu-Paket (<a class="crosslink" href="#Konfiguration">siehe oben</a>), aber die Voreinstellungen sind anders - weniger sinnvoll.</p><p>Als erstes möchte man vielleicht - wie oben schon beschrieben - die automatische Registrierung neuer Benutzer sperren. Das funktioniert, indem man die <em>access-register</em>-Zeile folgendermaßen anpasst:</p><pre class="notranslate">{access, register, [{deny, all}]}.</pre><p>Außerdem ist der ejabberd aus dem Installer - im Gegensatz zu dem aus dem Ubuntu-Paket - standardmäßig nicht für SSL-/TLS-Verschlüsselung ausgelegt. Wer das ändern will, muss wie im folgenden Abschnitt dargestellt ein paar Kommentarzeichen ('%') verrücken: 
</p><pre class="notranslate">{listen, [
      %%{5222, ejabberd_c2s, [{access, c2s}, {max_stanza_size, 65536}, {shaper, c2s_shaper}]},
          %% Use this line to enable SSL:
          %%{5223, ejabberd_c2s,     [{access, c2s}, {max_stanza_size, 65536}, tls, {certfile, "/opt/ejabberd-1.1.3/conf/serv
er.pem"}]},
          %%
          %% Use those lines instead for TLS support:
          {5222, ejabberd_c2s,     [{access, c2s}, {shaper, c2s_shaper}, starttls, {certfile, "/opt/ejabberd-1.1.3/conf/serve
r.pem"}]},
          {5223, ejabberd_c2s,     [{access, c2s}, tls, {certfile, "/opt/ejabberd-1.1.3/conf/server.pem"}]},</pre><p>Es empfiehlt sich, das <strong>bin/</strong>-Verzeichnis in den eigenen Programm-Pfad aufzunehmen, damit man für die <strong>start</strong>-/<strong>stop</strong>-Skripte und <strong>ejabberdctl</strong> nicht immer den kompletten Pfad benutzen muss. Wie das geht, steht im Artikel <a class="internal" href="./umgebungsvariable.html">Umgebungsvariable</a>. Außerdem möchte man sich wahrscheinlich ein Startskript in <strong>/etc/init.d/</strong> erstellen, um den Server gleich beim Systemstart hochzufahren <sup><a href="#source-5">[5]</a></sup>.</p></div><div class="section_3"><h4 id="Haerten-des-ejabberd-Servers">Härten des ejabberd-Servers<a class="headerlink" href="#Haerten-des-ejabberd-Servers">¶</a></h4><p>
Der ejabberd-Server wird mithilfe eines Skripts unter <strong>/etc/init.d/ejabberd</strong> gestartet/gestoppt. Dabei wird der Prozess unter dem Benutzer <code class="notranslate">ejabberd</code> gestartet. Dieser Benutzer hat in <strong>/etc/passwd</strong> als Shell "/bin/sh" definiert. Einen Server-Prozess unter Linux sollte möglichst als unpriviligierter Benutzer mit möglichst wenig Rechten laufen. Dazu wird die eingetragene Shell entfernt:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo usermod -s /usr/sbin/nologin ejabberd </pre></div></div><p>Nach dieser Änderung lässt sich ejabberd aber nicht mehr starten. Um das zu beheben, legt man zunächst eine Sicherung des bestehenden init-Skript an:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cp -a /etc/init.d/ejabberd /etc/init.d/ejabberd.bak </pre></div></div><p>Danach passt man das init-Skript an:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo sed -i 's/su $EJABBERDUSER -c/sudo -u "$EJABBERDUSER" sh -c/g' /etc/init.d/ejabberd </pre></div></div><p>Jetzt sollte der Start-Befehl wieder funktionieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo service ejabberd start </pre></div></div></div></div></div><div class="section_1"><h2 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h2><p>
Eine Besonderheit ist, dass der Server nach einem Wechsel der Host-Namens nicht mehr richtig läuft. Besser ausgedrückt, der Server kann auf den Datenbestand nicht mehr zugreifen. Wenn die Nutzerdaten z.B. über LDAP von anderer Stelle geholt werden, reicht es aus, das Verzeichnis <strong>/var/lib/ejabberd/</strong> zu leeren. Leider gehen dabei die eingerichteten Räume verloren.</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="https://github.com/processone/ejabberd/issues" rel="nofollow">ejabberd-Community</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.process-one.net/en/ejabberd/docs/" rel="nofollow">ejabberd-Dokumentation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.process-one.net/en/ejabberd/downloads/" rel="nofollow">Download des ejabberd-Installers</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="internal" href="./serverdienste.html">Serverdienste</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Übersichtsartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./ejabberd/a/revision/938971.html">Diese Revision</a> wurde am 3. Mai 2017 20:23 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./ejabberd.html">ejabberd</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>