<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>AppArmor/Profile_erstellen › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../apparmor/profile_erstellen.html">Profile erstellen</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/AppArmor/Profile_erstellen">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../apparmor/profile_erstellen/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../apparmor/profile_erstellen/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../apparmor/profile_erstellen/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../apparmor/profile_erstellen/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../apparmor/profile_erstellen/a/backlinks.html">Profile erstellen</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
Dieser Artikel ist mit keiner aktuell unterstützten Ubuntu-Version getestet! Bitte diesen Artikel testen und das getestet-Tag entsprechend anpassen.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorbereitung">Vorbereitung
</a></li><li><a class="crosslink" href="#Erstellen-einer-Log">Erstellen einer Log
</a></li><li><a class="crosslink" href="#Erstellen-des-eigentlichen-Profils">Erstellen des eigentlichen Profils
</a></li><li><a class="crosslink" href="#Testen-des-Profils">Testen des Profils
</a></li><li><a class="crosslink" href="#Feintuning-des-Profils">Feintuning des Profils
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Dieser Artikel beschäftigt sich mit dem Erstellen eigener Regeln für <a class="external" href="http://wiki.apparmor.net/index.php/Main_Page" rel="nofollow">AppArmor</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> . Es wird dringend geraten, bevor man mit dem Erstellen eines eigenen Profils beginnt, den vollständigen Artikel über <a class="internal" href="../apparmor.html">AppArmor</a> gelesen und verstanden zu haben, genauso wie dieser Artikel mindestens einmal komplett gelesen werden sollte, bevor man mit dem Erstellen beginnt.</p><p>Das Erstellen eines Profils ist keine einfache Angelegenheit. AppArmor wird eine Menge Fragen stellen, die nur durch gute Recherche und/oder Wissen über die Ordner- und Programmstruktur von Ubuntu richtig beantwortet werden können. Eine falsche Beantwortung mündet ohne Zweifel in einem zu restriktiven oder zu laschen Profil. Ist das Profil zu restriktiv, werden Funktionen des Programms nicht mehr zu benutzen sein, im schlimmsten Fall wird man das komplette Programm nicht mehr benutzen können. Ist es zu lasch, kann AppArmor das Programm nicht richtig schützen.</p><div class="section_1"><h2 id="Vorbereitung">Vorbereitung<a class="headerlink" href="#Vorbereitung">¶</a></h2><p>
Bevor man eine eigene Regel für ein Programm schreibt, sollte man sich überlegen, welche Bestandteile des Programms man alle benutzen möchte. Am besten erstellt man sich eine Liste dieser Features, denn wenn man hier etwas vergisst, dann wird das AppArmor-Profil unter Umständen nachher die Benutzung dieses Features verbieten. Man sollte auch Dinge bedenken, die das Programm nur selten oder nur unter ganz bestimmten Voraussetzungen macht. Diese Vorgänge muss man versuchen, nachzustellen, damit AppArmor sie erfassen kann.</p></div><div class="section_1"><h2 id="Erstellen-einer-Log">Erstellen einer Log<a class="headerlink" href="#Erstellen-einer-Log">¶</a></h2><p>
Ist man sich sicher, dass man jedes Feature im Kopf hat, kann es los gehen. Man startet nun das Programm im "Complain-modus", indem man vom Terminal aus folgenden Befehl eingibt:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aa-genprof &lt;Programmname&gt; </pre></div></div><p>AppArmor wird versuchen, den Pfad zum Programm zu ermitteln. Dies klappt jedoch nicht immer und es kann ggf. notwendig sein, den kompletten Pfad zur Datei anzugeben anstatt nur den Namen des Programms. Danach wird diese Ausgabe im Terminal erscheinen:</p><pre class="notranslate">Connecting to repository.....
Writing updated profile for /usr/bin/Programm-Name.
Setting /usr/bin/Programm-Name to complain mode.

Please start the application to be profiled in
another window and exercise its functionality now.

Once completed, select the "Scan" button below in
order to scan the system logs for AppArmor events.

For each AppArmor event, you will be given the
opportunity to choose whether the access should be
allowed or denied.

Profiling: /usr/bin/Programm-Name

[(S)can system log for SubDomain events] / (F)inish</pre><p>in der man aufgefordert wird, das Programm zu starten. Dies sollte man auch machen und es ist der Zeitpunkt gekommen indem man nun das Programm ausgiebig benutzen sollte. Jedes Feature des Programms, das man jetzt nicht benutzt wird möglicherweise später von AppArmor verboten werden. Es muss also sehr penibel darauf geachtet werden wirklich alles zu machen, was man mit dem Programm machen kann/will.</p><p>Ist man fertig, kann man das Programm, für das man ein Profil erstellen möchte, beenden und drückt im Terminal-Fenster von oben die 
<span class="key">S</span> -Taste.</p><p><a class="crosslink anchor" href="#genprof_fragen" id="genprof_fragen"></a></p></div><div class="section_1"><h2 id="Erstellen-des-eigentlichen-Profils">Erstellen des eigentlichen Profils<a class="headerlink" href="#Erstellen-des-eigentlichen-Profils">¶</a></h2><p>
AppArmor liest jetzt die Syslog aus und wird einen daraufhin eine Reihe von Fragen stellen, was dem Programm erlaubt werden soll und was nicht. Die Fragen gliedern sich in 2 Kategorien: Programme ausführen und Dateien lesen/schreiben.</p><ul><li><p>Eine Abfrage ob ein Programm ausgeführt werden darf sieht zum Beispiel so aus: </p></li></ul><p>
</p><pre class="notranslate">Profile:  /usr/local/bin/sylpheed
Execute:  /usr/bin/gpg
Severity: unknown

[(I)nherit] / (P)rofile / (U)nconfined / (D)eny / Abo(r)t / (F)inish</pre><ul><li><p>Eine Abfrage über Zugriffsrechte auf eine Datei sieht zum Beispiel so aus: </p></li></ul><p>
</p><pre class="notranslate">Profile:  /usr/local/bin/sylpheed
Path:     /etc/fonts/conf.avail/20-fix-globaladvance.conf
Mode:     r
Severity: unknown

  1 - #include &lt;abstractions/fonts&gt;
  2 - #include &lt;abstractions/gnome&gt;
  3 - #include &lt;abstractions/kde&gt;
  4 - /etc/fonts/conf.avail/20-fix-globaladvance.conf
 [5 - /etc/fonts/**]

[(A)llow] / (D)eny / (G)lob / Glob w/(E)xt / (N)ew / Abo(r)t / (F)inish</pre><p>Die Bedeutung der einzelnen Überschriften und Wahlmöglichkeiten kann man der folgenden Tabelle entnehmen:</p><table><tr class="titel"><td colspan="2"><strong>Legende</strong></td></tr><tr class="kopf"><td><strong>Überschrift</strong></td><td><strong>Beschreibung</strong></td></tr><tr><td><code class="notranslate">Profile</code></td><td> Für welches Programm das Profil ist. </td></tr><tr><td><code class="notranslate">Execute</code></td><td> Welches Programm ausgeführt werden soll. </td></tr><tr><td><code class="notranslate">Path</code></td><td> Auf welche(n) Datei/Ordner Sylpheed zugreifen möchte </td></tr><tr><td><code class="notranslate">Mode</code></td><td> Was mit einer Datei/Ordner gemacht werden darf. <code class="notranslate">r</code> für Lesezugriff, <code class="notranslate">w</code> für Schreibzugriff und <code class="notranslate">l</code> für darf symbolischen Links folgen </td></tr><tr><td><code class="notranslate">Severity</code></td><td> Wie gefährlich das Erlauben des Ausführens ist von <code class="notranslate">1</code> = ungefährlich, bis <code class="notranslate">10</code> = hohes Risiko (Diese Werte werden durch sogenannte Sicherheitsereignisse ermittelt und in einer Datenbank abgelegt. Sie sind nicht sehr akkurat, aber hohe Werte geben schon mal einen guten Hinweis, dass man das Erlauben genauer überdenken und überprüfen sollte. Für manche Programme und Dateien werden seltsamer Weise keine Einträge in der Datenbank abgelegt und werden von AA dann bei der Severity als <code class="notranslate">unknown</code> gekennzeichnet) </td></tr><tr class="kopf"><td><strong>Wahlmöglichkeit</strong></td><td><strong>Beschreibung</strong></td></tr><tr><td><code class="notranslate">Inherit</code></td><td> Das Programm wird mit dem gleichen Profil gestartet, wie das Elternprogramm. Zu beachten ist, dass es sehr wahrscheinlich ist, dass das Programm auf andere Dateien zugreifen muss als das Elternprogramm. Diese Option sollte man nur wählen, wenn man sich sicher ist, dass dem nicht so ist. </td></tr><tr><td><code class="notranslate">Profil</code></td><td> Das Programm wird mit seinem eigenen Profil gestartet. Existiert kein Profil für das Programm wird der Aufruf verboten. </td></tr><tr><td><code class="notranslate">Unconfined</code></td><td> Das Programm wird ganz normal gestartet. </td></tr><tr><td><code class="notranslate">Allow</code></td><td>  Erlaubt den Zugriff. </td></tr><tr><td><code class="notranslate">Glob</code></td><td>  Erlaube nicht nur die Datei sondern den ganzen Ordner, wenn man nochmals drückt inkl. aller Subordner. Dadurch kann man Profile verkleinern und verallgemeinern. Man sollte beachten, dass in dem Ordner und seinen Subordnern keine "gefährliche" Dateien/Programme liegen, welche missbraucht werden könnten. </td></tr><tr><td><code class="notranslate">Glob w/(E)xt</code></td><td> Das gleiche wie Glob allerdings erlaubt in den Subordnern nur den Zugriff auf Dateien mit der gleichen Endung. </td></tr><tr><td><code class="notranslate">New</code></td><td> Erlaubt das Erstellen einer eigenen Regel mit Hilfe von regulären Ausdrücken </td></tr><tr><td><code class="notranslate">Deny</code></td><td> Verbiete den Aufruf des Programms/den Zugriff auf die Datei. </td></tr><tr><td><code class="notranslate">Abort</code></td><td> Bricht den ganzen Vorgang des Profilerstellens ab. </td></tr><tr><td><code class="notranslate">Finish</code></td><td> Bricht den Vorgang ab und erstellt ein Profil aus den bereits bestätigten Regeln. </td></tr></table><p>
Es gilt bei jeder Frage individuell zu prüfen wie gefährlich es ist den Zugriff auf die einzelne Datei oder ihren ganzen Oberordner zu erlauben bzw. ob das Programm ausgeführt werden darf.</p><p>Stellt AppArmor keine Fragen mehr, kann  das Profil mit der 
<span class="key">S</span> -Taste speichern und mit der 
<span class="key">F</span> -Taste dann das Programm verlassen werden. Zuletzt sollte man das erfolgreiche Erstellen der Regel mit:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aa-status </pre></div></div><p>überprüfen. Dort sollte das Profil im Complain-Modus aufgelistet werden.</p></div><div class="section_1"><h2 id="Testen-des-Profils">Testen des Profils<a class="headerlink" href="#Testen-des-Profils">¶</a></h2><p>
Nachdem das Profil erstellt wurde, gilt es nun, es in den <a class="internal" href="../apparmor.html#AppArmor-Modi-flags">Enforce-Modus zu setzen</a> und dann den AppArmor-Dienst neu zu laden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/apparmor reload </pre></div></div><p>Von nun an wird AppArmor jeden Zugriff des Programms, der nicht im Profil erlaubt wurde, verbieten. Es bietet sich also an, das Programm wieder ausgiebig zu testen, um zu schauen, ob alles funktioniert.</p><p><a class="crosslink anchor" href="#Feintuning" id="Feintuning"></a></p></div><div class="section_1"><h2 id="Feintuning-des-Profils">Feintuning des Profils<a class="headerlink" href="#Feintuning-des-Profils">¶</a></h2><p>
Stellt man fest, dass etwas im Programm  nach Aktivierung eines Profils nicht mehr funktioniert, kann man nachträglich ein Feintuning durchführen. Dazu startet man das Programm <strong>logprof</strong>:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aa-logprof </pre></div></div><p>logprof überprüft die Syslog nach Meldungen, dass AppArmor etwas verboten hat. Man bekommt für die gefundenen Meldungen jetzt nochmal die gleichen Fragen gestellt wie <a class="crosslink" href="#genprof_fragen">oben</a> und kann das Profil updaten.</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="../apparmor.html">AppArmor</a> - Hauptartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../apparmor/profile_erstellen/a/revision/938409.html">Diese Revision</a> wurde am 28. April 2017 19:21 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../apparmor.html">AppArmor</a></li>
<li><a href="../apparmor/profile_erstellen.html">Profile erstellen</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>