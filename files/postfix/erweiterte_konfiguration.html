<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Postfix/Erweiterte_Konfiguration › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../postfix/erweiterte_konfiguration.html">Erweiterte Konfiguration</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Postfix/Erweiterte_Konfiguration">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../postfix/erweiterte_konfiguration/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../postfix/erweiterte_konfiguration/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../postfix/erweiterte_konfiguration/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../postfix/erweiterte_konfiguration/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../postfix/erweiterte_konfiguration/a/backlinks.html">Erweiterte Konfiguration</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../postfix.html">Postfix Grundkonfiguration</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Aliase">Aliase
</a></li><li><a class="crosslink" href="#Generic-Mapping">Generic Mapping
</a></li><li><a class="crosslink" href="#TLS-SSL-Verschluesselung">TLS-(SSL-)Verschlüsselung
</a><ol class="arabic"><li><a class="crosslink" href="#Veraltet-ssmtp">Veraltet: ssmtp
</a></li></ol></li><li><a class="crosslink" href="#SASL-Authentifizierung-als-Server">SASL-Authentifizierung als Server
</a><ol class="arabic"><li><a class="crosslink" href="#Gruppenberechtigungen-fuer-sasl-setzen">Gruppenberechtigungen für sasl setzen
</a></li><li><a class="crosslink" href="#Sicherheitseinstellungen-anpassen">Sicherheitseinstellungen anpassen
</a></li><li><a class="crosslink" href="#Aktivieren">Aktivieren
</a></li><li><a class="crosslink" href="#Testen">Testen
</a></li></ol></li><li><a class="crosslink" href="#Sender-abhaengige-Authentifizierung">Sender-abhängige Authentifizierung
</a></li><li><a class="crosslink" href="#Greylisting">Greylisting
</a><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>In diesem Artikel werden einige spezielle Postfix-Konfigurationen beschrieben, die nicht jeder Betreiber eines Mailservers benötigt, und die deswegen aus Gründen der Übersicht aus dem Hauptartikel ausgelagert wurden. Die einzelnen Abschnitte bauen nicht aufeinander auf und können auch unabhängig voneinander umgesetzt werden. Eine funktionierende <a class="internal" href="../postfix.html">Postfix</a>-Installation <sup><a href="#source-4">[4]</a></sup> wird natürlich vorausgesetzt.</p><p><a class="crosslink anchor" href="#aliase" id="aliase"></a>
</p><div class="section_1"><h2 id="Aliase">Aliase<a class="headerlink" href="#Aliase">¶</a></h2><p>
Mail-Aliase werden in der Datei <strong>/etc/aliases</strong> festgelegt <sup><a href="#source-3">[3]</a></sup>. Pro Zeile steht ein Adresspaar, wobei Mails, die an die erste (lokale) Adresse adressiert sind, an die zweite notierte Adresse weitergeleitet werden. Als Minimum sollte man Umleitungen für <em>root</em> und <em>postmaster</em> erstellen. Letzteres wird sogar offiziell per <a class="external" href="http://de.wikipedia.org/wiki/Request_for_Comments" rel="nofollow">RFC</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> gefordert, wenn man einen öffentlichen Mailserver betreibt.</p><pre class="notranslate">root:           adminname
postmaster:     adminname</pre><p>
Nach jeder Änderung dieser Datei muss man folgenden Befehl ausführen <sup><a href="#source-2">[2]</a></sup>, um die Datenbank zu aktualisieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo newaliases </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>
Die Benutzung der <strong>aliases</strong>-Datei unterscheidet sich von der Benutzung der anderen Hash-Dateien von Postfix, um Abwärtskompatibilität zu <strong>sendmail</strong>, dem "Urgestein", und zu anderen Mailservern zu erhalten. Man beachte die Doppelpunkte, den ungewöhnlichen Ort der Datei außerhalb von <strong>/etc/postfix</strong> und den besonderen Befehl <strong>newaliases</strong>.</p></div></div><p><a class="crosslink anchor" href="#Generic" id="Generic"></a>
</p></div><div class="section_1"><h2 id="Generic-Mapping">Generic Mapping<a class="headerlink" href="#Generic-Mapping">¶</a></h2><p>
Viele Hosts besitzen keine gültige Internetdomain und verwenden stattdessen eine Bezeichnung wie z.B. <strong>localdomain.local</strong>. Will man Mails über das Internet verschicken, so werden diese von vielen Mail-Servern abgelehnt.
Mittels Generic Mapping umgeht man das Problem indem man lokale Mail-Adressen durch reale ersetzt bevor sie via SMTP verschickt werden.</p><p>Die Datei <strong>/etc/postfix/main.cf</strong> muss zunächst um diese Zeile ergänzt werden.
</p><pre class="notranslate">smtp_generic_maps = hash:/etc/postfix/generic</pre><p>Außerdem muss man <strong>/etc/postfix/generic</strong> erstellen und in etwa so mit Einträgen versehen.
</p><pre class="notranslate">Sabrin@server1	SabRi@web.de
HeiBr@server1	Heinz.Brand@gmail.com</pre><p>
Die linken Einträge sind die (ungültigen) Mail-Adressen auf dem lokalen Server (hier mit dem Hostnamen server1), die rechten Einträge entsprechen den (gültigen) realen eMail-Adressen.</p><p>Das Mapping muss jetzt noch aktualisiert werden.
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo postmap /etc/postfix/generic </pre></div></div><p>Zum Schluss wird die Konfiguration neu eingelesen. Fertig.
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/postfix reload  </pre></div></div><p><a class="crosslink anchor" href="#tls" id="tls"></a>
</p></div><div class="section_1"><h2 id="TLS-SSL-Verschluesselung">TLS-(SSL-)Verschlüsselung<a class="headerlink" href="#TLS-SSL-Verschluesselung">¶</a></h2><p>
Wer einen MTA außerhalb des LANs anbieten (oder selber nutzen) möchte, sollte <a class="external" href="http://de.wikipedia.org/wiki/Transport_Layer_Security" rel="nofollow">TLS-Verschlüsselung</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> (ehemals SSL genannt) anbieten. Dafür benötigt man neben Postfix ein zweiteiliges SSL-/TLS-Zertifikat. Eine einfache Möglichkeit, an ein Dummy-Zertifikat zu kommen, bietet das Paket <a class="internal" href="../ssl-cert.html">ssl-cert</a>, das hier benutzt wird. Wer den Server nicht nur privat nutzt, sollte sich aber auf jeden Fall ein richtiges, von einer respektierten Zertifizierungsstelle signiertes, Zertifikat besorgen.</p><p>Um TLS-Verschlüsselung zu aktivieren, muss man nur folgende Zeilen in die <strong>/etc/postfix/main.cf</strong> eintragen <sup><a href="#source-3">[3]</a></sup>:</p><pre class="notranslate">smtpd_tls_cert_file = /etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file = /etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls = yes</pre><p>
Danach natürlich - wie immer nach einer Änderung an der Konfiguration - Postfix neu starten.</p><p>Zusätzlich zu den o.a. Konfigurationsdirektiven gibt es auch noch folgende:</p><pre class="notranslate">smtpd_enforce_tls = yes</pre><p>
Diese bewirkt, dass Postfix die Verschlüsselung nicht nur optional anbietet, sondern explizit erzwingt. Unterstützt der Client kein TLS, wird die Verbindung abgelehnt.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
In Postfix 2.3 (ab Edgy) wurden die beiden Direktiven <em>smtpd_use_tls</em> und <em>smtpd_enforce_tls</em> zusammengefasst zu <em>smtpd_tls_security_level</em>, mit den möglichen Werten <em>may</em> (Verschlüsselung möglich) und <em>encrypt</em> (Verschlüsselung erforderlich). Die alten Schlüsselwörter funktionieren aber aus Kompatibilitätsgründen vorerst weiterhin.</p><p>Außerdem ist zu beachten, dass ein Erzwingen der Verschlüsselung von vielen Emailservern nicht beachtet wird und Emails von anderen Emailservern (z.B. GMX) nicht an Ihre lokalen Postfächer zugestellt werden können.</p></div></div><div class="section_2"><h3 id="Veraltet-ssmtp">Veraltet: ssmtp<a class="headerlink" href="#Veraltet-ssmtp">¶</a></h3><p>
Ganz früher benutzte man SSL/TLS nicht über den normalen SMTP-Port, sondern ohne besondere Protokollverhandlungen über den sog. <em>ssmtp</em>- (oder <em>smtps</em>-)Port 465. Wer das unterstützen möchte, um auch Uralt-Clients Verschlüsselung zu bieten, muss die <strong>/etc/postfix/master.cf</strong> ändern und den zusätzlichen Service eintragen:</p><pre class="notranslate">smtps    inet  n       -       n       -       -       smtpd
  -o smtpd_tls_wrappermode=yes -o smtpd_sasl_auth_enable=yes</pre><p>
Diese zwei Zeilen sind in der Ubuntu-master.cf schon enthalten und es müssen nur die Kommentarzeichen (<strong>#</strong>) entfernt werden. Das Zertifikat wird wie oben beschrieben eingebunden.</p><p><a class="crosslink anchor" href="#sasl_auth" id="sasl_auth"></a>
</p></div></div><div class="section_1"><h2 id="SASL-Authentifizierung-als-Server">SASL-Authentifizierung als Server<a class="headerlink" href="#SASL-Authentifizierung-als-Server">¶</a></h2><p>
</p><div class="box fixme"><h3 class="box fixme">Fehlerhafte Anleitung</h3><div class="contents"><p>
Diese Anleitung ist fehlerhaft. Wenn du weißt, wie du sie
ausbessern kannst, nimm dir bitte die Zeit und bessere sie aus.
</p><hr/><p><strong>Anmerkung:</strong> In den neuen Versionen von Postfix wurde die Konfiguration grundlegend verändert! Das sorgt dafür, dass die Vorgehensweise sich auch grundlegend verändert hat!
</p></div></div><p>
Um einen SMTP-Dienst auch außerhalb des sicheren LANs anbieten zu können, sollte man eine Authentifizierung durch die Clients einfordern, damit man kein <em>offenes Relay</em> für Spammer o.ä. anbietet. Dafür wird das <em>Simple Authentication and Security Layer (SASL)</em>-Framework verwendet, welches z.B. über das Cyrus-Sasl-Projekt realisiert wird.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>
Bei dieser Installation werden Benutzerpasswörter im Klartext übertragen. Man sollte also zusehen, für die Verbindung <a class="crosslink" href="#tls">SSL-/TLS-Verschlüsselung</a> zu verwenden.</p></div></div><p>
Hierfür müssen folgende Pakete installiert werden <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>sasl2-bin</strong> </p></li><li><p><strong>libsasl2-2</strong></p></li><li><p><strong>libsasl2-modules</strong></p></li></ul><p>Cyrus SASL bietet mehrere Arten, Authentifizierungsdienste bereitzustellen. Da man z.B. mit <em>auxprop</em> nicht gegen die normalen Shadow-Passwörter des Linuxsystems authentifizieren kann, wird hier die Einrichtung mit <em>saslauthd</em> beschrieben.</p><p>Zunächst muss die Konfigurationsdatei <strong>/etc/default/saslauthd</strong> angepasst <sup><a href="#source-3">[3]</a></sup> und folgendes eingetragen werden:</p><pre class="notranslate">START=yes
MECHANISMS="shadow"</pre><p>
Dann muss eine neue Datei <strong>/etc/postfix/sasl/smtpd.conf</strong> erstellt werden:</p><pre class="notranslate">pwcheck_method: saslauthd
mech_list: PLAIN LOGIN
saslauthd_path: /var/run/saslauthd/mux</pre><p>
Und die <strong>/etc/postfix/main.cf</strong> muss natürlich auch noch angepasst werden:</p><pre class="notranslate">smtpd_sasl_auth_enable = yes
smtpd_recipient_restrictions = 
        permit_mynetworks permit_sasl_authenticated reject_unauth_destination

smtpd_helo_restrictions = permit_sasl_authenticated, permit_mynetworks, reject_invalid_hostname, reject_unauth_pipelining, reject_non_fqdn_hostname

# Postfix &gt;= 2.3, ab Edgy
smtpd_sasl_path = smtpd

broken_sasl_auth_clients = yes</pre><p>
Die letzte Zeile ist notwendig, weil sonst ein paar ältere Versionen von Microsoft-Software nicht korrekt funktioniert. Sollte es später beim Anmelden Probleme geben, sollte man die Kommentare  <code class="notranslate"># Postfix &gt;= 2.3, ab Edgy</code> entfernen.</p><div class="section_2"><h3 id="Gruppenberechtigungen-fuer-sasl-setzen">Gruppenberechtigungen für sasl setzen<a class="headerlink" href="#Gruppenberechtigungen-fuer-sasl-setzen">¶</a></h3><p>
Standardmäßig läuft der sasl Dienst mit eigenen Rechten, auf die postfix keinen Zugriff hat. Daher ist es nötig, den user "postfix" der Gruppe "sasl" hinzuzufügen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo adduser postfix sasl </pre></div></div></div><div class="section_2"><h3 id="Sicherheitseinstellungen-anpassen">Sicherheitseinstellungen anpassen<a class="headerlink" href="#Sicherheitseinstellungen-anpassen">¶</a></h3><p>
Jetzt könnte eigentlich alles funktionieren, wenn es nicht noch ein Problem gäbe, nämlich die Sicherheitseinstellungen von Postfix. Postfix sperrt nämlich den <strong>smtpd</strong> standardmäßig in eine <a class="internal" href="../chroot.html">chroot</a>-Umgebung, wo er den Sasl-Socket nicht finden kann. Es gibt mehrere Möglichkeiten, dieses Problem zu umgehen.</p><div class="section_3"><h4 id="Methode-1-chroot-abschalten">Methode 1: chroot abschalten<a class="headerlink" href="#Methode-1-chroot-abschalten">¶</a></h4><p>
Das geht am einfachsten und ist wahrscheinlich auch am praktischsten, wenn noch andere Dienste (wie z.B. ein IMAP-Server) den <strong>saslauthd</strong> nutzen wollen. Dazu muss einfach nur in der Datei <strong>/etc/postfix/master.cf</strong> in der <em>smtpd</em>-Zeile ein <strong>n</strong> in die <em>chroot</em>-Spalte eingetragen werden:</p><pre class="notranslate"># service type  private unpriv  chroot  wakeup  maxproc command + args
#               (yes)   (yes)   (yes)   (never) (100)
# ==========================================================================
smtp      inet  n       -       n       -       -       smtpd
smtps     inet  n       -       n       -       -       smtpd -o smtpd_tls_wrappermode=yes -o smtpd_sasl_auth_enable=yes</pre></div><div class="section_3"><h4 id="Methode-2-Socket-in-den-chroot-legen">Methode 2: Socket in den chroot legen<a class="headerlink" href="#Methode-2-Socket-in-den-chroot-legen">¶</a></h4><p>
Da Postfix seinen Prozess nach <strong>/var/spool/postfix</strong> <em>chrooted</em>, sucht dieser dann den Saslauthd-Socket in <strong>/var/spool/postfix/var/run/saslauthd/</strong>. Man muss also dem saslauthd befehlen, den Socket dort zu eröffnen, indem man in der oben erwähnten Datei /etc/default/saslauthd den Eintrag ändert:</p><pre class="notranslate">OPTIONS="-c -m /var/spool/postfix/var/run/saslauthd"</pre></div></div><div class="section_2"><h3 id="Aktivieren">Aktivieren<a class="headerlink" href="#Aktivieren">¶</a></h3><p>
Abschließend müssen Saslauthd und Postfix noch neu gestartet werden <sup><a href="#source-2">[2]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/saslauthd restart
sudo /etc/init.d/postfix restart </pre></div></div></div><div class="section_2"><h3 id="Testen">Testen<a class="headerlink" href="#Testen">¶</a></h3><p>
Man kann testen, ob alles klappt, indem man mit dem Telnet-Client direkt mit dem Server kommuniziert. Dafür muss man aber erstmal einen String aus den Zugangsdaten zur späteren Verwendung nach <a class="external" href="http://de.wikipedia.org/wiki/Base64" rel="nofollow">base64</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> konvertieren. Im folgenden Beispiel lautet der Benutzername "test" und das Passwort "testtest" und der String muss genau so (mit doppeltem Namen und \0 als Trennzeichen) eingegeben werden:</p><div class="bash"><div class="contents"><pre class="notranslate">$ perl -MMIME::Base64 -e     'print encode_base64("test\0test\0testtest");'
dGVzdAB0ZXN0AHRlc3R0ZXN0
$ telnet dapper-lamp 25
Trying 192.168.4.55...
Connected to dapper-lamp.otze.
Escape character is '^]'.
220 dapper-lamp.otze ESMTP Postfix (Ubuntu)
ehlo test
250-dapper-lamp.otze
250-PIPELINING
250-SIZE 10240000
250-VRFY
250-ETRN
250-STARTTLS
250-AUTH LOGIN PLAIN
250 8BITMIME
auth plain dGVzdAB0ZXN0AHRlc3R0ZXN0
235 Authentication successful
quit
221 Bye
Connection closed by foreign host. </pre></div></div></div></div><div class="section_1"><h2 id="Sender-abhaengige-Authentifizierung">Sender-abhängige Authentifizierung<a class="headerlink" href="#Sender-abhaengige-Authentifizierung">¶</a></h2><p>
Mit fortschreitender Verbreitung von spam-bekämpfenden Techniken wie <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Sender%20Policy%20Framework">Sender Policy Framework</a>, mit denen verhindert werden soll, dass Emails von anderen Servern versendet werden, als für ihre Domain zuständig sind (Absenderfälschung), kann es leider passieren, dass das normale Versenden über einen <a class="internal" href="../postfix.html#Authentifizierung-am-Smarthost">Smarthost</a> nicht mehr zuverlässig funktioniert. In diesem Fall muss Postfix die Mails je nach Absender über unterschiedliche SMTP-Server mit individuellen Authentifizierungsdaten verschicken.</p><p>Der Nachteil gegenüber der Verwendung eines einzelnen Smarthosts ist, dass die Benutzernamen und Passwörter aller Benutzer auf dem Server hinterlegt werden müssen.
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Diese Konfigurationsmöglichkeit existiert erst ab <em>Postfix 2.3</em>. Benutzer von <em>Ubuntu 6.06 LTS Dapper Drake</em> müssen sich daher aus dem Backports-Repository aktuellere Pakete besorgen.
</p></div></div><p>Als erstes muss die Datei <strong>/etc/postfix/main.cf</strong> folgendermaßen ergänzt werden:
</p><pre class="notranslate">smtp_sender_dependent_authentication = yes
smtp_sasl_auth_enable = yes
smtp_sasl_security_options = noplaintext noanonymous
smtp_connection_cache_on_demand = no
smtp_sasl_password_maps = hash:/etc/postfix/sasl_password
sender_dependent_relayhost_maps = hash:/etc/postfix/sender_dependent
sender_canonical_maps = hash:/etc/postfix/sender_canonical</pre><p>
Dann müssen die drei dort referenzierten Postfix-Maps erstellt werden. Ein Beispiel mit drei Benutzern:</p><ul><li><p><strong>/etc/postfix/sender_canonical</strong> (<code class="notranslate">LokalerName RealeAbsenderAdresse</code>):</p></li></ul><pre class="notranslate">erna erna@provider.de
otto otto@otto.de
paul paul@paul.com</pre><p>
</p><ul><li><p><strong>/etc/postfix/sender_dependent</strong> (<code class="notranslate">Absenderadresse SMTP-Server</code>):</p></li></ul><pre class="notranslate">erna@provider.de mail.provider.de
otto@otto.de smtp.provider.com
paul@paul.com smtp.provider.com</pre><p>
</p><ul><li><p><strong>/etc/postfix/sasl_password</strong> (<code class="notranslate">Absenderadresse Loginname:Passwort</code>):</p></li></ul><pre class="notranslate">erna@provider.de erna@provider.de:ernaspassword
otto@otto.de otto:ottospassword
paul@paul.com paul:paulspassword</pre><p>Nun müssen diese Maps noch in das Postfix-Datenbankformat konvertiert werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo postmap /etc/postfix/sender_canonical
sudo postmap /etc/postfix/sender_dependent
sudo postmap /etc/postfix/sasl_password </pre></div></div><p>
Und natürlich muss Postfix seine Konfiguration neu einlesen:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/postfix restart </pre></div></div><p><a class="crosslink anchor" href="#greylisting" id="greylisting"></a>
</p></div><div class="section_1"><h2 id="Greylisting">Greylisting<a class="headerlink" href="#Greylisting">¶</a></h2><p>
<a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Greylisting">Greylisting</a> ist eine Form der SPAM-Bekämpfung. Hierbei wird sich zunutze gemacht, dass normale Mailserver einen gescheiterten Zustellversuch später wiederholen, während Spammer sich im Allgemeinen nicht diese Mühe machen. Der Greylisting-Dienst identifiziert dabei jeden Client über eine Kombination aus IP-Adresse, Absenderadresse und Empfängeradresse. Taucht eine derartige Kombination das erste Mal auf, so wird der Zustellversuch mit einer Fehlermeldung bzgl. eines temporären Problems abgelehnt und diese ID in einer Liste eingetragen. Wird die Kombination erneut zugestellt, wird diese dann vom Mailer akzeptiert.</p><p>Nachteil dieser Methode ist, dass die jeweils ersten Emails von neuen Kontakten ein wenig verzögert eintreffen. Vorteil gegenüber herkömmlichen, analyse-gestützten Spamerkennungsverfahren ist, dass die Mail gar nicht erst angenommen und unter Aufwendung von Rechenzeit untersucht werden muss, sondern direkt abgelehnt wird. Gerade auf ausgelasteten Servern stellt das einige günstige Möglichkeit dar, einen Großteil des Mülls gar nicht erst aufs System zu lassen.</p><div class="section_2"><h3 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h3><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">$sudo apt-get install postgrey  </pre></div></div></div><div class="section_2"><h3 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h3><p>
<strong>/etc/postfix/main.cf</strong></p><div class="bash"><div class="contents"><pre class="notranslate">smtpd_recipient_restrictions = permit_mynetworks,
                                permit_sasl_authenticated,
                                reject_unauth_destination,
                                check_policy_service inet:127.0.0.1:60000 </pre></div></div><p>
Nach einem Postfix-Neustart 
</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/postfix restart </pre></div></div><p>
oder
</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/postfix reload </pre></div></div><p>
ist Postgrey als Policy-Server aktiviert.
Unter <strong>/var/log/mail.log</strong> sollten ab sofort Meldungen auftauchen wie z.B.</p><div class="bash"><div class="contents"><pre class="notranslate">Jul 24 18:17:45 v212910458 postfix/smtpd[24178]: NOQUEUE: reject: RCPT from unknown[83.234.156.154]: 450 4.7.1 &lt;edwardsm.edwardscv@blubberbla.de&gt;: Recipient address rejected: Greylisted, see http://isg.ee.ethz.ch/tools/postgrey/help/blubberbla.de.html; from=&lt;august26joke@askmen.com&gt; to=&lt;edwardsm.edwardscv@blubberbla.de&gt; proto=ESMTP helo=&lt;home-01590bcaf2&gt;
Jul 24 18:17:46 v212910458 postfix/smtpd[24178]: lost connection after DATA (0 bytes) from unknown[83.234.156.154] </pre></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.postfix.org/TLS_README.html" rel="nofollow">Postfix-TLS-Readme</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.postfix.org/SASL_README.html" rel="nofollow">Postfix-SASL-Howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://de.wikipedia.org/wiki/Greylisting" rel="nofollow">Wikipedia-Artikel "Greylisting"</a></p></li><li><p><a class="external" href="http://developer.gauner.org/vboxadm/" rel="nofollow">Postfix Webfrontend "VBoxAdm"</a></p></li><li><p><a class="external" href="http://www.postfix.org/ADDRESS_REWRITING_README.html#generic" rel="nofollow">Generic mapping for outgoing SMTP mail</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.fedorawiki.de/index.php/Postfix_minimal" rel="nofollow">Fedora Wiki - Generic Mapping</a></p></li><li><p><a class="external" href="http://www.howtoforge.de/anleitung/postfix-uberwachung-mit-mailgraph-und-pflogsumm-auf-debian-etch/" rel="nofollow">Postfix Monitoring mit Mailgraph und pflogsumm</a></p></li><li><p><a class="external" href="http://www.nerdsheaven.de/magazin/artikel/tipps-und-tricks/linux-mtasmtpd-sendmail-opensmtp-address-family-not-supported-by-protocol-880/" rel="nofollow">Smtpd “Address family not supported by protocol”</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul><p></p></div></div>
<p class="meta">
<a href="../postfix/erweiterte_konfiguration/a/revision/779153.html">Diese Revision</a> wurde am 7. Januar 2015 22:26 von <a href="https://ubuntuusers.de/user/Swissren/">Swissren</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../postfix.html">Postfix</a></li>
<li><a href="../postfix/erweiterte_konfiguration.html">Erweiterte Konfiguration</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>