<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Bacula/Server-Konfiguration › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../bacula/server-konfiguration.html">Server-Konfiguration</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Bacula/Server-Konfiguration">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../bacula/server-konfiguration/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../bacula/server-konfiguration/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../bacula/server-konfiguration/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../bacula/server-konfiguration/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../bacula/server-konfiguration/a/backlinks.html">Server-Konfiguration</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
Dieser Artikel ist mit keiner aktuell unterstützten Ubuntu-Version getestet! Bitte diesen Artikel testen und das getestet-Tag entsprechend anpassen.
</p></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../editor.html">Umgang mit einem Editor</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../sudo.html">Root-Rechte</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#etc-bacula-bacula-dir-conf">/etc/bacula/bacula-dir.conf
</a></li><li><a class="crosslink" href="#etc-bacula-bacula-sd-conf">/etc/bacula/bacula-sd.conf
</a></li><li><a class="crosslink" href="#Erstellen-der-Volumina">Erstellen der Volumina
</a></li></ol></div><p><img alt="./bacula_logo.png" class="image-left" src="../_/addf77f93f894f25a336e13acfbf2fd5ddfa2afb.png"/>
Dieser Abschnitt behandelt die Konfiguration des <a class="internal" href="../bacula.html">Bacula</a>-Servers, der regelmäßig Backups von verschiedenen Clients erstellen und beispielsweise unter dem Verzeichnis <strong>/mnt/backup</strong> abspeichern soll.</p><p>Der Server besteht aus dem Director- und dem Storage-Daemon:</p><ul><li><p><strong>/etc/bacula/bacula-dir.conf</strong>: Konfiguration des Director</p></li><li><p><strong>/etc/bacula/bacula-sd.conf</strong>: Konfiguration des Storage-Daemon</p></li></ul><p>
Dabei kann der Storage-Daemon jederzeit auf einen zweiten Server ausgelagert werden, muss aber nicht.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Authentifikation zwischen den Modulen erfolgt mit Passwörtern. Diese generiert Ubuntu bei der Installation automatisch. Überall, wo in den Beispielen "&lt;PASSWORD-...&gt;" steht, sollte dann das konkrete Kennwort stehen. Einzusehen sind diese in "/etc/bacula/common_default_passwords". Für die File-Daemons müssen neue ausgedacht oder (besser) generiert werden.
</p></div></div><div class="section_1"><h2 id="etc-bacula-bacula-dir-conf">/etc/bacula/bacula-dir.conf<a class="headerlink" href="#etc-bacula-bacula-dir-conf">¶</a></h2><p>
Die Konfiguration des Directors ist am aufwendigsten, da dieser alle anderen Dienste steuert und somit wissen muss, wann und wie Backups gemacht werden. Untergliedert ist <strong>/etc/bacula/bacula-dir.conf</strong> in folgende Abschnitte:</p><ul><li><p><em>"Director"</em> - Definition des Dienst selber</p></li><li><p><em>"JobsDefs"</em> - Eine Default Job-Definition für alle Jobs, die nicht bekannt sind</p></li><li><p><em>"Job"</em> - Ein Backup-Auftrag, der von Bacula verarbeitet wird (enthält Verweise auf FileSet, Schedule und Client)</p></li><li><p><em>"FileSet"</em> - Definiert, wie und welche Dateien gesichert werden sollen</p></li><li><p><em>"Schedule"</em> - Wann und welche Art von Sicherung ausgeführt werden soll </p></li><li><p><em>"Client"</em> - Informationen zum File-Daemon auf den jeweiligen Client</p></li><li><p><em>"Storage"</em> - Informationen zum Storage-Daemon auf dem Server</p></li><li><p><em>"Catalog"</em> - Datenbank-Benutzer und Passwort</p></li><li><p><em>"Messages"</em> - Bestimmte Aktionen ausführen (z.B. Senden einer Email bei Fertigstellung des Backups)</p></li><li><p><em>"Pool"</em> - Einteilungen von verschiedene Jobs in Gruppen</p></li></ul><p>
</p><div class="section_2"><div class="section_3"><h4 id="Director">Director<a class="headerlink" href="#Director">¶</a></h4><p>
Die Konfiguration des Directors sollte selbsterklärend sein. Man kann "Maximum Concurrent Jobs" erhöhen, wenn man <strong class="highlighted">...</strong>
</p><pre class="notranslate">Director {
  Name = server-1-dir
  DIRport = 9101 
  QueryFile = "/etc/bacula/scripts/query.sql"
  WorkingDirectory = "/var/lib/bacula"
  PidDirectory = "/var/run/bacula"
  Maximum Concurrent Jobs = 1
  Password = "&lt;PASSWORD-dir&gt;" 
  Messages = Daemon
  DirAddress = 127.0.0.1
}</pre></div><div class="section_3"><h4 id="JobDefs">JobDefs<a class="headerlink" href="#JobDefs">¶</a></h4><p>
In "JobsDefs" werden die Standard-Optionen für die Jobs festgelegt, die bei allen anderen Jobs identisch sind.</p><pre class="notranslate">JobDefs {
 Name = "DefaultJob"
 Type = Backup
 Level = Incremental
 Messages = Standard
 Storage = server-1-storage
 Priority = 10
 Maximum Concurrent Jobs = 10
}</pre></div><div class="section_3"><h4 id="Jobs">Jobs<a class="headerlink" href="#Jobs">¶</a></h4><p>
In der Standard-Installation sind schon mehrere Jobs definiert: ein Beispiel-Job sowie welche, um den Katalog zu sichern und um Dateien im Problemfall wiederherzustellen. Man muss hier schon auf verschiedene Konfigurationen verweisen, die noch folgen (Client, Schedule, Storage, Pool, FileSet). Der erste wird folgendermaßen angepasst:</p><pre class="notranslate">Job {
  Name = "server-1-job"
  Jobdefs = "DefaultJob"
  Client = server-1-fd
  Schedule = "server-schedule"
  FileSet = "server-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/server-1.bsr"
}
Job {
  Name = "server-2-job"
  Jobdefs = "DefaultJob"
  Client = server-2-fd
  Schedule = "server-schedule"
  FileSet = "server-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/server-2.bsr"
}
Job {
  Name = "Home"
  Jobdefs = "DefaultJob"
  Client = server-2-fd
  Schedule = home-schedule
  FileSet = "home-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/home.bsr"
}</pre><p>Der BackupCatalog-Job bleibt unverändert, aber der Restore-Job muss noch angepasst werden, indem man den Server ("Client") und den Pfad ("Where") definiert, wo die Backups wiederhergestellt werden sollen:</p><pre class="notranslate">Job {
  Name = "BackupCatalog"
  JobDefs = "DefaultJob"
  Level = Full
  FileSet="Catalog"
  Schedule = "WeeklyCycleAfterBackup"
  RunBeforeJob = "/etc/bacula/scripts/make_catalog_backup.pl MyCatalog"
  RunAfterJob  = "/etc/bacula/scripts/delete_catalog_backup"
  Write Bootstrap = "/var/lib/bacula/%n.bsr"
  Priority = 11
  Messages = Standard
}

#Restore
Job {
  Name = "RestoreFiles"
  Type = Restore
  Client=server-1-fd
  FileSet="server-files"
  Storage = server-1-storage
  Pool = Default
  Messages = Standard
  Where = /tmp
}</pre></div><div class="section_3"><h4 id="FileSet">FileSet<a class="headerlink" href="#FileSet">¶</a></h4><p>
In FileSet kann man angeben, welche Dateien gesichert und welche Dateien in Ruhe gelassen werden sollen. In diesem Szenario werden drei verschiedene Arten von Sicherungen definiert, einmal von dem normalen Server, dem Home-Verzeichniss und den Katalog. Mit "signature = MD5" kann Bacula die Backups signieren sowie überprüfen und mit "compression=gzip" werden alle Backups komprimiert angelegt:</p><pre class="notranslate">FileSet {
        Name = "server-files"
        Include {
                File = /
                File = /var
                Options {
                        signature = MD5
                        compression = gzip
                        }
                }
        Exclude {
                File = /proc
                File = /tmp
                File = /home
                File = /dev
                File = /sys
                File = /var/tmp
                File = /mnt
                File = /media
                File = /var/ftp
                File = /var/lib/amavis/virusmails
                File = /var/lib/mysql/bacula/
                File = /var/cache/apt
                File = /var/account
                File = /var/cache/squid
                File = /var/tmp
        }
}
FileSet {
        Name = "home-files"
        Include {
                File = /home
                Options {
                        signature = MD5
                        compression=gzip
                        }
                }
        Exclude {
                }
}
FileSet {
  Name = "Catalog"
  Include {
    Options {
      signature = MD5
    }
    File = /var/lib/bacula/bacula.sql
  }
}</pre></div><div class="section_3"><h4 id="Schedule">Schedule<a class="headerlink" href="#Schedule">¶</a></h4><p>
Hier definiert man, zu welchem Zeitpunkt ein Backup gemacht wird:</p><pre class="notranslate">Schedule {
  Name = "server-schedule"
    Run = Level=Incremental Pool=server-pool mon-sat at 1:00
    Run = Level=Differential Pool=server-pool 2nd-5th sun at 1:00
    Run = Level=Full Pool=server-pool 1st sun at 1:00
}
Schedule {
  Name = "home-schedule"
   Run = Level=Full Pool=server-pool jan apr jul oct 1st sun at 1:00
   Run = Level=Incremental Pool=server-pool sun-sat at 1:00
}
Schedule {
  Name = "WeeklyCycleAfterBackup"
  Run = Full sun-sat at 4:00
}</pre><p>"WeeklyCycleAfterBackup" ist für das Sichern des Katalogs zuständig.</p></div><div class="section_3"><h4 id="Client">Client<a class="headerlink" href="#Client">¶</a></h4><p>
Dieser Abschnitt enthält Informationen über den File-Daemon auf den Clients. Für jeden der Zwei sollte man ein eigenes Kennwort sich ausdenken oder generieren lassen, welches nachher auch in die Konfiguration der Clients eingetragen werden muss. <em>"Adress"</em> steht für den jeweiligen Hostname oder IP-Adresse,  <em>"File Retention"</em> sagt aus, wie lange eine Datei zurückgehalten werden soll bis es gelöscht, analog dazu <em>"Job Retention"</em>, welches die Verfallszeit von Jobs angibt:</p><pre class="notranslate">Client {
  Name = server-1-fd
  Address = localhost
  FDPort = 9102
  Catalog = MyCatalog
  Password = "&lt;PASSWORD-server-1&gt;"      
  File Retention = 30 days
  Job Retention = 6 months
  AutoPrune = yes
  Maximum Concurrent Jobs = 10
}
Client {
  Name = server-2-fd
  Address = server-2
  FDPort = 9102
  Catalog = MyCatalog
  Password = "&lt;PASSWORD-server-2&gt;"     
  File Retention = 30 days     
  Job Retention = 6 months         
  AutoPrune = yes           
  Maximum Concurrent Jobs = 10
}</pre></div><div class="section_3"><h4 id="Storage">Storage<a class="headerlink" href="#Storage">¶</a></h4><p>
Hier gibt man dem Director die Informationen, die er braucht, um sich mit dem Storage-Daemon zu verbinden:</p><pre class="notranslate">Storage {
  Name = server-1-storage
  Address = localhost
  SDPort = 9103
  Password = "&lt;PASSWORD-storage&gt;"
  Device = FileStorage
  Media Type = File
  Maximum Concurrent Jobs = 10
}</pre></div><div class="section_3"><h4 id="Catalog">Catalog<a class="headerlink" href="#Catalog">¶</a></h4><p>
Hier muss man nichts verändern, weil der Account und das Passwort beim Installieren schon festgelegt und eingerichtet wurden:
</p><pre class="notranslate"># Generic catalog service (i.e. MySQL)
Catalog {
  Name = MyCatalog
  dbname = "bacula"; DB Address = ""; dbuser = "bacula"; dbpassword = "GEHEIM"
}</pre></div><div class="section_3"><h4 id="Messages">Messages<a class="headerlink" href="#Messages">¶</a></h4><p>
Um Benachrichtigungen bei einem erfolgreichen/fehlgeschlagenden Backup kümmert sich dieser Abschnitt. Die Standardkonfiguration sieht vor, eine E-Mail an <code class="notranslate">localhost</code> zu senden. Man kann das <code class="notranslate">localhost</code> durch eine interne IP-Adresse ersetzten.</p></div><div class="section_3"><h4 id="Pools">Pools<a class="headerlink" href="#Pools">¶</a></h4><p>
Hier kann man die Jobs nochmal unterteilen und die Größe festlegen, wann das Backup recycelt wird. Außerdem noch ein Label davor setzen, damit man die erstellen Backup-Dateien unterscheiden kann:</p><pre class="notranslate">Pool {
  Name = Default
  Pool Type = Backup
  Recycle = yes                   
  AutoPrune = yes                    
  Volume Retention = 31 days       
  Maximum Volume Bytes = 1g
  Maximum Volume Jobs = 50
  Label Format = "catalog-"
}

Pool {
  Name = server-pool
  Pool Type = Backup
  Recycle = yes
  AutoPrune = yes
  Volume Retention = 31 days
  Maximum Volume Bytes = 2g
  Maximum Volume Jobs = 400
  Maximum Volumes = 400
  Label Format = "server-"
}

# Scratch pool definition
Pool {
  Name = Scratch
  Pool Type = Backup
}</pre><p>
In diesem Fall ist die Festplatte 900 GiB groß (2x 400 GiB für die Server + 1x 50 GiB für den Katalog). Der "Scratch Pool" ist der Standard-Pool, aus denen die anderen dupliziert werden (nicht verändern).</p></div><div class="section_3"><h4 id="Monitor">Monitor<a class="headerlink" href="#Monitor">¶</a></h4><p>
</p><pre class="notranslate">Console {
  Name = server-1-mon
  Password = "&lt;PASSWORD-mon&gt;"
  CommandACL = status, .status
}</pre></div><div class="section_3"><h4 id="Gesamte-Konfiguration">Gesamte Konfiguration<a class="headerlink" href="#Gesamte-Konfiguration">¶</a></h4><p>
Hier der Einfachheit halber nochmal die ganze Konfiguration:</p><pre class="notranslate">Director {
  Name = server-1-dir
  DIRport = 9101 
  QueryFile = "/etc/bacula/scripts/query.sql"
  WorkingDirectory = "/var/lib/bacula"
  PidDirectory = "/var/run/bacula"
  Maximum Concurrent Jobs = 1
  Password = "&lt;PASSWORD-dir&gt;" 
  Messages = Daemon
  DirAddress = 127.0.0.1
}

JobDefs {
 Name = "DefaultJob"
 Type = Backup
 Level = Incremental
 Messages = Standard
 Storage = server-1-storage
 Priority = 10
 Maximum Concurrent Jobs = 10
 Pool = "Default"
 Client = "server-1-fd"
}

Job {
  Name = "server-1-job"
  Jobdefs = "DefaultJob"
  Client = server-1-fd
  Schedule = "server-schedule"
  FileSet = "server-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/server-1.bsr"
}
Job {
  Name = "server-2-job"
  Jobdefs = "DefaultJob"
  Client = server-2-fd
  Schedule = "server-schedule"
  FileSet = "server-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/server-2.bsr"
}
Job {
  Name = "Home"
  Jobdefs = "DefaultJob"
  Client = server-2-fd
  Schedule = home-schedule
  FileSet = "home-files"
  Pool = "server-pool"
  Messages = Standard
  Write Bootstrap = "/var/lib/bacula/home.bsr"
}
Job {
  Name = "BackupCatalog"
  JobDefs = "DefaultJob"
  Level = Full
  FileSet="Catalog"
  Schedule = "WeeklyCycleAfterBackup"
  RunBeforeJob = "/etc/bacula/scripts/make_catalog_backup.pl MyCatalog"
  RunAfterJob  = "/etc/bacula/scripts/delete_catalog_backup"
  Write Bootstrap = "/var/lib/bacula/%n.bsr"
  Priority = 11
  Messages = Standard
}

#Restore
Job {
  Name = "RestoreFiles"
  Type = Restore
  Client=server-1-fd
  FileSet="server-files"
  Storage = server-1-storage
  Pool = Default
  Messages = Standard
  Where = /tmp
}

FileSet {
        Name = "server-files"
        Include {
                File = /
                File = /var
                Options {
                        signature = MD5
                        compression = gzip
                        }
                }
        Exclude {
                File = /proc
                File = /tmp
                File = /home
                File = /dev
                File = /sys
                File = /var/tmp
                File = /mnt
                File = /media
                File = /var/ftp
                File = /var/lib/amavis/virusmails
                File = /var/lib/mysql/bacula/
                File = /var/cache/apt
                File = /var/account
                File = /var/cache/squid
                File = /var/tmp
        }
}
FileSet {
        Name = "home-files"
        Include {
                File = /home
                Options {
                        signature = MD5
                        compression=gzip
                        }
                }
        Exclude {
                }
}
FileSet {
  Name = "Catalog"
  Include {
    Options {
      signature = MD5
    }
    File = /var/lib/bacula/bacula.sql
  }
}

Schedule {
  Name = "server-schedule"
    Run = Level=Incremental Pool=server-pool mon-sat at 1:00
    Run = Level=Differential Pool=server-pool 2nd-5th sun at 1:00
    Run = Level=Full Pool=server-pool 1st sun at 1:00
}
Schedule {
  Name = "home-schedule"
   Run = Level=Full Pool=server-pool jan apr jul oct 1st sun at 1:00
   Run = Level=Incremental Pool=server-pool sun-sat at 1:00
}
Schedule {
  Name = "WeeklyCycleAfterBackup"
  Run = Full sun-sat at 4:00
}

Client {
  Name = server-1-fd
  Address = localhost
  FDPort = 9102
  Catalog = MyCatalog
  Password = "&lt;PASSWORD-server-1&gt;"      
  File Retention = 30 days
  Job Retention = 6 months
  AutoPrune = yes
  Maximum Concurrent Jobs = 10
}
Client {
  Name = server-2-fd
  Address = server-2
  FDPort = 9102
  Catalog = MyCatalog
  Password = "&lt;PASSWORD-server-2&gt;"     
  File Retention = 30 days     
  Job Retention = 6 months         
  AutoPrune = yes           
  Maximum Concurrent Jobs = 10
}

Storage {
  Name = server-1-storageQuerverlinkung eingefügt
  Address = localhost
  SDPort = 9103
  Password = "&lt;PASSWORD-storage&gt;"
  Device = FileStorage
  Media Type = File
  Maximum Concurrent Jobs = 10
}

Pool {
  Name = Default
  Pool Type = Backup
  Recycle = yes                   
  AutoPrune = yes                    
  Volume Retention = 31 days       
  Maximum Volume Bytes = 1g
  Maximum Volume Jobs = 50
  Label Format = "catalog-"
}

Pool {
  Name = server-pool
  Pool Type = Backup
  Recycle = yes
  AutoPrune = yes
  Volume Retention = 31 days
  Maximum Volume Bytes = 2g
  Maximum Volume Jobs = 400
  Maximum Volumes = 400
  Label Format = "server-"
}

# Scratch pool definition
Pool {
  Name = Scratch
  Pool Type = Backup
}

# Generic catalog service (i.e. MySQL)
Catalog {
  Name = MyCatalog
  dbname = "bacula"; DB Address = ""; dbuser = "bacula"; dbpassword = "GEHEIM"
}

# Reasonable message delivery -- send most everything to email address
#  and to the console
Messages {
  Name = Standard
#
# NOTE! If you send to two email or more email addresses, you will need
#  to replace the %r in the from field (-f part) with a single valid
#  email address in both the mailcommand and the operatorcommand.
#  What this does is, it sets the email address that emails would display
#  in the FROM field, which is by default the same email as they're being
#  sent to.  However, if you send email to more than one address, then
#  you'll have to set the FROM address manually, to a single address. 
#  for example, a 'no-reply@mydomain.com', is better since that tends to
#  tell (most) people that its coming from an automated source.

#
  mailcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \&lt;%r\&gt;\" -s \"Bacula: %t %e of %c %l\" %r"
  operatorcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \&lt;%r\&gt;\" -s \"Bacula: Intervention needed for %j\" %r"
  mail = root@localhost = all, !skipped
  operator = root@localhost = mount
  console = all, !skipped, !saved
#
# WARNING! the following will create a file that you must cycle from
#          time to time as it will grow indefinitely. However, it will
#          also keep all your messages if they scroll off the console.
#
  append = "/var/lib/bacula/log" = all, !skipped

  catalog = all
}


#
# Message delivery for daemon messages (no job).
Messages {
  Name = Daemon
  mailcommand = "/usr/lib/bacula/bsmtp -h localhost -f \"\(Bacula\) \&lt;%r\&gt;\" -s \"Bacula daemon message\" %r"
  mail = root@localhost = all, !skipped
  console = all, !skipped, !saved
  append = "/var/lib/bacula/log" = all, !skipped
}

#
# Restricted console used by tray-monitor to get the status of the director
#
Console {
  Name = ubuntu-server-mon
  Password = "&lt;PASSWORD-mon&gt;"
  CommandACL = status, .status
}</pre></div><div class="section_3"><h4 id="Neustarten">Neustarten<a class="headerlink" href="#Neustarten">¶</a></h4><p>
Nach Änderungen an der Konfiguration muss der Director neu gestartet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/bacula-director restart </pre></div></div></div></div></div><div class="section_1"><h2 id="etc-bacula-bacula-sd-conf">/etc/bacula/bacula-sd.conf<a class="headerlink" href="#etc-bacula-bacula-sd-conf">¶</a></h2><p>
Die Konfiguration des Storage-Daemon verläuft ähnlich. Erstmal definiert man selbigen:</p><pre class="notranslate">Storage {
  Name = server-1-sd
  SDPort = 9103
  WorkingDirectory = "/var/lib/bacula"
  Pid Directory = "/var/run/bacula"
  Maximum Concurrent Jobs = 50
}</pre><div class="section_2"><div class="section_3"><h4 id="Director-2">Director<a class="headerlink" href="#Director-2">¶</a></h4><p>
Nachdem man den Storage-Daemon definiert hat, muss man noch regeln, welcher Director-Daemon sich mit ihm verbinden darf. Dabei muss natürlich das Passwort mit denjenigen im Director übereinstimmen:</p><pre class="notranslate">Director {
  Name = server-1-dir
  Password = "&lt;PASSWORD-storage&gt;"
}</pre></div><div class="section_3"><h4 id="Device">Device<a class="headerlink" href="#Device">¶</a></h4><p>
Unter dem Eintrag <em>"Device"</em> kann man definieren, unter welchem Verzeichnis man Backups sichern will:</p><pre class="notranslate">Device {
  Name = FileStorage
  Media Type = File
  Archive Device = /mnt/backup
  LabelMedia = yes;                  
  Random Access = Yes;
  AutomaticMount = yes;
  RemovableMedia = no;
  AlwaysOpen = no;
}</pre><p>
Sollte wieder selbsterklärend sein. Um die Datensicherheit nochmal zu steigern, könnten die in <strong>/mnt/backup</strong> eingehängten "Datenträger" ein <a class="internal" href="../software-raid.html">Software-RAID</a> besitzen.</p></div><div class="section_3"><h4 id="Messages-2">Messages<a class="headerlink" href="#Messages-2">¶</a></h4><p>
Damit alle Fehlermeldungen vom Storage auch am Director einsehbar sind, werden hier die Logs zurückgeschickt:</p><pre class="notranslate">Messages {
  Name = Standard
  director = server-1-dir = all
}</pre></div><div class="section_3"><h4 id="Neustarten-2">Neustarten<a class="headerlink" href="#Neustarten-2">¶</a></h4><p>
Nach Änderungen an der Konfiguration muss der Storage-Daemon neu gestartet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/bacula-sd restart </pre></div></div></div></div></div><div class="section_1"><h2 id="Erstellen-der-Volumina">Erstellen der Volumina<a class="headerlink" href="#Erstellen-der-Volumina">¶</a></h2><p>
Nachdem man den Director und Storage funktionstüchtig eingerichtet hat, müssen noch die benötigten Volumina erstellt werden, in denen Backups gesichert werden. Dazu muss ein Shell-Skript (z.B. <strong>create-volumes.sh</strong>) mit folgendem Inhalt erstellt werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span> -e <span class="s2">"\t(1) Print Only\n\t(2) Execute"</span>
<span class="nb">read</span> -p <span class="s1">'Choice: '</span> choice
<span class="nb">echo</span> -e <span class="s2">"\tNumber:"</span>
<span class="nb">read</span> num

<span class="k">if</span> <span class="o">[</span> <span class="nv">$choice</span> -eq <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">pipe</span><span class="o">=</span>bconsole
<span class="k">else</span>
        <span class="nv">pipe</span><span class="o">=</span>cat
<span class="k">fi</span>

<span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">2</span> <span class="nv">$num</span><span class="k">)</span>
<span class="k">do</span>
        cat <span class="s">&lt;&lt;-_</span>
<span class="s">        label</span>
<span class="s">        server-$(printf "%04d" $i)</span>
<span class="s">        3</span>
<span class="s">        _</span>
<span class="k">done</span> <span class="p">|</span> <span class="nv">$pipe</span>
</pre></div>
</td></tr></table></div><p>Nun macht man das Skript ausführbar und startet es mit Root-Rechten:</p><div class="bash"><div class="contents"><pre class="notranslate">chmod +x ./create-volumes.sh
sudo ./create-volumes.sh </pre></div></div><p>Nun hat man die Möglichkeit, zwischen "Print only" und "Execute" zu wählen. Bei "Print only" wird angezeigt, welche Befehle der <a class="internal" href="../bacula/bconsole.html">bconsole</a> übergeben werden, bei "Execute" werden diese ausgeführt. Außerdem ist die Anzahl der Volumina, die man unter dem Server-Pool angegeben habt, wichtig.</p><div class="section_2"><h3 id="Links">Links<a class="headerlink" href="#Links">¶</a></h3><p>
</p><ul><li><p><a class="external" href="http://www.bacula.org/5.2.x-manuals/en/main/main/Configuring_Director.html" rel="nofollow">Configuring Director</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - offizielle Dokumentation</p></li><li><p><a class="external" href="http://www.bacula.org/manuals/en/install/install/Storage_Daemon_Configuratio.html" rel="nofollow">Storage Daemon Configuration</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="internal" href="../bacula.html">Bacula</a> - Hauptartikel</p></li></ul><p>
</p></div></div></div>
<p class="meta">
<a href="../bacula/server-konfiguration/a/revision/938628.html">Diese Revision</a> wurde am 1. Mai 2017 17:22 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../bacula.html">Bacula</a></li>
<li><a href="../bacula/server-konfiguration.html">Server-Konfiguration</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>