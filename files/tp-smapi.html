<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>TP-SMAPI › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./tp-smapi.html">TP-SMAPI</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/TP-SMAPI">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./tp-smapi/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./tp-smapi/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./tp-smapi/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./tp-smapi/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./tp-smapi/a/backlinks.html">TP-SMAPI</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Paketen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./editor.html">Einen Editor mit Root-Rechten öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Kernelmodul-manuell-laden">Kernelmodul manuell laden
</a></li><li><a class="crosslink" href="#Problembehebung">Problembehebung
</a></li><li><a class="crosslink" href="#Kernelmodul-automatisch-beim-Systemstart-laden">Kernelmodul automatisch beim Systemstart...</a></li></ol></li><li><a class="crosslink" href="#Akkufunktionen">Akkufunktionen
</a></li><li><a class="crosslink" href="#Anwendungsbeispiele">Anwendungsbeispiele
</a><ol class="arabic"><li><a class="crosslink" href="#Akkudaten-auslesen">Akkudaten auslesen
</a></li><li><a class="crosslink" href="#Stromverbrauch-anzeigen">Stromverbrauch anzeigen
</a></li><li><a class="crosslink" href="#Ladeschwellen-einstellen">Ladeschwellen einstellen
</a></li><li><a class="crosslink" href="#Akku-rekalibrieren">Akku rekalibrieren
</a></li></ol></li><li><a class="crosslink" href="#Besonderheiten">Besonderheiten
</a><ol class="arabic"><li><a class="crosslink" href="#ThinkPad-Edge-L-SL-ab-SL410-510">ThinkPad Edge, L, SL (ab SL410/510)
</a></li><li><a class="crosslink" href="#ThinkPad-T420-s-T520-W520-X220-E320">ThinkPad T420(s), T520, W520, X220, E320...</a></li><li><a class="crosslink" href="#ThinkPad-T430-s-T530-W530-X230-S430">ThinkPad T430(s), T530, W530, X230, S430...</a></li></ol></li><li><a class="crosslink" href="#Alternative-tpacpi-bat">Alternative tpacpi-bat
</a></li><li><a class="crosslink" href="#Links">Links
</a><ol class="arabic"><li><a class="crosslink" href="#Intern">Intern
</a></li><li><a class="crosslink" href="#Extern">Extern
</a></li></ol></li></ol></div><p><img alt="Wiki/Icons/Oxygen/battery.png" class="image-left" src="./_/12c882abfbd3e392e85996a3d79db29cc54a416d.png"/></p><p>Notebooks von IBM/Lenovo (ThinkPads) besitzen eine proprietäre Schnittstelle namens <em>"SMAPI BIOS"</em> (System Management Application Program Interface), die über den Umfang von <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI</a> hinausgehende Möglichkeiten zur  Hardwaresteuerung bietet:</p><ul><li><p><strong>tp_smapi</strong>: Kontrolle des Akkuladevorgangs und erweiterter Akkustatus</p></li><li><p><strong>hdaps</strong>: siehe <a class="internal" href="./festplattenschutz.html">Festplattenschutz</a></p></li></ul><p>
tp-smapi ist <span class="underline">nicht</span> zuständig für das Schalten der Funkgeräte, Hotkeys, Temperaturanzeige sowie die Lüftersteuerung. Darum kümmert sich das Kernelmodul <a class="internal" href="./thinkpad_acpi.html">thinkpad_acpi</a>.</p><p>Benutzer folgender Modelle sollten den Abschnitt <a class="crosslink" href="#Besonderheiten">Besonderheiten</a> beachten:
</p><ul><li><p>ThinkPad Edge, L, SL (ab SL410/510)</p></li><li><p>ThinkPad T420(s), T520, W520, X220, E320</p></li></ul><p>
<a class="crosslink anchor" href="#inkompatibel" id="inkompatibel"></a>
Inkompatible Modelle, auf denen tp-smapi generell nicht funktioniert:
</p><ul><li><p>alle Nicht-ThinkPad-Baureihen von Lenovo (z.B. Ideapad-Reihe)</p></li><li><p>ThinkPad SL300/400/500</p></li><li><p>ThinkPad X121e</p></li><li><p>ThinkPad L430, L530, T430(s), T530, W530, X230, S430 sowie <span class="underline">alle</span> neueren Baureihen – siehe <a class="internal" href="./tp-smapi.html#Alternative-tpacpi-bat">Alternative tpacpi-bat</a></p></li></ul><p>
Die in tp-smapi enthaltenen Kernelmodule <code class="notranslate">tp_smapi</code> und <code class="notranslate">hdaps</code> machen diese Steuerungsmöglichkeiten über die sysfs-Schnittstelle als Dateien unterhalb von <strong>/sys/devices/platform/smapi/</strong> und <strong>/sys/devices/platform/hdaps/</strong> zugänglich.</p><p>Beide Kernelmodule verwenden ein drittes Modul <code class="notranslate">thinkpad_ec</code> für den Zugriff auf den sog. <em>"Embedded Controller"</em>, der SMAPI hardwareseitig implementiert.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
tp-smapi ist in den Ubuntu-Paketquellen verfügbar. Zu installieren <sup><a href="#source-1">[1]</a></sup> ist das Paket
</p><ul><li><p><strong>tp-smapi-dkms</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install tp-smapi-dkms </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install tp-smapi-dkms </pre></div></div><p>
</p></div></div><p>Ab Ubuntu 16.04.2 mit HWE-Kernel 4.8 erhält man bei der Installation des Pakets folgende Fehlermeldung:
</p><pre class="notranslate">Error! Bad return status for module build on kernel: 4.8.0-46-generic (x86_64)</pre><p>
Zur Behebung lädt man das neuere Paket aus Ubuntu 16.10 <a class="external" href="http://de.archive.ubuntu.com/ubuntu/pool/universe/t/tp-smapi/tp-smapi-dkms_0.42-1_all.deb" rel="nofollow">herunter</a> und installiert es von Hand <sup><a href="#source-1">[1]</a></sup>.</p><div class="section_2"><h3 id="Kernelmodul-manuell-laden">Kernelmodul manuell laden<a class="headerlink" href="#Kernelmodul-manuell-laden">¶</a></h3><p>
Um die sysfs-Schnittstelle nutzen zu können, muss nach der Installation noch das Kernelmodul <code class="notranslate">tp_smapi</code> geladen werden.</p><p>Das Terminal-Kommando <sup><a href="#source-2">[2]</a></sup></p><div class="bash"><div class="contents"><pre class="notranslate">sudo modprobe -v tp_smapi </pre></div></div><p>
lädt die Module <code class="notranslate">tp_smapi</code> und <code class="notranslate">thinkpad_ec</code> und produziert im Erfolgsfall folgende Ausgabe:</p><pre class="notranslate">insmod /lib/modules/KERNELVERSION/updates/dkms/thinkpad_ec.ko
insmod /lib/modules/KERNELVERSION/updates/dkms/tp_smapi.ko</pre></div><div class="section_2"><h3 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h3><p>
Erscheint beim obigen Kommando hingegen die Fehlermeldung</p><pre class="notranslate">insmod /lib/modules/KERNELVERSION/updates/dkms/thinkpad_ec.ko
WARNING: Error inserting thinkpad_ec (/lib/modules/KERNELVERSION/updates/dkms/thinkpad_ec.ko): No such device or address
FATAL: Error inserting tp_smapi (/lib/modules/KERNELVERSION/updates/dkms/tp_smapi.ko): No such device or address</pre><p>
kann man die Ursache weiter eingrenzen mit
</p><div class="bash"><div class="contents"><pre class="notranslate">dmesg | grep thinkpad_ec </pre></div></div><p><a class="crosslink anchor" href="#noec" id="noec"></a>
Erscheint die Meldung
</p><pre class="notranslate">... thinkpad_ec: no ThinkPad embedded controller!</pre><p>
so handelt es sich entweder um ein sehr altes ThinkPad-Modell, das tp-smapi nicht unterstützt (siehe <a class="external" href="http://www.thinkwiki.org/wiki/Tp_smapi#Model-specific_status" rel="nofollow">tp-smapi</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>) oder um ein ganz neues Modell. Im zweiten Fall hilft der Abschnitt <a class="crosslink" href="#ThinkPad-T420-s-T520-W520-X220">ThinkPad T420(s), T520, W520, X220</a> weiter.</p><p>Erscheint die Meldung
</p><pre class="notranslate">... thinkpad_ec: cannot claim IO ports 0x1600-0x161f... consider using force_io=1</pre><p>
sollte man einzeln in der genannten Reihenfolge die nachfolgenden Lösungsmöglichkeiten durchtesten und jeweils den obigen Ladebefehl wiederholen.</p><div class="section_3"><h4 id="Hardware-Reset">Hardware Reset<a class="headerlink" href="#Hardware-Reset">¶</a></h4><p>
</p><ul><li><p>ThinkPad herunterfahren und ausschalten</p></li><li><p>Netzteil entfernen</p></li><li><p>Akku entfernen</p></li><li><p>Einschalttaste mindestens 30 Sekunden gedrückt halten</p></li><li><p>Stromversorgung wieder herstellen und das ThinkPad starten</p></li></ul><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Beim ThinkPad X121e kann der Hardware-Reset dazu führen, dass das Notebook überhaupt nicht mehr startet (2 Fälle im Forum aufgetreten) und das Gerät in die Werkstatt muss. Alle anderen Modelle sind von diesem Problem jedoch nicht betroffen.
</p></div></div></div><div class="section_3"><h4 id="BIOS-Default-Settings">BIOS Default Settings<a class="headerlink" href="#BIOS-Default-Settings">¶</a></h4><p>
</p><ul><li><p>Nach dem Einschalten beim Erscheinen des ThinkPad-Logos mit 
<span class="key">F1</span>  ins BIOS Setup</p></li><li><p>
<span class="key">F9</span>  (Default Settings) 
<span class="key">⏎</span>  (Yes)</p></li><li><p>
<span class="key">F10</span>  (Save and Exit) 
<span class="key">⏎</span>  (Yes)</p></li><li><p>Nach dem Erscheinen des ThinkPad-Logos durch Halten der Einschalttaste (ca. 10 Sekunden) ThinkPad ausschalten</p></li><li><p>Wieder einschalten</p></li></ul><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bei einem im <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface">UEFI</a>-Modus installiertem Ubuntu – erkennbar z.B. an der Existenz des Verzeichnisses <strong>/sys/firmware/efi</strong> – wird durch den Aufruf der Default Settings der Booteintrag gelöscht, dadurch startet das System nicht mehr. Den Booteintrag kann man mittels eines Live-Systems (<a class="internal" href="./live-cd.html">Live-CD</a>/<a class="internal" href="./live-usb.html">Live-USB</a>) per <a class="internal" href="./efibootmgr.html#Booteintrag-erstellen">efibootmgr</a> wiederherstellen.
</p></div></div><p>Manchmal liegt das Problem auch an einer veralteten BIOS-Version. Auf der <a class="external" href="http://support.lenovo.com/de_DE/" rel="nofollow">Herstellerseite</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> werden BIOS-Updates in Form von bootfähigen ISO-Images angeboten. Nach jedem BIOS-Update sollte man unbedingt wie oben beschrieben die <em>"Default Settings"</em> aktivieren.</p></div><div class="section_3"><h4 id="Modulparameter">Modulparameter<a class="headerlink" href="#Modulparameter">¶</a></h4><p>
Mit einem Editor mit Root-Rechten <sup><a href="#source-3">[3]</a></sup> legt man die Datei <strong>/etc/modprobe.d/tp-smapi.conf</strong> mit folgendem Inhalt an:</p><pre class="notranslate">options thinkpad_ec force_io=1</pre></div><div class="section_3"><h4 id="Inkompatible-Hardware">Inkompatible Hardware<a class="headerlink" href="#Inkompatible-Hardware">¶</a></h4><p>
Bringen die vorstehenden Maßnahmen keinen Erfolg, dann hat man eine <a class="crosslink" href="#inkompatibel">inkompatible Hardware</a>.</p></div></div><div class="section_2"><h3 id="Kernelmodul-automatisch-beim-Systemstart-laden">Kernelmodul automatisch beim Systemstart laden<a class="headerlink" href="#Kernelmodul-automatisch-beim-Systemstart-laden">¶</a></h3><p>
Wenn das manuelle Laden erfolgreich getestet wurde, kann man es durch Einfügen <sup><a href="#source-3">[3]</a></sup> der folgenden Zeile in <strong>/etc/modules</strong> automatisieren:
</p><pre class="notranslate">tp_smapi</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Benutzer von TLP (siehe <a class="crosslink" href="#Links">Links</a>) brauchen diesen Schritt nicht durchzuführen, da TLP <code class="notranslate">tp_smapi</code> automatisch lädt.
</p></div></div></div></div><div class="section_1"><h2 id="Akkufunktionen">Akkufunktionen<a class="headerlink" href="#Akkufunktionen">¶</a></h2><p>
Status und Einstellungen sind je Akku als Dateien unterhalb eines Verzeichnisses abgebildet:
<a class="crosslink anchor" href="#tabelle1" id="tabelle1"></a></p><p>
</p><table><tr class="titel"><td colspan="2"> Tabelle 1: Akkuverzeichnisse </td></tr><tr class="kopf"><td> Akku </td><td> Verzeichnis </td></tr><tr><td> Hauptakku </td><td> <strong>/sys/devices/platform/smapi/BAT0/</strong> </td></tr><tr><td> Ultrabayakku </td><td> <strong>/sys/devices/platform/smapi/BAT1/</strong> </td></tr></table><p>Die Bedeutung der einzelnen Dateien erklärt die folgende Tabelle (aus Gründen der Übersichtlichkeit wird nur eine Auswahl wiedergegeben):</p><p><a class="crosslink anchor" href="#tabelle2" id="tabelle2"></a>
</p><p>
</p><table><tr class="titel"><td colspan="5"> Tabelle 2: Akkufunktionen </td></tr><tr class="kopf"><td> Datei </td><td> Schreibbar </td><td> Funktion </td><td> Einheit </td><td> Bemerkung </td></tr><tr><td> <code class="notranslate">current_avg</code> </td><td style="text-align: center">N </td><td> Akkustrom (Durchschnitt) </td><td> mA </td><td> Durchschnitt der letzten Minute; positiver Wert=Akku wird geladen, negativer Wert=Akku wird entladen </td></tr><tr><td> <code class="notranslate">current_now</code> </td><td style="text-align: center">N </td><td> Akkustrom (momentan) </td><td> mA </td><td> positiver Wert=Akku wird geladen, negativer Wert=Akku wird entladen </td></tr><tr><td> <code class="notranslate">cycle_count</code> </td><td style="text-align: center">N </td><td> Anzahl Ladezyklen </td><td> 1 </td><td> als Ladezyklus zählt eine vollständige Entladung des Akkus, d.h. von 100 % auf 0 %, oder z.B. zweimaliges Entladen von 80 % auf 30 %, gefolgt von einer Aufladung auf den Ursprungswert </td></tr><tr><td> <code class="notranslate">design_capacity</code> </td><td style="text-align: center">N </td><td> Vorgesehener Energieinhalt </td><td> mWh </td><td> Designkapazität (mAh) · Nennspannung (V) </td></tr><tr><td> <code class="notranslate">design_voltage</code> </td><td style="text-align: center">N </td><td> Nennspannung </td><td> mV </td><td> </td></tr><tr><td> <code class="notranslate">first_use_date</code> </td><td style="text-align: center">N </td><td> Datum der Erstverwendung </td><td> JJJJ-MM-TT </td><td> </td></tr><tr><td> <code class="notranslate">force_discharge</code> </td><td style="text-align: center">J </td><td> Entladung erzwingen </td><td> - </td><td> 0=Inaktiv, 1=Entladen; Zwangsentladung ist nur bei angeschlossenem Netzteil möglich; der Entladevorgang wird bei leerem Akku automatisch beendet und der Akku anschließend bis zur eingestellten oberen Ladeschwelle (s.u.) geladen </td></tr><tr><td> <code class="notranslate">inhibit_charge_minutes</code> </td><td style="text-align: center">J </td><td> Ladevorgang unterbrechen für definierte Zeitspanne </td><td> min </td><td> </td></tr><tr><td> <code class="notranslate">installed</code> </td><td style="text-align: center">N </td><td> Akku vorhanden </td><td> - </td><td> 0=nein, 1=ja </td></tr><tr><td> <code class="notranslate">last_full_capacity</code> </td><td style="text-align: center">N </td><td> Energieinhalt nach letzter vollständiger Aufladung </td><td> mWh </td><td> Tatsächlich nutzbarer Energieinhalt; dieser Wert kann bei neuem Akku über dem vorgesehenen (s.o.) liegen und sinkt im Verlauf des Akkulebens durch Verschleiß allmählich ab </td></tr><tr><td> <code class="notranslate">manufacture_date</code> </td><td style="text-align: center">N </td><td> Herstellungsdatum </td><td> JJJJ-MM-TT </td><td> </td></tr><tr><td> <code class="notranslate">manufacturer</code> </td><td style="text-align: center">N </td><td> Hersteller der Akkuzellen </td><td> - </td><td> </td></tr><tr><td> <code class="notranslate">power_avg</code> </td><td style="text-align: center">N </td><td> Leistungsaufnahme/-abgabe (Durchschnitt) </td><td> mW </td><td> Durchschnitt der letzten Minute; positiver Wert=Akku wird geladen, negativer Wert=Akku wird entladen </td></tr><tr><td> <code class="notranslate">power_now</code> </td><td style="text-align: center">N </td><td> Leistungsabgabe (momentan) </td><td> mW </td><td> positiver Wert=Akku wird geladen, negativer Wert=Akku wird entladen </td></tr><tr><td> <code class="notranslate">remaining_capacity</code> </td><td style="text-align: center">N </td><td> momentaner Energieinhalt </td><td> mWh </td><td> </td></tr><tr><td> <code class="notranslate">remaining_charging_time</code> </td><td style="text-align: center">N </td><td> verbleibende Ladezeit </td><td> min </td><td> </td></tr><tr><td> <code class="notranslate">remaining_percent</code> </td><td style="text-align: center">N </td><td> momentaner Ladestand </td><td> % </td><td> </td></tr><tr><td> <code class="notranslate">remaining_running_time</code> </td><td style="text-align: center">N </td><td> Restlaufzeit (Durchschnitt) </td><td> min </td><td> Schätzung aus Durchschnitts-Endladestrom (s.o.) </td></tr><tr><td> <code class="notranslate">remaining_running_time_now</code> </td><td style="text-align: center">N </td><td> Restlaufzeit (momentan) </td><td> min </td><td> Schätzung aus momentanem Endladestrom (s.o.) </td></tr><tr><td> <code class="notranslate">state</code> </td><td style="text-align: center">N </td><td> Akkustatus </td><td> - </td><td> charging=Akku wird geladen, discharging=Akku wird entladen, idle=keine Änderung des Ladestands </td></tr><tr><td> <code class="notranslate">start_charge_thresh</code> </td><td style="text-align: center">J </td><td> untere Ladeschwelle </td><td> % </td><td> Das Aufladen startet beim Anschließen des Netzteils nur dann, wenn die Ladung unterhalb dieses Werts liegt; Werkseinstellung: 96 % </td></tr><tr><td> <code class="notranslate">stop_charge_thresh</code> </td><td style="text-align: center">J </td><td> obere Ladeschwelle </td><td> % </td><td> Beim Erreichen dieses Werts endet der Aufladevorgang; Werkseinstellung: 100 % </td></tr><tr><td> <code class="notranslate">temperature</code> </td><td style="text-align: center">N </td><td> Akkutemperatur </td><td> °C / 1000 </td><td> </td></tr><tr><td> <code class="notranslate">voltage</code> </td><td style="text-align: center">N </td><td> Akkuspannung (momentan) </td><td> mV </td><td> </td></tr></table></div><div class="section_1"><h2 id="Anwendungsbeispiele">Anwendungsbeispiele<a class="headerlink" href="#Anwendungsbeispiele">¶</a></h2><p>
</p><div class="section_2"><h3 id="Akkudaten-auslesen">Akkudaten auslesen<a class="headerlink" href="#Akkudaten-auslesen">¶</a></h3><p>
Alle in <a class="crosslink" href="#tabelle2">Tabelle 2</a> aufgeführten Daten lassen sich per Terminalkommando auslesen. Entweder einzeln mit</p><div class="bash"><div class="contents"><pre class="notranslate">cat /sys/devices/platform/smapi/BATx/DATEI </pre></div></div><p>oder alles zusammen mit</p><div class="bash"><div class="contents"><pre class="notranslate">grep '.*' /sys/devices/platform/smapi/BATx/* </pre></div></div></div><div class="section_2"><h3 id="Stromverbrauch-anzeigen">Stromverbrauch anzeigen<a class="headerlink" href="#Stromverbrauch-anzeigen">¶</a></h3><p>
Folgendes Kommando gibt alle 5 Sekunden die am Hauptakku gemessene momentane Leistungsaufnahme aus:</p><div class="bash"><div class="contents"><pre class="notranslate">watch -n 5 cat /sys/devices/platform/smapi/BAT0/power_now </pre></div></div><p>
Beenden mit 
<span class="key">Strg</span>  + 
<span class="key">C</span> .</p></div><div class="section_2"><h3 id="Ladeschwellen-einstellen">Ladeschwellen einstellen<a class="headerlink" href="#Ladeschwellen-einstellen">¶</a></h3><p>
Um beim Hauptakku den Ladebeginn auf 75% und das Ladeende auf 80% der Akkukapazität festzulegen, verwendet man folgende Kommandos:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo sh -c "echo 75 &gt; /sys/devices/platform/smapi/BAT0/start_charge_thresh"
sudo sh -c "echo 80 &gt; /sys/devices/platform/smapi/BAT0/stop_charge_thresh" </pre></div></div><p><span class="underline">Hinweise:</span>
</p><ul><li><p>Die untere Ladeschwelle muss mindestens 4 Prozentpunkte kleiner als die obere sein; von dieser Regel abweichende Werte werden von tp-smapi eigenständig angepaßt </p></li><li><p>Die so eingestellten Ladeschwellen werden erst wirksam, nachdem das ThinkPad einmal heruntergefahren und ausgeschaltet wurde (siehe auch <a class="crosslink" href="#Ladeschwellen-im-laufenden-Betrieb-aktivieren">sofort aktivieren</a>)</p></li><li><p>Die Ladeschwellen bleiben beim Ausschalten des ThinkPads erhalten</p></li><li><p>Die Ladeschwellen gehen beim Entnehmen des Akkus verloren und müssen nach dem Wiedereinsetzen neu geschrieben werden (gilt nur für ältere Modelle)</p></li></ul><p>
Möchte man - z.B. aufgrund des vorstehenden Hinweises zum Akkuwechsel - die Ladeschwellen bei jedem Systemstart erneut setzen, nimmt man folgende Zeilen in <a class="internal" href="./rc.local.html">rc.local</a> auf <sup><a href="#source-3">[3]</a></sup> :
</p><pre class="notranslate">echo 75 &gt; /sys/devices/platform/smapi/BAT0/start_charge_thresh
echo 80 &gt; /sys/devices/platform/smapi/BAT0/stop_charge_thresh</pre><div class="section_3"><h4 id="Ladeschwellen-aktivieren">Ladeschwellen aktivieren<a class="headerlink" href="#Ladeschwellen-aktivieren">¶</a></h4><p>
Bei älteren ThinkPad-Modellen greifen die so geschriebenen Akkuladeschwellen nicht sofort. Man aktiviert sie entweder durch Herunterfahren und Ausschalten des ThinkPads oder indem man im laufenden Betrieb <code class="notranslate">force_discharge</code> für kurze Zeit (im Beispiel 2s) auf 1 setzt:</p><div class="bash"><div class="contents"><pre class="notranslate">cd /sys/devices/platform/smapi/BAT0/
sudo sh -c "echo 1 &gt; force_discharge; sleep 2; echo 0 &gt; force_discharge" </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>In einem Fall eines ThinkPads mit defektem Akku wurde beobachtet, dass diese Vorgehensweise zu einer Unterbrechung der Stromversorgung und damit zum sofortigen Neustart führte. Daher sollte das Kommando keinesfalls in den Systemstart eingebaut werden. 
</p></div></div></div></div><div class="section_2"><h3 id="Akku-rekalibrieren">Akku rekalibrieren<a class="headerlink" href="#Akku-rekalibrieren">¶</a></h3><p>
Das Rekalibrieren sorgt dafür, dass die Elektronik im Akkupack Ladezustand und Kapazität korrekt wiedergibt. Verschlissene oder defekte Akkuzellen werden dadurch nicht repariert.</p><p>Der Rekalibrierungsvorgang besteht aus folgenden Schritten:
</p><ul><li><p>Ladeende auf 100% festlegen (Vorgehensweise s.o.)</p></li><li><p>Akku vollständig entladen (mit angeschlossenem Netzteil)</p></li><li><p>Akku vollständig aufladen</p></li></ul><p>
Das folgende Kommando leitet das Entladen des Hauptakkus ein (nur bei angeschlossenem Netzteil möglich!):</p><div class="bash"><div class="contents"><pre class="notranslate">sudo sh -c "echo 1 &gt; /sys/devices/platform/smapi/BAT0/force_discharge" </pre></div></div><p>
Nach dem Ende des Entladevorgangs wechselt der Inhalt der Datei automatisch wieder auf 0 und der Ladevorgang bis zur eingestellten oberen Ladeschwelle beginnt.</p><p>Die verbleibende Kapazität kann man während des Entladens beobachten mit:</p><div class="bash"><div class="contents"><pre class="notranslate">cd /sys/devices/platform/smapi/BAT0/
while [ "$(cat force_discharge)" = "1" ]; do cat remaining_capacity; sleep 5; done </pre></div></div></div></div><div class="section_1"><h2 id="Besonderheiten">Besonderheiten<a class="headerlink" href="#Besonderheiten">¶</a></h2><p>
</p><div class="section_2"><h3 id="ThinkPad-Edge-L-SL-ab-SL410-510">ThinkPad Edge, L, SL (ab SL410/510)<a class="headerlink" href="#ThinkPad-Edge-L-SL-ab-SL410-510">¶</a></h3><p>
Bei diesen Baureihen entsprechen die ausgelesenen Werte für die Akkuladeschwellen nicht den zuvor geschriebenen Werten.</p><p>So liefert z.B. das Setzen der Ladeschwellen auf <code class="notranslate">start_charge_thresh = 75 / stop_charge_thresh = 80</code>, beim Auslesen stattdessen 81 / 80. Wenn man zuerst <code class="notranslate">stop_charge_thresh</code> und danach <code class="notranslate">start_charge_thresh</code> schreibt, ist das Ergebnis 75 / 74. Benutzer berichten jedoch, dass trotzdem die zuvor geschriebenen Werte wirksam sind.</p></div><div class="section_2"><h3 id="ThinkPad-T420-s-T520-W520-X220-E320">ThinkPad T420(s), T520, W520, X220, E320<a class="headerlink" href="#ThinkPad-T420-s-T520-W520-X220-E320">¶</a></h3><p>
Bei diesen Modellen (mit Intel Sandy Bridge Prozessor) werden derzeit die Akkufunktionen <code class="notranslate">start_charge_thresh</code> und <code class="notranslate">force_discharge</code> nicht unterstützt, wobei bisher nicht bekannt ist, ob es sich um eine Limitierung der Hardware oder ein Softwareproblem handelt. Eine Alternative stellt das unten erwähnte <a class="internal" href="./tp-smapi.html#Alternative-tpacpi-bat">tpacpi-bat</a> dar (außer E320). Der <a class="internal" href="./festplattenschutz.html">Festplattenschutz</a> funktioniert (außer E320).</p><p>Leider entfällt bei den betroffenen Modellen beim Schreiben von <code class="notranslate">stop_charge_thresh</code> auch die automatische Anpassung von <code class="notranslate">start_charge_thresh</code> auf einen Wert kleiner oder gleich <code class="notranslate">stop_charge_thresh - 4</code>. Dies kann zu häufigen kurzen Ladevorgängen und erhöhtem Akkuverschleiß führen.</p></div><div class="section_2"><h3 id="ThinkPad-T430-s-T530-W530-X230-S430">ThinkPad T430(s), T530, W530, X230, S430<a class="headerlink" href="#ThinkPad-T430-s-T530-W530-X230-S430">¶</a></h3><p>
Bei diesen Modellen (mit Intel Ivy Bridge Prozessor) und allen neueren Baureihen schlägt das Laden von <code class="notranslate">tp_smapi</code> mit der Meldung
</p><pre class="notranslate">insmod /lib/modules/KERNELVERSION/updates/dkms/thinkpad_ec.ko 
WARNING: Error inserting thinkpad_ec (/lib/modules/KERNELVERSION/updates/dkms/thinkpad_ec.ko): No such device or address
FATAL: Error inserting tp_smapi (/lib/modules/KERNELVERSION/updates/dkms/tp_smapi.ko): No such device or address</pre><p>
fehl. Eine Lösung für tp-smapi ist bisher nicht bekannt, als Alternative für die Ladeschwellen bietet sich das nachfolgend erwähnte tpacpi-bat an.</p></div></div><div class="section_1"><h2 id="Alternative-tpacpi-bat">Alternative tpacpi-bat<a class="headerlink" href="#Alternative-tpacpi-bat">¶</a></h2><p>
Für ThinkPad-Modelle ab der Sandy-Bridge-Generation (oder neuer), bei denen tp-smapi nur unvollständig oder gar nicht mehr funktioniert (s. oben, Ausnahme: E320), gibt es als Alternative für das Setzen der Ladeschwellen das Perl-Skript <a class="external" href="https://github.com/teleshoes/tpacpi-bat" rel="nofollow">tpacpi-bat</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p><p>Für den Einsatz dieses Skripts greift man am einfachsten auf das <a class="external" href="http://linrunner.de/tlp" rel="nofollow">Stromspartool TLP</a> zurück, das tpacpi-bat bereits mitbringt. TLP bietet eine einheitliche Schnittstelle zu den oben beschriebenen ThinkPad-Akkufunktionen und verwendet je nach Hardware autom. entweder tp-smapi oder tpapci-bat.</p><div class="box warning"><h3 class="box warning">Hinweis!</h3><div class="contents"><p>
Zusätzliche <a class="internal" href="./fremdquellen.html">Fremdquellen</a> können das System gefährden. 
</p></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><div class="section_2"><h3 id="Intern">Intern<a class="headerlink" href="#Intern">¶</a></h3><p>
</p><ul><li><p><a class="internal" href="./festplattenschutz.html">Festplattenschutz</a> – Installation und Konfiguration von HDAPS (Hard Disk Active Protection System) </p></li><li><p><a class="internal" href="./thinkpad_acpi.html">thinkpad_acpi</a> – ThinkPad-spezifisches Kernelmodul zum Schalten der Funkgeräte, Hotkeys, Temperaturanzeige und Lüftersteuerung</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Extern">Extern<a class="headerlink" href="#Extern">¶</a></h3><p>
</p><ul><li><p><a class="external" href="https://github.com/evgeni/tp_smapi" rel="nofollow">tp-smapi bei Github</a> – Repository des Debian Package Maintainers (hier werden mittlerweile Änderungen gepflegt)</p></li><li><p><a class="external" href="http://www.thinkwiki.org/wiki/Tp_smapi" rel="nofollow">tp-smapi</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> – Artikel bei thinkwiki.org</p></li><li><p><a class="external" href="https://github.com/teleshoes/tpacpi-bat" rel="nofollow">tpacpi-bat</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> – Perl-Skript zum Setzen der Ladeschwellen bei neueren ThinkPads</p></li><li><p><a class="external" href="https://github.com/teleshoes/acpi_call/commits/master" rel="nofollow">acpi-call</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> – Kernelmodul das von tpacpi-bat vorausgesetzt wird</p></li><li><p><a class="external" href="http://linrunner.de/tlp" rel="nofollow">TLP</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> – Stromspartool mit Funktionen zur Anzeige des Akkustatus, Setzen der Ladeschwellen und Rekalibrieren des Akkus</p></li><li><p><a class="external" href="http://thinkwiki.de/TLP_FAQ#ThinkPad_Akku" rel="nofollow">TLP FAQ ThinkPad-Akku</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> – vertiefende FAQ zu Akkufunktionen, Ladeschwellen sowie zur Fehleranalyse bei tp-smapi und tpacpi-bat</p></li><li><p><a class="external" href="http://thinkwiki.de/Messung_der_Leistungsaufnahme_unter_Linux#thinkwatt" rel="nofollow">thinkwatt</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> – einfaches Tool zur Aufzeichnung und grafischen Anzeige des Stromverbrauchs</p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Lithium-Ionen-Akkumulator">Lithium-Ionen-Akkumulator</a> – Wikipedia</p></li></ul><p>
</p></div></div></div>
<p class="meta">
<a href="./tp-smapi/a/revision/942099.html">Diese Revision</a> wurde am 20. Juni 2017 16:59 von <a href="https://ubuntuusers.de/user/linrunner/">linrunner</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./tp-smapi.html">TP-SMAPI</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>