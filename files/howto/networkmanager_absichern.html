<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Howto/NetworkManager_absichern › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../howto/networkmanager_absichern.html">NetworkManager absichern</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Howto/NetworkManager_absichern">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../howto/networkmanager_absichern/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../howto/networkmanager_absichern/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../howto/networkmanager_absichern/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../howto/networkmanager_absichern/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../howto/networkmanager_absichern/a/backlinks.html">NetworkManager absichern</a></h1>
<div id="page"><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Verwendung dieses Howto geschieht auf eigene Gefahr. Bei Problemen mit der Anleitung melde dies bitte in der dazugehörigen Diskussion und wende dich zusätzlich an den Verfasser des Howtos.
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Diese Howto-Anleitung wurde zuletzt von <a class="crosslink user" href="https://ubuntuusers.de/user/kB/">kB</a> im November 2017 unter <strong>Ubuntu 17.10</strong>, <strong>Ubuntu 16.04</strong> und <strong>Ubuntu 14.04</strong> erfolgreich getestet.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../programme_starten.html">Starten von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../sudo.html">Root-Rechte</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../networkmanager.html">NetworkManager</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="../networkmanager/networkmanager_ohne_gui.html">NetworkManager/NetworkManager ohne GUI</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="../policykit.html">PolicyKit</a></p></li></ol></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Einleitung">Einleitung
</a></li><li><a class="crosslink" href="#NetworkManager-mit-PolicyKit-unter-Ubuntu">NetworkManager mit PolicyKit unter Ubuntu
</a></li><li><a class="crosslink" href="#Anleitung-Berechtigungen-ueberpruefen">Anleitung: Berechtigungen überprüfen
</a><ol class="arabic"><li><a class="crosslink" href="#Implizite-Berechtigungen">Implizite Berechtigungen
</a></li><li><a class="crosslink" href="#Explizite-Berechtigungen">Explizite Berechtigungen
</a></li></ol></li><li><a class="crosslink" href="#Anleitung-PolicyKit-konfigurieren">Anleitung: PolicyKit konfigurieren
</a></li><li><a class="crosslink" href="#Alternativen">Alternativen
</a></li><li><a class="crosslink" href="#Anhang-Skript-pk-inspector">Anhang: Skript pk-inspector
</a></li><li><a class="crosslink" href="#Dokumentation">Dokumentation
</a></li><li><a class="crosslink" href="#Links">Links
</a><ol class="arabic"><li><a class="crosslink" href="#intern">intern
</a></li><li><a class="crosslink" href="#extern">extern
</a></li></ol></li></ol></div><div class="section_1"><h2 id="Einleitung">Einleitung<a class="headerlink" href="#Einleitung">¶</a></h2><p>
NetworkManager stellt eine moderne Methode zur Konfiguration, Verwaltung und zum Betrieb des Netzwerkes eines Rechners dar und kann sowohl für Desktop-Systeme<sup><a href="#source-4">[4]</a></sup> als auch für Konsolen-Systeme<sup><a href="#source-5">[5]</a></sup> (z.B. Server) eingesetzt werden. Dieses HOWTO richtet sich an Administratoren, die ihr System vor dem Missbrauch durch Unberechtigte absichern wollen.</p><p>Dieses HOWTO kann auch als Tutorial für PolicyKit gelesen werden; es beschreibt am Beispiel NetworkManager, wie man die von PolicyKit verwalteten programmspezifischen Berechtigungen modifizieren kann.</p><p>NetworkManager erlaubt in der Standardeinstellung <span class="underline">jedem</span> Benutzer weitreichende Eingriffe in das Netzwerk. Die in der jeweiligen Situation (Art der Session und Gruppenzugehörigkeit des Benutzers) möglichen Eingriffe kann man aus NetworkManager<sup><a href="#source-1">[1]</a></sup><sup><a href="#source-2">[2]</a></sup><sup><a href="#source-5">[5]</a></sup> abfragen:
</p><div class="bash"><div class="contents"><pre class="notranslate">nmcli general permissions   # für NM Version ab 1.2 (ab Ubuntu 16.04)
nmcli    nm   permissions   # für NM Version 0.9.8.8 (Ubuntu 14.04) </pre></div></div><p>Für einen lokalen Benutzer von Ubuntu 16.04, der nicht zur Gruppe <code class="notranslate">sudo</code> gehört, ergibt das diese Liste:
</p><pre class="notranslate">tester@gnome25:~$ groups
tester
tester@gnome25:~$ nmcli general permissions 
BEFUGNIS                                                   WERT          
org.freedesktop.NetworkManager.enable-disable-network      ja            
org.freedesktop.NetworkManager.enable-disable-wifi         ja            
org.freedesktop.NetworkManager.enable-disable-wwan         ja            
org.freedesktop.NetworkManager.enable-disable-wimax        ja            
org.freedesktop.NetworkManager.sleep-wake                  nein          
org.freedesktop.NetworkManager.network-control             ja            
org.freedesktop.NetworkManager.wifi.share.protected        ja            
org.freedesktop.NetworkManager.wifi.share.open             ja            
org.freedesktop.NetworkManager.settings.modify.system      Legitimierung 
org.freedesktop.NetworkManager.settings.modify.own         ja            
org.freedesktop.NetworkManager.settings.modify.hostname    Legitimierung 
org.freedesktop.NetworkManager.settings.modify.global-dns  unbekannt     
org.freedesktop.NetworkManager.reload                      Legitimierung </pre><p>Für einen lokalen Benutzer, der zur Gruppe <code class="notranslate">sudo</code> gehört, ergibt das fast dieselbe Liste; lediglich für die Aktion <em>org.freedesktop.NetworkManager.settings.modify.system</em> wird „<em>Legitimierung</em>“ durch „<em>ja</em>“ ersetzt.</p><p>Diese komfortable Großzügigkeit ist zweckmäßig für Rechner, die in der Regel nur einen angemeldeten Benutzer kennen bzw. in wechselnden Netzwerk-Umgebungen betrieben werden, also z.B. mitgeführte Laptops.
Bereits bei stationär betriebenen Arbeitsstationen möchten IT-Verantwortliche jedoch oft den Benutzern nur die benötigten Rechte geben und Eingriffe in das Netzwerk gehören nicht dazu.
Bei Servern bzw. allgemein bei Rechnern, die gleichzeitig mehrere angemeldete Benutzer kennen, wäre es sogar kontraproduktiv, wenn ein Benutzer alle anderen durch Eingriffe ins Netzwerk beeinträchtigen würde.</p><p>Administratoren, welche die Standard-Berechtigungen von NetworkManager einschränken möchten, erhalten im folgenden Abschnitt Hinweise, welche Dateien hierfür bearbeitet werden müssen und in den dann folgenden Abschnitten beispielhafte, aber konkrete Anleitungen.</p></div><div class="section_1"><h2 id="NetworkManager-mit-PolicyKit-unter-Ubuntu">NetworkManager mit PolicyKit unter Ubuntu<a class="headerlink" href="#NetworkManager-mit-PolicyKit-unter-Ubuntu">¶</a></h2><p>
NetworkManager verwendet <a class="internal" href="../policykit.html">PolicyKit</a> zur Legitimation von Eingriffen in das Netzwerk. Hier wird Grundwissen zum Zusammenspiel der Komponenten vermittelt als Grundlage zur Erstellung einer eigenen Konfiguration.</p><p>PolicyKit existiert in 3 Generationen, die sich in ihren Fähigkeiten und bezüglich ihrer Konfiguration unterscheiden:
</p><ol class="arabic"><li><p>Generation: Das ursprüngliche <strong>PolicyKit</strong> ist veraltet und wurde durch polkit-1 ersetzt. Der Name PolicyKit wird aber gelegentlich (eigentlich fälschlicherweise) noch für den Nachfolger verwendet.</p></li><li><p>Generation: <strong>polkit-1</strong> in den Versionen bis einschließlich <em>0.105</em> wird konfiguriert über Dateien in den Verzeichnissen</p><ul><li><p>/usr/lib/i386-linux-gnu/polkit-1/</p></li><li><p><strong>/usr/share/polkit-1/actions/</strong>: Definition der Aktionen mit implizit gesetzten Rechten über Konfigrationsdateien mit Endung <strong>.policy</strong></p></li><li><p><strong>/var/lib/polkit-1/localauthority/</strong>: Konfigrationsdateien mit Endung <strong>.pkla</strong> und</p></li><li><p><strong>/etc/polkit-1/localauthority/</strong>: Konfigrationsdateien mit Endung <strong>.pkla </strong>zur Änderung der impliziten Rechte durch Vergabe expliziter Rechte</p></li></ul></li><li><p>Generation: <strong>polkit-1</strong> verwendet ab Version <em>0.106</em> andere Unterverzeichnisse, eine andere Dateiendung (<strong>.rules</strong>) und ein anderes Format für die Konfigurationsdateien.</p><ul><li><p><strong>/usr/share/polkit-1/actions/</strong>: Definition der Aktionen mit implizit gesetzten Rechten über Konfigrationsdateien mit Endung <strong>.policy</strong></p></li><li><p><strong>/usr/share/polkit-1/rules.d/</strong>: JavaScript-Funktionen in Dateien mit Endung <strong>.rules</strong> und</p></li><li><p><strong>/etc/polkit-1/rules.d/</strong>: JavaScript-Funktionen in Dateien mit Endung <strong>.rules</strong> zur Änderung der impliziten Rechte durch Vergabe expliziter Rechte</p></li></ul></li></ol><p>
<em>Ubuntu</em> verwendet in den Versionen 14.04 LTS, 16.04 LTS, 17.04 und 17.10 (und voraussichtlich auch in naher Zukunft) polkit-1 in der Version <em>0.105</em> (also 2. Generation von PolicyKit). Bei dieser Version sind Regeln in Dateien <strong>*.rules</strong> unwirksam; nur Konfigurationen in Dateien <strong>*.pkla</strong> werden beachtet.</p><p>Andere Betriebssysteme verwenden möglicherweise andere Strategien hinsichtlich der Generation bzw. Version von polkit-1. Deshalb sind weder die hier für Ubuntu in den hier getesteten Versionen beschriebenen Maßnahmen auf andere Betriebssysteme übertragbar noch kann man voraussetzen, dass Hinweise bezüglich PolicyKit für andere Betriebssysteme bei Ubuntu funktionieren!</p><p>Die in den <strong>*.policy</strong>-Dateien als <code class="notranslate">implicit</code> gesetzten Rechte gelten als Vorgaben.</p><p>Die Vorgaben können durch Angaben in Dateien in den Verzeichnissen <strong>/var/lib/polkit-1/localauthority/</strong> und <strong>/etc/polkit-1/localauthority/</strong> modifiziert werden; dabei sind alle Dateien in diesen Verzeichnissen und Unterverzeichnissen funktional gleichberechtigt und werden in lexikalischer Reihenfolge abgearbeitet. Jedoch wird eine Datei unter <strong>/etc</strong> nach einer gleichlautenden Datei unter <strong>/var</strong> bearbeitet. (Siehe: <a class="crosslink" href="#Dokumentation">Dokumentation und Links</a>)</p><p>Die Datei-Hierarchie unter <strong>/var/lib/polkit-1/localauthority/</strong> ist für aus Paketen bezogenen Änderungen vorgesehen, eigene Änderungen sollte man unter <strong>/etc/polkit-1/localauthority/</strong> ablegen.</p><p>Für NetworkManager relevant sind bei einem Ubuntu-16.04-Gnome-Desktop die Dateien:
</p><ul><li><p><strong>/usr/share/polkit-1/actions/org.freedesktop.NetworkManager.policy</strong></p></li><li><p><strong>/var/lib/polkit-1/localauthority/10-vendor.d/com.ubuntu.desktop.pkla</strong></p></li><li><p><strong>/var/lib/polkit-1/localauthority/10-vendor.d/org.freedesktop.NetworkManager.pkla</strong></p></li></ul><p>
</p></div><div class="section_1"><h2 id="Anleitung-Berechtigungen-ueberpruefen">Anleitung: Berechtigungen überprüfen<a class="headerlink" href="#Anleitung-Berechtigungen-ueberpruefen">¶</a></h2><p>
Die effektiven Berechtigungen unterscheiden sich abhängig von Ubuntu-Version und -Flavor sowie installierter Software; sie sind daher hier nicht übersichtlich auflistbar. Im folgenden Text wird beschrieben, wie man sich die benötigten Informationen aus dem eigenen System beschaffen kann.</p><div class="section_2"><h3 id="Implizite-Berechtigungen">Implizite Berechtigungen<a class="headerlink" href="#Implizite-Berechtigungen">¶</a></h3><p>
Die relevanten Daten aus den <strong>*.policy</strong>-Dateien erhält man mit einem zweistufigen Verfahren:
</p><ol class="arabic"><li><p>Eine Liste aller vom NetworkManager behandelten Aktionen liefert der Befehl <code class="notranslate">pkaction</code><sup><a href="#source-1">[1]</a></sup><sup><a href="#source-2">[2]</a></sup>: </p><div class="bash"><div class="contents"><pre class="notranslate">pkaction | grep  NetworkManager </pre></div></div></li><li><p>Die impliziten Rechte für eine bestimmte Aktion aus dieser Liste (hier exemplarisch für <code class="notranslate">org.freedesktop.NetworkManager.network-control</code>) erhält man mit: </p><div class="bash"><div class="contents"><pre class="notranslate">pkaction --verbose --action-id org.freedesktop.NetworkManager.network-control | grep implicit </pre></div></div></li></ol><p>
Alternativ kann man komfortabler das im <a class="crosslink" href="#Anhang-Skript-pk-inspector">Anhang</a> beschriebene Skript <code class="notranslate">pk-inspector</code> benutzen, welches auf den vorstehend genannten Befehlen beruht: </p><div class="bash"><div class="contents"><pre class="notranslate">./pk-inspector --policy </pre></div></div></div><div class="section_2"><h3 id="Explizite-Berechtigungen">Explizite Berechtigungen<a class="headerlink" href="#Explizite-Berechtigungen">¶</a></h3><p>
Zur Abfrage der expliziten Rechte benötigt man selbst <code class="notranslate">root</code>-Rechte<sup><a href="#source-3">[3]</a></sup> zum Durchsuchen der <strong>*.pkla</strong>-Dateien in einem zweistufigen Verfahren:
</p><ol class="arabic"><li><p>Eine Liste aller relevanten Dateien generiert man mittels find: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo find /var/lib/polkit-1/ /etc/polkit-1/ -type f -exec grep -i -e '^Action=.*NetworkManager' -q '{}' \; -print  </pre></div></div><p> Beispielhafte Ausgabe: </p><pre class="notranslate">/var/lib/polkit-1/localauthority/10-vendor.d/org.freedesktop.NetworkManager.pkla
/var/lib/polkit-1/localauthority/10-vendor.d/com.ubuntu.desktop.pkla</pre></li><li><p>Die so gefundenen Dateien kann man z.B. mit <code class="notranslate">cat</code> sichten: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cat /var/lib/polkit-1/localauthority/10-vendor.d/com.ubuntu.desktop.pkla  </pre></div></div><p> Beispielhafte Ausgabe: </p><pre class="notranslate"> …
[Adding or changing system-wide NetworkManager connections]
Identity=unix-group:admin;unix-group:sudo
Action=org.freedesktop.NetworkManager.settings.modify.system
ResultActive=yes
 …</pre></li></ol><p>
Alternativ kann man komfortabler das im #Anhang-Skript-pk-inspector Anhang] beschriebene Skript <code class="notranslate">pk-inspector</code> benutzen, welches auf den vorstehend genannten Befehlen beruht: </p><div class="bash"><div class="contents"><pre class="notranslate">./pk-inspector --rules </pre></div></div></div></div><div class="section_1"><h2 id="Anleitung-PolicyKit-konfigurieren">Anleitung: PolicyKit konfigurieren<a class="headerlink" href="#Anleitung-PolicyKit-konfigurieren">¶</a></h2><p>
Hier wird beispielhaft eine Konfiguration beschrieben, mit der NetworkManager nur noch <code class="notranslate">root</code> Änderungen am Netzwerksystem vornehmen läßt – d.h. PolicyKit wird für NetworkManager effektiv ausgeschaltet. Dies erhebt nicht den Anspruch, für jeden Anwendungsfall die optimale Strategie zu sein.</p><p>Man legt in <strong>/etc/polkit-1/localauthority/</strong> das Verzeichnis <strong>99/</strong> und in diesem eine Datei an, deren beliebiger Name auf <strong>.pkla</strong> enden muss:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mkdir -p /etc/polkit-1/localauthority/99/ ; sudo touch "$_/00-NetworkManager-deny.pkla" </pre></div></div><p>
</p><pre class="notranslate">### /etc/polkit-1/localauthority/99/00-NetworkManager-deny.pkla
[NetworkManager deny all]
Identity=unix-user:*
Action=org.freedesktop.NetworkManager.*
ResultAny=no
ResultInactive=no
ResultActive=no</pre><p>Die Änderung wird sofort wirksam, da PolicyKit seine Konfigurationsverzeichnisse ständig überwacht. Nach Erstellung der Datei kann ein normaler Benutzer mittels <strong>nmcli</strong> oder einer anderen Benutzer-Schnittstelle wie <strong>nmtui</strong> oder <strong>nm-applet</strong> noch die meisten Netzwerk-Einstellungen abfragen, aber nicht mehr ändern. Änderungen erfordern einen Aufruf als <code class="notranslate">root</code>, z.B. kann man mittels <strong>sudo nmcli</strong> den sudo-Mechanismus benutzen.</p><p>Bei der Erstellung eigener Konfigurationen sind diese Hinweise zu beachten:
</p><ul><li><p>Für PolicyKit unter Ubuntu bedeutet Adminstrator: Zugehörigkeit zur Gruppe <code class="notranslate">sudo</code>. Das kann man – global für alle Programme, welche PolicyKit benutzen! – in einer Konfigurationsdatei unter <strong>/etc/polkit-1/localauthority.conf.d/</strong> einstellen. (Bei Ubuntu existiert die Gruppe <code class="notranslate">admin</code> nicht mehr; sie wurde durch die Gruppe <code class="notranslate">sudo</code> ersetzt.)</p></li><li><p>NetworkManager gewährt zusätzlich der Gruppe <code class="notranslate">netdev</code> Rechte, aber nur für die Aktion org.freedesktop.NetworkManager.settings.modify.system.</p></li><li><p>Die ganze Litanei der <strong>pkla</strong>-Dateien wird zweimal durchlaufen:</p><ol class="arabic"><li><p>Zuerst werden die Rechte über die Gruppenzugehörigkeiten des aufrufenden Benutzers ermittelt.</p></li><li><p>In einem zweiten Durchgang werden die gewährten Rechte über die per Benutzer-Kennung ermittelten Rechte ggf. überschrieben oder erst ermittelt.</p></li></ol></li><li><p>Die vorstehend beschriebene Arbeitsweise ergibt in der Praxis: Man kann eine auf Benutzer-Ebene entzogene Berechtigung nicht wirksam auf Gruppenebene wieder gewähren!</p></li><li><p>Wenn die Berechtigungen für einen Benutzer, der zu mehreren Gruppen gehört, ermittelt werden soll, dann werden die Gruppen in aufsteigender Reihenfolge ihrer numerischen ID abgearbeitet.</p></li></ul><p>
Nachdem man zunächst allen Benutzern mit der Datei <strong>00-NetworkManager-deny.pkla</strong> die implizit zugeteilten Rechte entzogen hat, kann man ausgesuchten Benutzern wieder Rechte verleihen. Hierzu kann man eine weitere Datei benutzen:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mkdir -p /etc/polkit-1/localauthority/99/ ; sudo touch "$_/99-NetworkManager-allow.pkla" </pre></div></div><p>
</p><pre class="notranslate">### /etc/polkit-1/localauthority/99/99-NetworkManager-allow.pkla
[NetworkManager.settings.modify.system allow some user]
Identity=unix-user:klaus;
Action=org.freedesktop.NetworkManager.settings.modify.system
ResultActive=auth_admin_keep</pre><p>
In dieser Datei selektiert man die gewünschten Benutzer namentlich; man kann keine numerischen ID benutzen. Eine Selektion über Gruppen ist syntaktisch möglich, funktioniert aber wie oben beschrieben leider nicht.</p></div><div class="section_1"><h2 id="Alternativen">Alternativen<a class="headerlink" href="#Alternativen">¶</a></h2><p>
Anstelle einer eigenen Konfiguration von PolicyKit kann man auch erwägen:
</p><ol class="arabic"><li><p>Ersatz/Änderung der Datei <strong>/usr/share/polkit-1/actions/org.freedesktop.NetworkManager.policy</strong>: Die geänderte Datei wird jedoch bei Updates überschrieben!</p></li><li><p>Ersatz des NetworkManagers durch ein anderes Konfigurationsprogramm (ifupdown, Wicd …)</p></li><li><p>Ersatz des Standard-Paketes durch einen selbst ohne PolicyKit aus den Quellen übersetzten NetworkManager</p></li></ol><p>
</p></div><div class="section_1"><h2 id="Anhang-Skript-pk-inspector">Anhang: Skript pk-inspector<a class="headerlink" href="#Anhang-Skript-pk-inspector">¶</a></h2><p>
Das Skript <code class="notranslate">pk-inspector</code> vereinfacht die Sichtung der relevanten Dateien für die Vergabe der Berechtigungen zur Nutzung von NetworkManager. Es muss nach dem <a class="crosslink" href="https://ubuntuusers.de/user/kB/#Policy-Kit">Herunterladen</a> noch mit</p><div class="bash"><div class="contents"><pre class="notranslate">chmod +x pk-inspector </pre></div></div><p>ausführbar gemacht werden. Eine Gebrauchsanleitung erhält man mit der Option <code class="notranslate">--help</code>.</p><p>Man kann dieses Programm auch zur Sichtung der Berechtigungen für andere Programme, die PolicyKit benutzen, verwenden. Man muss dann einen charakteristischen Teil der polkit-Aktion als Suchbegriff angeben. Beispielsweise gibt
</p><div class="bash"><div class="contents"><pre class="notranslate">./pk-inspector --all apt </pre></div></div><p> die Berechtigungen bezüglich der Paketverwaltung aus.</p></div><div class="section_1"><h2 id="Dokumentation">Dokumentation<a class="headerlink" href="#Dokumentation">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="../manpages.html">Manpages</a>: polkit, pklocalauthority</p></li><li><p><a class="external" href="https://www.freedesktop.org/software/polkit/docs/0.105/" rel="nofollow" title="https://www.freedesktop.org/software/polkit/docs/0.105/">https://www.freedesktop.org/software/polkit/docs/0.105/</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> Referenz PolicyKit (als Version 0.105 von polkit-1)</p></li></ul><p>
</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><div class="section_2"><h3 id="intern">intern<a class="headerlink" href="#intern">¶</a></h3><p>
</p><ul><li><p><a class="internal" href="../policykit.html">PolicyKit</a></p></li><li><p><a class="internal" href="../networkmanager.html">NetworkManager</a></p></li><li><p><a class="internal" href="../networkmanager/networkmanager_ohne_gui.html">NetworkManager/NetworkManager ohne GUI</a></p></li></ul><p>
</p></div><div class="section_2"><h3 id="extern">extern<a class="headerlink" href="#extern">¶</a></h3><p>
</p><ul><li><p><a class="external" href="http://www.linux-magazin.de/ausgaben/2012/11/sudo-policykit" rel="nofollow" title="http://www.linux-magazin.de/ausgaben/2012/11/sudo-policykit">http://www.linux-magazin.de/ausgaben/2012/11/sudo-policykit</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> (ab Seite 3 unten – Text davor hier OT.)</p></li><li><p><a class="external" href="http://www.linux-community.de/Internal/Artikel/Print-Artikel/LinuxUser/2010/07/Admin-Rechte-gezielt-vergeben-mit-PolicyKit" rel="nofollow" title="http://www.linux-community.de/Internal/Artikel/Print-Artikel/LinuxUser/2010/07/Admin-Rechte-gezielt-vergeben-mit-PolicyKit">http://www.linux-community.de/Internal/Artikel/Print-Artikel/LinuxUser/2010/07/Admin-Rechte-gezielt-vergeben-mit-PolicyKit</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul><p>
</p></div></div></div>
<p class="meta">
<a href="../howto/networkmanager_absichern/a/revision/945384.html">Diese Revision</a> wurde am 10. Dezember 2017 19:42 von <a href="https://ubuntuusers.de/user/noisefloor/">noisefloor</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../howto.html">Howto</a></li>
<li><a href="../howto/networkmanager_absichern.html">NetworkManager absichern</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>