<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>LUKS › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./luks.html">LUKS</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/LUKS">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./luks/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./luks/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./luks/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./luks/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./luks/a/backlinks.html">LUKS</a></h1>
<div id="page"><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>
Diese Seite wird aktuell überarbeitet. Bitte hier keine Änderungen mehr vornehmen, sondern in <a class="internal missing" href="./baustelle/luks.html">Baustelle/LUKS</a>!
</p></div></div><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ohne ein sicheres Kennwort nutzt die stärkste Verschlüsselung nichts! Wie man Passwörter am besten wählt, steht hier: <a class="internal" href="./sicherheits_1x1.html">Sicherheits 1x1</a>
</p></div></div><p>
</p><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./partitionierung.html">Partitionierung</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./formatieren.html">Formatieren eines Datenträgers</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./editor.html">Einen Editor mit Root-Rechten öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="./skripte/gerät_mit_pseudozufallszahlen_überschreiben.html">Gerät mit Pseudozufallszahlen überschreiben</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorbereitung">Vorbereitung
</a></li><li><a class="crosslink" href="#Verwendung">Verwendung
</a><ol class="arabic"><li><a class="crosslink" href="#Erstellen">Erstellen
</a></li><li><a class="crosslink" href="#ffnen-von-LUKS-Geraeten-mit-Passwortabfrage">Öffnen von LUKS-Geräten mit Passwortabfr...</a></li><li><a class="crosslink" href="#ffnen-von-LUKS-Geraeten-beim-Start-ohne-Passwortabfrage">Öffnen von LUKS-Geräten beim Start ohne ...</a><ol class="arabic"><li><a class="crosslink" href="#LVM">LVM
</a></li><li><a class="crosslink" href="#Schluesselableitung">Schlüsselableitung
</a></li><li><a class="crosslink" href="#Schluesseldatei">Schlüsseldatei
</a></li><li><a class="crosslink" href="#Bei-der-Anmeldung">Bei der Anmeldung
</a></li><li><a class="crosslink" href="#Schliessen">Schließen
</a></li></ol></li><li><a class="crosslink" href="#Passwoerter-verwalten">Passwörter verwalten
</a><ol class="arabic"><li><a class="crosslink" href="#Passwort-hinzufuegen">Passwort hinzufügen
</a></li><li><a class="crosslink" href="#Passwort-loeschen">Passwort löschen
</a></li><li><a class="crosslink" href="#Passwort-aendern">Passwort ändern
</a></li></ol></li><li><a class="crosslink" href="#Header-sichern">Header sichern
</a></li><li><a class="crosslink" href="#Automatisiertes-Verschluesseln-mit-Alternate-CD">Automatisiertes Verschlüsseln mit Altern...</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>
Diese Anleitung geht auf die Erstellung und Wartung von verschlüsselten Datenträgern mittels LUKS - <a class="external" href="https://gitlab.com/cryptsetup/cryptsetup" rel="nofollow">Linux Unified Key Setup</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - ein. Es handelt sich um das Standardverfahren zur Festplattenverschlüsselung unter Linux. Dabei werden alle nötigen Informationen zum Öffnen einer verschlüsselten Partition oder Container-Datei in dieser gespeichert. Das erlaubt es auch, beim Anschließen eines externen Datenträgers mit verschlüsselten Partitionen diese nach Passwortabfrage automatisch einzubinden.</p><p>Es wird hier nur auf die Verwendung von LUKS eingegangen. Für eine Schritt-für-Schritt-Anleitung zum Verschlüsseln des Systems bitte die Artikel <a class="internal" href="./daten_verschlüsseln.html">Daten verschlüsseln</a> und <a class="internal" href="./system_verschlüsseln.html">System verschlüsseln</a> hinzuziehen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle folgenden Befehle benötigen <a class="internal" href="./sudo.html">Root-Rechte</a>. Wenn man nicht <code class="notranslate">sudo</code> vor das betreffende Kommando setzen möchte, kann man temporär mit <code class="notranslate">sudo -s</code> eine Root-Shell öffnen. Diese wird nach Abschluss der Arbeiten mit dem Befehl <code class="notranslate">exit</code> wieder geschlossen.
</p></div></div><div class="section_1"><h2 id="Vorbereitung">Vorbereitung<a class="headerlink" href="#Vorbereitung">¶</a></h2><p>
Zuerst wird dieses Paket installiert <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>cryptsetup</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install cryptsetup </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install cryptsetup </pre></div></div><p>
</p></div></div><p>Anschließend wird das benötigte Kernelmodul mittels des folgenden Befehls <sup><a href="#source-2">[2]</a></sup> geladen:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo modprobe dm-crypt </pre></div></div><p>Damit sollte die Vorbereitung abgeschlossen sein. Zukünftig werden alle benötigen Module automatisch geladen.</p></div><div class="section_1"><h2 id="Verwendung">Verwendung<a class="headerlink" href="#Verwendung">¶</a></h2><p>
Hier wird ein Auszug der wichtigsten LUKS-Funktionen dargestellt. Für weitere Informationen sei auf die entsprechenden Dokumentationen wie u.a. die <a class="external" href="http://www.dsm.fordham.edu/cgi-bin/man-cgi.pl?topic=cryptsetup" rel="nofollow">Manpage von cryptsetup</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> verwiesen.</p><div class="section_2"><h3 id="Erstellen">Erstellen<a class="headerlink" href="#Erstellen">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Sollte nicht das <a class="internal" href="./system_verschlüsseln.html">gesamte System verschlüsselt</a> werden, besteht die Gefahr, dass persönliche Daten in unverschlüsselten Bereichen gespeichert werden. Um dieses Risiko zu minimieren, sollte der Artikel <a class="internal" href="./vorbereitung_teilverschlüsselung.html">Vorbereitung zur Teilverschlüsselung</a> durchgearbeitet werden. Ohne diese Maßnahmen ist die Verschlüsselung möglicherweise wirkungslos.</p><p>Außerdem ist aus Sicherheitsgründen empfehlenswert, die Partition ein mal mit Zufallszahlen zu überschreiben, vor allen Dingen, wenn auf dieser vorher unverschlüsselte Daten gespeichert waren <sup><a href="#source-6">[6]</a></sup>. Ansonsten sind unter Umständen viele Dateien nach dem Verschlüsseln noch auslesbar.
</p></div></div><p>Zum Erstellen eines LUKS-Geräts wird eine zu überschreibende Partition erzeugt oder ausgewählt <sup><a href="#source-3">[3]</a></sup>. Daraufhin werden diese Befehle ausgeführt, wobei <code class="notranslate">GERÄTEDATEI</code> durch den entsprechenden Namen ersetzt werden muss, z.B <strong>/dev/sde9</strong>:</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bereits bei der <a class="internal" href="./installation.html">Installation</a> kann auch bei der manuellen Partitionierung eine zu verschlüsselnde Datenpartition unter <em>"Benutzen als:"</em> mit dem Eintrag <em>"physikalisches Volume für Verschlüsselung"</em> zur Verschlüsselung ausgewählt werden. Danach kann man ein Passwort festlegen. In der Übersicht erscheint dann das neue Laufwerk, welches man z.B. als <strong>/cryptodaten</strong> wie ein unverschlüsseltes Laufwerk ins System einbinden und formatieren lassen kann. <a class="internal" href="./verzeichnisstruktur.html#mnt">/mnt</a> sowie Unterordner sind für temporär eingehängte Partitionen freizuhalten und daher hier eher nicht zu benutzen.</p><p>In der Regel möchte man jedoch einfach das <a class="internal" href="./system_verschlüsseln.html">System verschlüsseln</a> oder die <a class="internal" href="./homeverzeichnis.html#Homeverzeichnis-verschluesseln">Homeverzeichnis-Verschlüsselung</a> im Installer (auch bei manueller Partitionierung) aktivieren und keine extra Datenpartition zur Verschlüsselung - für speziell gewünschte Fälle ist dies jedoch möglich.
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Alle bisherigen Daten auf dem betreffenden Gerät gehen verloren! Der Datenträger muss vorher <a class="internal" href="./mount.html#Dateisysteme-aushaengen">ausgehängt</a> werden, da ansonsten die Partition unbrauchbar wird!
</p></div></div><ol class="arabic"><li><p>Zuerst den Anfang der zu verschlüsselnden Partition mit Zufallsbytes überschreiben: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo dd if=/dev/urandom bs=1M count=8 of=GERÄTEDATEI </pre></div></div><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p><code class="notranslate">GERÄTEDATEI</code> kann statt etwa einer Partition auch eine gewöhnliche Datei sein, welche dann als Container (Image) ebenfalls in den weiteren Schritten verschlüsselt, mit einem Dateisystem formatiert wird und danach geöffnet und mit beliebigen Dateien befüllt werden kann. Dazu gibt man an dieser Stelle für <code class="notranslate">count</code> die gewünschte Größe in MiB an. </p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Bei sehr großen Containerdateien können sehr große <code class="notranslate">bs</code>-Werte wie <code class="notranslate">200M</code> bei <code class="notranslate">count=1</code> je nach System die Erzeugung der Datei in der gewünschten Größe stark beschleunigen. In diesem Beispiel wäre die Datei 200 * 1 = 200 MiB groß. Alternativ beschleunigt auch die Verwendung von <code class="notranslate">if=/dev/zero</code> durch Nullen anstelle von Zufallszahlen wie bei <code class="notranslate">urandom</code>. Um einen Container von 1000 GiB anzulegen, welcher nicht erst mehrere Stunden überschrieben wird (dadurch unter Umständen unsicherer), sondern sofort verfügbar ist, eignet sich der Befehl <code class="notranslate">fallocate -l 1000G DATEI</code>. Soll dagegen die Datei zwar sofort 1000 GiB Platz bieten und als Platzverbrauch (mit <a class="internal" href="./ls.html">ls</a>) anzeigen, aber erst tatsächlich wachsen und Platz belegen (mit <a class="internal" href="./df.html">df</a> überprüfbar), wenn der Container auch tatsächlich gefüllt wird, so eignet sich der Befehl <code class="notranslate">truncate -s 1000G DATEI</code>.
</p></div></div><p>
</p></div></div></li><li><p>Danach die Partition verschlüsseln: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksFormat -c aes-xts-plain64 -s 512 -h sha512 -y GERÄTEDATEI </pre></div></div><p> Dieser Befehl erstellt eine verschlüsselte Partition im Gerät <code class="notranslate">GERÄTEDATEI</code>. Der Parameter <code class="notranslate">-c</code> bestimmt den Algorithmus, <code class="notranslate">-y</code> lässt cryptsetup das Passwort zweimal abfragen (was in Verbindung mit Key-Files sinnlos wäre) und <code class="notranslate">-s</code> bestimmt die Länge des Schlüssels. <code class="notranslate">luksFormat</code> legt fest, dass der Header nach dem LUKS-Standard erstellt wird. Zur Sicherheitsbestätigung wird die Eingabe von YES gefordert. Also wirklich YES in Großbuchstaben (engl. uppercase) und nicht y, Y oder yes. </p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p><a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/XEX-TCB-CTS">XTS</a> unterstützt Verwaltungsschlüssel von 128 oder 256 Bit. 512 heißt in dem Fall, dass sowohl <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> als auch XTS die maximale Schlüssellänge von 256 Bit verwenden.</p><p>Um eine höhere Lese-/Schreibgeschwindigkeit zu erzielen, kann auch stattdessen 256 eingesetzt werden - das entspricht einer 128 Bit Verschlüsselung. Dies ist z.B. für langsamere Systeme empfehlenswert. Einen Anhaltspunkt über die Verschlüsselungsleistung des Systems liefert <code class="notranslate">cryptsetup benchmark</code>.</p><p>Alternativ zu AES ist es möglich, den Verschlüsselungsalgorithmus <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Twofish">Twofish</a> oder <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Serpent_(Verschl%C3%BCsselung)">Serpent</a> zu verwenden. Dazu wird <code class="notranslate">aes-xts-plain64</code>  durch <code class="notranslate">twofish-xts-plain64</code> bzw. <code class="notranslate">serpent-xts-plain64</code> ersetzt.
</p></div></div></li><li><p>Zuweisung der verschlüsselten Partition einem virtuellen Gerät (nach Passworteingabe wird eine Gerätedatei <strong>/dev/mapper/usb-crypt</strong> angelegt, über die der verschlüsselte Inhalt zugänglich ist): </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksOpen GERÄTEDATEI usb-crypt  </pre></div></div></li><li><p>Die Partition steht jetzt unter dem virtuellen Gerät /<strong>dev/mapper/usb-crypt</strong> zur Verfügung und kann mit einem Dateisystem beschrieben werden (z.B. ext4): </p><div class="bash"><div class="contents"><pre class="notranslate">sudo mkfs.ext4 /dev/mapper/usb-crypt </pre></div></div><p> Optional kann dem Dateisystem ein Label zugewiesen werden, das beim späteren Einhängen der Partition mithilfe der GUI des Systems automatisch als Name verwendet wird (<code class="notranslate">LABEL</code> durch eine eindeutige Bezeichnung ersetzen): </p><div class="bash"><div class="contents"><pre class="notranslate">sudo tune2fs -L LABEL /dev/mapper/usb-crypt </pre></div></div><p> oder: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo e2label /dev/mapper/usb-crypt LABEL </pre></div></div></li><li><p>Nun kann man sie ganz normal einhängen: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount /dev/mapper/usb-crypt /mnt </pre></div></div></li><li><p>Neu angelegte Linux-Dateisysteme gehören erst einmal ausschließlich root. Wenn es für den regulären Benutzer gedacht ist, sind die <a class="internal" href="./rechte.html">Rechte</a> mit <a class="internal" href="./chown.html">chown</a> anzupassen: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo chown $USER:$USER /mnt </pre></div></div></li><li><p>Das Aushängen und Beenden der Verschlüsselung funktioniert dann in folgenden Schritten: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo umount /mnt </pre></div></div><p> und Freigabe des virtuellen Gerätes: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksClose usb-crypt </pre></div></div></li></ol><p>
<span class="underline">Informationen</span></p><p>Möchte man Informationen über eine verschlüsselte Partition, kann folgender Befehl verwendet werden: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksDump /dev/sde9 </pre></div></div><p>
Eine ausführliche Info über ein Dateisystem läßt sich mit folgender Eingabe anzeigen: 
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo dumpe2fs -h /dev/mapper/usb-crypt </pre></div></div><p> 
oder alternativ: 
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo tune2fs -l /dev/mapper/usb-crypt </pre></div></div><p>
Eine Auflistung aller Blockgeräten im Baumformat:
</p><div class="bash"><div class="contents"><pre class="notranslate">lsblk </pre></div></div></div><div class="section_2"><h3 id="ffnen-von-LUKS-Geraeten-mit-Passwortabfrage">Öffnen von LUKS-Geräten mit Passwortabfrage<a class="headerlink" href="#ffnen-von-LUKS-Geraeten-mit-Passwortabfrage">¶</a></h3><p>
Nach der Anmeldung kann man LUKS-Geräte über die Kommandozeile einhängen und aushängen, wie es oben beschrieben ist (<code class="notranslate">luksOpen, mount, umount, luksClose</code>). Beispiel: Ein per
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksOpen /dev/sdXY mnt </pre></div></div><p>
geöffnetes LUKS-Gerät <strong>/dev/sdXY</strong> (XY passend auswählen, z.B. <strong>/dev/sda2</strong>) ist danach in <strong>/dev/mapper/mnt</strong> entschlüsselt und im Falle einer Partition (anstatt <a class="internal" href="./lvm.html">LVM</a>) von dort aus direkt mountbar:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount /dev/mapper/mnt /mnt </pre></div></div><p>
Danach ist der Inhalt im Verzeichnis <strong>/mnt</strong> entschlüsselt.</p><p>Leider ist es ziemlich umständlich und man braucht Root-Rechte dazu.</p><p>LUKS-Geräte können aber in GUI komfortabel per Maus-Klick eingebunden werden. Das Passwort kann dabei im Falle von <a class="internal" href="./gnome.html">GNOME</a> im <a class="internal" href="./gnome_schlüsselbund.html">Schlüsselbund</a>, bei <a class="internal" href="./kde.html">KDE</a> in der <a class="internal" href="./kde_brieftasche.html">KDE Brieftasche</a> hinterlegt werden, sodass LUKS-Geräte ohne extra Abfrage eingehängt werden können.</p><p>Unter GNOME kann man LUKS-Geräte mittels des <a class="internal" href="./gvfs-mount.html">GVFS</a> (Gnome Virtual File System) einbinden. Das Einbinden ins GVFS erfolgt entweder über einen Dateimanager (z. B. <a class="crosslink" href="#Transparente-Verwendung-in-Nautilus">Nautilus</a>, <a class="internal" href="./thunar.html">Thunar</a> oder <a class="internal" href="./pcmanfm.html">PCManFM</a>), über das graphische Tool <a class="internal" href="./gigolo.html">Gigolo</a> oder über die Kommandozeile mit dem Befehl <code class="notranslate">gvfs-mount</code>. Hierzu sind keine <a class="internal" href="./sudo.html">Root-Rechte</a> und kein Eintrag in <strong>/etc/fstab</strong> erforderlich, und es muss auch nirgends ein SUID-Bit gesetzt werden. Die so eingebundenen LUKS-Geräte lassen sich auch ohne Root-Rechte wieder aushängen. Mehr dazu s. im Artikel <a class="internal" href="./gvfs-mount.html">gvfs-mount</a></p></div><div class="section_2"><h3 id="ffnen-von-LUKS-Geraeten-beim-Start-ohne-Passwortabfrage">Öffnen von LUKS-Geräten beim Start ohne Passwortabfrage<a class="headerlink" href="#ffnen-von-LUKS-Geraeten-beim-Start-ohne-Passwortabfrage">¶</a></h3><p>
Es gibt drei mehr oder minder geeignete Varianten zum Öffnen von LUKS-Geräten beim Start ohne extra Passworteingabe.</p><div class="section_3"><h4 id="LVM">LVM<a class="headerlink" href="#LVM">¶</a></h4><p>
Es ist möglich, eine große Partition mit LUKS zu verschlüsseln und in dieser ein <a class="internal" href="./logical_volume_manager.html">LVM</a>-Gerät anzulegen. In diesem können beliebig viele logische Partitionen erstellt werden, die alle mittels einer Passworteingabe freigeschaltet werden.</p><p>Der Einrichtungsvorgang bei einer Neuinstallation ist im Artikel <a class="internal" href="./system_verschlüsseln.html">System verschlüsseln</a> beschrieben.</p></div><div class="section_3"><h4 id="Schluesselableitung">Schlüsselableitung<a class="headerlink" href="#Schluesselableitung">¶</a></h4><p>
Seit Ubuntu 8.04 gibt es das sogenannte Decrypted-Derived-Script, das den Schlüssel aus einem bereits geöffneten LUKS-Gerät berechnen kann. Mit diesem können nach der Freischaltung des Ursprungsgeräts beliebig viele geöffnet werden.</p><p>Auf die generelle Verwendung geht der Artikel <a class="internal" href="./luks/schlüsselableitung.html">LUKS/Schlüsselableitung</a> und auf den Einrichtungsvorgang bei einer Neuinstallation <a class="internal" href="./system_verschlüsseln/schlüsselableitung.html">System verschlüsseln/Schlüsselableitung</a> ein.</p></div><div class="section_3"><h4 id="Schluesseldatei">Schlüsseldatei<a class="headerlink" href="#Schluesseldatei">¶</a></h4><p>
Des Weiteren ist es möglich, LUKS-Geräte mit einer Schlüsseldatei zu öffnen. Da diese jedoch das Passwort im Klartext enthält, wird von dieser Variante abgeraten. Dabei kann man sich an der Ableitung von Schlüsseln in <a class="internal" href="./luks/schlüsselableitung.html#Bestehendes-LUKS-Geraet">Bestehendes LUKS-Gerät</a> sowie dem Öffnen im Abschnitt <a class="internal" href="./luks/schlüsselableitung.html#Manuell">Manuell</a> orientieren. Das Öffnen lässt sich z.B. in der Datei <a class="internal" href="./rc.local.html">rc.local</a> automatisiert aufrufen, allerdings sollte man dort nur ein externes <a class="internal" href="./shell/bash-skripting-guide_für_anfänger.html">Skript</a> mit <a class="internal" href="./rechte.html">Leserechten</a> für ausschließlich den <a class="internal" href="./benutzer_und_gruppen.html">Benutzer</a> <code class="notranslate">root</code> eintragen (<a class="internal" href="./chmod.html">chmod</a> <code class="notranslate">700</code>).</p></div><div class="section_3"><h4 id="Bei-der-Anmeldung">Bei der Anmeldung<a class="headerlink" href="#Bei-der-Anmeldung">¶</a></h4><p>
Außerdem ist es möglich, mittels eines extra <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Pluggable_Authentication_Modules">PAM</a>-Plugins ein LUKS-Gerät automatisch beim Login einzuhängen, wenn einer der LUKS-Schlüssel identisch mit dem Anmeldepasswort ist. Die Anleitung dazu würde den Rahmen dieses Artikels sprengen, es ist aber am Beispiel der Home-Partition <a class="internal" href="./daten_verschlüsseln.html#luks">hier</a> beschrieben.</p></div><div class="section_3"><h4 id="Schliessen">Schließen<a class="headerlink" href="#Schliessen">¶</a></h4><p>
Sobald das enthaltene Dateisystem nicht mehr eingehängt ist oder anderweitig verwendet wird, kann das LUKS-Gerät wie folgt geschlossen werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksClose MapperDatei </pre></div></div></div></div><div class="section_2"><h3 id="Passwoerter-verwalten">Passwörter verwalten<a class="headerlink" href="#Passwoerter-verwalten">¶</a></h3><p>
LUKS bietet insgesamt acht Speicherplätze (genannt "Slot" 0-7) für änderbare Passwörter, die jeweils den Zugriff auf die Daten erlauben. Die belegten Speicherplätze und Headerinformationen lassen sich mittels dieses Befehl überprüfen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksDump GERÄTEDATEI </pre></div></div><div class="section_3"><h4 id="Passwort-hinzufuegen">Passwort hinzufügen<a class="headerlink" href="#Passwort-hinzufuegen">¶</a></h4><p>
Zuerst das alte Passwort eingeben, dann das neue.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksAddKey GERÄTEDATEI </pre></div></div></div><div class="section_3"><h4 id="Passwort-loeschen">Passwort löschen<a class="headerlink" href="#Passwort-loeschen">¶</a></h4><p>
Ein bekanntes Passwort kann mit folgendem Befehl entfernt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksRemoveKey GERÄTEDATEI </pre></div></div><p>Will man hingegen einen bestimmten Slot löschen, kann man dies mit folgendem Befehl tun:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksKillSlot GERÄTEDATEI SLOT </pre></div></div><p>Alternativ kann ein Slot mit dem veralteten Befehl entfernt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksDelKey GERÄTEDATEI SLOT </pre></div></div><p>Für <code class="notranslate">SLOT</code> muss die Nummer des Keyslots eingegeben werden. Diesen findet man am einfachsten heraus, wenn mit <code class="notranslate">cryptsetup luksOpen -v</code> einen Container oder eine Partition einhängt. Dort ist dann auch der Slot angegeben, der, basierend auf dem Schlüssel, benutzt wurde.</p></div><div class="section_3"><h4 id="Passwort-aendern">Passwort ändern<a class="headerlink" href="#Passwort-aendern">¶</a></h4><p>
Zum Ändern eines Passworts wird zuerst das neue Passwort hinzugefügt und anschließend das alte entfernt.</p></div></div><div class="section_2"><h3 id="Header-sichern">Header sichern<a class="headerlink" href="#Header-sichern">¶</a></h3><p>
Um Informationen über die Partitionierung innerhalb des Containers und der Keyslots zu sichern, empfiehlt es sich, ein Backup vom LUKS-Header (außerhalb des verschlüsselten Containers) anzulegen. Wird dieses Backup entwendet, ist ein Zugriff auf den verschlüsselten Container trotzdem nur mit Schlüsselinformationen möglich.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ein gesicherter Header hängt von den Passwörtern ab, die gerade zu dem Zeitpunkt der Sicherung aktiv sind. Das erfordert einerseits, dass man zur Nutzung der Sicherung diese noch kennen muss. Andererseits bedeutet es auch, dass bekannt gewordene Passwörter, selbst wenn sie am Gerät geändert wurden, mit der Sicherung noch für den Zugriff auf das Gerät verwendet werden können.</p><p>Entsprechend ist es empfehlenswert, die Sicherung des Headers unter Verschluss zu halten und nach jeder Änderung am Gerät unmittelbar zu aktualisieren.
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksHeaderBackup GERÄTEDATEI --header-backup-file BACKUP-DATEI </pre></div></div><p>Zur Wiederherstellung wird folgender Befehl verwendet:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cryptsetup luksHeaderRestore GERÄTEDATEI --header-backup-file BACKUP-DATEI </pre></div></div></div><div class="section_2"><h3 id="Automatisiertes-Verschluesseln-mit-Alternate-CD">Automatisiertes Verschlüsseln mit Alternate-CD<a class="headerlink" href="#Automatisiertes-Verschluesseln-mit-Alternate-CD">¶</a></h3><p>
Es kann auch mit Hilfe der <a class="internal" href="./alternate-cd.html">Alternate-CD</a> eine neue Partition im Nachhinein verschlüsselt werden. Siehe dazu <a class="internal" href="./system_verschlüsseln/alternate_installation.html#Datentraeger-verschluesseln">Alternate Installation - Datenträger verschlüsseln</a>.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bei dieser Vorgehensweise sollte man sehr vorsichtig sein, um nicht irrtümlich eine Systempartition zu beschädigen! Eine Datensicherung ist sehr zu empfehlen.</p><p>Insbesondere <em>"Änderungen auf die Festplatte schreiben"</em>-Abfragen sind immer sehr genau zu lesen, damit keine unbeabsichtigten Änderungen am System vorgenommen werden!
</p></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Um die Änderungen der Partitionierung übernehmen zu können, ohne zu installieren, wählt man am Schluss z. B. <em>"Logical Volume Manager konfigurieren"</em>, womit eine Abfrage erzwungen wird, ob man die anstehenden Änderungen übernehmen möchte. Anschließend kann die Installation abgebrochen werden.
</p></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="./luks/containerdatei.html">LUKS/Containerdatei</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - LUKS mit einer Container-Datei verwenden</p></li><li><p><a class="external" href="https://gitlab.com/cryptsetup/cryptsetup" rel="nofollow">LUKS-Homepage</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://wiki.gentoo.org/wiki/DM-Crypt_LUKS" rel="nofollow">DM-Crypt LUKS</a> - Gentoo Wiki <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://www.fedorawiki.de/index.php?title=Verschl%C3%BCsselte_Festplatten" rel="nofollow">Verschlüsselte Festplatten</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - fedorawiki.de</p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Linux_Unified_Key_Setup">Wikipedia über LUKS und dm-crypt</a></p></li><li><p><a class="external" href="http://heise.de/-2072199" rel="nofollow">Erfolgreicher Angriff auf Linux-Verschlüsselung</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - heise Security, 12/2013</p></li><li><p><a class="external" href="http://www.linux-magazin.de/Ausgaben/2005/08/Geheime-Niederschrift" rel="nofollow">Festplattenverschlüsselung mit DM-Crypt und Cryptsetup-LUKS: Technik und Anwendung</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Clemens Fruhwirth, Markus Schuster. Aus Linux-Magazin 08/2005</p></li><li><p><a class="external" href="http://blog.andreas-haerter.com/2011/06/18/ubuntu-festplattenvollverschluesselung-lvm-luks" rel="nofollow">Vollverschlüsseltes System mit Ubuntu, LVM und LUKS</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - blog.andreas-haerter.com</p></li></ul><p></p></div></div>
<p class="meta">
<a href="./luks/a/revision/941625.html">Diese Revision</a> wurde am 28. Mai 2017 10:30 von <a href="https://ubuntuusers.de/user/noisefloor/">noisefloor</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./luks.html">LUKS</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>