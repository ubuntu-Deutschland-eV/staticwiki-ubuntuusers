<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>VM_basierende_Anonymisierung › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./vm_basierende_anonymisierung.html">VM basierende Anonymisierung</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/VM_basierende_Anonymisierung">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./vm_basierende_anonymisierung/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./vm_basierende_anonymisierung/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./vm_basierende_anonymisierung/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./vm_basierende_anonymisierung/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./vm_basierende_anonymisierung/a/backlinks.html">VM basierende Anonymisierung</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Einrichtung-einer-virtualisierten-Ubuntu-Instanz">Einrichtung einer virtualisierten Ubuntu-I...</a></li><li><a class="crosslink" href="#Anonymisierung-des-Netzverkehrs">Anonymisierung des Netzverkehrs
</a><ol class="arabic"><li><a class="crosslink" href="#Variante-1-socks-http-Proxy-als-Gateway">Variante 1: socks- &amp; http-Proxy als Gate...</a></li><li><a class="crosslink" href="#Variante-2-transparenter-Proxy-als-Gateway">Variante 2: transparenter Proxy als Gate...</a></li></ol></li><li><a class="crosslink" href="#Bewertung-der-Sicherheit">Bewertung der Sicherheit
</a></li><li><a class="crosslink" href="#Weiterfuehrende-Links">Weiterführende Links
</a><ol class="arabic"><li><a class="crosslink" href="#intern">intern
</a></li><li><a class="crosslink" href="#extern">extern
</a></li></ol></li></ol></div><p>Dieser Artikel beschreibt die <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Anonymit%C3%A4t_im_Internet">Anonymisierung</a> des gesamten Netzwerkverkehrs einer Ubuntu-Instanz innerhalb einer <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Virtuelle_Maschine">virtuellen Maschine</a> mit Hilfe von <a class="internal" href="./tor.html">Tor</a> und <a class="internal" href="./iptables.html">iptables</a>. Insbesondere kann kein nicht-anonymisierter Netzwerkverkehr die VM-Instanz verlassen.</p><p>Das Aufsetzen einer dedizierten Ubuntu-Instanz ermöglicht dem Benutzer eine tiefgreifende Trennung zwischen normalem (alltäglichem) und anonymisiertem System. Dadurch wird der Benutzer angehalten, zwischen seinem normalen System (Gastgebersystem) - mit allen installierten Anwendungen und Daten - und dem anonymisierten System (Gast) zu trennen und somit "Benutzerfehler" bezüglich seiner Anonymität zu vermeiden.</p><p>Folglich sind die Ziele dieser Anleitung sowohl die Trennung der Systeme als auch die Zusicherung, dass kein nicht-anonymisierter Netzwerkverkehr das anonymisierte System verlassen kann. Dabei ist anzumerken, dass kein UDP-Verkehr die VM verlassen kann, da Tor das Weiterleiten von UDP noch nicht unterstützt. Ausnahme stellen DNS-Anfragen, die Tor über einen gesonderten DnsPort weiterleiten kann, sowie die Anfragen für die Zeitsynchronisation dar.</p><p>Der hier vorgestellte Ansatz bietet weitere Vorteile gegenüber der Anonymisierung des Netzwerkverkehrs einzelner Programme:</p><ul><li><p>Firefox-Plugins wie z.B. Java und Flash, die die Proxy-Einstellungen des Browsers gegebenenfalls nicht beachten, können keine Verbindung mit dem Internet herstellen und die tatsächliche IP-Adresse offenlegen. </p></li><li><p>das Problem des "<a class="internal" href="./tor/gefahren.html#DNS-Leaking">DNS-Leaking</a>" ist nicht gegeben. Programme müssen den konfigurierten Proxy für die DNS-Auflösung benutzen, sonst werden entsprechende DNS-Anfrage-Pakete von iptables verworfen.</p></li></ul><p>
Dagegen ergeben sich folgende Nachteile:</p><ul><li><p>höhere Anforderungen an die Hardware durch die Virtualisierung. Insbesondere ist mehr Arbeitsspeicher erforderlich.</p></li><li><p>höherer Konfigurations- und Wartungsaufwand. Für Einsteiger ist dies sicherlich nicht einfach zu bewältigen.</p></li></ul><div class="section_1"><h2 id="Einrichtung-einer-virtualisierten-Ubuntu-Instanz">Einrichtung einer virtualisierten Ubuntu-Instanz<a class="headerlink" href="#Einrichtung-einer-virtualisierten-Ubuntu-Instanz">¶</a></h2><p>
Die Einrichtung einer virtualisierten Ubuntu-Instanz ist in den Artikeln zu <a class="internal" href="./qemu.html">QEMU</a> und <a class="internal" href="./virtualbox.html">VirtualBox</a> beschrieben (weitere Virtualisierungsmöglichkeiten werden durch XEN und KVM angeboten). Dabei bietet sich an, das gesamte System mit Hilfe der <a class="internal" href="./system_verschlüsseln/alternate_installation.html">Alternate - Installation zu verschlüsseln</a>.</p></div><div class="section_1"><h2 id="Anonymisierung-des-Netzverkehrs">Anonymisierung des Netzverkehrs<a class="headerlink" href="#Anonymisierung-des-Netzverkehrs">¶</a></h2><p>
Im Folgenden werden zwei Varianten der Anonymisierung des Netzwerkverkehrs einer dedizierten Ubuntu-Instanz vorgestellt. Beide Varianten stellen sicher, dass kein nicht anonymisierter IPv4 Netzwerkverkehr die Instanz verlassen kann. Die Betrachtung von IPv6 erfolgt in diesem Artikel nicht. Um sicherzustellen, das kein IPv6 Verkehr die VM verlassen kann, sollte zu Beginn IPv6 daher systemweit per Grub-Bootoption deaktiviert werden, siehe <a class="internal" href="./tuning.html">Tuning</a>.</p><div class="section_2"><h3 id="Variante-1-socks-http-Proxy-als-Gateway">Variante 1: socks- &amp; http-Proxy als Gateway<a class="headerlink" href="#Variante-1-socks-http-Proxy-als-Gateway">¶</a></h3><p>
Alle aus- und eingehenden Pakete werden durch entsprechende iptables-Regeln verworfen - außer sie gehören zum Tor-Netzwerkverkehr. Als Gateway zum Tor-Netzwerk stehen ein socks- und ein http-Proxy zur Verfügung. Der Tor-Client interne socks-Proxy lauscht auf Port 9050. Als http-Proxy dient Polipo; er lauscht auf Port 8118.</p><p>Der Nachteil dieser Variante ist, dass Programme - wie zum Beispiel Firefox - sowohl eine Proxy-Konfiguration anbieten müssen als dass diese auch pro Programm konfiguriert werden muss (siehe <a class="internal" href="./tor/programme_zur_nutzung_von_tor_konfigurieren.html">Tor/Programme zur Nutzung von Tor konfigurieren</a>; die Gefahr des "DNS-Leaking" besteht bei diesem Vorgehen nicht).</p><p>Der Vorteil dieser Variante liegt darin, dass nur explizit konfigurierte Programme Pakete senden können; dadurch ist sowohl eine rudimentäre Abschottung von Programmen möglich als auch eine Protokoll-individuelle Filterung auf Anwendungsebene durch den genutzten Proxy.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle nachfolgenden Instruktionen müssen innerhalb der virtualisierten Instanz mit Root-Rechten ausgeführt werden.
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Schnittstellenkonfiguration für das Netzwerk der virtualisierten Instanz wird überschrieben!
</p></div></div><p>Zunächst müssen die Pakete tor und polipo installiert werden:
</p><ul><li><p><strong>polipo tor</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install polipo tor </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install polipo tor </pre></div></div><p>
</p></div></div><p>Anschließend muss noch die Konfiguration von polipo angepasst werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>cp /etc/polipo/config /etc/polipo/config.backup
<span class="nb">echo</span> <span class="s1">'socksParentProxy = "localhost:9050"'</span> &gt; /etc/polipo/config
<span class="nb">echo</span> <span class="s1">'socksProxyType = socks5'</span> &gt;&gt; /etc/polipo/config
<span class="nb">echo</span> <span class="s1">'diskCacheRoot = ""'</span> &gt;&gt; /etc/polipo/config
<span class="nb">echo</span> <span class="s1">'proxyPort = 8118'</span> &gt;&gt; /etc/polipo/config

<span class="c1">## in 14.04 muss der Pfad des Logs angepasst werden</span>
<span class="c1"># echo 'logFile = /var/log/polipo/polipo.log' &gt;&gt; /etc/polipo/config</span>
</pre></div>
</td></tr></table></div><p>Des Weiteren sollte das automatische Aktivieren der Netzwerkschnittstelle beim Bootvorgang deaktiviert werden. Dazu wird ein Eintrag in der <a class="internal" href="./interfaces.html">interfaces</a> vorgenommen, wodurch die Schnittstelle nicht mehr per Networkmanager verwaltet wird:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="nb">echo</span> -e <span class="s2">"\niface eth0 inet dhcp\n"</span> &gt;&gt; /etc/network/interfaces
</pre></div>
</td></tr></table></div><p>Zur Absicherung wird iptables eingesetzt. Denkbar ist nachfolgendes Script, das bei Bedarf oder automatisch (z.B. per Cron) gestartet werden kann. Aus didaktischen Gründen werden im Script die Langform der Parameter und Optionen von iptables verwendet. Alternativ können die iptables auch automatisch bei Systemstart bzw. beim Hochfahren der Netzwerkschnittstelle geladen werden (siehe <a class="internal" href="./iptables.html">iptables</a>).</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1"># Kernelmodule laden</span>
modprobe ip_tables
modprobe ip_nat_ftp
modprobe ip_nat_irc
modprobe ip_conntrack_irc
modprobe ip_conntrack_ftp
modprobe iptable_filter
modprobe iptable_nat
modprobe ipt_REJECT
modprobe xt_recent
modprobe ipt_mac

<span class="c1"># alle bisherigen Regeln und Ketten löschen</span>
iptables --flush
iptables --table nat --flush
iptables --delete-chain

<span class="c1"># jeglichen Traffic verwerfen</span>
iptables --policy INPUT DROP
iptables --policy OUTPUT DROP
iptables --policy FORWARD DROP

<span class="c1"># localhost zulassen</span>
iptables --append INPUT --in-interface lo --jump ACCEPT
iptables --append OUTPUT --out-interface lo --jump ACCEPT

<span class="c1"># Proxy Einstellungen</span>
<span class="c1"># Schnittstellenbezeichnung ab 16.04 anpassen</span>
ip link <span class="nb">set</span> eth0 up <span class="c1">#manuelles Hochfahren der Schnittstelle</span>
dhclient eth0 <span class="c1">#DHCP beantragen</span>
iptables --append OUTPUT --match owner --uid-owner <span class="s2">"debian-tor"</span> --jump ACCEPT
iptables --append INPUT --protocol tcp --match state --state ESTABLISHED,RELATED -j ACCEPT

<span class="c1"># der Rest wird verworfen</span>
iptables --append OUTPUT --jump REJECT

<span class="c1">## bis 12.04 auskommentieren</span>
<span class="c1"># /etc/init.d/networking restart</span>
<span class="c1"># /etc/init.d/polipo restart</span>

<span class="c1">## ab 14.04 auskommentieren</span>
<span class="c1"># service networking restart</span>
<span class="c1"># service polipo restart</span>
</pre></div>
</td></tr></table></div><p>Besonders ist zu beachten, dass die apt-Konfiguration angepasst werden muss, damit Sicherheitsaktualisierungen gefunden und nachgeladen werden können. Dazu muss mit einem Editor mit Root-Rechten die Datei <strong>/etc/apt/apt.conf</strong> editiert bzw., wenn noch nicht vorhanden, erstellt werden:
</p><pre class="notranslate">gksudo gedit /etc/apt/apt.conf</pre><p>
Es muss folgende Zeile eingetragen werden:
</p><pre class="notranslate">Acquire::http::Proxy "http://localhost:8118";</pre></div><div class="section_2"><h3 id="Variante-2-transparenter-Proxy-als-Gateway">Variante 2: transparenter Proxy als Gateway<a class="headerlink" href="#Variante-2-transparenter-Proxy-als-Gateway">¶</a></h3><p>
Der Tor-Client bietet einen internen <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Proxy_(Rechnernetz)#Transparenter_Proxy">transparenten Proxy</a> an, der genutzt werden kann, um sämtlichen TCP-Netzwerkverkehr zu anonymisieren. Zur Umsetzung dieser Variante wird ein DNS-Proxy benötigt, der die DNS-Anfragen entgegennimmt und anonymisiert durch das Tor-Netzwerk auflöst.</p><p>Der Vorteil dieser Variante ist, dass keine weitere Konfiguration von Programmen nötig ist. Insbesondere müssen Programme keine Proxy-Unterstützung anbieten. Alle TCP-Pakete werden durch iptables-Regeln automatisch durch das Tor-Netzwerk anonymisiert (UDP-Pakete werden jedoch aufgrund der fehlenden Funktionalität von Tor grundsätzlich nicht weitergeleitet).</p><p>Ein Nachteil dieser Variante ist, dass jeder TCP-Netzwerkverkehr durch Tor geleitet wird. Protokoll-individuelle Filter auf Anwendungsebene wie Polipo oder Prixoxy werden nicht angewandt, dadurch werden gegebenenfalls unbewusst nicht anonymisierte Informationen gesendet.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle nachfolgenden Instruktionen müssen innerhalb der virtualisierten Instanz mit Root-Rechten ausgeführt werden.
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Schnittstellenkonfiguration für das Netzwerk der virtualisierten Instanz wird überschrieben!
</p></div></div><p>Zunächst muss tor installiert werden:
</p><ul><li><p><strong>tor</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install tor </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install tor </pre></div></div><p>
</p></div></div><p>Anschließend muss noch die Konfiguration von tor angepasst werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>cp /etc/tor/torrc /etc/tor/torrc.backup
<span class="c1">## bis 12.04 auskommentieren</span>
<span class="c1"># echo "VirtualAddrNetwork 172.16.0.0/12" &gt; /etc/tor/torrc </span>

<span class="c1">## ab 14.04 auskommentieren</span>
<span class="c1"># echo "VirtualAddrNetworkIPv4 172.16.0.0/12" &gt; /etc/tor/torrc </span>

<span class="nb">echo</span> <span class="s2">"TransPort 9040"</span> &gt;&gt; /etc/tor/torrc
<span class="nb">echo</span> <span class="s2">"DNSPort 9053"</span> &gt;&gt; /etc/tor/torrc
<span class="nb">echo</span> <span class="s2">"AutomapHostsOnResolve 1"</span> &gt;&gt; /etc/tor/torrc
</pre></div>
</td></tr></table></div><p>Des Weiteren sollte das automatische Aktivieren der Netzwerkschnittstelle beim Bootvorgang deaktiviert werden. Dazu wird ein Eintrag in der <a class="internal" href="./interfaces.html">interfaces</a> vorgenommen, wodurch die Schnittstelle nicht mehr per Networkmanager verwaltet wird:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="nb">echo</span> -e <span class="s2">"\niface eth0 inet dhcp\n"</span> &gt;&gt; /etc/network/interfaces
</pre></div>
</td></tr></table></div><p>Zur Absicherung wird iptables eingesetzt:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># Kernelmodule laden</span>
modprobe ip_tables
modprobe ip_nat_ftp
modprobe ip_nat_irc
modprobe ip_conntrack_irc
modprobe ip_conntrack_ftp
modprobe iptable_filter
modprobe iptable_nat
modprobe ipt_REJECT
modprobe xt_recent
modprobe ipt_mac

<span class="c1"># alle bisherigen Regeln und Ketten löschen</span>
iptables --flush
iptables --table nat --flush
iptables --delete-chain

<span class="c1"># jeglichen Traffic verwerfen</span>
iptables --policy INPUT DROP
iptables --policy OUTPUT DROP
iptables --policy FORWARD DROP

<span class="c1"># zugelassene Verbindungen</span>
<span class="c1"># Schnittstellenbezeichnung ab 16.04 anpassen</span>
ip link <span class="nb">set</span> eth0 up <span class="c1">#manuelles Hochfahren der Schnittstelle</span>
dhclient eth0 <span class="c1">#DHCP beantragen</span>
iptables --append INPUT --in-interface eth0 --match state --state ESTABLISHED,RELATED --jump ACCEPT
iptables --append OUTPUT --out-interface eth0 --match state --state ESTABLISHED,RELATED --jump ACCEPT

<span class="c1"># localhost zulassen</span>
iptables --append INPUT --in-interface lo --jump ACCEPT
iptables --append OUTPUT --out-interface lo --jump ACCEPT

<span class="c1"># Ruleset for Tor Transparent Proxy</span>
iptables -t nat --append OUTPUT --out-interface lo --jump RETURN
iptables -t nat --append OUTPUT --match owner --uid-owner <span class="s2">"debian-tor"</span> --jump RETURN
iptables -t nat --append OUTPUT --protocol udp --dport <span class="m">53</span> --jump REDIRECT --to-ports <span class="m">9053</span>
iptables -t nat --append OUTPUT --protocol tcp --syn --jump REDIRECT --to-ports <span class="m">9040</span>

iptables --append OUTPUT --match state --state ESTABLISHED,RELATED --jump ACCEPT
iptables --append OUTPUT --match owner --uid-owner <span class="s2">"debian-tor"</span> --jump ACCEPT

<span class="k">for</span> NET in <span class="m">127</span>.0.0.0/8<span class="p">;</span> <span class="k">do</span>
 iptables --append OUTPUT --destination <span class="nv">$NET</span> --jump ACCEPT
<span class="k">done</span>

<span class="c1">## optional Zugriff aus dem lokalen Netzbereich 192.168.1.0 ermöglichen, z.B. für ssh</span>
<span class="c1">#for NET in 192.168.1.0/24; do</span>
<span class="c1"># iptables --append INPUT --destination $NET --jump ACCEPT</span>
<span class="c1"># iptables --append OUTPUT --destination $NET --jump ACCEPT</span>
<span class="c1">#done</span>

<span class="c1">## alternativ kann der Port auch ohne Einschränkung freigeschaltet werden</span>
<span class="c1"># iptables --append INPUT --protocol tcp --dport 22 --jump ACCEPT</span>
<span class="c1"># iptables --append OUTPUT --protocol tcp --sport 22 --jump ACCEPT</span>

<span class="c1"># zur Zeitsynchronisation wird der Port 123 freigeschaltet</span>
iptables --append OUTPUT --protocol udp --match udp --dport <span class="m">123</span> --jump ACCEPT
<span class="c1"># der Rest wird verworfen</span>
iptables --append OUTPUT --jump REJECT

<span class="c1">## bis 12.04 auskommentieren</span>
<span class="c1"># /etc/init.d/networking restart</span>
<span class="c1"># /etc/init.d/tor restart</span>

<span class="c1">## ab 14.04 auskommentieren</span>
<span class="c1"># service networking restart</span>
<span class="c1"># service tor restart</span>
</pre></div>
</td></tr></table></div><p>Als Vorlage für diesen Code diente <a class="external" href="https://wiki.torproject.org/noreply/TheOnionRouter/TransparentProxy" rel="nofollow">Tor Wiki - Transparently Routing Traffic Through Tor</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>.</p></div></div><div class="section_1"><h2 id="Bewertung-der-Sicherheit">Bewertung der Sicherheit<a class="headerlink" href="#Bewertung-der-Sicherheit">¶</a></h2><p>
Die VM dient als Trennung zwischen normalem und dem anonymisierten System. Dabei stellt die VM zwar eine erhebliche, aber doch wegen möglicher Sicherheitslücken nicht unüberwindliche Hürde dar. Innerhalb der VM-Instanz kann nicht ohne weiteres auf das Dateisystem des Gastgebersystems zugegriffen werden; vom Gastgebersystem ist das Dateisystem des Gastes bei aktivierter Verschlüsselung des VM-Containers mittels der Alternate-Installation nicht zugreifbar.</p><p>Bezüglich der Vertraulichkeit der Daten innerhalb der VM ist besonders zu beachten:
</p><ul><li><p>Das Gastgebersystem muss vertrauenswürdig sein. Prozesse des Gastgebers dürfen die VM nicht ausspionieren - sie dürfen zum Beispiel nicht das Speicherabbild oder die Tastatureingaben analysieren. </p></li><li><p>Besonders ist zu beachten, dass bei einem mit Hilfe der Alternate-Installation verschlüsselten System unverschlüsselte Inhalte des VM-Arbeitsspeichers in den Auslagerungsspeicher (swap) des Gastgebersystems gelangen können.</p></li></ul><p>
Um die beiden genannten Nachteile zu umgehen, kann ein dediziertes nicht-virtualisiertes System zur Anonymisierung mit Hilfe der aufgezeigten iptables-Regeln eingesetzt werden.</p><p>Durch die iptables-Regeln kann kein nicht-anonymisierter Netzwerkverkehr die VM verlassen. Wenn aber Schadcode innerhalb der VM durch eine Sicherheitslücke die Rechte des root-Benutzers erlangen könnte, dann könnten die iptables-Regeln außer Kraft gesetzt und somit die wahre IP-Adresse offengelegt werden. Eine mögliche Abhilfe gegen das skizzierte Angriffsszenario wäre das Anonymisieren des VM-Netzverkehrs außerhalb der VM (siehe z.B. <a class="external" href="http://www.artifex.org/~jarusl/TorVTL/" rel="nofollow">TorVTL</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>).</p><p>Weitere Gefahrenhinweise:
</p><ul><li><p>Besonders wird vor <a class="internal" href="./tor/gefahren.html#Boese-Exit-Nodes">"bösen" Exit-Nodes</a> gewarnt. </p></li><li><p>Die Grenzen der von Tor erreichten Anonymität sind unter <a class="external" href="https://www.torproject.org/docs/faq.html.en#WhatProtectionsDoesTorProvide" rel="nofollow">Tor FAQ - What protections does Tor provide?</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> aufgezeigt.</p></li><li><p>Es wird empfohlen, die erfolgreiche Umsetzung mit Hilfe von <a class="external" href="https://check.torproject.org/?lang=de" rel="nofollow">Testen, ob man mit Tor surft</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> zu prüfen.</p></li></ul><p>
</p></div><div class="section_1"><h2 id="Weiterfuehrende-Links">Weiterführende Links<a class="headerlink" href="#Weiterfuehrende-Links">¶</a></h2><p>
</p><div class="section_2"><h3 id="intern">intern<a class="headerlink" href="#intern">¶</a></h3><p>
</p><ul><li><p><a class="internal" href="./tor.html">Tor</a></p></li><li><p><a class="internal" href="./sicherheit/anonym_surfen.html">Sicherheit/Anonym Surfen</a></p></li></ul></div><div class="section_2"><h3 id="extern">extern<a class="headerlink" href="#extern">¶</a></h3><p>
</p><ul><li><p><a class="external" href="https://wiki.torproject.org/noreply/TheOnionRouter/TransparentProxy" rel="nofollow">Tor Wiki - Transparently Routing Traffic Through Tor</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="https://www.torproject.org/docs/faq.html.en#WhatProtectionsDoesTorProvide" rel="nofollow">Tor FAQ - What protections does Tor provide?</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="https://check.torproject.org/?lang=de" rel="nofollow">Testen, ob man mit Tor surft</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> </p></li><li><p><a class="external" href="https://www.whonix.org/" rel="nofollow">Whonix - Anonymisierte VM der Tor-Community</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p></p></div></div></div>
<p class="meta">
<a href="./vm_basierende_anonymisierung/a/revision/940441.html">Diese Revision</a> wurde am 8. Mai 2017 18:21 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./vm_basierende_anonymisierung.html">VM basierende Anonymisierung</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>