<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/Samba_Client/ADAUTH › ubuntuusers statisches Wiki</title>
<link href="../../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../../archiv/samba_client/adauth.html">ADAUTH</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/Samba_Client/ADAUTH">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../../wiki/index.html">Index</a></li>
<li><a href="../../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../../wiki.html">Übersicht</a></li>
<li><a href="../../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../../kategorien.html">Kategorie</a></li>
<li><a href="../../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../../howto.html">Howto anlegen</a></li>
<li><a href="../../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../../baustelle.html">Baustellen</a></li>
<li><a href="../../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../../archiv/samba_client/adauth/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../../archiv/samba_client/adauth/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../../archiv/samba_client/adauth/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../../archiv/samba_client/adauth/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../../archiv/samba_client/adauth/a/backlinks.html">ADAUTH</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../../pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../../paketquellen_freischalten.html">Bearbeiten von Paketquellen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../../terminal.html">Ein Terminal öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Ubuntu-am-Active-Directory-Windows-Server-2003">Ubuntu am Active Directory (Windows Server...</a></li><li><a class="crosslink" href="#Her-mit-den-Benutzernamen">Her mit den Benutzernamen
</a></li><li><a class="crosslink" href="#Kerberos">Kerberos
</a></li><li><a class="crosslink" href="#home-sweet-home">/home, sweet /home
</a></li></ol></div><div class="section_1"><h2 id="Ubuntu-am-Active-Directory-Windows-Server-2003">Ubuntu am Active Directory (Windows Server 2003)<a class="headerlink" href="#Ubuntu-am-Active-Directory-Windows-Server-2003">¶</a></h2><p>
In diesem Artikel geht es darum, Ubuntu gegen andere Sachen als die klassischen Dateien <strong><a class="internal" href="../../shell/passwd.html">/etc/passwd</a></strong>, <strong>/etc/groups</strong> und <strong>/etc/shadow</strong> zu authentifizieren, z.B. falls man sich in einem <a class="internal" href="../../samba.html">Windowsnetzwerk</a> befindet, in dem <a class="internal" href="../../active_directory_client_authentifikation.html">zur Authentifikation das Active Directory</a> benutzt wird.</p><p>Vereinfacht gesehen besteht das Active Directory aus einem LDAP-Server, der für die Benutzernamen angezapft werden kann, und einen <a class="internal" href="../../kerberos.html">Kerberos</a>-Server, gegen den man sich dann mit den Namen aus dem LDAP authentifizieren kann. Auf dem oder den Domänencontrollern müssen für diese Vorgehensweise die MS Services For Unix 3.5 installiert sein. Beim Anlegen eines Benutzers hat man dann einen neuen Reiter, mit dem Login-Informationen für Ubuntu eingegeben werden können.</p></div><div class="section_1"><h2 id="Her-mit-den-Benutzernamen">Her mit den Benutzernamen<a class="headerlink" href="#Her-mit-den-Benutzernamen">¶</a></h2><p>
Zuerst muss man das Paket</p><ul><li><p><strong>libnss-ldap</strong> (<em>universe</em>, <sup><a href="#source-2">[2]</a></sup>) </p></li></ul><p>installieren <sup><a href="#source-1">[1]</a></sup>. Danach die Konfigurationsdatei <strong>/etc/libnss-ldap.conf</strong> (ab Hardy <strong>/etc/ldap.conf</strong>) mit Root-Rechten editieren <sup><a href="#source-3">[3]</a></sup>. Hier macht man dem Name Service Switch die neuen Benutzer bekannt: 
</p><pre class="notranslate">host ldap1.w2k3domaene.de ldap2.w2k3domaene.de # Bei Bedarf werden mehrere Domaenencontroller
                                               # via Leerzeichen getrennt.
base dc=w2k3domaene,dc=de
ldap_version 3

binddn cn=LDAP,cn=Users,dc=w2k3domaene,dc=de # Benutzer zum Auselesen des Active Directory
bindpw LDAPs_Passwort                        # Hab mir einen extra zu diesem Zweck angelegt

nss_base_passwd cn=Users,dc=w2k3domaene,dc=de?one
nss_base_shadow cn=Users,dc=w2k3domaene,dc=de?one
nss_base_group cn=Users,dc=w2k3domaene,dc=de?one

nss_map_objectclass posixAccount User
nss_map_objectclass shadowAccount User
nss_map_objectclass posixGroup Group

nss_map_attribute uid msSFU30Name
nss_map_attribute uniqueMember msSFU30PosixMember
#nss_map_attribute userPassword msSFU30Password
nss_map_attribute homeDirectory msSFU30HomeDirectory
nss_map_attribute loginShell msSFU30LoginShell
nss_map_attribute uidNumber msSFU30UidNumber
nss_map_attribute gidNumber msSFU30GidNumber

pam_login_attribute msSFU30Name
pam_filter objectclass=User
pam_password ad</pre><p>
Das Passwortmapping wird nicht benutzt, weil die Authentifizierung über Kerberos ablaufen soll.</p><p>Damit der Name Service Switch die Namen auch für das Anmelden kennt, muss die <strong>/etc/nsswitch.conf</strong> wie folgt angepasst werden (Bug: mit neueren <a class="internal" href="../../gdm.html">GDM</a>-Versionen muss <em>ldap</em> an zweiter Stelle stehen!):</p><pre class="notranslate">passwd:         compat ldap   # Bei passwd und group müssen nun Einträge für LDAP stehen
group:          compat ldap
shadow:         compat

hosts:          files dns
networks:       files

protocols:      db files
services:       db files
ethers:         db files
rpc:            db files

netgroup:       nis</pre><p>
Damit sind dem Ubuntusystem die Namen aus dem Active Directory bekannt und sie kommen für eine Anmeldung in Frage. Die Dienste müssen nun noch neu gestartete werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /etc/init.d/nscd restart
sudo /etc/init.d/portmap restart
sudo /etc/init.d/libnss-ldap restart </pre></div></div><p>Im Terminal <sup><a href="#source-4">[4]</a></sup> kann man mittels 
</p><div class="bash"><div class="contents"><pre class="notranslate">getent passwd </pre></div></div><p>
bzw. 
</p><div class="bash"><div class="contents"><pre class="notranslate">getent group </pre></div></div><p>
überprüfen, ob die Namen aus dem Active Directory bekannt sind. Jedoch fehlt noch die Einstellung für die Authentifizierung über...</p></div><div class="section_1"><h2 id="Kerberos">Kerberos<a class="headerlink" href="#Kerberos">¶</a></h2><p>
<a class="internal" href="../../kerberos.html">Kerberos</a> lässt sich über die Pakete</p><ul><li><p><strong>libpam-krb5</strong> (<em>universe</em> <sup><a href="#source-2">[2]</a></sup>) </p></li><li><p><strong>krb5-user</strong> (<em>universe</em>) </p></li></ul><p>installieren <sup><a href="#source-1">[1]</a></sup>.</p><p><strong>krb5-user</strong> wird zur eigentlichen Authentifizierung nicht gebraucht, liefert aber mit <strong>kinit</strong> und <strong>klist</strong> Werkzeuge, mit denen man den Erhalt des Tickets überprüfen kann. Die Kerberoskonfigurationsdatei <strong>/etc/krb5.conf</strong> muss dann wie folgt aussehen (Editor mit Root-Rechten, <sup><a href="#source-3">[3]</a></sup>): 
</p><pre class="notranslate">[libdefaults]
default_realm = W2K3DOMAENE.DE
krb4_config = /etc/krb.conf
krb4_realms = /etc/krb.realms
kdc_timesync = 1
ccache_type = 4
forwardable = true
proxiable = true

[realms]
W2K3DOMAENE.DE = {
kdc = ldap1.w2k3domaene.de
kdc = ldap2.w2k3domaene.de
admin_server = ldap1.w2k3domaene.de
}</pre><p>
Im Terminal <sup><a href="#source-4">[4]</a></sup> mittels</p><div class="bash"><div class="contents"><pre class="notranslate">kinit user </pre></div></div><p>
kann man nun überprüfen, ob man ein Ticket bekommt.</p><div class="bash"><div class="contents"><pre class="notranslate">klist </pre></div></div><p>
listet alle gelösten Tickets.</p><p>Hiermit ist der Grundstein für die Authentifizierung mittels PAM gelegt. Nun müssen die PAM-Konfigurationsdateien im <strong>/etc/pam.d</strong> in Angriff genommen werden <sup><a href="#source-3">[3]</a></sup>.</p><p><strong>/etc/pam.d/common-auth:</strong>
</p><pre class="notranslate">auth sufficient pam_krb5.so
auth required pam_unix.so nullok_secure use_first_pass</pre><p>
<strong>/etc/pam.d/common-account:</strong>
</p><pre class="notranslate">account sufficient pam_krb5.so
account required pam_unix.so</pre><p>
<strong>/etc/pam.d/common-password:</strong>
</p><pre class="notranslate">password           sufficient   pam_krb5.so nullok obscure min=4 max=8 md5
password   required   pam_unix.so nullok obscure min=4 max=8 md5</pre><p>
<strong>/etc/pam.d/common-session:</strong>
</p><pre class="notranslate">session required pam_mkhomedir.so skel=/etc/skel/ umask=0022 #vorher, sonst kein homedir bei 1st login
session sufficient pam_krb5.so # Wichtig fuer gdm
session required pam_unix.so</pre><p>
<em>use_first_pass</em> bei <strong>common_auth</strong> bedeutet, dass auch für die zweite Authentifizierungsmethode dasselbe Passwort wie für die erste benutzt wird. <em>pam_mkhomedir.so</em> in <strong>common-session</strong> bewirkt, dass das Homeverzeichnis eines Benutzers, wenn es denn noch nicht existiert, angelegt wird.</p></div><div class="section_1"><h2 id="home-sweet-home">/home, sweet /home<a class="headerlink" href="#home-sweet-home">¶</a></h2><p>
Am einfachsten werden mit <strong>libpam-mount</strong> die <a class="internal" href="../../homeverzeichnis.html">Homeverzeichnisse</a> via SMB unter <strong>$HOME/Dokumente</strong> eingebunden, weil SMB keine Links, Sockets, etc. kann und somit nicht direkt als <strong>$HOME</strong> dienen kann.</p><p>Naheliegender ist jedoch folgendes: der NFS-Server aus den MS Services for Unix 3.5. Bei Ordnereigenschaften hat man einen Reiter mehr für NFS-Freigaben. Dort muss man den Ordner freigeben und die erlaubten Maschinen deklarieren. Danach kann die Freigabe eingebunden werden und man kann Homeverzeichnisse automatisch anlegen lassen, wenn auf Windowsseite <em>allow Root-Access</em> gesetzt ist.</p><p>Der Eintrag in <strong>/etc/fstab</strong> ist wie folgt <sup><a href="#source-4">[4]</a></sup>: 
</p><pre class="notranslate">fileserver.w2k3domaene.de:/users   /home   nfs   auto,rw,soft,udp,nolock,rsize=32768,wsize=32768   0   0</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
Wenn für den NFS-Server die Windowseigene Rechtevererbung eingeschaltet ist (was ich aus administrativen Zwecken will), werden alle Dateien mit x-Flag angelegt. Ich hab da noch keine Abhilfe gefunden.</p></div></div><p></p></div></div>
<p class="meta">
<a href="../../archiv/samba_client/adauth/a/revision/657662.html">Diese Revision</a> wurde am 17. November 2013 20:50 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../../startseite.html">Wiki</a></li>
<li><a href="../../archiv.html">Archiv</a></li>
<li><a href="../../archiv/samba_client.html">Samba Client</a></li>
<li><a href="../../archiv/samba_client/adauth.html">ADAUTH</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>