<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/ecryptfs-utils › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../archiv/ecryptfs-utils.html">ecryptfs-utils</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/ecryptfs-utils">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../archiv/ecryptfs-utils/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../archiv/ecryptfs-utils/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../archiv/ecryptfs-utils/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../archiv/ecryptfs-utils/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../archiv/ecryptfs-utils/a/backlinks.html">ecryptfs-utils</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p><hr/><p><strong>Anmerkung:</strong> Jetzt in <a class="internal" href="../ecryptfs.html">ecryptfs</a> und Unterartikeln zu finden
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../paketquellen_freischalten.html">Bearbeiten von Paketquellen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../programme_starten.html">Ein Programm starten</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="../rechte.html">Rechte für Dateien und Ordner ändern</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="../editor.html">Einen Editor nutzen</a></p></li></ol></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Daten im "verschlüsselten" Bereich sind, sobald der jeweilige Benutzer sich eingeloggt hat, auch prinzipiell von anderen Nutzern oder Anwendungen lesbar. Falls dies nicht gewünscht ist, sind die <a class="internal" href="../rechte.html">Rechte</a> entsprechend zu setzen.
</p></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Einrichtung-Verzeichnis-Private">Einrichtung Verzeichnis Private
</a></li><li><a class="crosslink" href="#Einrichtung-Homeverzeichnis">Einrichtung Homeverzeichnis
</a><ol class="arabic"><li><a class="crosslink" href="#Installation-mit-Alternate-CD-DVD">Installation mit Alternate-CD/DVD
</a></li><li><a class="crosslink" href="#Installation-mit-Desktop-CD-DVD">Installation mit Desktop-CD/DVD
</a></li><li><a class="crosslink" href="#Frische-Installation-nachbearbeiten">Frische Installation nachbearbeiten
</a></li><li><a class="crosslink" href="#Zusaetzlicher-Benutzer">Zusätzlicher Benutzer
</a></li><li><a class="crosslink" href="#Bestehendes-Homeverzeichnis">Bestehendes Homeverzeichnis
</a></li></ol></li><li><a class="crosslink" href="#Wechsel-Login-Passwort">Wechsel Login-Passwort
</a></li></ol></li><li><a class="crosslink" href="#Nutzung">Nutzung
</a><ol class="arabic"><li><a class="crosslink" href="#Passphrase-extern-auslagern">Passphrase extern auslagern
</a></li><li><a class="crosslink" href="#Manuelles-Sperren-ffnen-des-Verzeichnis">Manuelles Sperren/Öffnen des Verzeichnis...</a></li><li><a class="crosslink" href="#Moegliches-Szenario">Mögliches Szenario
</a></li><li><a class="crosslink" href="#Trash-bereinigen">Trash bereinigen
</a></li></ol></li><li><a class="crosslink" href="#Datenrettung">Datenrettung
</a><ol class="arabic"><li><a class="crosslink" href="#Daten-extern-auslesen">Daten extern auslesen
</a><ol class="arabic"><li><a class="crosslink" href="#Integriertes-Homeverzeichnis">Integriertes Homeverzeichnis
</a></li><li><a class="crosslink" href="#Separates-Homeverzeichnis">Separates Homeverzeichnis
</a></li><li><a class="crosslink" href="#Benutzer-aktivieren">Benutzer aktivieren
</a></li><li><a class="crosslink" href="#Benutzer-deaktivieren">Benutzer deaktivieren
</a></li></ol></li><li><a class="crosslink" href="#Daten-wieder-herstellen">Daten wieder herstellen
</a><ol class="arabic"><li><a class="crosslink" href="#Datenzugriff-vorbereiten">Datenzugriff vorbereiten
</a></li><li><a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien
</a></li><li><a class="crosslink" href="#berpruefung-der-Schluesseldateien">Überprüfung der Schlüsseldateien
</a></li><li><a class="crosslink" href="#Schluesseldateien-reparieren">Schlüsseldateien reparieren
</a></li></ol></li></ol></li><li><a class="crosslink" href="#Deinstallation">Deinstallation
</a><ol class="arabic"><li><a class="crosslink" href="#Verzeichnis-Private-entfernen">Verzeichnis Private entfernen
</a></li><li><a class="crosslink" href="#Homeverzeichnis-uncodiert">Homeverzeichnis uncodiert
</a><ol class="arabic"><li><a class="crosslink" href="#Vorbereitungen-2">Vorbereitungen
</a></li><li><a class="crosslink" href="#Verschluesselung-entfernen">Verschlüsselung entfernen
</a></li></ol></li><li><a class="crosslink" href="#Basis-Programme-entfernen">Basis-Programme entfernen
</a></li></ol></li><li><a class="crosslink" href="#Probleme-behandeln">Probleme behandeln
</a><ol class="arabic"><li><a class="crosslink" href="#Ordner-wird-beim-Einloggen-nicht-mehr-automatisch-gemountet">Ordner wird beim Einloggen nicht (mehr) ...</a></li><li><a class="crosslink" href="#Fehlermeldung-SWAP-beim-Booten">Fehlermeldung SWAP beim Booten
</a></li><li><a class="crosslink" href="#Keine-Initialisierung">Keine Initialisierung
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><a class="external" href="http://ecryptfs.sourceforge.net/" rel="nofollow">ecryptfs-utils</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> bietet eine sehr einfache Möglichkeit einen einzelnen Ordner (<strong>~/Private</strong>) innerhalb vom <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a>, ab Jaunty Jackalope das gesamte Homeverzeichnis eines Benutzers zu verschlüsseln. Die Ent- bzw. Verschlüsselung geschieht dabei automatisch beim Ein-/Ausloggen des Benutzers. Da beide Varianten aber unterschiedliche Vorgehensweisen erfordern, wird die Einrichtung hier getrennt beschrieben.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bitte vorab die Hinweise unter <a class="crosslink" href="#Wechsel-Login-Passwort">Änderung Login-Passwort</a> lesen!
</p></div></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Konnte die Option <code class="notranslate">ecryptfs-utils</code> nicht schon bei der Installation ausgewählt, so muss das folgende Paket installiert werden <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>ecryptfs-utils</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="../_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="../apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install ecryptfs-utils </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install ecryptfs-utils </pre></div></div><p>
</p></div></div><p>Sofern die Einrichtung einer verschlüsselten Swap nicht bereits bei der Installation erfolgte (ab  Karmic Koala per Default), so kann man dieses wie unter <a class="internal" href="../vorbereitung_teilverschlüsselung.html#Swap">Teilverschlüsselung</a> beschrieben einrichten.</p><p>Möchte man andere Grade der Verschlüsselung anwenden, so sind die "Experten-Info" bei <a class="internal" href="../luks.html#Erstellen">LUKS</a> zu beachten.</p><div class="section_2"><h3 id="Einrichtung-Verzeichnis-Private">Einrichtung Verzeichnis Private<a class="headerlink" href="#Einrichtung-Verzeichnis-Private">¶</a></h3><p>
Jeder Benutzer kann nach der Installation einfach sein privates verschlüsseltes Verzeichnis einrichten, dazu führt man als Benutzer (<span class="underline">nicht</span> als Root) den folgenden Befehl in einem Terminal <sup><a href="#source-2">[2]</a></sup> aus:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-setup-private </pre></div></div><p>Dabei wird das Benutzerpasswort und ein Verschlüsselungs-Passwort abgefragt. Wird kein Verschlüsselungs-Passwort angegeben, so generiert das Programm ein Passwort.</p><p>Sollte das Verzeichnis <strong>~/Private</strong> bzw. die versteckten Verzeichnisse <strong>~/.ecryptfs</strong> oder <strong>~/.Private</strong> bereits existieren, bricht die Einrichtung mit entsprechendem Hinweis ab, selbst wenn das Verzeichnis leer ist. Danach sollte man den Befehl wiederholen und zwar mit</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-setup-private --force </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Das Verschlüsselungs-Passwort bitte unbedingt sicher aufbewahren, dies ist die einzige Möglichkeit wieder an die Daten heran zu kommen, falls das System "beschädigt" wurde! Es wird empfohlen, alle Dateien aus dem relevanten Schlüssel-Verzeichnis extern zu sichern (siehe hierzu auch <a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien</a>).
</p></div></div><p>Anschließend muss man sich neu einloggen und findet das Verzeichnis <strong>~/Private</strong> vor. Dieses wird von nun an bei jedem Einloggen des Nutzers entschlüsselt, und beim Ausloggen wieder verschlüsselt.</p></div><div class="section_2"><h3 id="Einrichtung-Homeverzeichnis">Einrichtung Homeverzeichnis<a class="headerlink" href="#Einrichtung-Homeverzeichnis">¶</a></h3><p>
Ab Jaunty Jackalope besteht die Möglichkeit, ein verschlüsseltes <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> gleich bei der Installation anzulegen.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ab Karmic Koala wird gleich eine verschlüsselte <a class="internal" href="../swap.html">Swap-Partition</a> eingerichtet, sofern man <span class="underline">bei</span> der Installation diese angelegt hat. Diese verschlüsselte Swap-Partition ist für andere Linux-Systeme unbrauchbar. Bei Rechnern mit <span class="underline">mehreren</span> Linux-Distributionen muss man ggf. eine weitere <span class="underline">offene</span> Swap-Partition einrichten oder die anderen Systeme auf die <a class="internal" href="../vorbereitung_teilverschlüsselung.html#Swap">verschlüsselte Swap</a> umstellen.
</p></div></div><div class="section_3"><h4 id="Installation-mit-Alternate-CD-DVD">Installation mit Alternate-CD/DVD<a class="headerlink" href="#Installation-mit-Alternate-CD-DVD">¶</a></h4><p>
Um ein verschlüsseltes Homeverzeichnis von Anfang an zu erhalten, sollte man unter Jaunty die Alternate-CD/DVD benutzen <span class="underline">oder</span> die Installation über <a class="internal" href="../downloads/netzwerkinstallation.html">Downloads/Netzwerkinstallation</a> ausführen, da man bei <span class="underline">dieser</span> Art der Installation dieses Feature gleich direkt auswählen kann. Danach steht für den ersten Benutzer, also den der bei der Installation direkt angelegt wird, gleich ein verschlüsseltes Homeverzeichnis zur Verfügung.</p></div><div class="section_3"><h4 id="Installation-mit-Desktop-CD-DVD">Installation mit Desktop-CD/DVD<a class="headerlink" href="#Installation-mit-Desktop-CD-DVD">¶</a></h4><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Dieser Hinweis ist bei Jaunty Jackalope <span class="underline">nur</span> für Ubuntu-Desktop und XFCE-Desktop anwendbar, ab Karmic auch für Kubuntu-Desktop.</p><p>Um diese Möglichkeit auch bei einer Installation mit einer Desktop-CD nutzen zu können, <span class="underline">muss</span> man dieses beim Start gezielt anfordern. Dazu ruft man mit 
<span class="key">F6</span>  im Startmenü die Eingabezeile auf (löscht mit 
<span class="key">Esc</span>  die eingeblendeten Vorgaben) und gibt am Ende der Zeile zusätzlich <code class="notranslate">user-setup/encrypt-home=true</code> vor den <code class="notranslate">--</code> mit Leerzeichen ein , dann wird dieses beim Desktop-Installer gleich mit angeboten.
</p></div></div></div><div class="section_3"><h4 id="Frische-Installation-nachbearbeiten">Frische Installation nachbearbeiten<a class="headerlink" href="#Frische-Installation-nachbearbeiten">¶</a></h4><p>
Bei allen anderen Installation mit einer Desktop-CD bzw. -DVD oder wenn man obigen Hinweis nicht umsetzen konnte, muss man die Installation nachbearbeiten.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei einer "frischen Installation" sollte man diese erst einmal überprüfen, ob alles einwandfrei startet (Grafikkarte, Netzwerk und was sonst noch schief laufen kann), bevor man nun anfängt, Weiteres zu verändern/hinzuzufügen.</p><p>Überall wo nachfolgend <code class="notranslate">&lt;Benutzername&gt;</code> steht, ist der relevante Benutzername einzusetzen
</p></div></div><p>
Nachfolgende Prozedur löscht alle Dateien und Einstellungen des entsprechenden Anwenders. Bei einem frischen System ist das natürlich unproblematisch. Man ruft das System im <a class="internal" href="../recovery_modus.html">Recovery Modus</a> auf, wählt <em>"root"</em> um eine root-Konsole zu starten und gibt dort ein:</p><div class="bash"><div class="contents"><pre class="notranslate">deluser --remove-home &lt;Benutzername&gt;
adduser --encrypt-home &lt;Benutzername&gt; </pre></div></div><p>Die Abfrage nach dem Passwort ist nun neu einzugeben - die restlichen Fragen nach Name usw. kann auch später noch nachgeholt werden. Ist dieser Benutzer auch derjenige, der administrative Tätigkeiten (sudo) durchführen soll, so muß diesem dieses Recht wieder zugewiesen werden:</p><div class="bash"><div class="contents"><pre class="notranslate">adduser &lt;Benutzername&gt; admin </pre></div></div><p>Nun kann man mit 
<span class="key">Strg</span>  + 
<span class="key">D</span>  in das das Auswahlmenü zurück, und via <em>"resume"</em> zum Einloggen weitergehen. Nach dem Einloggen als Benutzer kann mit dem Befehl "startx" die grafische Oberfläche gestartet werden.</p></div><div class="section_3"><h4 id="Zusaetzlicher-Benutzer">Zusätzlicher Benutzer<a class="headerlink" href="#Zusaetzlicher-Benutzer">¶</a></h4><p>
Für jeden zusätzlichen Benutzer kann man mit <a class="internal" href="../sudo.html">Root-Rechten</a> im Terminal <sup><a href="#source-3">[3]</a></sup> ein neues, verschlüsseltes  Homeverzeichnis anlegen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo adduser --encrypt-home &lt;Benutzername&gt; </pre></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Ab Lucid Lynx (10.04 LTS) kann das über die Menü-Option erfolgen: <br/>GNOME-Dektop = <em>"System -&gt; Systemverwaltung -&gt; Benutzer und Gruppen"</em>
</p></div></div></div><div class="section_3"><h4 id="Bestehendes-Homeverzeichnis">Bestehendes Homeverzeichnis<a class="headerlink" href="#Bestehendes-Homeverzeichnis">¶</a></h4><p>
Bei einer bestehenden Installation gestaltet sich die "Umwandlung" in ein verschlüsseltes <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> etwas komplexer, aber stellt sich auch für einen ungeübten Nutzer als durchaus machbar dar.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Vorab ein <a class="internal" href="../sicherheit.html">Backup</a> vom Homeverzeichnis anfertigen! Es ist angeraten, auch gleich Bleistift und Papier für die Systemausgaben bereit zu legen. Der Ablauf sieht dabei wie folgt aus (bitte die Reihenfolge einhalten).
</p></div></div><p>Man startet das System im <a class="internal" href="../recovery_modus.html">Recovery Modus</a>, wählt im Auswahlmenü <em>"root"</em> um eine root-Konsole zu starten und gibt dort ein:</p><div class="section_4"><h5 id="Vorbereitungen">Vorbereitungen<a class="headerlink" href="#Vorbereitungen">¶</a></h5><p>
Zuerst muss die Datei <strong>/etc/adduser.conf</strong> angepasst werden. Diese Datei gibt u.a. die Inhalte vor, die kopiert / übernommen werden sollen. Dazu ruft man diese Datei mit einem Editor auf <sup><a href="#source-6">[6]</a></sup> (am einfachsten ist <a class="internal" href="../nano.html">Nano</a>) und kommentiert die vorhandene Zeile mit</p><pre class="notranslate">SKEL=/etc/skel</pre><p>durch Voransetzen von 
<span class="key">#</span>  aus und schreibt direkt darunter</p><pre class="notranslate">SKEL=/home/backup</pre><p>Danach die Datei sichern.</p></div><div class="section_4"><h5 id="Homeverzeichnis-umstellen">Homeverzeichnis umstellen<a class="headerlink" href="#Homeverzeichnis-umstellen">¶</a></h5><p>
Man gibt jetzt nacheinander nachfolgende Befehle ein und achte auf die Rückmeldungen aus dem System (Rückmeldung zum Schlüssel bitte notieren - siehe Hinweis oben).</p><div class="bash"><div class="contents"><pre class="notranslate">deluser &lt;Benutzername&gt;
mv /home/&lt;Benutzername&gt; /home/backup
adduser --encrypt-home &lt;Benutzername&gt;
adduser &lt;Benutzername&gt; admin
rm -rf /home/backup </pre></div></div><p>und stellt in <strong>/etc/adduser.conf</strong> den alten Zustand mittels Editor wieder her (siehe oben!). Man kehrt mit 
<span class="key">Strg</span>  + 
<span class="key">D</span>  in den Auswahldialog des <a class="internal" href="../recovery_modus.html">Recovery Modus</a> zurück und startet das System nun via <em>"resume"</em>. Nach dem Einloggen als Benutzer kann mit dem Befehl "startx" die grafische Oberfläche gestartet werden. Es sollte nun das Homeverzeichnis verschlüsselt - für den Nutzer les- und bearbeitbar sein.</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Es kann vorkommen, dass Programme noch vor dem Einloggen  bzw. gleich danach auf das Homeverzeichnis zugreifen wollen, aber weil die Dekodierung noch nicht abgeschlossen ist, einen Fehler melden. Dieses muss man gezielt behandeln und ggf. in den <strong>/etc/init.d/</strong>-Dateien die Startsequenz verändern oder die Programme aus den Diensten heraus nehmen bzw. neu orientieren!</p><p>Um das Volumen für die Codierung/Decodierung in Grenzen zu halten, sollte man auf Folgendes achten: Symbolische Links wirken nur von außen nach innen, d.h. Daten, die im codierbaren Bereichen liegen, können von außen mit einem symbolischen Link aufgerufen werden und werden codiert, Daten die außerhalb liegen und mit symbolischen Links vom inneren Bereich angesprochen werden, werden <span class="underline">nicht</span> codiert. Mit diesem Wissen kann man nun dafür sorgen, das Daten, die nicht unbedingt codiert werden müssen oder ein sehr großes Volumen darstellen (z.B. ISO's, Videos), via symbolischen Link nach außerhalb zu verlegen und somit die Rechenarbeit (-zeit) zu verringern.
</p></div></div></div></div></div><div class="section_2"><h3 id="Wechsel-Login-Passwort">Wechsel Login-Passwort<a class="headerlink" href="#Wechsel-Login-Passwort">¶</a></h3><p>
Soll das bestehende Login-Passwort eines Benutzers gewechselt werden, so ist es zwingend erforderlich, zeitnah auch die Datei <strong>.ecryptfs/wrapped-passphrase</strong> anzupassen. Damit dieses auch richtig ausgeführt wird, <span class="underline">muss</span> die Änderung des Login-Passwortes, nach dem Anmelden durch den Benutzer, von diesem selbst beim Ubuntu-Desktop über die Menü-Funktion:
</p><ul><li><p>System -&gt; Einstellungen -&gt; Persönliche Angaben -&gt; Passwort ändern</p></li></ul><p>beim Kubuntu-Desktop über die Funktion:
</p><ul><li><p>Systemeinstellungen -&gt; Persönliche Informationen -&gt; Passwort ändern</p></li></ul><p>ausgeführt werden. Nach dem Aufrufen wird dort zur Legitimation das <em>alte</em> Login-Passwort eingegeben und danach dann das <em>neue</em> Login-Passwort (zweimal) eingegeben.</p><p>Nach dem erfolgreichen Wechsel des Login-Passwortes (Akzeptanz wird angezeigt) sollte man sich abmelden und erneut einloggen.</p></div></div><div class="section_1"><h2 id="Nutzung">Nutzung<a class="headerlink" href="#Nutzung">¶</a></h2><p>
Die Verschlüsselung läuft transparent, das Verzeichnis wird beim Einloggen automatisch entschlüsselt und beim Ausloggen wieder verschlüsselt. In vielen Fällen reicht das für die Nutzung schon aus.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei <a class="internal" href="../gdm.html#Benutzer-ohne-Passwort-einloggen">automatischen Login</a> ist eine direkte Nutzung des Verzeichnisses nicht möglich, weil sonst der Aspekt der Daten-Sicherheit unterlaufen würde.
</p></div></div><p>Um die Daten nach einem automatischen Login zugänglich zu machen, muss man das <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> des Benutzers oder das Verzeichnis <strong>~/Private</strong> öffnen und auf die Datei <strong>Access Your Private Data</strong> klicken. Es öffnet sich daraufhin ein Terminal, in das man das Login-Passwort eingeben kann. Nach Schließen des Terminals und des Verzeichnisses sind die Daten wie oben beschrieben zugänglich.</p><div class="section_2"><h3 id="Passphrase-extern-auslagern">Passphrase extern auslagern<a class="headerlink" href="#Passphrase-extern-auslagern">¶</a></h3><p>
Es ist grundsätzlich möglich, die Passphrase und zugehörige Dateien getrennt auf ein externes Medium (USB-Stick, Smartcard oder ähnlichen Medien) zu verlagern. Wichtig dabei ist nur, dass dieses Speichermedium beim Booten eingesteckt/verbunden ist, vom System erkannt wird und in der <strong>/etc/fstab</strong> eingetragen wurde z.B.:</p><pre class="notranslate">UUID=xxxx /var/lib/ecryptfs ext2 defaults 0  0</pre><p>Hinweise zum korrekten Pfad siehe <a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien</a></p><p>Wurden die Benutzerdaten nun auf diesem Speichermedium abgelegt (durch Verschieben der jeweiligen Nutzerdaten), werden sie nun von dort beim Einloggen abgefragt.</p></div><div class="section_2"><h3 id="Manuelles-Sperren-ffnen-des-Verzeichnis">Manuelles Sperren/Öffnen des Verzeichnis<a class="headerlink" href="#Manuelles-Sperren-ffnen-des-Verzeichnis">¶</a></h3><p>
Will man das Verzeichnis sperren, während man eingeloggt ist, kann man dies mit dem Befehl <sup><a href="#source-3">[3]</a></sup> erreichen.</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-umount-private </pre></div></div><p>Umgekehrt kann man das Verzeichnis auch wieder manuell entschlüsseln</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-mount-private </pre></div></div><p>Alternativ kann man sich diese Befehle auch auf einen "Starter" legen oder in ein Skript einfügen.</p></div><div class="section_2"><h3 id="Moegliches-Szenario">Mögliches Szenario<a class="headerlink" href="#Moegliches-Szenario">¶</a></h3><p>
<a class="internal" href="../ssh.html">SSH</a>-Keys oder <a class="internal" href="../gnupg.html">GnuPG</a>-Keys sollte man möglichst sicher aufbewahren, damit diese nicht in die falschen Hände geraten. Um dies zu verhindern, sollte man diese verschlüsselt auf der Festplatte ablegen. Dazu kann man die Festplatte komplett verschlüsseln, hat aber dann den Nachteil, dass <span class="underline">sämtliche</span> Schreib- und Lesezugriffe auf die Festplatte erstmal ver-/entschlüsselt werden müssen. Dies kann für manche Anwendungen einen massiven Geschwindigkeitsverlust bedeuten.</p><p>Mit verschlüsselten Verzeichnissen kann man diese Schlüssel alle in sein <strong>~/Private</strong> verschieben. SSH sucht aber nach dem Schlüssel in <strong>~/.ssh</strong> Dort kann man dann einfach einen Link ablegen.</p><p>Beispiel:
</p><div class="bash"><div class="contents"><pre class="notranslate">mv ~/.ssh/ ~/Private/
ln -s ~/Private/.ssh ~/.ssh  </pre></div></div></div><div class="section_2"><h3 id="Trash-bereinigen">Trash bereinigen<a class="headerlink" href="#Trash-bereinigen">¶</a></h3><p>
Dieser Hinweis gilt nur für das Verzeichnis <strong>~/Private:</strong></p><p>Will man Daten aus dem Verzeichnis <strong>~/Private</strong> löschen, so muss man die Funktion <em>"Löschen"</em> im Kontext-Menü (<img alt="rechte Maustaste" class="image-default" src="../_/aa516ca8be74ff7de9b706b8ffc7a88e87e17fb5.png"/>-Klick auf dem zu löschenden Objekt) des eingesetzten Datei-Browsers wählen. Das Löschen mittels Kontext-Menü und der Option <code class="notranslate">In den Müll verschieben</code> belässt die Daten im versteckten Verzeichnis <strong>~/Private/.Trash-&lt;User-ID&gt;</strong>, so dass sich <span class="underline">derart</span> gelöschte Dateien mit der Zeit ansammeln und ggf. zu Speicherplatz-Problemen führen können. Ist diese Funktion bei den relevanten Datei-Browsern nicht aktiviert, so kann man das einstellen - Informationen geben die jeweilige WIKI-Seite.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Dieses ist kein Fehler im Programm, sondern so vorgesehen, damit keine Daten nach außerhalb des Verzeichnisses gelangen.
</p></div></div></div></div><div class="section_1"><h2 id="Datenrettung">Datenrettung<a class="headerlink" href="#Datenrettung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Daten-extern-auslesen">Daten extern auslesen<a class="headerlink" href="#Daten-extern-auslesen">¶</a></h3><p>
Sollte das System nicht mehr bis zum Desktop gelangen, so startet man mit einem Live-System (CD/DVD bzw. USB-Stick) <span class="underline">gleicher</span> Architektur (i386 bzw. amd64) - vorzugsweise mit Version Jaunty (&gt;= 9.04). Will man den Zugriff über einen <a class="internal" href="../dateimanager.html">Dateimanager</a> ausführen, so muss auch die Desktop-Version (GNOME, KDE bzw XFCE) berücksichtigt werden.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ist die Partition mit dem Verzeichnis <strong>~/.Private</strong> so defekt, dass diese wie nachfolgend beschrieben nicht mehr einzubinden ist, so muss man davon ausgehen, das die Daten mit <span class="underline">einfachen</span> Mitteln nicht mehr zu retten sind.
</p></div></div><p>Man öffnet am Desktop ein Terminal <sup><a href="#source-3">[3]</a></sup> und bindet das "beschädigte" System in das Ubuntu-Live-System ein.</p><div class="section_3"><h4 id="Integriertes-Homeverzeichnis">Integriertes Homeverzeichnis<a class="headerlink" href="#Integriertes-Homeverzeichnis">¶</a></h4><p>
Befindet sich das Verzeichnis <strong>/home/&lt;Benutzername&gt;</strong> auf der <span class="underline">selben</span> Partition wie das Wurzelverzeichnis (nachfolgend wird als Beispiel <strong>/dev/sda1</strong> angenommen), dann gibt man ein:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo mount /dev/sda1 /mnt </pre></div></div></div><div class="section_3"><h4 id="Separates-Homeverzeichnis">Separates Homeverzeichnis<a class="headerlink" href="#Separates-Homeverzeichnis">¶</a></h4><p>
Befindet sich das Verzeichnis <strong>/&lt;Benutzername&gt;</strong> auf einer vom Wurzelverzeichnis <span class="underline">getrennten</span> Partition (als Beispiel root = <strong>/dev/sda1</strong>, home = <strong>/dev/sda5</strong> ), so muss das System beginnend mit root ( <strong>/</strong> ) in der richtigen Reihenfolge vorab aufgebaut werden. Handelt es sich um ein <a class="internal" href="../software-raid.html">Software-RAID</a> oder vergleichbares System, so sind entsprechende Maßnahmen vorab zu ergreifen.</p><div class="section_4"><h5 id="mit-intakter-Root-Partition">mit intakter Root-Partition<a class="headerlink" href="#mit-intakter-Root-Partition">¶</a></h5><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo mount /dev/sda1 /mnt
ubuntu@ubuntu:~$ sudo mount /dev/sda5 /mnt/home </pre></div></div><p>Sollten noch andere Verzeichnisse (siehe <strong>/etc/fstab</strong>) erforderlich sein, so sind auch diese einzubinden.</p><p>Um die erforderlichen Kernel-Informationen für <code class="notranslate">ecryptfs-utils</code> vom Ubuntu-Live-System zu übertragen, wird in das Terminal eingegeben:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo mount -o bind /dev  /mnt/dev
ubuntu@ubuntu:~$ sudo mount -o bind /proc /mnt/proc
ubuntu@ubuntu:~$ sudo mount -o bind /sys  /mnt/sys
ubuntu@ubuntu:~$ sudo mount -o bind /dev/shm  /mnt/dev/shm
ubuntu@ubuntu:~$ sudo chroot /mnt </pre></div></div><p>Weiter bei <a class="crosslink" href="#Benutzer-aktivieren">Benutzer aktivieren</a>.</p></div><div class="section_4"><h5 id="mit-defekter-Root-Partition">mit defekter Root-Partition<a class="headerlink" href="#mit-defekter-Root-Partition">¶</a></h5><p>
Für die Simulation der <span class="underline">fehlenden</span> Root-Partition sind folgende Schritte erforderlich:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo mount /dev/sda5 /mnt </pre></div></div><p>Nun einen Nutzer mit <code class="notranslate">&lt;Benutzername&gt;</code> im Ubuntu-Live-System anlegen und diesem Root-Rechte geben, siehe dazu die Ausführungen unter: <a class="crosslink" href="#Datenzugriff-vorbereiten">Datenzugriff vorbereiten</a>. Anschließend löscht man den Inhalt des gerade angelegten home Verzeichnises und verlinkt es mit dem zu Rettenden.</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo rm -rf /home/&lt;Benutzername&gt;
ubuntu@ubuntu:~$ sudo ln -s /mnt/&lt;Benutzername&gt; /home/&lt;Benutzername&gt; </pre></div></div><p>Nun das Verzeichnis <strong>/var/lib/ecryptfs/&lt;Benutzername&gt;</strong> anlegen und die darin erforderlichen Dateien erstellen, siehe dazu die Ausführungen unter: <a class="crosslink" href="#Schluesseldateien-reparieren">Schlüsseldateien reparieren</a>. Danach dauerhafte Rootrechte erwerben mit:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo su
root@ubuntu:~$ </pre></div></div></div></div><div class="section_3"><h4 id="Benutzer-aktivieren">Benutzer aktivieren<a class="headerlink" href="#Benutzer-aktivieren">¶</a></h4><p>
Man wechselt nun den Benutzer - dabei auf das Minus- und die Leer-Zeichen bei der Eingabe achten. Bei der Abfrage zum Passwort ist das <code class="notranslate">&lt;Login-Passwort&gt;</code> von <code class="notranslate">&lt;Benutzername&gt;</code> einzugeben. Die angezeigten Meldungen können ignoriert werden.</p><div class="bash"><div class="contents"><pre class="notranslate">root@ubuntu:~$ su - &lt;Benutzername&gt; </pre></div></div><p>Mit den nächsten Eingaben logt man sich nun in sein "verschlüsseltes" Verzeichnis ein:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:~$ ecryptfs-add-passphrase --fnek
Passphrase: &lt; notierte Passphrase
&lt;Benutzername&gt;@ubuntu:~$ ecryptfs-mount-private </pre></div></div><p>Jetzt hat man Zugriff auf seine Daten, sowohl über den <a class="internal" href="../dateimanager.html">Dateimanager</a>, als auch im Terminal, dazu noch folgende Eingabe</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:~$ cd ..
&lt;Benutzername&gt;@ubuntu:~$ cd &lt;Benutzername&gt; </pre></div></div><p>damit die Daten angezeigt, ausgelesen und auch extern gesichert werden können. Den <a class="internal" href="../dateimanager.html">Dateimanager</a> aus dem Terminal heraus aufrufen., wenn man diesen direkt nutzen will.</p></div><div class="section_3"><h4 id="Benutzer-deaktivieren">Benutzer deaktivieren<a class="headerlink" href="#Benutzer-deaktivieren">¶</a></h4><p>
Um keine Datenverluste zu erleiden, die eingebundenen Verzeichnisse richtig verlassen, dazu im Terminal eingeben:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:~$ ecryptfs-umount-private
&lt;Benutzername&gt;@ubuntu:~$ exit
logout
root@ubuntu:~$ exit
ubuntu@ubuntu:~$ </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Ist das vorstehende nicht ohne Fehlermeldungen auszuführen, so sind aufgrund der Vielzahl der Möglichkeiten tieferes Basiswissen zu Linux und zu den aufgetretenen Fehlern erforderlich, die diese Beschreibung sprengen würde - wobei eine Wiederherstellung nicht grundsätzlich ausgeschlossen wird.
</p></div></div></div></div><div class="section_2"><h3 id="Daten-wieder-herstellen">Daten wieder herstellen<a class="headerlink" href="#Daten-wieder-herstellen">¶</a></h3><p>
Wenn das System nicht mehr starten will und die Dateien zur Verschlüsselung defekt sind oder fehlen, startet man mit einem Live-System (CD/DVD oder USB-Stick) - vorzugsweise mit Version Jaunty (&gt;= 9.04), sowie mit <span class="underline">gleicher</span> Desktop-Version (GNOME, KDE bzw. XFCE) wie das defekte System. Zum Einbinden der relevanten Partition siehe die Ausführungen weiter oben unter <a class="crosslink" href="#Daten-extern-auslesen">Daten extern auslesen</a>.</p><div class="section_3"><h4 id="Datenzugriff-vorbereiten">Datenzugriff vorbereiten<a class="headerlink" href="#Datenzugriff-vorbereiten">¶</a></h4><p>
Für alle Varianten zuerst einen Benutzer im Ubuntu-Live-System mit <a class="internal" href="../shell/adduser.html">adduser</a> &lt;Benutzername&gt; anlegen:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo adduser &lt;Benutzername&gt;
Geben Sie ein neues UNIX-Passwort ein: &lt; Eingabe Login-Passwort &gt;
Geben Sie ein neues UNIX-Passwort erneut ein: &lt; Eingabe Login-Passwort &gt;  </pre></div></div><p>Die anderen Daten sind hier nicht relevant und können jeweils mit 
<span class="key">⏎</span>  bestätigt werden. Nun sollte noch der Eintrag in die <a class="internal" href="../benutzer_und_gruppen.html#Gruppen">Gruppe admin</a> mit:</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ sudo adduser &lt;Benutzername&gt; admin  </pre></div></div><p>vorgenommen werden.</p></div><div class="section_3"><h4 id="Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien<a class="headerlink" href="#Systempfade-der-Schluesseldateien">¶</a></h4><p>
Die für die Entschlüsselung erforderlichen Dateien befinden sich in einem für <code class="notranslate">ecryptfs-utils</code> reservierten Verzeichnis. Die Pfade dorthin unterscheiden sich abhängig vom gewählten Mount-Point (entsprechend voran setzen) und nach Variante:</p><p>Bei der Variante Einzelordner <strong>~/Private</strong> :</p><pre class="notranslate">/home/&lt;Benutzername&gt;/.ecryptfs</pre><p>für die Variante verschlüsseltes Homeverzeichnis für Jaunty Jackalope :</p><pre class="notranslate">/var/lib/ecryptfs/&lt;Benutzername&gt;</pre><p>für die Variante verschlüsseltes Homeverzeichnis (bei Neuinstallation) Karmic Koala :</p><pre class="notranslate">/home/.ecryptfs/&lt;Benutzername&gt;/.ecryptfs</pre><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die beiden versteckten Verzeichnisse /home/&lt;Benutzername&gt;/.ecryptfs und /home/.ecryptfs/&lt;Benutzername&gt; unterscheiden sich grundlegend: Während im ersten "nur" die Schlüsseldaten liegen, sind im zweiten (bei Neuinstallation ab Karmic Koala) darin auch die verschlüsselten Daten des gesamten Home-Verzeichnisses des jeweiligen Nutzers gespeichert, falls dieser ein verschlüsseltes Home-Verzeichnis besitzt.
</p></div></div><p>Bei allen Varianten sollten sich jeweils die folgenden Dateien befinden:</p><pre class="notranslate">auto-mount  (Null-Byte Indikator-Datei)
auto-umount (Null-Byte Indikator-Datei)
Private.mnt (der relevante mount-point, in der Regel /home/&lt;Benutzername&gt;)
Private.sig (Hinweis auf Verschlüsselung von Ordnern und Files)
wrapped-passphrase (Verschlüsselungspasswort - encryptet)
.wrapped-passphrase.recorded (Null-Byte Indikator-Datei)</pre></div><div class="section_3"><h4 id="berpruefung-der-Schluesseldateien">Überprüfung der Schlüsseldateien<a class="headerlink" href="#berpruefung-der-Schluesseldateien">¶</a></h4><p>
Wenn man bei Prüfung erkennt, dass die Dateien nicht mehr brauchbar sind oder gar fehlen, so kann man diese <em>reparieren</em>. Dies setzt allerdings voraus, dass die Datei <strong>wrapped-passphrase</strong> entweder intakt ist, eine Kopie von ihr existiert oder das Passwort, mit dem der private Ordner bzw. das Home-Verzeichnis verschlüsselt wurde, bekannt sind. Ist alles dies nicht der Fall, ist eine Wiederherstellung der Daten nicht möglich. Die verschlüsselten Verzeichnisse können in diesem Fall nicht mehr entschlüsselt werden!</p><p>Um die Schlüsseldateien zu reparieren, wechselt man in das Verzeichnis <strong>.ecryptfs</strong> (siehe oben, nachfolgend wurde Variante zwei mit dem Mount-Point <strong>/mnt</strong> gewählt) und löscht vorab die relevante Datei, bevor man eine neue Datei erstellt. Die versteckte Datei <strong>.wrapped-passphrase.recorded</strong> kann man vernachlässigen.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Vor dem Löschen der Datei <strong>wrapped-passphrase</strong> muss unbedingt das Verschlüsselungspasswort ausgelesen und gesichert werden. Ohne dieses ist eine Entschlüsselung der Verzeichnisse unmöglich!
</p></div></div><div class="section_4"><h5 id="wrapped-passphrase-auslesen">wrapped-passphrase auslesen<a class="headerlink" href="#wrapped-passphrase-auslesen">¶</a></h5><p>
Zur Prüfung, ob das Verschlüsselungs-Passwort (nicht das Login-Passwort) stimmt und dieses unbeschädigt ist, kann man sich dieses mit dem folgenden Befehl anzeigen lassen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei dem Basis-System Intrepid Ibex (= 8.10) muss das Login-Passwort gleich im Klartext bei dem nachfolgenden Befehl mit eingegeben werden. Anschließend sollte man das Terminal mit <code class="notranslate">history -c</code> bereinigen, um unbefugtes Auslesen des Passwortes zu unterbinden.
</p></div></div><p>Man wechselt in das Verzeichnis mit der Datei <strong>wrapped-passphrase</strong> (siehe oben) und gibt dort ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ecryptfs-unwrap-passphrase  wrapped-passphrase [Intrepid Ibex siehe Hinweis]  </pre></div></div><p>und schließt mit 
<span class="key">⏎</span>  ab, die folgende Abfrage mit der Eingabe:</p><div class="bash"><div class="contents"><pre class="notranslate">passphrase: &lt; Eingabe Login-Passwort Benutzer &gt;  </pre></div></div><p>und 
<span class="key">⏎</span>  abschließen. Danach dann den Schlüssel unbedingt notieren oder in eine Datei kopieren.</p></div></div><div class="section_3"><h4 id="Schluesseldateien-reparieren">Schlüsseldateien reparieren<a class="headerlink" href="#Schluesseldateien-reparieren">¶</a></h4><p>
Falls es erforderlich wird, die Schlüsseldateien neu zu erstellen, so öffnet man ein Terminal <sup><a href="#source-3">[3]</a></sup> und bereitet die Eingabe wie folgt vor. Nachfolgend wurde als Beispielpfad <strong>/mnt/var/lib/ecryptfs</strong> genommen, dieser ist <span class="underline">anzupassen</span> (siehe oben)! Wichtig dabei, auf das Minuszeichen und die Leerzeichen bei der Eingabe des ersten Befehles achten !</p><div class="bash"><div class="contents"><pre class="notranslate">ubuntu@ubuntu:~$ su - &lt;Benutzername&gt;
Passwort: &lt; Login-Passwort von &lt;Benutzername&gt;
&lt;Benutzername&gt;@ubuntu:~$ sudo mkdir --parents --mode=777 /mnt/var/lib/ecryptfs/&lt;Benutzername&gt;
&lt;Benutzername&gt;@ubuntu:~$ cd /mnt/var/lib/ecryptfs/&lt;Benutzername&gt;
&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ </pre></div></div><p>Man sollte das Terminal solange nicht verlassen, bis alle Dateien angelegt wurden. Mit dieser Maßnahme werden bei der Erstellung gleich die richtigen Rechte mit angelegt.</p><div class="section_4"><h5 id="wrapped-passphrase-erstellen">wrapped-passphrase erstellen<a class="headerlink" href="#wrapped-passphrase-erstellen">¶</a></h5><p>
Ist das Verschlüsselungspasswort unbekannt, kann es (wie im Kapitel <a class="crosslink" href="#wrapped-passphrase-auslesen">wrapped-passphrase auslesen</a> beschrieben) aus einer intakten <strong>wrapped-passphrase</strong>-Datei ausgelesen werden. Ist es bekannt, kann die Datei wie folgt neu erstellt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ ecryptfs-wrap-passphrase wrapped-passphrase </pre></div></div><p>Die nachfolgenden Abfragen sind wie folgt zu beantworten (es erfolgt keine Anzeige, <span class="underline">blinde</span> Eingabe erforderlich):</p><div class="bash"><div class="contents"><pre class="notranslate">Passphrase to wrap:  &lt; Eingabe notierte Passphrase
Wrapping passphrase: &lt; Eingabe Login-Passwort von &lt;Benutzername&gt; </pre></div></div><p>und schränkt die erforderlichen Zugriffs-Rechte dieser Datei ein mit:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ chmod 700 wrapped-passphrase </pre></div></div></div><div class="section_4"><h5 id="auto-mount-erstellen">auto-mount erstellen<a class="headerlink" href="#auto-mount-erstellen">¶</a></h5><p>
Man erstellt mit einem Editor <sup><a href="#source-6">[6]</a></sup>, den man vom Terminal her aufruft, die leere Datei <strong>auto-mount</strong> und speichert diese ab. Danach den Editor wieder verlassen.</p><p>Alternativ kann die Datei auch mit folgendem Befehl erzeugt werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">touch auto-mount </pre></div></div></div><div class="section_4"><h5 id="auto-umount-erstellen">auto-umount erstellen<a class="headerlink" href="#auto-umount-erstellen">¶</a></h5><p>
Man erstellt mit einem Editor, den man vom Terminal her aufruft, die leere Datei <strong>auto-umount</strong> und speichert diese ab. Danach den Editor wieder verlassen.</p><p>Alternativ kann die Datei auch mit folgendem Befehl erzeugt werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">touch auto-umount </pre></div></div></div><div class="section_4"><h5 id="Private-mnt-erstellen">Private.mnt erstellen<a class="headerlink" href="#Private-mnt-erstellen">¶</a></h5><p>
Man erstellt mit einem Editor, den man vom Terminal her aufruft, die Datei <strong>Private.mnt</strong> und gibt dort ein:</p><pre class="notranslate">/home/&lt;Benutzername&gt;</pre><p>Dabei diese Zeile mit 
<span class="key">⏎</span>  abschließen und danach abspeichern, den Editor wieder verlassen und schränkt die erforderlichen Zugriffs-Rechte dieser Datei ein mit:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ chmod 700 Private.mnt </pre></div></div></div><div class="section_4"><h5 id="Private-sig-erstellen">Private.sig erstellen<a class="headerlink" href="#Private-sig-erstellen">¶</a></h5><p>
Um die Daten für diese Datei zu erhalten, gibt man in das Terminal ein:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ ecryptfs-add-passphrase --fnek
Passphrase: &lt; Eingabe notierte Passphrase </pre></div></div><p>und erhält nun u.a. folgende Zeilen (hier beispielhaftes Ergebnis):</p><pre class="notranslate">Inserted auth tok with sig [14140887552e0bec] into the user session keyring
Inserted auth tok with sig [de5d090606c60111] into the user session keyring</pre><p>Man erstellt mit einem Editor, den man vom Terminal her aufruft, die Datei <strong>Private.sig</strong>, indem man die  Schlüsselwerte zwischen den <strong>[ ]</strong> zeilenweise überträgt/kopiert, die Zeilen mit 
<span class="key">⏎</span>  abschließt und abspeichert, den Editor wieder verlässt und schränkt die erforderlichen Zugriffs-Rechte dieser Datei ein mit:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ chmod 700 Private.sig </pre></div></div><p>Bevor man das Terminal wieder verlässt, gibt man noch ein:</p><div class="bash"><div class="contents"><pre class="notranslate">&lt;Benutzername&gt;@ubuntu:/mnt/var/lib/ecryptfs/&lt;Benutzername&gt;$ exit
logout
ubuntu@ubuntu:~$ </pre></div></div><p>Man sollte diese Daten jetzt <span class="underline">auch</span> extern sichern, versuchen, mit diesen Werten bei <a class="crosslink" href="#Daten-extern-auslesen">Daten extern auslesen</a> weiter zu machen oder das System neu zu starten.</p></div></div></div></div><div class="section_1"><h2 id="Deinstallation">Deinstallation<a class="headerlink" href="#Deinstallation">¶</a></h2><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Daran denken: wichtige Daten vorab aus dem Homeverzeichnis bzw. aus dem Verzeichnis <strong>~/Private</strong> an einen anderen Ort sichern!
</p></div></div><div class="section_2"><h3 id="Verzeichnis-Private-entfernen">Verzeichnis Private entfernen<a class="headerlink" href="#Verzeichnis-Private-entfernen">¶</a></h3><p>
Um das Verzeichnis <strong>~/Private</strong> zu löschen, führt man im Terminal <sup><a href="#source-3">[3]</a></sup> nacheinander folgende Befehle aus:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-umount-private
chmod 700 ~/Private
rm -rf ~/Private ~/.Private ~/.ecryptfs </pre></div></div></div><div class="section_2"><h3 id="Homeverzeichnis-uncodiert">Homeverzeichnis uncodiert<a class="headerlink" href="#Homeverzeichnis-uncodiert">¶</a></h3><p>
Um das verschlüsselte <a class="internal" href="../homeverzeichnis.html">Homeverzeichnis</a> umzustellen (um unverschlüsselt zu arbeiten) muss man nachfolgende Schritte in der aufgeführten Reihenfolge ausführen.</p><div class="section_3"><h4 id="Vorbereitungen-2">Vorbereitungen<a class="headerlink" href="#Vorbereitungen-2">¶</a></h4><p>
Der Benutzer muss sich einloggen und danach im Terminal <sup><a href="#source-3">[3]</a></sup> mit <a class="internal" href="../sudo.html">Root-Rechten</a> seine Daten unverschlüsselt an eine andere Stelle kopieren:</p><div class="bash"><div class="contents"><pre class="notranslate">cd /
sudo cp -a /home/&lt;Benutzername&gt; /home/backup </pre></div></div><p>Danach startet man das System im <a class="internal" href="../recovery_modus.html">Recovery Modus</a> neu, wechselt im "friendly-recovery" zum "root-prompt" und passt die Datei <strong>/etc/adduser.conf</strong> an, dazu ruft man diese Datei mit einem Editor auf <sup><a href="#source-6">[6]</a></sup> und kommentiert die vorhandene Zeile mit</p><pre class="notranslate">SKEL=/etc/skel</pre><p>durch Voransetzen von 
<span class="key">#</span>  aus und schreibt direkt darunter</p><pre class="notranslate">SKEL=/home/backup</pre><p>Danach die Datei sichern.</p></div><div class="section_3"><h4 id="Verschluesselung-entfernen">Verschlüsselung entfernen<a class="headerlink" href="#Verschluesselung-entfernen">¶</a></h4><p>
Nun muss man nachfolgende Befehle eingeben, <span class="underline">Reihenfolge einhalten</span>!</p><div class="bash"><div class="contents"><pre class="notranslate">deluser --remove-home &lt;Benutzername&gt;
adduser &lt;Benutzername&gt;
adduser &lt;Benutzername&gt; admin
rm -rf /home/backup
rm -f /home/&lt;Benutzername&gt;/.ecryptfs </pre></div></div><p>
und stellt mit einem Editor den alten Zustand wieder her (siehe oben!). Man kehrt mit 
<span class="key">Strg</span>  + 
<span class="key">D</span>  in den friendly-recovery zurück und startet das System nun via resume durch - es sollte das Homeverzeichnis unverschlüsselt - für den Nutzer wieder les- und bearbeitbar sein.</p></div></div><div class="section_2"><h3 id="Basis-Programme-entfernen">Basis-Programme entfernen<a class="headerlink" href="#Basis-Programme-entfernen">¶</a></h3><p>
Will man auch das Basispaket <code class="notranslate">ecryptfs-utils</code> endgültig entfernen, so sind in einem "Mehruser-System" <span class="underline">erst</span> obige Schritte von <span class="underline">jedem</span> Nutzer auszuführen, danach kann man im Terminal <sup><a href="#source-3">[3]</a></sup> mit</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get remove ecryptfs-utils libecryptfs0 --purge </pre></div></div><p>die Anwendung deinstallieren.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Sollte es nach dem Entfernen des Basis-Programmes zu Problemen beim Löschen der Verzeichnisse kommen, so kann man diese Verzeichnisse auch noch nachträglich im Recovery-Mode am Root-Prompt löschen. 
</p></div></div></div></div><div class="section_1"><h2 id="Probleme-behandeln">Probleme behandeln<a class="headerlink" href="#Probleme-behandeln">¶</a></h2><p>
</p><div class="section_2"><h3 id="Ordner-wird-beim-Einloggen-nicht-mehr-automatisch-gemountet">Ordner wird beim Einloggen nicht (mehr) automatisch gemountet<a class="headerlink" href="#Ordner-wird-beim-Einloggen-nicht-mehr-automatisch-gemountet">¶</a></h3><p>
Eine mögliche Ursache für dieses Problem könnte sein, dass das Verschlüsselungspasswort nicht mehr im keyring des Benutzers vorhanden ist. Um es dort wieder einzutragen, kann folgender Befehl benutzt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">ecryptfs-insert-wrapped-passphrase-into-keyring ~/.ecryptfs/wrapped-passphrase &lt;Login-Passwort&gt; </pre></div></div><p>Dabei sind je nach System und Ubuntu-Version der Pfad zur Datei <strong>wrapped-passphrase</strong> anzupassen, siehe auch <a class="crosslink" href="#Systempfade-der-Schluesseldateien">Systempfade der Schlüsseldateien</a></p></div><div class="section_2"><h3 id="Fehlermeldung-SWAP-beim-Booten">Fehlermeldung SWAP beim Booten<a class="headerlink" href="#Fehlermeldung-SWAP-beim-Booten">¶</a></h3><p>
Es kann durch den Eintrag von <code class="notranslate">cryptswap</code> (verschlüsselte <a class="internal" href="../swap.html">Swap-Partition</a>) in der <strong>/etc/fstab</strong> beim Booten zu einer Fehlermeldung durch ein "timing-Problem" kommen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Man sollte dem Hinweis auf die Benutzung der angebotenen "recovery shell" nicht nachkommen, da damit der Bootvorgang <span class="underline">nur</span> unterbrochen wird, dass Problem als solches nicht gelöst wird!
</p></div></div><p>Dieses ist unkritisch - <span class="underline">nur</span> sollte man anfangs prüfen, ob die Datei <strong>/dev/mapper/&lt;meine_crypted_swap&gt;</strong> richtig angelegt wurde. Unter <code class="notranslate">GNOME-Desktop</code> kann die einwandfreie Funktion mit dem Tool <code class="notranslate">Palimpsest-Laufwerksverwaltung</code> überprüft werden oder man gibt (bei den anderen Distributionen) im Terminal <sup><a href="#source-3">[3]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo blkid /dev/mapper/&lt;meine_crypted_swap&gt; </pre></div></div><p>Die Ausgabe sollte in etwa so aussehen:</p><pre class="notranslate">[sudo] password for laura: 
/dev/mapper/&lt;meine_crypted_swap&gt;: UUID="c82ad900-4fb0-4505-8612-557a884676b6" TYPE="swap" </pre><p>Die ausgegebene "UUID" ist zufällig und wechselt mit jeder Initialisierung!</p></div><div class="section_2"><h3 id="Keine-Initialisierung">Keine Initialisierung<a class="headerlink" href="#Keine-Initialisierung">¶</a></h3><p>
Vor allem bei "leistungsschwachen" Rechnern kann es passieren, dass die verschlüsselte Swap beim Booten nicht initialisiert wurde. Dann sollte man die <strong>/etc/rc.local</strong> mit Rootrechten bearbeiten und folgendes vor <code class="notranslate">exit0</code> eintragen:</p><pre class="notranslate">blkid /dev/mapper/&lt;meine_crypted_swap&gt;  &gt; /dev/null || /etc/init.d/cryptdisks restart;</pre></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="https://help.ubuntu.com/community/EncryptedPrivateDirectory" rel="nofollow">Weitere Hinweise</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p>
</p><hr/><p></p></div></div>
<p class="meta">
<a href="../archiv/ecryptfs-utils/a/revision/231868.html">Diese Revision</a> wurde am 6. Mai 2011 09:33 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../archiv.html">Archiv</a></li>
<li><a href="../archiv/ecryptfs-utils.html">ecryptfs-utils</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>