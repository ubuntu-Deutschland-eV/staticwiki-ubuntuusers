<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/DNS-Server_Bind/Erweiterte_Konfiguration › ubuntuusers statisches Wiki</title>
<link href="../../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../../archiv/dns-server_bind/erweiterte_konfiguration.html">Erweiterte Konfiguration</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/DNS-Server_Bind/Erweiterte_Konfiguration">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../../wiki/index.html">Index</a></li>
<li><a href="../../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../../wiki.html">Übersicht</a></li>
<li><a href="../../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../../kategorien.html">Kategorie</a></li>
<li><a href="../../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../../howto.html">Howto anlegen</a></li>
<li><a href="../../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../../baustelle.html">Baustellen</a></li>
<li><a href="../../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/backlinks.html">Erweiterte Konfiguration</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../../dns-server_bind.html">Bind - Basiskonfiguration</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../../chroot.html">Hintergrund von chroot</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Netzwerkschnittstellen">Netzwerkschnittstellen
</a></li><li><a class="crosslink" href="#Clientzugriff-beschraenken">Clientzugriff beschränken
</a></li><li><a class="crosslink" href="#Forwarders">Forwarders
</a></li><li><a class="crosslink" href="#Chroot-Umgebung">Chroot-Umgebung
</a><ol class="arabic"><li><a class="crosslink" href="#Einrichten-der-Umgebung">Einrichten der Umgebung
</a></li><li><a class="crosslink" href="#Anpassen-der-Konfiguration">Anpassen der Konfiguration
</a></li><li><a class="crosslink" href="#AppArmor">AppArmor
</a></li><li><a class="crosslink" href="#Umstellung-des-Servers">Umstellung des Servers
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Standardmäßig lauscht der Bind-Daemon auf allen verfügbaren Netzwerkschnittstellen. Dies kann unerwünscht sein, wenn man ihn bspw. auf einem Gateway betreibt, ohne die interne Zone im Internet preisgeben zu wollen. Wie man das ändern kann, wird nachfolgend beschrieben.</p><div class="section_1"><h2 id="Netzwerkschnittstellen">Netzwerkschnittstellen<a class="headerlink" href="#Netzwerkschnittstellen">¶</a></h2><p>
Zur Änderung der Netzwerkschnittstellen muss man in einem Editor mit Root-Rechten <sup><a href="#source-2">[2]</a></sup> die Datei <strong>named.conf.options</strong> bearbeiten und die folgende Zeile in den <em>options</em>-Block eintragen:</p><pre class="notranslate">        listen-on { 127.0.0.1; 192.168.0.10; };</pre><p>Die Angabe der IP-Adresse <code class="notranslate">192.168.0.10</code> muss natürlich an die IP-Adresse des Bind-Servers im lokalen Netzwerk angepasst werden. Wichtig ist auch, den <em>Localhost</em>, also <code class="notranslate">127.0.0.1</code>, nicht zu vergessen, sowie auf die korrekte Verwendung der Semikolons zu achten.</p></div><div class="section_1"><h2 id="Clientzugriff-beschraenken">Clientzugriff beschränken<a class="headerlink" href="#Clientzugriff-beschraenken">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Dieser Abschnitt ist nur dann wirklich relevant, wenn der Server aus dem Internet erreicht werden kann. Wer seinen Nameserver in einem lokalen Netz betreibt, das durch einen NAT-Router vom Internet getrennt ist, kann auf diese Absicherung getrost verzichten. 
</p></div></div><p>Wer seinen Nameserver nicht für das gesamte Internet betreiben will, sondern nur für seine eigenen Rechner, der wird den Zugriff darauf beschränken wollen. Auch hierfür gibt es eine Option, die bspw. wie folgt in die Datei <strong>/etc/bind/named.conf.options</strong> eingetragen wird:</p><pre class="notranslate">        allow-query { 192.168.1.0/24; };</pre><p>Hierbei ist es auch möglich, mehrere Netze oder auch einzelne Hosts in die Direktive einzubeziehen.</p><p>Wer selber eine öffentliche Zone für das Internet bedient, darf natürlich entfernten Rechnern nicht den Zugriff versperren. Andererseits möchte man aber sicher auch nicht, dass Fremde den eigenen Nameserver evtl. als Standard eintragen und dadurch unnötigen Traffic zu eigenen Lasten verursachen. Mit der folgenden Direktive erlaubt man deshalb nur den eigenen Clients, reguläre <em>(rekursive)</em> Anfragen an den Nameserver zu stellen, während allen anderen Clients nur Anfragen über die eigene Zone beantwortet werden:</p><pre class="notranslate">        allow-recursion { 192.168.1.0/24; };</pre><p>In größeren Installationen ist es oft sogar sinnvoll, die Funktionen zu trennen, indem man den eigenen Clients einige mit <em>allow-query</em> zugriffsbeschränkte Nameserver zur Namensauflösung zur Verfügung stellt, und für die Verwaltung der eigenen Zone andere verwendet. Bei diesen kann man dann die rekursive Auflösung ganz abstellen:</p><pre class="notranslate">        recursion no;</pre></div><div class="section_1"><h2 id="Forwarders">Forwarders<a class="headerlink" href="#Forwarders">¶</a></h2><p>
Normalerweise fragt sich ein Nameserver auf der Suche nach der gewünschten IP-Adresse rekursiv, von den sogenannten <em>Root-Servern</em> ausgehend, durch, bis er den Server gefunden hat, der ihm die richtige Antwort geben kann. Manchmal ist dieses Verhalten jedoch nicht erwünscht und der Server soll stattdessen lieber alle Anfragen, die er nicht direkt selber beantworten kann, einfach nur an bestimmte Nameserver weiterleiten, bspw. die des eigenen Providers, oder die Hauptnameserver eines Intranets.</p><p>In diesem Fall muss man die betreffenden Server, wie im Folgenden beschrieben, im <em>options</em>-Block der Datei <strong>/etc/bind/named.conf.options</strong> eintragen:</p><pre class="notranslate">        forwarders { a.b.c.d; w.x.y.z; };</pre><p>Antworten die Forwarder aus irgendwelchen Gründen nicht, so fällt Bind automatisch auf das erstgenannte Verfahren zurück und versucht "auf eigene Faust" die Anfrage zu befriedigen. Das kann man aber auch verhindern, in welchem Fall stattdessen eine Fehlermeldung zurückgegeben würde:</p><pre class="notranslate">        forward only;</pre></div><div class="section_1"><h2 id="Chroot-Umgebung">Chroot-Umgebung<a class="headerlink" href="#Chroot-Umgebung">¶</a></h2><p>
Nameserver sind leider überdurchschnittlich häufig Angriffen aus dem Internet ausgesetzt, und in der Geschichte von Bind gab es auch schon mal die eine oder andere Sicherheitslücke. Deswegen kann man auf einem exponierten Server einen gewissen Sicherheitsgewinn erlangen, indem man den Bind-Daemon in einer chroot-Umgebung <sup><a href="#source-4">[4]</a></sup> laufen lässt. Praktischerweise ist eine chroot-Funktion bereits in den Server integriert, so dass man auf die aufwendige Vollausstattung der chroot-Jail, wie im Artikel <a class="internal" href="../../chroot.html">chroot</a> beschrieben, verzichten kann. Ein wenig Mehrarbeit gegenüber einer herkömmlichen Installation muss man aber trotzdem in Kauf nehmen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Da die folgenden Schritte alle als root ausgeführt werden müssen, und man als normaler Benutzer teilweise nicht mal die entsprechenden Verzeichnisse betreten darf, empfiehlt sich die Benutzung von <code class="notranslate">sudo -s</code>.</p><p>Die Existenz einer funktionierenden Bind9-Installation <sup><a href="#source-3">[3]</a></sup> wird vorausgesetzt. 
</p></div></div><div class="section_2"><h3 id="Einrichten-der-Umgebung">Einrichten der Umgebung<a class="headerlink" href="#Einrichten-der-Umgebung">¶</a></h3><p>
Als erstes braucht man ein Verzeichnis, in dass der Server dann "chrooted" wird, und das sowohl die Konfigurationsdateien, als auch alle Laufzeitdaten aufnimmt. Ein geeigneter Ort wäre bspw. ein Verzeichnis namens <strong>/var/named</strong>. Die variablen Daten, bspw. die Process-ID (normalerweise in <strong>/var/run</strong> zu finden) und Slave-Zonen (<strong>/var/cache/bind</strong>), sollten dort ihre eigenen Verzeichnisse bekommen, damit man dem Daemon keine Schreibrechte auf das normale Konfigurationsverzeichnis einräumen muss. Mit den geeigneten Besitzverhältnissen und Rechten sollte das dann nach diversen chown- und chmod-Befehlen <em>exakt</em> so aussehen:</p><div class="bash"><div class="contents"><pre class="notranslate">ls -ld /var/named/ </pre></div></div><p>Ausgabe:</p><pre class="notranslate">drwxr-x--- 4 root bind 1024 2006-08-15 22:26 /var/named/
root@server:~# ls -l /var/named/
drwxrwx--- 2 root bind 1024 2006-08-15 21:55 cache
drwxrwx--- 2 root bind 1024 2006-08-15 22:30 pid</pre><p>Nun müssen noch alle Dateien aus <strong>/etc/bind</strong> in dieses Verzeichnis verschoben werden.</p></div><div class="section_2"><h3 id="Anpassen-der-Konfiguration">Anpassen der Konfiguration<a class="headerlink" href="#Anpassen-der-Konfiguration">¶</a></h3><p>
Die Pfade in den Konfigurationsdateien stimmen natürlich jetzt alle nicht mehr, und müssen angepasst werden. Durch die Art, wie eine chroot-Umgebung funktioniert <sup><a href="#source-4">[4]</a></sup>, ist das Verzeichnis <strong>/var/named</strong> dem Daemon im chroot jetzt nur noch als <strong>/</strong> bekannt.</p><p>In der Datei <strong>named.conf</strong> müssen deswegen <em>alle</em> Vorkommen von <strong>/etc/bind</strong> durch <strong>/</strong> ersetzt werden. Beispiel:</p><pre class="notranslate">include "/named.conf.options";</pre><p>Auch in <strong>named.conf.local</strong> und, nicht zu vergessen, in der <strong>named.conf-default-zones</strong> sind entsprechende Anpassungen vorzunehmen. Bei relativen Pfadangaben, wie <strong>back/domainname.bak</strong>, wird der komplette Pfad entfernt:</p><pre class="notranslate">file "domainname.bak";</pre><p>Die größten Anpassungen sind in der Datei <strong>named.conf.options</strong> vorzunehmen. Im <code class="notranslate">options</code>-Block ist die <code class="notranslate">directory</code>-Direktive in geeigneter Form abzuändern und ein Pfad für die Process-ID-Datei festzulegen:</p><pre class="notranslate">       directory "/cache";
       pid-file "/pid/named.pid";</pre><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die folgenden Direktiven sind im Gegensatz zu allen bisherigen Änderungen an der <strong>options</strong>-Datei am Ende der Datei, unterhalb der geschweiften Klammer, die den <code class="notranslate">options</code>-Block abschließt, einzutragen. 
</p></div></div><pre class="notranslate">controls {
        inet 127.0.0.1 allow { localhost; } keys { rndc-key; };
};

include "/rndc.key";</pre></div><div class="section_2"><h3 id="AppArmor">AppArmor<a class="headerlink" href="#AppArmor">¶</a></h3><p>
Abschließend muss noch das AppArmor-Profile von BIND angepasst werden. Dieses findet man unter <strong>/etc/apparmor.d/usr.sbin.named</strong>. In dieser Datei fügt man unter:</p><pre class="notranslate">/etc/bind/** r,</pre><p>nun den Eintrag mit dem chroot-Verzeichnis 
</p><pre class="notranslate">/var/named/** r,</pre><p>mit ein und lädt das AppArmor-Profile mit dem Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aa-enforce /etc/apparmor.d/usr.sbin.named </pre></div></div><p>neu.</p></div><div class="section_2"><h3 id="Umstellung-des-Servers">Umstellung des Servers<a class="headerlink" href="#Umstellung-des-Servers">¶</a></h3><p>
Da das Hilfstool <code class="notranslate">rndc</code>, das von den Startskripten verwendet wird, den zugehörigen Schlüssel im Verzeichnis <strong>/etc/bind</strong> erwartet, sollte als erstes dort im inzwischen leeren Verzeichnis ein symbolischer Link auf die Datei <strong>/var/named/rndc.key</strong> angelegt werden.</p><p>Dann muss man ein paar zusätzliche Optionen in der Datei <strong>/etc/default/bind9</strong> eintragen:</p><pre class="notranslate">OPTIONS="-u bind -t /var/named -c /named.conf"</pre><p>Und zum Abschluss muss der Server neu gestartet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">/etc/init.d/bind9 restart </pre></div></div><p>In der Datei <strong>/var/log/daemon.log</strong> kann man dann nachsehen, ob alles auch reibungslos geklappt hat. Außer den folgenden zwei Zeilen, die man ignorieren kann, sollten dort keine Fehler auftauchen:</p><pre class="notranslate">could not open entropy source /dev/random: file not found
using pre-chroot entropy source /dev/random</pre><p>Dass der Server wirklich im chroot läuft, kann man durch ein Auflisten des zur Bind-Pid gehörigen <strong>/proc</strong>-Unterverzeichnisses kontrollieren (Ausgabe gekürzt):</p><div class="bash"><div class="contents"><pre class="notranslate">ls -l /proc/`ps aux | grep '\/usr\/sbin\/[n]amed' | awk '{ print $2; }'` </pre></div></div><p>
Ausgabe:
</p><pre class="notranslate">lrwxrwxrwx 1 root root 0 2006-08-16 00:17 cwd -&gt; /var/named/cache
lrwxrwxrwx 1 root root 0 2006-08-16 00:17 exe -&gt; /usr/sbin/named
lrwxrwxrwx 1 root root 0 2006-08-16 00:17 root -&gt; /var/named</pre></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="../../dns-server_bind.html">DNS-Server Bind</a> - Hauptartikel</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../../archiv/dns-server_bind/erweiterte_konfiguration/a/revision/850163.html">Diese Revision</a> wurde am 16. November 2015 13:08 von <a href="https://ubuntuusers.de/user/aasche/">aasche</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../../startseite.html">Wiki</a></li>
<li><a href="../../archiv.html">Archiv</a></li>
<li><a href="../../archiv/dns-server_bind.html">DNS-Server Bind</a></li>
<li><a href="../../archiv/dns-server_bind/erweiterte_konfiguration.html">Erweiterte Konfiguration</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>