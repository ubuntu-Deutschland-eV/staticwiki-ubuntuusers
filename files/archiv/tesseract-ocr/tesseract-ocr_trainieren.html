<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/tesseract-ocr/tesseract-ocr_trainieren › ubuntuusers statisches Wiki</title>
<link href="../../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren.html">tesseract-ocr trainieren</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/tesseract-ocr/tesseract-ocr_trainieren">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../../wiki/index.html">Index</a></li>
<li><a href="../../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../../wiki.html">Übersicht</a></li>
<li><a href="../../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../../kategorien.html">Kategorie</a></li>
<li><a href="../../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../../howto.html">Howto anlegen</a></li>
<li><a href="../../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../../baustelle.html">Baustellen</a></li>
<li><a href="../../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/backlinks.html">tesseract-ocr trainieren</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../../pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../../editor.html">Einen Editor öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../../rechte.html">Rechte für Dateien und Ordner ändern</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="../../packprogramme.html">Archive entpacken</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="../../programme_kompilieren.html">Pakete aus dem Quellcode erstellen</a></p></li><li><p><a class="crosslink anchor" href="#source-7" id="source-7"></a> <a class="internal" href="../../programme_starten.html">Ein Programm starten</a></p></li></ol></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Funktionsweise">Funktionsweise
</a></li><li><a class="crosslink" href="#Vorlagen-erstellen">Vorlagen erstellen
</a><ol class="arabic"><li><a class="crosslink" href="#box-Dateien-erstellen">.box-Dateien erstellen
</a></li><li><a class="crosslink" href="#langid-DangAmbigs-Datei-erstellen">&lt;langid&gt;.DangAmbigs-Datei erstellen
</a></li></ol></li><li><a class="crosslink" href="#Trainingslauf-durchfuehren">Trainingslauf durchführen
</a></li><li><a class="crosslink" href="#Clustering">Clustering
</a></li><li><a class="crosslink" href="#Erstellung-des-spezifischen-Zeichen-Satzes">Erstellung des spezifischen Zeichen-Satzes...</a></li><li><a class="crosslink" href="#Woerterbuchdateien">Wörterbuchdateien
</a></li><li><a class="crosslink" href="#Tipps-und-Tricks">Tipps und Tricks
</a><ol class="arabic"><li><a class="crosslink" href="#Neue-Sprachen-vereinfachen">Neue Sprachen vereinfachen
</a></li><li><a class="crosslink" href="#Variationen-Kombinationen-erstellen">Variationen/Kombinationen erstellen
</a></li><li><a class="crosslink" href="#Sprachen-aus-Dokumenten-erstellen">"Sprachen" aus Dokumenten erstellen
</a></li></ol></li><li><a class="crosslink" href="#Boxes-Hilfsmittel">Boxes-Hilfsmittel
</a><ol class="arabic"><li><a class="crosslink" href="#xsane2boxes">xsane2boxes
</a></li><li><a class="crosslink" href="#tessboxes">tessboxes
</a></li><li><a class="crosslink" href="#tesseractTrainer-py">tesseractTrainer.py
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><a class="internal" href="../../tesseract-ocr.html">tesseract-ocr</a> lässt sich für neue Sprachen <a class="interwiki interwiki-googlecode" href="https://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract">"anlernen"</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>; der Prozess ist allerdings recht aufwendig und verlangt sehr exaktes Arbeiten. Die benötigten Programme sind in einer tesseract-ocr-Installation bereits vorhanden. Viele Schritte sind nur in "Handarbeit" zu bewerkstelligen, allerdings gibt es einige Hilfsmittel zur Erleichterung (spezielle <a class="crosslink" href="#Boxes-Hilfsmittel">Editor-Programme</a>, ein <a class="crosslink" href="#xsane2boxes">Skript</a>, um benötigte Dateien direkt aus <a class="internal" href="../../xsane.html">XSane</a> heraus anzulegen.) Theoretisch kann auch für eine bestehende Sprache die Erkennung erweitert werden, allerdings kann der Prozess fast genauso aufwändig wie eine Neuerstellung sein.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Der Trainingsprozess hat sich ab Version 3.00 verändert, siehe <a class="interwiki interwiki-googlecode" href="https://code.google.com/p/tesseract-ocr/wiki/TrainingTesseract3">TrainingTesseract3</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>; dieser Artikel bezieht sich nur auf Version 2.0x !
</p></div></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Benötigt<sup><a href="#source-1">[1]</a></sup> werden die Pakete
</p><ul><li><p><strong>tesseract-ocr</strong></p></li><li><p><strong>tesseract-ocr-&lt;langid&gt;</strong>, optional, wenn auf bestehende Sprachen/Bestandteile aufgebaut werden soll</p></li><li><p><strong>libtiff-dev</strong>, optional, um "compressed" oder mehrseitige <strong>.tif</strong>-Dateien verwenden zu können</p></li></ul><p>
</p></div><div class="section_1"><h2 id="Funktionsweise">Funktionsweise<a class="headerlink" href="#Funktionsweise">¶</a></h2><p>
<img alt="tessboxes-boxes.png" class="image-right" src="../../_/a60f00244646178d93041581f7e0f7817e1ce1a2.png"/>
tesseract-ocr "erkennt" Zeichen auf folgende Weise: Alle als mögliche Zeichen erkannte Elemente einer Vorlage werden von je einem rechteckigen Rahmen umgeben, deren Inhalt mit vorliegenden "Zeichen-Prototypen" verglichen werden. Der Prototyp mit der größten Übereinstimmung wird als erkanntes Zeichen ausgegeben; Zweifelsfälle lassen sich in der Datei <strong>&lt;langid&gt;.DangAmbigs</strong> beschreiben. Außerdem stützt sich die Erkennung auf <a class="crosslink" href="#Woerterbuchdateien">Wörterbuchdateien</a>, die in einem bestimmten Format vorliegen müssen; tesseract-ocr greift zur Abgrenzung der einzelnen Wörter u.a. auf diese Listen zurück.</p><p>tesseract-ocr kann nur Schriften verarbeiten, die getrennte Zeichen verwenden, die Lese-Richtung muss von links nach rechts verlaufen. Zur Ausgabe können alle <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Unicode">Unicode</a>-Zeichen verwendet werden, die in <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/UTF-8">UTF-8</a> codiert sind; die in einem Sprach-Set verwendbaren Zeichen müssen (in der Datei <strong>&lt;langid&gt;.unicharset</strong>) definiert sein.</p><p>Ein vollständiges Sprachen-Set besteht aus acht Dateien, die im Normalfall im Verzeichnis <strong>/usr/share/tesseract/tessdata</strong> abgelegt werden:
</p><table><tr class="titel"><td colspan="2"> tesseract-Sprachen-Set </td></tr><tr class="kopf"><td> Name </td><td> Funktion </td></tr><tr><td> <strong>&lt;langid&gt;.freq-dawg</strong> </td><td> Wortliste der häufig verwendeten Wörter, muss mindestens ein Wort enthalten </td></tr><tr class="highlight"><td> <strong>&lt;langid&gt;.word-dawg</strong> </td><td> Wortliste der übrigen Wörter, muss mindestens ein Wort enthalten </td></tr><tr><td> <strong>&lt;langid&gt;.user-words</strong> </td><td> persönliche Wortliste für spezielle Wörter, kann leer sein </td></tr><tr class="highlight"><td> <strong>&lt;langid&gt;.inttemp</strong> </td><td> Index des Zeichen-Sets </td></tr><tr><td> <strong>&lt;langid&gt;.normproto</strong> </td><td> normalisierte Prototypen der Zeichen </td></tr><tr class="highlight"><td> <strong>&lt;langid&gt;.pffmtable</strong> </td><td> Anzahl der zu erwartenden Eigenschaften der Zeichen </td></tr><tr><td> <strong>&lt;langid&gt;.unicharset</strong> </td><td> tatsächlich verwendetes Zeichen-Set </td></tr><tr class="highlight"><td> <strong>&lt;langid&gt;.DangAmbigs</strong> </td><td> Verzeichnis der leicht verwechselbaren Zeichen </td></tr></table><p>
</p></div><div class="section_1"><h2 id="Vorlagen-erstellen">Vorlagen erstellen<a class="headerlink" href="#Vorlagen-erstellen">¶</a></h2><p>
Die Vorlagen müssen als <strong>.tif</strong>-uncompressed-Format vorliegen, ggf. können mehrseitige <strong>.tif</strong>-Dateien verwendet werden. Die besten Ergebnisse werden mit Vorlagen erzielt, bei denen sowohl der Abstand zwischen den Zeichen als auch den Reihen deutlich ist; als Beispiele können die in den <a class="interwiki interwiki-googlecode" href="https://code.google.com/p/tesseract-ocr/downloads/list">box.tiff-Archiven</a> <img alt="{dl}" src="../../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/> verwendeten Vorlagen dienen. Dabei sollten die Zeichen möglichst "realitätsnah" verwendet werden, also gebräuchliche Wörter und keine gehäufte Verwendung von Sonderzeichen beinhalten. Für eine universelle Verwendung sollten die Vorlagen möglichst in den gebräuchlichsten Fonts erstellt werden; es sind bis zu 32 verschiedene Schriftarten für eine Sprache möglich (dabei auch Vorlagen für jeweils fette und kursive Varianten erstellen). Wer tesseract-ocr für ein bestimmtes Projekt trainieren will, sollte natürlich möglichst nur die verwendeten Schriftarten trainieren, diese aber umso "intensiver".</p><div class="section_2"><h3 id="box-Dateien-erstellen">.box-Dateien erstellen<a class="headerlink" href="#box-Dateien-erstellen">¶</a></h3><p>
Aus den Vorlagen werden nun die sog. <strong>.box</strong>-Dateien erstellt<sup><a href="#source-2">[2]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">tesseract &lt;fontfile&gt;.tif &lt;fontfile&gt;  [-l &lt;langid&gt;] batch.nochop makebox </pre></div></div><p>Dabei kann eine vorliegende Sprache verwendet werden (sinnvoll, wenn z.B. eine spezielle Version für ein existierendes Sprach-Set oder eine Sprache mit ähnlichem Zeichensatz erstellt werden soll). Die dabei entstehende <strong>fontfile.txt</strong>-Datei muss im Anschluss in <strong>fontfile.box</strong> umbenannt werden.</p><p>Diese Datei beinhaltet die jeweils erkannten Zeichen und die Koordinaten der es umgebenden Box (optional kann für mehrseitige <strong>.tif</strong>-Dateien eine weitere Spalte mit der jeweiligen Seitenzahl verwendet werden, allerdings haben einige Hilfsprogramme Probleme, diese Versionen zu bearbeiten). "<code class="notranslate">0,0</code>" ist dabei die Koordinate der unteren linken Ecke der gesamten Vorlage, erstes Paar jeder Zeile: linke untere Ecke, zweites Paar: rechte obere Ecke des Zeichens:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>D 101 503 131 534
e 135 501 154 527
r 158 503 173 526
, 197 496 205 507
, 206 496 214 508
s 220 499 236 524
c 239 499 258 523
h 262 500 284 532
n 288 500 310 524
e 313 499 332 523
l 336 500 347 533
l 352 500 363 532
e 367 499 386 524
" 389 520 407 532
</pre></div>
</td></tr></table></div><p>Diese Listen müssen nun so angepasst werden, dass am Anfang der Zeile das tatsächlich verwendete Zeichen steht, welches zunächst ggf. von tesseract-ocr nicht korrekt erkannt worden ist. Theoretisch sollte jedes Zeichen in einer Box stehen, z.T. müssen Boxen aber getrennt oder zusammengeführt (hier z.B. die Zeilen 5 und 6) und in ihrer Größe verändert werden. Diese aufwendige Arbeit wird sinnvollerweise mit <a class="crosslink" href="#Boxes-Hilfsmittel">Hilfsmitteln</a> bewerkstelligt.</p></div><div class="section_2"><h3 id="langid-DangAmbigs-Datei-erstellen">&lt;langid&gt;.DangAmbigs-Datei erstellen<a class="headerlink" href="#langid-DangAmbigs-Datei-erstellen">¶</a></h3><p>
Bei dieser Überprüfung kann schon an der Datei <strong>&lt;langid&gt;.DangAmbigs</strong> gearbeitet werden<sup><a href="#source-3">[3]</a></sup>, in der die leicht verwechselbaren Zeichen aufgeführt werden. Dabei handelt es sich um eine einfache Text-Datei, die in vier Spalten aufgeteilt ist, z.B.:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>1	f	1	t
1	a	1	o
1	o	1	a
1	e	1	c
1	c	1	e
2	r r	1	n
1	E	2	f i
2	l &lt;	1	k
2	l d	2	k i
2	l x	1	h
2	x n	1	m
2	u x	2	i n
</pre></div>
</td></tr></table></div><p>In der ersten Spalte steht die Anzahl, in der zweiten das bzw. die falsch erkannten Zeichen. In der dritten Zeile werden die richtige Anzahl der Zeichen, in der vierten die tatsächlich gemeinten Zeichen eingetragen. Die Erstellung muss von Hand erfolgen, die Datei darf leer sein, eine exakte <strong>&lt;langid&gt;.DangAmbigs</strong>-Datei ("dangerous ambiguities", gefährliche Doppeldeutigkeiten) kann aber zu einer genauen Zeichenerkennung beitragen. Das gilt auch zum "einfachen" Training für bereits bestehende Sprach-Sets.</p></div></div><div class="section_1"><h2 id="Trainingslauf-durchfuehren">Trainingslauf durchführen<a class="headerlink" href="#Trainingslauf-durchfuehren">¶</a></h2><p>
Wenn genügend <strong>.box</strong>-Dateien erstellt und vorbereitet sind, wird tesseract-ocr für jedes <strong>.tif</strong>/<strong>.box</strong>-Paar im Trainingsmodus gestartet. Dazu wird der Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">tesseract fontfile.tif junk nobatch box.train &amp;&gt; Errors.txt </pre></div></div><p>verwendet.</p><p>Ausgegeben wird eine <strong>fontfile.tr</strong>-Datei, die die Merkmale jedes Zeichens der <strong>.box</strong>-Datei enthält; der Ausgabename entspricht dem der Eingabe-<strong>.tif</strong>.  Die <strong>fontfile.tif</strong>- und <strong>-.box</strong>-Dateien müssen dazu im selben Verzeichnis liegen, ansonsten findet tesseract-ocr sie nicht. Außerdem gibt der Befehl alle auftretenden (Fehler-)Meldungen auf <a class="internal" href="../../shell/umleitungen.html#stdin-stdout-stderr-Kanaele-der-Bashstderr">stderr</a> aus, die dann in eine Log-Datei (hier <strong>Error.txt</strong>) umgeleitet werden. Die leere, ebenfalls entstehende <strong>junk.txt</strong>-Datei ist ein nicht benötigtes "Abfallprodukt".</p><p>Wichtig ist, die Log-Datei gründlich zu überprüfen und ggf. auftretende Fehler (<code class="notranslate">FAILURES/FATALITIES</code>) in der <strong>.box</strong>-Datei zu korrigieren. <code class="notranslate">FATALITIES</code> <span class="underline">müssen</span> korrigiert werden, sie weisen darauf hin, dass für eines der in der <strong>.box</strong>-Datei aufgeführten Zeichen kein Trainings-Sample gefunden wurde. Entweder stimmen die Koordinaten nicht, oder es liegt ein Fehler in dem Bild des betroffenen Zeichens vor. Dann kann das Zeichen nicht erkannt werden, und die generierte <strong>.inttemp</strong>-Datei stimmt später nicht mit der <strong>.unicharset</strong>-Datei überein - tesseract-ocr würde dann abstürzen.</p><p>Ein weiterer Fehler, der behoben werden muss (Ausgabe <code class="notranslate"> Bad utf-8 char...</code> gefolgt von <code class="notranslate">Box file format error on line n</code> o.ä.), deutet auf Verwendung eines falschen UTF-8-Codes hin. Andere Fehlerausgaben zum <strong>.box</strong>-Datei-Format sind meist auf Fehler in den Koordinaten der Box oder eine leere Zeile in der Datei zurückzuführen. Leere Zeilen sind dabei harmlos, der Fehler wird vorsichtshalber trotzdem ausgegeben.</p><p>Fehlerlos entstandene <strong>fontfile.tr</strong>-Dateien brauchen nicht weiter bearbeitet zu werden, sondern können so verwendet werden.</p></div><div class="section_1"><h2 id="Clustering">Clustering<a class="headerlink" href="#Clustering">¶</a></h2><p>
Nachdem die Zeichenmerkmale aller Trainings-Vorlagen ausgelesen sind, müssen sie zusammengefasst werden, um die Prototypen zu erstellen. Dazu werden die Programme <code class="notranslate">mftraining</code> und <code class="notranslate">cntraining</code> verwendet:</p><div class="bash"><div class="contents"><pre class="notranslate">mftraining fontfile_1.tr fontfile_2.tr ... </pre></div></div><p>Dabei werden zwei Dateien ausgegeben: <strong>.inttemp</strong> (die Form-Prototypen) und <strong>.pffmtable</strong> (beinhaltet die Anzahl der zu erwartenden Merkmale jedes einzelnen Zeichens) (die dritte ausgegeben Datei <strong>Microfeat</strong> wird nicht benötigt).</p><p>Der Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">cntraining fontfile_1.tr fontfile_2.tr ... </pre></div></div><p>gibt die <strong>.normproto</strong>-Datei aus, in der die normalisierten Zeichen-Prototypen zur Erkennung gespeichert sind.</p><p>Die Dateien müssen jeweils um den &lt;langid.&gt;-Wert ergänzt werden.</p></div><div class="section_1"><h2 id="Erstellung-des-spezifischen-Zeichen-Satzes">Erstellung des spezifischen Zeichen-Satzes<a class="headerlink" href="#Erstellung-des-spezifischen-Zeichen-Satzes">¶</a></h2><p>
Um festzulegen, welcher Zeichensatz ausgegeben werden kann, müssen mit dem <code class="notranslate">unicharset_extractor</code>-Programm alle <strong>.box</strong>-Dateien der zum "Clustering" verwendeten Vorlagen (in der entsprechenden Reihenfolge!) bearbeitet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">unicharset_extractor fontfile_1.box fontfile_2.box ... </pre></div></div><p>tesseract-ocr benötigt Informationen zu den Zeichen-Eigenschaften <code class="notranslate">isalpha</code> (Buchstabe), <code class="notranslate">isdigit</code> (Zahl), <code class="notranslate">isupper</code> (Großschreibung), <code class="notranslate">islower</code> (Kleinschreibung). Jede Zeile der <strong>.unicharset</strong>-Datei entspricht einem Zeichen; hinter dem eigentlichen Zeichen steht eine Hexadezimal-Zahl, die eine binäre Maske aller Eigenschaften darstellt. Jedes Bit repräsentiert eine Eigenschaft, <code class="notranslate">1</code> steht für das jeweilige Vorhandensein. Die Bits sind aufsteigend nach Signifikanz der Eigenschaften geordnet:  <code class="notranslate">isalpha</code>, <code class="notranslate">islower</code>, <code class="notranslate">isupper</code>, <code class="notranslate">isdigit</code>.</p><p>Beispiele:</p><ul><li><p>"<code class="notranslate">;</code>" ist kein Buchstabe, weder klein noch groß geschrieben" und auch keine Zahl. Seine Eigenschaften werden daher durch die Binärzahl "<code class="notranslate">0000</code>" wiedergegeben; hexadezimal "<code class="notranslate">0</code>".</p></li><li><p>"<code class="notranslate">b</code>" ist ein klein geschriebener Buchstabe; seine Eigenschaften werden durch die Binärzahl "<code class="notranslate">0011</code>" (hexadezimal "<code class="notranslate">3</code>") wiedergegeben.</p></li><li><p>"<code class="notranslate">W</code>" ist ein groß geschriebener Buchstabe; seine Eigenschaften werden durch die Binärzahl "<code class="notranslate">0101</code>" (hexadezimal "<code class="notranslate">5</code>") wiedergegeben.</p></li><li><p>"<code class="notranslate">7</code>" ist nur eine Zahl, seine Eigenschaften werden daher durch die Binärzahl "<code class="notranslate">1000</code>" (hexadezimal "<code class="notranslate">8</code>") wiedergegeben. </p></li></ul><p>
In der <strong>.unicharset</strong>-Datei stünde entsprechend:
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>; 0
b 3
W 5
7 8
</pre></div>
</td></tr></table></div><p>Die <strong>.unicharset</strong>-Datei muss bei jeder Neuerstellung der <strong>.inttemp</strong>-, <strong>.normproto</strong>- und <strong>.pffmtable</strong>-Dateien (also bei jeder Veränderung an den <strong>.box</strong>-Dateien) aktualisiert werden, damit sie "synchronisiert" bleiben. Die Zeilen müssen in der richtigen Reihenfolge bleiben, da <strong>.inttemp</strong> einen Index in die <strong>.unicharset</strong>-Datei schreibt und die klassifizierten Zeichen auf diesem Index basieren.</p></div><div class="section_1"><h2 id="Woerterbuchdateien">Wörterbuchdateien<a class="headerlink" href="#Woerterbuchdateien">¶</a></h2><p>
tesseract-ocr verwendet drei Wörterbuchdateien; zwei müssen als "<a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Directed_acyclic_word_graph">Directed Acyclic Word Graph</a>" (DAWG) codiert sein, die dritte als einfache in UTF-8 codierte Textdatei mit einem Wort pro Zeile. Um die DAWG-Wortlisten zu erstellen, wird eine Liste für die verwendete Sprache benötigt (Format wie oben; kann ggf. von <a class="external" href="http://ficus-www.cs.ucla.edu/geoff/ispell-dictionaries.html" rel="nofollow">ispell-dictionaries</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> bezogen werden). Die Liste wird in einen Teil mit den häufig verwendeten Wörtern und einen mit den restlichen Wörtern aufgeteilt (diese Listen müssen jeweils mindestens ein Wort enthalten; natürlich wird die Spracherkennung mit umfangreichen Wörterbüchern wesentlich zuverlässiger), die DAWG-Dateien werden dann mit den Befehlen</p><div class="bash"><div class="contents"><pre class="notranslate">wordlist2dawg frequent_words_list freq-dawg
wordlist2dawg words_list word-dawg </pre></div></div><p>generiert. Die Dateien müssen später in <strong>&lt;langid&gt;.freq-dawg</strong> bzw. <strong>&lt;langid&gt;.word-dawg</strong> umbenannt werden; wenn für eine bereits bestehende Sprache die Dateien gleich mit dem Sprachkürzel erstellt werden soll, muss die entsprechende <strong>&lt;langid&gt;.unicharset</strong>-Datei im selben Verzeichnis vorliegen und mit angegeben werden. Die Umwandlung selbst kann, je nach Größe der Wortliste, sehr lange (bis zu mehreren Stunden!) dauern und ist sehr "rechenintensiv".</p><p>Die dritte <strong>&lt;langid&gt;.user-words</strong>-Datei kann eigene Wörter (Fachjargon, Namen etc.) enthalten, darf aber auch leer sein. Wenn häufig Wörter mit Punkten o.ä. vorkommen (z.B. <code class="notranslate">ubuntuusers.de</code>), sollten diese so aufgenommen werden.</p><p>Wenn alle Dateien erstellt sind, werden sie in <strong>/usr/share/tesseract-ocr/tessdata</strong> abgelegt und können dann als neue oder angepasste Sprach-Version verwendet werden. Um auch von anderen Programmen erkannt werden zu können, sollte als Bezeichnung (&lt;langid&gt;) ein <a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/List_of_ISO_639-2_codes">ISO 639-2-Kürzel</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> verwendet werden.</p></div><div class="section_1"><h2 id="Tipps-und-Tricks">Tipps und Tricks<a class="headerlink" href="#Tipps-und-Tricks">¶</a></h2><p>
</p><div class="section_2"><h3 id="Neue-Sprachen-vereinfachen">Neue Sprachen vereinfachen<a class="headerlink" href="#Neue-Sprachen-vereinfachen">¶</a></h3><p>
Das Training ganz neuer Sprachen vereinfacht sich, wenn zunächst der gesamte Prozess für eine gute Vorlage durchgeführt wird. Mit der erstellten vorläufigen Sprache wird dann die Erstellung für die weiteren Vorlagen erheblich erleichtert, weil die Erkennung schon wesentlich besser ist. Die weiteren <strong>.box</strong>-Dateien können dann mit</p><div class="bash"><div class="contents"><pre class="notranslate">tesseract fontfile.tif fontfile -l &lt;langid&gt; batch.nochop makebox </pre></div></div><p>erstellt werden. Allerdings können Probleme auftreten, wenn nicht für jedes Zeichen wenigstens drei Sample vorliegen.</p></div><div class="section_2"><h3 id="Variationen-Kombinationen-erstellen">Variationen/Kombinationen erstellen<a class="headerlink" href="#Variationen-Kombinationen-erstellen">¶</a></h3><p>
Angepasste Versionen aus schon vorliegenden Sprach-Sets (z.B. aus den <a class="interwiki interwiki-googlecode" href="https://code.google.com/p/tesseract-ocr/downloads/list">box.tiff-Archiven</a> <img alt="{dl}" src="../../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/>) lassen sich etwas einfacher erstellen. Dazu können vorhandene Sprach-Sets kombiniert werden, aus bestehenden Sprachen "subsets" oder um bestimmte Zeichen oder Schriftarten erweiterte Versionen erstellt werden. Die Dateien liegen als G4-compressed-Versionen vor, die ggf., falls <strong>libtiff</strong> nicht verfügbar ist, extrahiert werden müssen, um sie verarbeiten zu können.</p><ol class="arabic"><li><p>Bestehende <strong>.box</strong>-Dateien "filtern", also nur die benötigten Zeichen beibehalten</p></li><li><p><a class="crosslink" href="#Trainingslauf-durchführen">Trainingsläufe</a> durchführen</p></li><li><p>Die <strong>&lt;filefont&gt;.tr</strong>-Dateien für jede Schriftart der verwendeten Sprachen aneinander hängen, um den gewünschten Zeichensatz zu erhalten ; ggf. eigene <strong>.tr</strong>-Dateien für Schriftarten oder Zeichen hinzufügen</p></li><li><p>Die gefilterten <strong>.box</strong>-Dateien entsprechend aneinander hängen, um sie mit dem <code class="notranslate">unicharset_extractor</code> zu verarbeiten</p></li><li><p>Die weiteren Schritte des Trainingsprozesses durchführen</p></li></ol><p>
Dieser Vorgang ist allerdings nicht ganz einfach. <code class="notranslate">cntraining</code> und <code class="notranslate">mftraining</code> können nur bis zu 32 <strong>.tr</strong>-Dateien verarbeiten. Daher müssen ggf. die Dateien aller Sprach-Sets für eine Schriftart zusammengefasst werden, um sprachübergreifende, aber "schriftarten-einheitliche" Dateien zu erhalten. Die Zeichen in den <strong>.tr</strong>-Dateien müssen in exakt der selben Reihenfolge wie in den <strong>.box</strong>-Dateien stehen, wenn sie an den <code class="notranslate">unicharset_extractor</code> übergeben werden. Das bedeutet, dass die <strong>.tr</strong>- und <strong>.box</strong>-Dateien in genau derselben Reihenfolge aneinander gehängt werden müssen.</p><p>Die Kommandozeilen für <code class="notranslate">cntraining</code>, <code class="notranslate">mftraining</code> und <code class="notranslate">unicharset_extractor</code> müssen entsprechend die <strong>.tr</strong>- bzw. <strong>.box</strong>-Dateien in identischer Reihenfolge übergeben, falls - was fast unweigerlich der Fall sein wird - unterschiedliche Filter-Auswahlen für die unterschiedlichen Schriftarten verwendet wurden. Sinnvoll wäre dafür ein Automatismus oder ein Programm, das die Auswahl der Zeichen anhand einer Zeichentafel ermöglichen würde; die identische Reihenfolge ließe sich ggf. mittels einer zu dem Zweck erstellten Textdatei realisieren, die, jeweils an <strong>.tr</strong>- bzw. <strong>.box</strong>-Endungen angepasst, per <a class="internal" href="../../shell/umleitungen.html">stdin</a> an die Programme übergeben würde.</p></div><div class="section_2"><h3 id="Sprachen-aus-Dokumenten-erstellen">"Sprachen" aus Dokumenten erstellen<a class="headerlink" href="#Sprachen-aus-Dokumenten-erstellen">¶</a></h3><p>
Einen Sonderfall stellt das Anlernen für vorliegende Dokumente dar - der Screenshot zu <strong>tesseractTrainer.py</strong> zeigt ein Beispiel, in dem tesseract-ocr zum Auslesen eines alten lateinisch-deutsch Lexikons angelernt werden soll. Die Idealbedingungen sind natürlich nicht gegeben, insbesondere die Empfehlung, keine Schriftarten zu mischen, lässt sich schwerlich realisieren (im Beispiel werden eine Fraktur-Schriftart, mit <strong>fett</strong>-Variante, für die deutschen Teile, und eine Serifen-Schrift in den Spielarten <strong>fett</strong> und <em>kursiv</em> für die lateinischen Textstellen verwendet; als weiteres Erschwernis kommen einzelne in griechischer Schrift geschriebene Wörter hinzu).</p><p>Entweder man versucht, entsprechende Schriftarten anderweitig zu finden, um daraus "vernünftige" Vorlagen zu erstellen, oder man extrahiert aus dem Dokument so umfangreiche Vorlagen, dass alle Zeichen häufig genug verwendet werden. Dabei muss ggf. auf einige Boxen verzichtet werden, wenn die Abstände zwischen den Zeichen zu klein sind und die Boxen ansonsten nicht trennscharf ausgegeben werden können. Dabei ist eine Überlappung der Boxen an sich nicht problematisch, allerdings darf eine Box sich nicht mit dem Zeichen in einer weiteren Box überschneiden. Außerdem lassen sich Zeichen, die so eng aneinander gedruckt sind, dass sie sich berühren, nicht trennen. In dem Fall können auch zwei (ggf. bis zu 4) Zeichen zusammengefasst werden.</p><p>Bei der Verwendung mehrerer Schriftarten, insbesondere wenn für dasselbe Zeichen sehr unterschiedliche Formen verwendet werden, können beim "Clustering" signifikante Eigenschaften aus den unterschiedlichen Schriftarten verwischen und damit die Erkennungsqualität herabsetzen. Allerdings werden bei ganz unterschiedlichen Schriftarten (z.B. griechisch/lateinisch) die Zeichen wieder besser erkannt, weil jeweils ganz andere Formen zum Einsatz kommen. Es kann aber auch zu Schwierigkeiten kommen, wenn in einem Sprach-Set mehr als 256 unterschiedliche Zeichen verwendet werden.</p><p>Mit ansonsten nicht verwendeten Sonderzeichen, die einzelnen Zeichen bei der Erkennung zusätzlich zugeordnet werden, lassen sich auch Formatierungsanweisungen "erkennen"; außerdem ist die Verwendung mehrerer Schriftarten in einer Trainingsvorlage damit etwas einfacher, weil weniger fehleranfällig (siehe <a class="crosslink" href="#tesseractTrainer-py">tesseractTrainer.py</a>). Allerdings greift dann die Worterkennung nicht mehr; es sei denn, man legt sich eine entsprechende "Wort"-Datei an, in der die Sonderzeichen mit integriert werden.</p><p>Sinnvoll ist es für derartige Fälle, sich zwei oder ggf. mehrsprachige Wörterbuchdateien zu erstellen.</p></div></div><div class="section_1"><h2 id="Boxes-Hilfsmittel">Boxes-Hilfsmittel<a class="headerlink" href="#Boxes-Hilfsmittel">¶</a></h2><p>
Um die <strong>.box</strong>-Dateien zu bearbeiten, gibt es verschiedene Hilfsmittel, um den aufwendigen Prozess etwas zu vereinfachen.</p><div class="section_2"><h3 id="xsane2boxes">xsane2boxes<a class="headerlink" href="#xsane2boxes">¶</a></h3><p>
Vorlagen können direkt aus <a class="internal" href="../../xsane.html">XSane</a> gescannt und als <strong>.box</strong>-Dateien mit den dazugehörigen <strong>.tif</strong>-Bildern (bzw. <strong>.pbm</strong>-Bildern, wenn <a class="crosslink" href="#tessboxes">tessboxes</a> zum Einsatz kommen soll), erstellt werden. Benötigt wird dazu das Programm <a class="internal" href="../../imagemagick.html">ImageMagick</a>, um die Vorlage-Dateien automatisch in ein von tesseract-ocr lesbares <strong>.tif</strong>- bzw. <strong>.pbm</strong>-Format zu konvertieren (das von XSane verwendete kompressierte <strong>.tif</strong>-Format wird nicht erkannt, es sei denn, tesseract-ocr wurde mit <strong>libtiff</strong>-Unterstützung kompiliert). Das "Boxenerstellungswerkzeug" wird mit folgendem Skript eingebunden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="c1">#</span>
<span class="c1">#                                   xsane2boxes 1.0</span>
<span class="c1">#</span>
<span class="c1">#           *** tesseract-boxes made "simple" (well, kind of ...) ***</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">##############################################################################</span>
<span class="c1"># </span>
<span class="c1"># xsane2boxes is a TesseractOCR wrapper to be able to produce boxes with xsane.</span>
<span class="c1"># .box-files are needed to train TesseractOCR for new languages. </span>
<span class="c1"># Corresponding .tif and .pbm-images are produced, too.</span>
<span class="c1"># </span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="nv">TEMP_DIR</span><span class="o">=</span>~/tmp/      <span class="c1"># folder for temporary files (TIFF &amp; tesseract data)</span>
<span class="nv">ERRORLOG</span><span class="o">=</span><span class="s2">"xsane2boxes.log"</span>  <span class="c1"># file where STDERR goes </span>

<span class="k">if</span> <span class="o">[[</span> -z <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span>  <span class="o">]]</span>
  <span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> [OPTIONS]</span>

<span class="s2">  xsane2boxes converts files to TIFF/PBM, scans them with TesseractOCR</span>
<span class="s2">  and outputs .tif/.pbm-files and the corresponding .box-files.</span>

<span class="s2">  OPTIONS:</span>
<span class="s2">    -i &lt;file1&gt;  define input file (any image-format supported)</span>
<span class="s2">    -o &lt;file2&gt;  define output-file (*.box)</span>
<span class="s2">    -l &lt;langid&gt;  define language-data tesseract should use</span>

<span class="s2">  Progress- &amp; error-messages will be stored in this logfile:</span>
<span class="s2">     </span><span class="nv">$TEMP_DIR$ERRORLOG</span><span class="s2"></span>

<span class="s2">  xsane2boxes depends on</span>
<span class="s2">    - ImageMagick  http://www.imagemagick.org/</span>
<span class="s2">    - TesseractOCR http://code.google.com/p/tesseract-ocr/</span>

<span class="s2">  Some coding was stolen from 'ocube'</span>
<span class="s2">  http://www.geocities.com/thierryguy/ocube.html</span>
<span class="s2">  </span>
<span class="s2">  This script is based on xsane2tess, http://doc.ubuntu-fr.org/xsane2tess </span>

<span class="s2">  The very useful little application tessboxes</span>
<span class="s2">  (http://www.lbreyer.com/tessboxes.html)</span>
<span class="s2">  uses .pbm-files to work on .box-files. However,</span>
<span class="s2">  the temporary images used by XSane are not fit to produce</span>
<span class="s2">  .pbm-files tessboxes is able to use. Therefore a .tiff-file</span>
<span class="s2">  has to be produced before the conversion takes place; the </span>
<span class="s2">  script converts that to a usable .pbm-file.</span>

<span class="s2">  Hints on this odd fact and comments in general are welcome! </span>
<span class="s2">  heinrich (dot) schwietering (at) gmx (dot) de </span>
<span class="s2">"</span>

  <span class="nb">exit</span>
<span class="k">fi</span>


<span class="c1"># get options...</span>
<span class="k">while</span> <span class="nb">getopts</span> <span class="s2">":i:o:l:"</span> OPTION
  <span class="k">do</span>
  <span class="k">case</span> <span class="nv">$OPTION</span> in 
    i<span class="o">)</span>  <span class="c1"># input filename (with path)</span>
      <span class="nv">FILE_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span>
      <span class="nv">FILE_PATH2</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span>
    <span class="p">;;</span>
    o <span class="o">)</span>  <span class="c1"># output filename</span>
      <span class="nv">FILE_OUT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span>
    <span class="p">;;</span>
    l <span class="o">)</span>  <span class="c1"># Language-selection</span>
      <span class="nv">TES_LANG</span><span class="o">=</span><span class="s2">"</span><span class="nv">$OPTARG</span><span class="s2">"</span>
    <span class="p">;;</span>
  <span class="k">esac</span>
<span class="k">done</span>

<span class="c1"># prepare output-value to move .tif-image</span>
<span class="nv">FILE_OUT2</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">FILE_OUT</span><span class="p">%.*</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># redirect STDOUT to FILE_OUT</span>
<span class="nb">exec</span> <span class="m">1</span>&gt;&gt;<span class="nv">$FILE_OUT</span>

<span class="c1"># redirect STDERR to ERRORLOG</span>
<span class="nb">exec</span> <span class="m">2</span>&gt;&gt;<span class="nv">$TEMP_DIR$ERRORLOG</span>

<span class="c1"># strip path from FILE_PATH, use filename only</span>
<span class="nv">IN_FILE</span><span class="o">=</span><span class="si">${</span><span class="nv">FILE_PATH</span><span class="p">##*/</span><span class="si">}</span>

<span class="nv">TIF_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TEMP_DIR</span><span class="s2">""</span><span class="si">${</span><span class="nv">IN_FILE</span><span class="p">%.*</span><span class="si">}</span><span class="s2">"</span>.tif
<span class="nv">TXT_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TEMP_DIR</span><span class="s2">""</span><span class="si">${</span><span class="nv">IN_FILE</span><span class="p">%.*</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># converting image into TIFF (ImageMagick)</span>
convert <span class="s2">"</span><span class="nv">$FILE_PATH</span><span class="s2">"</span> -compress none  <span class="s2">"</span><span class="nv">$TIF_FILE</span><span class="s2">"</span> <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="c1"># start tesseract to produce .box-file</span>
tesseract <span class="s2">"</span><span class="nv">$TIF_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TXT_FILE</span><span class="s2">"</span> -l <span class="s2">"</span><span class="nv">$TES_LANG</span><span class="s2">"</span> batch.nochop makebox <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>

<span class="c1"># STDOUT scanned text =&gt; FILE_OUT</span>
cat <span class="s2">"</span><span class="nv">$TXT_FILE</span><span class="s2">"</span>.txt
<span class="c1"># save.tif-file as well</span>
<span class="sb">`</span>cp <span class="s2">"</span><span class="nv">$TIF_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$FILE_OUT2</span><span class="s2">"</span>.tif<span class="sb">`</span>
<span class="c1"># produce pbm-file from final Xsane output</span>
convert <span class="s2">"</span><span class="nv">$FILE_OUT2</span><span class="s2">"</span>.tiff <span class="s2">"</span><span class="nv">$FILE_OUT2</span><span class="s2">"</span>.pbm

<span class="c1"># delete graphic file after use</span>
rm <span class="s2">"</span><span class="nv">$FILE_OUT2</span><span class="s2">"</span>.tiff
rm <span class="s2">"</span><span class="nv">$TIF_FILE</span><span class="s2">"</span>
rm <span class="s2">"</span><span class="nv">$TXT_FILE</span><span class="s2">"</span>.box
<span class="c1"># delete tesseract output</span>
rm <span class="s2">"</span><span class="nv">$TXT_FILE</span><span class="s2">"</span>.txt
</pre></div>
</td></tr></table></div><p>Das Skript in einen Editor kopieren, unter <strong>xsane2boxes.sh</strong> o.ä. abspeichern und ausführbar<sup><a href="#source-4">[4]</a></sup> machen. Es basiert auf <a class="internal" href="../../tesseract-ocr.html#xsane2tess">xsane2tess</a>, das  auf der französischen Ubuntu-Seite <a class="external" href="http://doc.ubuntu-fr.org/xsane2tess" rel="nofollow">ubuntu-fr.org</a> <img alt="{fr}" src="../../_/a4d7caed6af30e5c7549b4de45c71ed5f7036425.png"/> veröffentlicht worden ist.</p><p>Das Temporärverzeichenis (Zeile 19) muss entweder angelegt oder entsprechend den eigenen Wünschen abgepasst werden, dort wird auch die <strong>xsane2boxes.log</strong>-Datei abgelegt.</p><p>In <em>"XSane -&gt; Einstellung -&gt; Konfiguration -&gt; Texterkennung"</em> wird als OCR-Befehl <em>"/Pfad/zu/xsane2boxes.sh -l &lt;langid&gt;</em> eingesetzt, als Option für die Eingabedatei werden <em>"-i"</em>, für die Ausgabedatei <em>"-o"</em> angeben, die weiteren Felder bleiben leer.</p><p>Die Vorlage wird in XSane im Betrachter-Modus als <em>"Strichzeichnung"</em> mit einer Auflösung von mindestens 300 dpi erstellt. Wenn auch eine <strong>.pbm</strong>-Datei erstellt werden soll, muss das Bild im Betrachter zunächst abgespeichert werden. Erst dann die Texterkennung (<img alt="xsane/xsane-ocr.jpg" class="image-default" src="../../_/4e3625efd312583aec31a27d72d118b883c2ed49.png"/>-Taste) wählen, der Ausgabename mit der Endung <strong>.box</strong> wird im OCR-Speicher-Dialog festgelegt - dabei ggf. auf den gleichen Namen und Nummerierung wie für die <strong>.pbm</strong>-Datei achten! Theoretisch lassen sich auch mehrere <strong>.box</strong>-Scans zu einer Datei aneinander hängen, wenn zum Abspeichern der selbe Name verwendet wird; das ist allerdings nur sinnvoll, wenn auch eine entsprechende <a class="internal" href="../../xsane.html#Multipage-Mehrseitig">mehrseitige</a> <strong>.tif</strong>-Datei angelegt wird, was aber nicht gleichzeitig mit der Texterkennung erfolgen kann. Für <strong>.pbm</strong>-Dateien sind mehrseitige Vorlagen nicht möglich!</p><p>Falls Probleme auftauchen, liefert das angelegte Protokoll <strong>xsane2boxes.log</strong> ggf. Hinweise zur Lösung.</p><p>Die entstandenen <strong>.tif</strong>/<strong>.box</strong>- bzw <strong>.pbm</strong>/<strong>.box</strong>-Paare können dann mit tesseractTrainer.py bzw. tessboxes weiterverarbeitet werden.</p></div><div class="section_2"><h3 id="tessboxes">tessboxes<a class="headerlink" href="#tessboxes">¶</a></h3><p>
<a class="external" href="http://www.lbreyer.com/tessboxes_man.html" rel="nofollow">tessboxes</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein kleines Kommandozeilen-Werkzeug, um <strong>.box</strong>-Dateien zu bearbeiten. Es muss von der <a class="external" href="http://www.lbreyer.com/tessboxes.html" rel="nofollow">Projektseite</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> heruntergeladen, entpackt<sup><a href="#source-5">[5]</a></sup> und kompiliert<sup><a href="#source-6">[6]</a></sup> werden; dazu benötigt man die Pakete</p><ul><li><p><strong>libslang2</strong></p></li><li><p><strong>libslang2-dev</strong></p></li><li><p><strong>xorg-dev </strong></p></li><li><p><strong>libreadline-dev </strong></p></li><li><p><strong>netpbm</strong> (optional, um eine Bild mit den Boxen erstellen zu können)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="../../_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="../../apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install libslang2 libslang2-dev xorg-dev  libreadline-dev  netpbm </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install libslang2 libslang2-dev xorg-dev  libreadline-dev  netpbm </pre></div></div><p>
</p></div></div><div class="box warning"><h3 class="box warning">Hinweis!</h3><div class="contents"><p>
<a class="internal" href="../../fremdsoftware.html">Fremdsoftware</a> kann das System gefährden.
</p></div></div><p>Die <a class="internal" href="../../man.html">manpage</a> des Programms liefert neben den Hinweisen zur Benutzung eine recht ausführliche Beschreibung des gesamten Spracherstellungsprozess.
<img alt="tessboxes.png" class="image-right" src="../../_/19e3842262dd86bc27eb967ca22d149902b49b10.png"/>
tessboxes kann nur Dateien im <strong>.pbm</strong>-Format verarbeiten, die <strong>.tif</strong>-Dateien müssen also konvertiert werden (z.B. mit <a class="internal" href="../../imagemagick.html">ImageMagick</a> oder <a class="internal" href="../../gimp.html">GIMP</a>).</p><p>Der Aufruf des Editors erfolgt mit</p><div class="bash"><div class="contents"><pre class="notranslate">tessboxes -e &lt;Vorlage&gt;.pbm &lt;Vorlage&gt;.box </pre></div></div><p>Ggf. kann die Option "<code class="notranslate">-g x,y</code>" verwendet werden, um schnell eine bestimmte Box bearbeiten zu können. "<code class="notranslate">x</code>" und "<code class="notranslate">y</code>" sind  dabei die Koordinaten der linken unteren Ecke einer Box, die z.B. eine Fehlermeldung bei der Weiterverarbeitung ausgibt.</p><p>Es öffnen sich ein kleines Betrachter-Fenster sowie eine Liste im Terminal; die Bedienung erfolgt über die Tastatur. Eine Änderung des Zeichens muss bei "mehrzeichigen" Eingaben mit 
<span class="key">⏎</span>  abgeschlossen werden. Die Speicherung erfolgt mit 
<span class="key">Strg</span>  + 
<span class="key">X</span> , eine Bedienung mit der Maus ist nicht möglich.
<img alt="tessboxes-terminal.png" class="image-right" src="../../_/35d13e102aaea358f5cad271ef13012357cbc29b.png"/>
Der Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">tessboxes image.pbm boxes | pnmtopng &gt; image_with_boxes.png </pre></div></div><p>erzeugt ein Bild der Vorlage, in dem die Boxen genau zu sehen sind (siehe den Screenshot am Anfang des Artikels). Wenn es zu Problemen bei der Weiterverarbeitung kommt, lässt sich anhand des Bildes ggf. feststellen, ob und wo sich Boxen mit Buchstaben in anderen Boxen überschneiden (siehe <a class="crosslink" href="#Trainingslauf-durchfuehren">Trainingslauf durchführen</a>).</p><table><tr class="titel"><td colspan="2"> Tessboxes-Tastatur-Befehle </td></tr><tr class="kopf"><td> Taste </td><td> Funktion </td></tr><tr><td>
<span class="key">Strg</span>  + 
<span class="key">X</span> </td><td> Editor beenden und <strong>.box</strong>-Datei speichern </td></tr><tr class="highlight"><td>
<span class="key">Esc</span> </td><td> Editor beenden <span class="underline">ohne</span> <strong>.box</strong>-Datei zu speichern </td></tr><tr><td>
<span class="key">↑</span> ,
<span class="key">↓</span> ,
<span class="key">←</span> ,
<span class="key">→</span> </td><td> Eine Box aus der Liste wählen </td></tr><tr class="highlight"><td>
<span class="key">Einfg</span> </td><td> eine neue leere Box vor der gewählten einfügen </td></tr><tr><td>
<span class="key">Entf</span> </td><td> gewählte Box löschen </td></tr><tr class="highlight"><td>
<span class="key">Strg</span>  + 
<span class="key">↑</span> ,
<span class="key">↓</span> ,
<span class="key">←</span> ,
<span class="key">→</span> </td><td> gewählte Box vergrößern oder verkleinern </td></tr><tr><td>
<span class="key">Alt</span>  + 
<span class="key">↑</span> ,
<span class="key">↓</span> ,
<span class="key">←</span> ,
<span class="key">→</span> </td><td> gewählte Box verschieben</td></tr><tr class="highlight"><td>
<span class="key">Alt</span>  + 
<span class="key">S</span> </td><td> gewählte Box verkleinern </td></tr><tr><td>
<span class="key">Alt</span>  + 
<span class="key">C</span> </td><td> gewählte Box zuschneiden (kann wiederholt verwendet werden) </td></tr><tr class="highlight"><td>
<span class="key">Alt</span>  + 
<span class="key">A</span> </td><td> <span class="underline">Alle</span> Boxen der Datei zuschneiden </td></tr></table><p>
</p></div><div class="section_2"><h3 id="tesseractTrainer-py">tesseractTrainer.py<a class="headerlink" href="#tesseractTrainer-py">¶</a></h3><p>
<strong>tesseractTrainer.py</strong> ist ein in <a class="internal" href="../../python.html">Python</a> verfasstes Programm, mit dem komfortabel <strong>.box</strong>-Dateien bearbeitet und Einträge korrigiert werden können. Es bietet sehr hilfreiche Funktionen zum Vorbereiten des <strong>.box</strong>-Trainings. Leider hat der Entwickler die Arbeit an dem Skript, das er 2007 für ein eigenes Scan-Projekt entwickelt hatte, eingestellt.</p><p>Es kann von <a class="crosslink" href="http://paste.ubuntuusers.de/399471/">paste.ubuntuuusres.de</a> <img alt="{dl}" src="../../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/> bezogen werden. (Achtung: Im Gegensatz zu anderen Versionen dieses Quelltextes wurde diese hier an gewissen Stellen korrigiert.)</p><div class="box warning"><h3 class="box warning">Hinweis!</h3><div class="contents"><p>
<a class="internal" href="../../fremdsoftware.html">Fremdsoftware</a> kann das System gefährden.
</p></div></div><p>Benötigt werden eine python-Installation (ist in jeder Standard-Ubuntu-Instalation enthalten), außerdem das Paket</p><ul><li><p><strong>python-numpy</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="../../_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="../../apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install python-numpy </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install python-numpy </pre></div></div><p>
</p></div></div><p>Das Skript herunterladen, unter <strong>tesseractTrainer.py</strong> abspeichern und ausführbar machen.</p><p><img alt="tesseractTrainer.png" class="image-right" src="../../_/b2afe39413ed479992cc32a28efc26830c26754d.png"/>
Nach Aufruf kann eine <strong>.tif</strong>-Datei, wenn die entsprechende <strong>.box</strong>-Datei im selben Verzeichnis existiert, über <em>"File -&gt; Open Image"</em> oder 
<span class="key">Strg</span>  + 
<span class="key">O</span>  aufgerufen werden. Es lassen sich auch mehrere Dateien-Paare zusammenführen (<em>"File -&gt; Merge Text"</em>). Im oberen Fenster wird die Vorlage angezeigt, das jeweils "aktive" Zeichen in einer Box. Durch die Boxen wird mit 
<span class="key">Tab ⇆</span> , 
<span class="key">⇧</span>  + 
<span class="key">Tab ⇆</span> , 
<span class="key">↑</span> , 
<span class="key">↓</span>  navigiert.</p><p>Im unteren Fenster werden die erkannten Zeichen in den Boxen angezeigt, Veränderungen können über die Tastatur eingegeben werden. Es ist möglich, einer Box auch zwei (ggf. bis zu vier) Zeichen zuzuordnen, wenn sie sich nicht sauber trennen lassen. <strong>tesseractTrainer.py</strong> erlaubt es auch, die Formatierungsmerkmale <strong>fett</strong> ("bold"), <em>kursiv</em> ("italic") und <span class="underline">unterstrichen</span> ("underlined") mit anzugeben. Fett und kursiv können nur für ganze Wörter verwendet werden, unterstrichen auch für einzelne Buchstaben. Die Angabe der Formatierung kann allerdings nur "indirekt" erfolgen, da tesseract-ocr nur reinen Text ausgeben kann. Dazu werden die entsprechend markierten Symbole nach Abschluss des gesamten Trainings bei der Erkennung als "<code class="notranslate">@&lt;Zeichen&gt;</code>" (fett), "<code class="notranslate">$&lt;Zeichen&gt;</code>" (kursiv) oder "<code class="notranslate">'&lt;Zeichen&gt;</code>" (unterstrichen) wiedergegeben. In einem Textverarbeitungsprogramm  (z.B. <a class="internal" href="../../openoffice.org.html">OpenOffice.org</a>) können dann diesen Zeichenkombinationen die entsprechenden Formatierungen wieder zugewiesen und die "Steuerzeichen" dann wieder entfernt  werden - Vorsicht aber, wenn in den zu konvertierenden Vorlagen diese Zeichen tatsächlich verwendet werden! Ggf. können im Skript auch andere, anderweitig nicht verwendete Zeichen benutzt werden.</p><p>Die Boxen lassen sich in der Größe anpassen, entweder über die Tastenkombinationen oder über die Eingabefenster unter der Boxen-Anzeige. Leider ist nicht ohne Weiteres sichtbar, ob Boxen sich mit Zeichen aus anderen Boxen überschneiden (das führt bei der Weiterverarbeitung zu Fehlern!), da immer nur die aktuelle Box angezeigt wird.</p><p>Nach Abschluss der Bearbeitung wird die <strong>.box</strong>-Datei mit <em>"File -&gt; Save Box Info"</em> (
<span class="key">Strg</span>  + 
<span class="key">S</span> ) gespeichert, beim einfachen Beenden (
<span class="key">Strg</span>  + 
<span class="key">Q</span> ) werden Änderungen nicht übernommen!</p><table><tr class="titel"><td colspan="2"> tesseractTrainer.py-Tasten, unteres Fenster </td></tr><tr class="kopf"><td> Taste </td><td> Funktion </td></tr><tr><td>
<span class="key">Strg</span>  + 
<span class="key">B</span> </td><td> Ganzes Wort als <strong>fett</strong> markieren </td></tr><tr class="highlight"><td>
<span class="key">Strg</span>  + 
<span class="key">I</span> </td><td> Ganzes Wort als <em>kursiv</em> markieren </td></tr><tr><td>
<span class="key">Strg</span>  + 
<span class="key">U</span> </td><td> gewähltes Symbol als <span class="underline">unterstrichen</span> markieren </td></tr><tr class="highlight"><td>
<span class="key">Strg</span>  + 
<span class="key">↑</span> , 
<span class="key">↓</span> , 
<span class="key">←</span> , 
<span class="key">→</span> </td><td> Box nach oben, unten, links oder rechts vergrößern </td></tr><tr><td>
<span class="key">Strg</span>  + 
<span class="key">⇧</span>  + 
<span class="key">↑</span> , 
<span class="key">↓</span> , 
<span class="key">←</span> , 
<span class="key">→</span> </td><td> Box nach oben, unten, links oder rechts verkleinern </td></tr><tr class="highlight"><td>
<span class="key">Strg</span>  + 
<span class="key">1</span> </td><td> gewählte Box mit der nächsten verbinden </td></tr><tr><td>
<span class="key">Strg</span>  + 
<span class="key">2</span> </td><td> gewählte Box vertikal teilen </td></tr><tr class="highlight"><td>
<span class="key">Strg</span>  + 
<span class="key">D</span> </td><td> gewählte Box löschen </td></tr></table><p>
</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.saltcymru.org/english/saltcymru_document5.pdf" rel="nofollow">Exemplarische Beschreibung</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> zur Spracherstellung</p></li><li><p><a class="external" href="http://www.lbreyer.com/tessboxes.html" rel="nofollow">tessboxes</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://ficus-www.cs.ucla.edu/geoff/ispell-dictionaries.html" rel="nofollow">Verzeichnis von Wortlisten</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>, nützlich für die Wörterbuchdateien</p></li><li><p><a class="external" href="http://ereimer.net/programs/tesseract-tools.htm" rel="nofollow">tesseract-tools</a> <img alt="{en}" src="../../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> Skripte zur Automatisierunmg des Trainingsvorgangs</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren/a/revision/665407.html">Diese Revision</a> wurde am 7. Dezember 2013 12:44 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../../startseite.html">Wiki</a></li>
<li><a href="../../archiv.html">Archiv</a></li>
<li><a href="../../archiv/tesseract-ocr.html">tesseract-ocr</a></li>
<li><a href="../../archiv/tesseract-ocr/tesseract-ocr_trainieren.html">tesseract-ocr trainieren</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>