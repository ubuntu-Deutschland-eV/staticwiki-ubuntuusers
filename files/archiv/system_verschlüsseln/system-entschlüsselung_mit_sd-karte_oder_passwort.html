<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/System_verschlüsseln/System-Entschlüsselung_mit_SD-Karte_oder_Passwort › ubuntuusers statisches Wiki</title>
<link href="../../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort.html">System-Entschlüsselung mit SD-Karte oder Passwort</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/System_verschlüsseln/System-Entschlüsselung_mit_SD-Karte_oder_Passwort">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../../wiki/index.html">Index</a></li>
<li><a href="../../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../../wiki.html">Übersicht</a></li>
<li><a href="../../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../../kategorien.html">Kategorie</a></li>
<li><a href="../../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../../howto.html">Howto anlegen</a></li>
<li><a href="../../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../../baustelle.html">Baustellen</a></li>
<li><a href="../../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/backlinks.html">System-Entschlüsselung mit SD-Karte oder Passwort</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../../formatieren.html">Formatieren</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../../terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../../kernelmodule.html">Umgang mit Kernelmodulen (Treibern)</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="../../sudo.html">Root-Rechte</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="../../dateisystem.html">Dateisystem</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="../../editor.html">Einen Editor öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-7" id="source-7"></a> <a class="internal" href="../../rechte.html">Rechte für Dateien und Ordner ändern</a></p></li><li><p><a class="crosslink anchor" href="#source-8" id="source-8"></a> <a class="internal" href="../../pakete_installieren.html">Installation von Programmen</a></p></li></ol></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorbereitungen">Vorbereitungen
</a></li><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Schluesselkarte-erzeugen">Schlüsselkarte erzeugen
</a></li><li><a class="crosslink" href="#Systemanpassung">Systemanpassung
</a></li></ol></li><li><a class="crosslink" href="#Abschluss-und-Rettung">Abschluss und Rettung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Im Artikel <a class="internal" href="../../system_verschlüsseln.html">System verschlüsseln</a> ist beschrieben, wie ein Ubuntu-System vollständig (bis auf <strong>/boot</strong>) verschlüsselt und mit einem <a class="internal" href="../../luks.html">LUKS</a>-Passwort während des Bootens entschlüsselt wird. Für z.B. manche Laptop-Nutzer reicht es aber eventuell aus, diesen Rechner nur unterwegs mittels Passwort zu entsperren. In einer "sichereren" Umgebung (z.B. zu Hause) würde man eher eine bequeme Lösung bevorzugen, bei der sich der Rechner mittels einem eingesteckten Speichermedium selbst entsperrt.</p><p>Diese Anleitung beschreibt Schritt für Schritt die Einrichtung eines Systems mit SD-Karte, die diese Funktion übernimmt. Sollte diese spezielle SD-Karte nicht eingesteckt sein, wird wie gehabt nach dem Passwort gefragt. Diese Anleitung kann selbstverständlich an andere Speichermedien (USB-Stick, MMPro-Karten etc.) angepasst werden.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Diese Anleitung baut vollständig auf dem Artikel <a class="internal" href="../../system_verschlüsseln.html">System verschlüsseln</a> auf und ist als eine Erweiterung zu verstehen. Insbesondere wird seine Syntax übernommen, z.B. <strong>/dev/sdX2</strong> für das LVM-Volume.
</p></div></div><div class="section_1"><h2 id="Vorbereitungen">Vorbereitungen<a class="headerlink" href="#Vorbereitungen">¶</a></h2><p>
In diesem Beispiel wird eine beliebige SD-Karte verwendet. Beim Kauf einer Digitalkamera liegen die z.B. in viel zu kleinen Größen bei, so eine kann man dann exklusiv zum Entschlüsseln verwenden. Alternativ zwackt man sich etwas Platz von einer großen Karte ab. Für dieses Beispiel wird eine (kleine) Karte vollständig formatiert<sup><a href="#source-1">[1]</a></sup> werden, also keine eigene Mini-Partition erstellt.</p><p>Zuerst muss festgestellt werden, ob die SD-Karte vom System erkannt wird und welche Treiber dafür nötig sind. Ubuntu wird ohne Karte gestartet. In einem Terminal-Fenster<sup><a href="#source-2">[2]</a></sup> werden mit</p><div class="bash"><div class="contents"><pre class="notranslate">watch --i=3 lsmod </pre></div></div><p>alle 3 Sekunden die momentan geladenen Kernelmodule<sup><a href="#source-3">[3]</a></sup> angezeigt. Jetzt wird die SD-Karte eingesteckt. Wurde die Karte richtig vom System erkannt, sollte nach kurzer Zeit neu geladene Module auftauchen, in diesem Fall:</p><pre class="notranslate">Every 3,0s: lsmod                                      Mon Aug  3 12:14:36 2009

Module                  Size  Used by
mmc_block              19464  0
binfmt_misc            18572  1
ppdev                  16904  0
bridge                 63904  0
stp                    11140  1 bridge
bnep                   22912  2
input_polldev          12688  0
...</pre><p>ist es eines, nämlich <code class="notranslate">mmc_block</code>.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Wird die Karte nicht richtig erkannt, muss dies zu allererst behoben werden, u.U. mit Hilfe der <a class="crosslink" href="http://forum.ubuntuusers.de/">Forengemeinschaft</a> oder dem <a class="crosslink" href="http://wiki.ubuntuusers.de/">Wiki</a>.
</p></div></div><p>Für den nächsten Befehl muss zuerst folgendes Paket installiert<sup><a href="#source-8">[8]</a></sup> werden:</p><ul><li><p><strong>hwinfo</strong> (<em>universe</em>, bis einschließlich <a class="internal" href="../../raring.html">Ubuntu 13.04</a>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="../../_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="../../apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install hwinfo </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install hwinfo </pre></div></div><p>
</p></div></div><p>
Nun können alle erkannten Speicher-Medien aufgelistet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo hwinfo --disk </pre></div></div><p>
Ein Eintrag wie z.B.</p><pre class="notranslate">29: None 00.0: 10600 Disk                                       
  [Created at block.243]
  UDI: /org/freedesktop/Hal/devices/storage_serial_0xa9f72db2
  Unique ID: HAKk.Fxp0d3BezAE
  Parent ID: tT1U.VJKpUAQeTjB
  SysFS ID: /class/block/mmcblk0
  SysFS BusID: mmc0:2db2
  SysFS Device Link: /devices/pci0000:00/0000:00:1e.0/0000:09:01.1/mmc_host/mmc0/mmc0:2db2
  Hardware Class: disk
  Model: "Disk"
  Driver: "sdhci-pci", "mmcblk"
  Driver Modules: "sdhci_pci"
  Device File: /dev/mmcblk0
  Device Number: block 179:0-179:7
  Features: Hotpluggable
  Geometry (Logical): CHS 455/4/16
  Size: 29120 sectors a 512 bytes
  Config Status: cfg=new, avail=yes, need=no, active=unknown
  Attached to: #4 (SD Host controller)</pre><p>bedeutet, dass
</p><ul><li><p>die SD-Karte erkannt wurde,</p></li><li><p>als Gerät <strong>/dev/mmcblk0</strong> eingebunden ist, und</p></li><li><p>das Treibermodul dafür <code class="notranslate">sdhci_pci</code> ist.</p></li></ul><p>Ein</p><div class="bash"><div class="contents"><pre class="notranslate">sudo blkid </pre></div></div><p>liefert dann noch die <a class="internal" href="../../uuid.html">UUID</a> der SD-Karte. Damit sind alle Information verfügbar, um an die eigentliche Arbeit zu gehen.</p></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Viele der folgenden Kommandos müssen mit System-Rechten<sup><a href="#source-4">[4]</a></sup> eingegeben werden.
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">sudo -i </pre></div></div><p>
startet eine root-Sitzung.</p><div class="section_2"><h3 id="Schluesselkarte-erzeugen">Schlüsselkarte erzeugen<a class="headerlink" href="#Schluesselkarte-erzeugen">¶</a></h3><p>
Für den höchstwahrscheinlichen Fall, dass die SD-Karte bereits ein handelsübliches Dateisystem<sup><a href="#source-5">[5]</a></sup> besitzt, wird sie vermutlich auf dem Desktop erschienen sein, was dafür spricht, dass sie z.B. als <strong>/media/disk</strong> eingehängt wurde. Die Karte soll jetzt mit dem <strong>ext3</strong>-Dateisystem formatiert werden. <strong>ext3</strong> hat den Vorteil, dass keine zusätzlichen Kernelmodule für dieses Dateisystem geladen werden müssen.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Alle Daten auf der SD-Karte werden durch das Formatieren gelöscht!
</p></div></div><p>Die SD-Karte wird</p><div class="bash"><div class="contents"><pre class="notranslate">umount /media/disk          # Dies ist ein Beispiel. Einhängepunkt muss ggf. angepasst werden. </pre></div></div><p>ausgehängt und dann mit</p><div class="bash"><div class="contents"><pre class="notranslate">mkfs.ext3 /dev/mmcblk0          # Dies ist ein Beispiel. Gerätename muss ggf. angepasst werden. </pre></div></div><p>formatiert. Dann wird sie mit</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir /media/disk
mount /dev/mmcblk0 /media/disk          # Dies ist ein Beispiel. Gerätename muss ggf. angepasst werden. </pre></div></div><p>erneut ins System gehängt. Mit</p><div class="bash"><div class="contents"><pre class="notranslate">dd if=/dev/urandom of=/media/disk/keyfile bs=4k count=1 </pre></div></div><p>wird dann ein 4kB großer Zufallsdatenstrom als Schlüsseldatei <strong>keyfile</strong> auf der Karte erzeugt. Mit der Schlüsseldatei soll das zukünftige System alternativ zur Passworteingabe entschlüsselt werden können. 
</p></div><div class="section_2"><h3 id="Systemanpassung">Systemanpassung<a class="headerlink" href="#Systemanpassung">¶</a></h3><p>
Mit</p><div class="bash"><div class="contents"><pre class="notranslate">cryptsetup luksAddKey /dev/sdX2 /media/disk/keyfile          # Dies ist ein Beispiel. Gerätename muss ggf. angepasst werden. </pre></div></div><p>wird die Schlüsseldatei als neuer Schlüssel für das LVM-Volume <strong>/dev/sdX2</strong> hinzugefügt. <strong>sdX2</strong> muss selbstverständlich durch einen gültigen Gerätenamen ersetzt werden. Der Schlüssel wird hinzugefügt, nachdem das bisherige Passwort eingegeben wurde.</p><p>Bevor weitere Änderungen vorgenommen werden, sollte die aktuelle <strong>initrd</strong>-Datei gesichert werden. Für z.B. <strong>initrd.img-2.6.28-15-generic</strong> erledigt dies</p><div class="bash"><div class="contents"><pre class="notranslate">cp /boot/initrd.img-2.6.28-15-generic /boot/initrd.img-2.6.28-15-generic.backup          # Dies ist ein Beispiel. Versionsnamen müssen ggf. angepasst werden. </pre></div></div><p>Mit dieser Kopie kann zur Not aus <a class="internal" href="../../grub.html">GRUB</a> heraus das momentane (sicher funktionierende) System gestartet werden, falls es zu Problemen kommen sollte (s.u.). Jetzt werden die oben ermittelten Kernel-Module in die Liste der zu ladenden Module angefügt. Dazu wird <strong>/etc/initramfs-tools/modules</strong> (in diesem Beispiel) in einem Editor<sup><a href="#source-6">[6]</a></sup> mit Root-Rechten um die Zeilen</p><pre class="notranslate">sdhci_pci
mmc_block</pre><p>erweitert. Dies ermöglicht es, dass die SD-Karte bereits im frühen boot-Stadium der initram richtig erkannt werden kann. Die Datei <strong>/etc/crypttab</strong> legt fest, welche verschlüsselten Datenträger wie entschlüsselt werden. <strong>crypttab</strong> wird jetzt dahingehend geändert, dass statt einer Passworteingabe ein Skript <strong>/sbin/keyscript</strong> läuft, dessen Standardausgabe einer der (in diesem Beispiel zwei) Schlüssel ist, und zwar entweder das Passwort (wie gehabt) oder das <strong>keyfile</strong> auf der SD-Karte. Zuvor wird wieder eine Sicherungskopie gemacht:</p><div class="bash"><div class="contents"><pre class="notranslate">cp /etc/crypttab /etc/crypttab.backup </pre></div></div><p>Dann wird die Datei <strong>/etc/crypttab</strong> in einem Editor geöffnet und die Zeile</p><pre class="notranslate">lukslvm UUID=&lt;VOLUME_ID&gt; none luks</pre><p>ersetzt mit</p><pre class="notranslate">lukslvm UUID=&lt;VOLUME_ID&gt; none luks,keyscript=/sbin/keyscript</pre><p><code class="notranslate">&lt;VOLUME_ID&gt;</code> sollte eine UUID sein und hier nicht geändert werden. Nach dem Speichern kann der Editor wieder geschlossen werden. Jetzt wird das eigentliche Skript als Datei <strong>/sbin/keyscript</strong> erstellt.
Hierbei gilt es zwischen Plymouth und USplash zu unterscheiden, da beide Bootsplash-Systeme anders angesprochen werden.</p><p><strong>USplash</strong>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/sh</span>

modprobe usb-storage <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>                                                       <span class="c1"># Zur Sicherheit, evtl. nicht notwendig</span>
sleep <span class="m">10</span>                                                                        <span class="c1"># Kann u.U. verkürzt werden</span>
<span class="k">if</span> <span class="o">[</span> -b /dev/disk/by-uuid/68560947-b5e5-494d-87e9-0d293d436cea <span class="o">]</span>		<span class="c1"># UUID muss angepasst werden</span>
  <span class="k">then</span>
    mkdir /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    mount /dev/disk/by-uuid/68560947-b5e5-494d-87e9-0d293d436cea /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>	<span class="c1"># UUID muss angepasst werden</span>
    cat /keytmp/keyfile                                                         <span class="c1"># Ausgabe der oben mit dd erzeugten Schlüsseldatei "keyfile"</span>
    umount /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
  <span class="k">else</span>
    <span class="k">if</span> <span class="o">[</span> -p /dev/.initramfs/usplash_outfifo <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> -x /sbin/usplash_write <span class="o">]</span>
      <span class="k">then</span> 
        /sbin/usplash_write <span class="s2">"INPUTQUIET Enter password: "</span>
        <span class="nv">tmpin</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>/bin/cat /dev/.initramfs/usplash_outfifo<span class="k">)</span><span class="s2">"</span>
      <span class="k">else</span>
	sleep <span class="m">5</span>
        <span class="nb">echo</span> -n <span class="s2">"Enter password: "</span> <span class="m">1</span>&gt;/dev/tty1
        stty -echo &lt;/dev/console <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
        <span class="nb">read</span> tmpin &lt;/dev/console <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
        stty <span class="nb">echo</span> &lt;/dev/console <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    <span class="k">fi</span>
    <span class="nb">echo</span> -n <span class="nv">$tmpin</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table></div><p><strong>Plymouth</strong>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1"># keyscript.sh</span>

<span class="k">if</span> <span class="o">[</span> -b /dev/disk/by-uuid/68560947-b5e5-494d-87e9-0d293d436cea <span class="o">]</span><span class="p">;</span><span class="k">then</span>           <span class="c1"># UUID der Partition des Sticks</span>
    mkdir /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
    mount /dev/disk/by-uuid/68560947-b5e5-494d-87e9-0d293d436cea /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>   <span class="c1"># UUID der Partition des Sticks</span>
    cat /keytmp/keyfile                                                         <span class="c1"># Ausgabe der erzeugten Schluesseldatei "keyfile"</span>
    umount /keytmp <span class="m">1</span>&gt;<span class="p">&amp;</span><span class="m">2</span>
  <span class="k">else</span>
    <span class="k">if</span> <span class="o">[</span> -x /bin/plymouth <span class="o">]</span> <span class="o">&amp;&amp;</span> plymouth --ping<span class="p">;</span><span class="k">then</span>
	plymouth ask-for-password --prompt<span class="o">=</span><span class="s2">"LUKS-Passphrase for /dev/mapper/root:"</span>
    <span class="k">else</span>
        <span class="nb">echo</span> -n <span class="s2">"LUKS-Passphrase for /dev/mapper/root"</span>
        stty -echo
        <span class="nb">read</span> passphrase
        <span class="nb">echo</span> -n <span class="nv">$passphrase</span>
        stty echo<span class="p">;</span>
    <span class="k">fi</span>
<span class="k">fi</span>
</pre></div>
</td></tr></table></div><p>Die UUIDs müssen mit der der SD-Karte ersetzt werden. Das Skript versucht, die SD-Karte zu erkennen. Wenn dies gelingt, wird sie als Verzeichnis <strong>/keytmp</strong> der <em>initial ram disk</em> eingehängt. Das <strong>keyfile</strong> wird ausgelesen und an <code class="notranslate">cryptsetup</code> übergeben. Wird keine SD-Karte gefunden (weil diese z.B. nicht eingesteckt wurde), wird ein Passwort mittels des entsprechenden Bootsplash-Systems (<code class="notranslate">USplash</code>/<code class="notranslate">Plymouth</code>) oder über die Console (<code class="notranslate">read</code>) angenommen und dieses dann an <code class="notranslate">cryptsetup</code> übergeben.</p><p>Nach dem Speichern von <strong>keyscript</strong> kann der Editor geschlossen werden. Das Skript wird dann ausführbar gemacht<sup><a href="#source-7">[7]</a></sup>. Schließlich werden alle Änderungen in die neue <em>initial ram disk</em> mit</p><div class="bash"><div class="contents"><pre class="notranslate">update-initramfs -u </pre></div></div><p>überführt. Das System erkennt automatisch, dass aus der <strong>/etc/crpyttab</strong> das <strong>/sbin/keyscript</strong> ausgeführt wird und lädt diese Datei in die neue aktualisierte <em>initial ram disk</em>.</p></div></div><div class="section_1"><h2 id="Abschluss-und-Rettung">Abschluss und Rettung<a class="headerlink" href="#Abschluss-und-Rettung">¶</a></h2><p>
Um die "Schlüsselkarte" nicht ständig auf dem Desktop angezeigt zu bekommen, könnte z.B. mit</p><div class="bash"><div class="contents"><pre class="notranslate">echo "UUID=68560947-b5e5-494d-87e9-0d293d436cea /mnt/disk ext3 users,defaults,noauto   0   0" &gt;&gt; /etc/fstab </pre></div></div><p>dafür gesorgt werden, dass sie nur auf Anforderung eingebunden wird (UUID muss angepasst werden!).</p><div class="bash"><div class="contents"><pre class="notranslate">exit </pre></div></div><p>setzt den Administratoren-Rechten ein Ende. Nach einem Neustart des Systems <em>sollte</em> es sich mit eingesteckter SD-Karte eigenständig entschlüsseln. Bei fehlender Karte sollte nach einem Passwort gefragt werden. Sollte etwas nicht funktionieren, kann aus GRUB heraus jederzeit auf <strong>/boot/initrd.img-2.6.28-15-generic.backup</strong> (u.ä.) zugriffen werden.</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
Diese Anleitung basiert auf Informationen der folgende Seiten:
</p><ul><li><p><a class="external" href="http://www.andreas-janssen.de/cryptodisk.html" rel="nofollow">Festplattenverschlüsselung mit Debian GNU/Linux</a> <img alt="{de}" src="../../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="crosslink topic" href="https://forum.ubuntuusers.de/topic/lsung-fuer-komfortables-veritschluesseln-mit-/">Lösung für komfortables Verschlüsseln mit USB-Stick als Key</a></p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort/a/revision/850323.html">Diese Revision</a> wurde am 16. November 2015 15:53 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../../startseite.html">Wiki</a></li>
<li><a href="../../archiv.html">Archiv</a></li>
<li><a href="../../archiv/system_verschlüsseln.html">System verschlüsseln</a></li>
<li><a href="../../archiv/system_verschlüsseln/system-entschlüsselung_mit_sd-karte_oder_passwort.html">System-Entschlüsselung mit SD-Karte oder Passwort</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>