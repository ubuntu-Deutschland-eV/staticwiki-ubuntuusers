<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/Multiple_Uplink_Routing › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../archiv/multiple_uplink_routing.html">Multiple Uplink Routing</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/Multiple_Uplink_Routing">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../archiv/multiple_uplink_routing/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../archiv/multiple_uplink_routing/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../archiv/multiple_uplink_routing/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../archiv/multiple_uplink_routing/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../archiv/multiple_uplink_routing/a/backlinks.html">Multiple Uplink Routing</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../rechte.html">Rechte für Dateien und Ordner ändern</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Verbindungsteilung">Verbindungsteilung
</a><ol class="arabic"><li><a class="crosslink" href="#Definitionen-zum-Umgang-mit-den-Variablen">Definitionen zum Umgang mit den Variable...</a></li><li><a class="crosslink" href="#Deklaration">Deklaration
</a></li><li><a class="crosslink" href="#Routing">Routing
</a></li></ol></li><li><a class="crosslink" href="#Datenaufteilung">Datenaufteilung
</a></li><li><a class="crosslink" href="#Automatisierung">Automatisierung
</a></li></ol></div><p>Diese Anleitung basiert auf diesem <a class="external" href="http://lartc.org/howto/lartc.rpdb.multiple-links.html" rel="nofollow">Howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> auf lartc.org und erklärt die Benutzung mehrerer Internetprovider über einen Computer.</p><p><img alt="./mpa.jpg" class="image-center" src="../_/49bd4f49d9b644506f8a53d8b55a475dace25c42.jpg"/></p><p><em>Was ist nach dieser Anleitung möglich?</em></p><ul><li><p>Es werden mehrere (2 laut dieser Anleitung) Internetverbindungen von einem Rechner angesprochen. </p></li><li><p>Falls eine Verbindung ausfällt, wird ohne Unterbrechung die Zweite weiterbenutzt. </p></li><li><p>Bei bestimmter Verwendung kann der Uplink beider Leitungen voll genutzt werden. </p></li></ul><p><em>Was ist nach dieser Anleitung nicht möglich?</em></p><ul><li><p>Kanalbündelung (Bonding) im klassischen Sinne. </p></li></ul><p>Die Anfragen, die der Rechner an das Internet stellt, werden nacheinander auf beide Uplinks verteilt, das heißt, dass häufige Anfragen zu ein und derselben Internetseite meist über den selben Provider abgewickelt werden.</p><div class="section_1"><h2 id="Verbindungsteilung">Verbindungsteilung<a class="headerlink" href="#Verbindungsteilung">¶</a></h2><p>
Als erstes bearbeitet man die Datei <strong>/etc/iproute2/rt_tables</strong> in einem Editor mit Root-Rechten <sup><a href="#source-2">[2]</a></sup>. Dort erstellt man zwei neue Routing-Tabellen "T1" und "T2", indem man die Zeilen</p><pre class="notranslate">1     T1
2     T2</pre><p>an das Dateiende anfügt und die Datei speichert.</p><div class="section_2"><h3 id="Definitionen-zum-Umgang-mit-den-Variablen">Definitionen zum Umgang mit den Variablen<a class="headerlink" href="#Definitionen-zum-Umgang-mit-den-Variablen">¶</a></h3><p>
</p><table><tr><td> IF </td><td> Name der Netzwerkschnittstelle </td><td> z.B. <code class="notranslate">eth0</code> </td></tr><tr><td> IP </td><td> IP - Adresse der Netzwerkschnittstelle </td><td> z.B. <code class="notranslate">192.168.0.22</code> </td></tr><tr><td> P </td><td> IP - Adresse des Gateways </td><td> z.B. <code class="notranslate">192.168.0.1</code> </td></tr><tr><td> P_NET </td><td> Adressbereich, in dem sich <em>P</em> befindet </td><td> z.B. <code class="notranslate">192.168.0.0</code> </td></tr><tr><td> P0_NET </td><td> Lokaler Adressbereich </td><td> z.B. <code class="notranslate">127.0.0.0</code> </td></tr><tr><td> IF0 </td><td> Lokale Netzwerkschnittstelle </td><td> z.B. <code class="notranslate">lo</code> </td></tr></table><p>
Alle nötigen Informationen können der Ausgabe <sup><a href="#source-1">[1]</a></sup> von</p><div class="bash"><div class="contents"><pre class="notranslate">ifconfig </pre></div></div><p>entnommen werden.</p></div><div class="section_2"><h3 id="Deklaration">Deklaration<a class="headerlink" href="#Deklaration">¶</a></h3><p>
Da man für die Befehle unten dauerhaft Root-Rechte benötigt, sollte man ein Root-Terminal <sup><a href="#source-1">[1]</a></sup> öffnen (oder andernfalls <a class="internal" href="../sudo.html">sudo</a> vor alle Befehle anstellen). Nun legt man oben genannte Variablen fest, um später Tipparbeit zu sparen. Die Platzhalter [] müssen entsprechend angepasst werden.</p><div class="bash"><div class="contents"><pre class="notranslate">export IF1=[eth0]
export IP1=[192.168.0.22]
export P1=[192.168.0.1]
export P1_NET=[192.168.0.0]

export IF2=[eth1]
export IP2=[192.168.1.33]
export P2=[192.168.1.1]
export P2_NET=[192.168.1.0]

export IF0=[lo]
export P0_NET=[127.0.0.0] </pre></div></div><p>Wenn alle Werte korrekt übernommen sind, können folgende Befehle einfach in das Terminal kopiert werden.</p></div><div class="section_2"><h3 id="Routing">Routing<a class="headerlink" href="#Routing">¶</a></h3><p>
Eventuell müssen noch vorhandene Default-IP-Routen gelöscht werden. Dies geschieht per</p><div class="bash"><div class="contents"><pre class="notranslate">ip route delete default </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Internetverbindung geht hierbei verloren und ist erst nach einem Neustart oder dem erneuten Festlegen wieder verfügbar. 
</p></div></div><p>Bei mehreren Default-Routen muss der Befehl mehrmals ausgeführt werden. Wieviele vorhanden sind, lässt sich mittels</p><div class="bash"><div class="contents"><pre class="notranslate">ip route show </pre></div></div><p>
feststellen. Nun wird das Routing in den Tabellen "T1" und "T2" festgelegt:</p><div class="bash"><div class="contents"><pre class="notranslate">ip route add $P1_NET dev $IF1 src $IP1 table T1
ip route add default via $P1 table T1
ip route add $P2_NET dev $IF2 src $IP2 table T2
ip route add default via $P2 table T2 </pre></div></div><p>Um den korrekten Ursprung der Pakete zu bewahren, nutzt man Folgendes:</p><div class="bash"><div class="contents"><pre class="notranslate">ip route add $P1_NET dev $IF1 src $IP1
ip route add $P2_NET dev $IF2 src $IP2 </pre></div></div><p>Nun wird eingestellt, welche Routing-Tabellen genutzt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">ip rule add from $IP1 table T1
ip rule add from $IP2 table T2 </pre></div></div><p>Folgende Befehle stellen sicher, dass der eingehende Verkehr über ein bestimmtes Interface auch von diesem beantwortet wird:</p><div class="bash"><div class="contents"><pre class="notranslate">ip route add $P0_NET dev $IF0 table T1
ip route add $P2_NET dev $IF2 table T1
ip route add 127.0.0.0/8 dev lo table T1
ip route add $P0_NET dev $IF0 table T2
ip route add $P1_NET dev $IF1 table T2
ip route add 127.0.0.0/8 dev lo table T2 </pre></div></div></div></div><div class="section_1"><h2 id="Datenaufteilung">Datenaufteilung<a class="headerlink" href="#Datenaufteilung">¶</a></h2><p>
Anstelle eines Providers, der als Standard festgelegt wird, wird der Datenstrom nun über beide verteilt. Dies ist also der eigentliche und kürzeste Teil der Arbeit.</p><div class="bash"><div class="contents"><pre class="notranslate">ip route add default scope global nexthop via $P1 dev $IF1 weight 1 nexthop via $P2 dev $IF2 weight 1 </pre></div></div><p>Die <code class="notranslate">weight</code>-Kriterien können je nach Bedarf angepasst werden. Soll z.B. Provider I zu 3/4 und Provider II zu 1/4 genutzt werden, so wären <code class="notranslate">weight 75</code> und <code class="notranslate">weight 25</code> einzustellen.</p></div><div class="section_1"><h2 id="Automatisierung">Automatisierung<a class="headerlink" href="#Automatisierung">¶</a></h2><p>
Die Einstellungen gehen nach jedem Neustart verloren, deshalb ist es sinnvoll sie mit einem Skript zu automatisieren. Außerdem bekommt man von seinem Provider auch oft nur dynamische IPs zugewiesen. Das folgende Skript parst die nötigen Informationen automatisch. Man muss lediglich die Namen der Schnittstellen ändern. Man erstellt dazu eine neue Datei in einem Editor <sup><a href="#source-2">[2]</a></sup> mit folgendem Inhalt:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="nb">export</span> <span class="nv">IF1</span><span class="o">=</span><span class="s2">"raub0"</span><span class="p">;</span> <span class="c1">### &lt;&lt;&lt; Hier ändern</span>
<span class="nb">export</span> <span class="nv">IP1</span><span class="o">=</span><span class="sb">`</span>ifconfig <span class="nv">$IF1</span> <span class="p">|</span> grep <span class="s2">"inet Adresse:"</span><span class="p">|</span>cut -d<span class="s2">":"</span> -f2<span class="p">|</span>cut -d<span class="s2">" "</span> -f1<span class="sb">`</span><span class="p">;</span>
<span class="nb">export</span> <span class="nv">P1</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$IP1</span><span class="s2">| cut -d"</span>.<span class="s2">" -f 1-3`.1"</span><span class="p">;</span>
<span class="nb">export</span> <span class="nv">P1_NET</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$IP1</span><span class="s2">| cut -d"</span>.<span class="s2">" -f 1-3`.0"</span>

<span class="nb">export</span> <span class="nv">IF2</span><span class="o">=</span><span class="s2">"eth1"</span><span class="p">;</span> <span class="c1">### &lt;&lt;&lt; Hier ändern</span>
<span class="nb">export</span> <span class="nv">IP2</span><span class="o">=</span><span class="sb">`</span>ifconfig <span class="nv">$IF2</span> <span class="p">|</span> grep <span class="s2">"inet Adresse:"</span><span class="p">|</span>cut -d<span class="s2">":"</span> -f2<span class="p">|</span>cut -d<span class="s2">" "</span> -f1<span class="sb">`</span><span class="p">;</span>
<span class="nb">export</span> <span class="nv">P2</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$IP2</span><span class="s2">| cut -d"</span>.<span class="s2">" -f 1-3`.1"</span><span class="p">;</span>
<span class="nb">export</span> <span class="nv">P2_NET</span><span class="o">=</span><span class="s2">"`echo </span><span class="nv">$IP2</span><span class="s2">| cut -d"</span>.<span class="s2">" -f 1-3`.0"</span>

<span class="nb">export</span> <span class="nv">IF0</span><span class="o">=</span><span class="s2">"lo"</span><span class="p">;</span>
<span class="nb">export</span> <span class="nv">P0_NET</span><span class="o">=</span><span class="s2">"127.0.0.0"</span><span class="p">;</span>

ip route delete default<span class="p">;</span>
ip route delete default<span class="p">;</span>

ip route add <span class="nv">$P1_NET</span> dev <span class="nv">$IF1</span> src <span class="nv">$IP1</span> table T1<span class="p">;</span>
ip route add default via <span class="nv">$P1</span> table T1<span class="p">;</span>
ip route add <span class="nv">$P2_NET</span> dev <span class="nv">$IF2</span> src <span class="nv">$IP2</span> table T2<span class="p">;</span>
ip route add default via <span class="nv">$P2</span> table T2<span class="p">;</span>

ip route add <span class="nv">$P1_NET</span> dev <span class="nv">$IF1</span> src <span class="nv">$IP1</span><span class="p">;</span>
ip route add <span class="nv">$P2_NET</span> dev <span class="nv">$IF2</span> src <span class="nv">$IP2</span><span class="p">;</span>

ip rule add from <span class="nv">$IP1</span> table T1<span class="p">;</span>
ip rule add from <span class="nv">$IP2</span> table T2<span class="p">;</span>

ip route add <span class="nv">$P0_NET</span> dev <span class="nv">$IF0</span> table T1<span class="p">;</span>
ip route add <span class="nv">$P2_NET</span> dev <span class="nv">$IF2</span> table T1<span class="p">;</span>
ip route add <span class="m">127</span>.0.0.0/8 dev lo table T1<span class="p">;</span>
ip route add <span class="nv">$P0_NET</span> dev <span class="nv">$IF0</span> table T2<span class="p">;</span>
ip route add <span class="nv">$P1_NET</span> dev <span class="nv">$IF1</span> table T2<span class="p">;</span>
ip route add <span class="m">127</span>.0.0.0/8 dev lo table T2<span class="p">;</span>

ip route add default scope global nexthop via <span class="nv">$P1</span> dev <span class="nv">$IF1</span> weight <span class="m">1</span> nexthop via <span class="nv">$P2</span> dev <span class="nv">$IF2</span> weight <span class="m">1</span>

<span class="nb">echo</span> <span class="s2">"done."</span><span class="p">;</span>

<span class="nb">exit</span>
</pre></div>
</td></tr></table></div><p>In dem Skript müssen die Variablen entsprechend angepasst werden. Anschließend speichert man die Datei ab und macht sie ausführbar <sup><a href="#source-3">[3]</a></sup>. Das Skript lässt sich im Terminal mittels</p><div class="bash"><div class="contents"><pre class="notranslate">sudo /PFAD/ZUM/SKRIPTNAMEN </pre></div></div><p>starten. Die Automatisierung sollte über die <a class="internal" href="../rc.local.html">rc.local</a>-Datei geschehen. Dabei ist Folgendes einzufügen:</p><pre class="notranslate">/PFAD/ZUM/SKRIPTNAMEN</pre><p>
Danach wird das Skript bei jedem Systemstart automatisch ausgeführt.</p><p></p></div></div>
<p class="meta">
<a href="../archiv/multiple_uplink_routing/a/revision/833668.html">Diese Revision</a> wurde am 30. August 2015 16:16 von <a href="https://ubuntuusers.de/user/aasche/">aasche</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../archiv.html">Archiv</a></li>
<li><a href="../archiv/multiple_uplink_routing.html">Multiple Uplink Routing</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>