<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Archiv/Authentifizierung_OpenPGP_SmartCard › ubuntuusers statisches Wiki</title>
<link href="../_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="../_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="../_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="../_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="../_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="../_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="../startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="../archiv/authentifizierung_openpgp_smartcard.html">Authentifizierung OpenPGP SmartCard</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Archiv/Authentifizierung_OpenPGP_SmartCard">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="../wiki/index.html">Index</a></li>
<li><a href="../wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="../wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="../wiki.html">Übersicht</a></li>
<li><a href="../wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="../wiki/benutzung.html">Benutzung</a></li>
<li><a href="../kategorien.html">Kategorie</a></li>
<li><a href="../wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="../wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="../howto.html">Howto anlegen</a></li>
<li><a href="../wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="../wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="../baustelle.html">Baustellen</a></li>
<li><a href="../wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="../wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="../wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="../wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="../archiv/authentifizierung_openpgp_smartcard/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="../archiv/authentifizierung_openpgp_smartcard/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="../archiv/authentifizierung_openpgp_smartcard/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="../archiv/authentifizierung_openpgp_smartcard/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="../archiv/authentifizierung_openpgp_smartcard/a/backlinks.html">Authentifizierung OpenPGP SmartCard</a></h1>
<div id="page"><div class="box improvable"><h3 class="box improvable">Archivierte Anleitung</h3><div class="contents"><p>
Dieser Artikel wurde archiviert, da er - oder Teile daraus -
nur noch unter einer älteren Ubuntu-Version nutzbar ist. Diese
Anleitung wird vom Wiki-Team weder auf Richtigkeit überprüft
noch anderweitig gepflegt. Zusätzlich wurde der Artikel für
weitere Änderungen gesperrt.
</p></div></div><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="../pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="../terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="../editor.html">Einen Editor öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#bersicht">Übersicht
</a></li><li><a class="crosslink" href="#Voraussetzung">Voraussetzung
</a></li><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Einrichten-des-CardReaders">Einrichten des CardReaders
</a></li><li><a class="crosslink" href="#Generierung-des-Schluessels">Generierung des Schlüssels
</a></li><li><a class="crosslink" href="#Sicherung-des-Schluessels">Sicherung des Schlüssels
</a></li><li><a class="crosslink" href="#Einrichten-von-PAM-Poldi">Einrichten von PAM Poldi
</a></li><li><a class="crosslink" href="#Konfiguration-von-PAM">Konfiguration von PAM
</a></li><li><a class="crosslink" href="#Problemloesung">Problemlösung
</a><ol class="arabic"><li><a class="crosslink" href="#Segmentation-fault">Segmentation fault
</a></li><li><a class="crosslink" href="#Kdesu">Kdesu
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><div class="section_1"><h2 id="bersicht">Übersicht<a class="headerlink" href="#bersicht">¶</a></h2><p>
<a class="external" href="http://de.wikipedia.org/wiki/Pluggable_Authentication_Modules" rel="nofollow">PAM</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> steht für "Pluggable Authentication Modules". Durch die Nutzung von PAM-Modulen ist man in der Lage, verschiedene Authentifizierungsmechanismen unter Linux zu implementieren. Zum Beispiel: Kerberus, LDAP, Public-Key-Authentication oder SmartCards. Das hier vorgestellte PAM-Modul ermöglicht es, dem Benutzer, sich mit einer <a class="external" href="http://www.g10code.de/p-card.html" rel="nofollow">OpenPGP SmartCard</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> am System zu authentifizieren. Dazu wird PAM Poldi verwendet</p><p>Der Vorteile der Authentifizierung über eine SmartCard ist die erhöhte Sicherheit. Das Ausspähen des Passwortes ist unmöglich. Die Anmeldung ist an die Karte gebunden und kann zusätzlich mit einer PIN abgesichert werden.</p><p>Diese Anleitung basiert auf dem <a class="external" href="https://www.fsfe.org/en/card/howto" rel="nofollow">FSFE Card howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ,  <a class="external" href="http://www.gnupg.org/howtos/card-howto/en/smartcard-howto-single.html" rel="nofollow">GnuPG Card howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> und dem <a class="external" href="http://www.schiessle.org/howto/poldi.shtml" rel="nofollow">PAM Poldi howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> .</p></div><div class="section_1"><h2 id="Voraussetzung">Voraussetzung<a class="headerlink" href="#Voraussetzung">¶</a></h2><p>
Um sich mit einer OpenPGP SmartCard am System zu authentifizieren, braucht man einen SmartCard Reader und eine OpenPGP SmartCard. Eine Liste unterstützter Kartenleser findet man in diesem <a class="external" href="http://www.gnupg.org/howtos/card-howto/en/ch02s02.html" rel="nofollow">HowTo</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> von GnuPG. Eine OpenPGP SmartCard kann man entweder von der <a class="external" href="https://www.fsfe.org/en/card" rel="nofollow">FSFE</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> beziehen oder bei <a class="external" href="http://www.kernelconcepts.de/shop/products/security.shtml?hardware" rel="nofollow">Kernel concepts</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> bestellen.</p></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Für die Authentifizierung über OpenPGP SmartCard und die Verwendung der SmartCard müssen folgende Pakete <sup><a href="#source-1">[1]</a></sup> installiert werden (und alle davon abhängigen Pakete):</p><ul><li><p><strong>gnupg</strong> </p></li><li><p><strong>libpam-poldi</strong> </p></li><li><p><strong>libccid</strong> </p></li></ul><p>
</p></div><div class="section_1"><h2 id="Einrichten-des-CardReaders">Einrichten des CardReaders<a class="headerlink" href="#Einrichten-des-CardReaders">¶</a></h2><p>
Um den Reader zu verwenden müssen die Dateien <a class="external" href="http://www.fsfe.org/en/content/download/15872/77909/file/gnupg-ccid" rel="nofollow">gnupg-ccid</a> <img alt="{dl}" src="../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/> und <a class="external" href="http://www.fsfe.org/en/content/download/17665/125518/file/gnupg-ccid.rules" rel="nofollow">gnupg-ccid.rules</a> <img alt="{dl}" src="../_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/> heruntergeladen werden und in die udev Konfiguration eingefügt werden. Hierfür werden Root-Rechte benötigt. Dazu können folgende Befehle in einem Terminal <sup><a href="#source-2">[2]</a></sup> verwendet werden:</p><div class="bash"><div class="contents"><pre class="notranslate">mkdir smartcard
cd smartcard
wget http://www.fsfe.org/en/content/download/15872/77909/file/gnupg-ccid
wget http://www.fsfe.org/en/content/download/17665/125518/file/gnupg-ccid.rules
sudo cp gnupg-ccid.rules /etc/udev/gnupg-ccid.rules
sudo mkdir /etc/udev/scripts/
sudo cp gnupg-ccid /etc/udev/scripts/gnupg-ccid
sudo chmod +x /etc/udev/scripts/gnupg-ccid
sudo ln -s /etc/udev/gnupg-ccid.rules /etc/udev/rules.d/gnupg-ccid.rules </pre></div></div><p>
Nun sind alle Konfigurationsdateien an der richtigen Stelle und haben die richtigen Benutzerrechte. Um den Kartenleser zu verwenden muss noch eine Gruppe angelegt werden und der Benutzer, der den Kartenleser verwenden soll, zur Gruppe hinzugefügt werden.</p><div class="bash"><div class="contents"><pre class="notranslate">sudo addgroup scard
sudo addgroup &lt;benutzername&gt; scard #(&lt;benutzername&gt; durch den entsprechenden Benutzernamen ersetzen) </pre></div></div><p>
Nun sollte der Kartenleser bei eingelegter Karte ansprechbar sein. Dies kann man mit folgendem Befehl überprüfen: 
</p><div class="bash"><div class="contents"><pre class="notranslate">gpg --card-status </pre></div></div></div><div class="section_1"><h2 id="Generierung-des-Schluessels">Generierung des Schlüssels<a class="headerlink" href="#Generierung-des-Schluessels">¶</a></h2><p>
Um sich am System authentifizieren zu können, muss auf der Karte ein Schlüssel generiert werden (Eine Anleitung zur Verwendung bestehender Schlüssel findet man bei der <a class="external" href="https://www.fsfe.org/en/card/howto/subkey_howto" rel="nofollow">FSFE</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ). Dies geschieht mit folgenden Befehlen:</p><div class="bash"><div class="contents"><pre class="notranslate">gpg --card-edit
admin (Um die Admin Befehle zu erhalten)
generate </pre></div></div><p>
Den Angaben während der Generierung folgen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
Bei der Generierung die Backup Option auswählen, da ohne Backup eine Wiederherstellung des Keys im Falle eines Verlusts oder Defekts der SmartCard unmöglich ist!</p></div></div></div><div class="section_1"><h2 id="Sicherung-des-Schluessels">Sicherung des Schlüssels<a class="headerlink" href="#Sicherung-des-Schluessels">¶</a></h2><p>
Um den generierten Schlüssel zu sichern, sollte er auf einem externen Medium (z.B. USB-Key) gespeichert werden. Dazu die Dateien <strong>~/.gnupg/pubring.gpg</strong> und <strong>~/.gnupg/secring.gpg</strong> auf den USB-Key kopieren:</p><div class="bash"><div class="contents"><pre class="notranslate">cd ~/.gnupg
cp pubring.gpg /path/to/usb-key/pubring.gpg
cp secring.gpg /path/to/usb-key/secring.gpg </pre></div></div><p>
Das Backup-Medium sollte abseits des Rechners an einem sicheren Ort aufbewahrt werden.</p></div><div class="section_1"><h2 id="Einrichten-von-PAM-Poldi">Einrichten von PAM Poldi<a class="headerlink" href="#Einrichten-von-PAM-Poldi">¶</a></h2><p>
Zur Authentifizierung mit OpenPGP SmartCard wird das PAM Poldi Module verwendet. Zur Konfiguration wird die Seriennummer der Karte benötigt. Diese wird bei <strong>gpg --card-status</strong> als <strong>Application ID</strong> angezeigt. Es muss die Karte registriert werden und mit einem Account verbunden werden. Folgende Befehle konfigurieren PAM Poldi (SmartCard muss eingelegt sein).</p><div class="bash"><div class="contents"><pre class="notranslate">sudo poldi-ctrl --register-card --account &lt;benutzername&gt; --serialno &lt;Seriennummer der Karte&gt;
sudo poldi-ctrl --associate --account &lt;benutzername&gt; --serialno &lt;Seriennummer der Karte&gt;
poldi-ctrl --set-key </pre></div></div><p>
Damit ist PAM Poldi konfiguriert und die Authentifizierung kann mit <strong>poldi-ctrl --test</strong> getestet werden.</p></div><div class="section_1"><h2 id="Konfiguration-von-PAM">Konfiguration von PAM<a class="headerlink" href="#Konfiguration-von-PAM">¶</a></h2><p>
Nun muss man nur noch PAM so konfigurieren, dass die Authentifizierung über SmartCard erfolgt. Dazu muss die Datei <strong>/etc/pam.d/common-auth</strong> mit Root-Rechten in einem Editor <sup><a href="#source-3">[3]</a></sup> geöffnet werden. Um sich ausschließlich über die SmartCard zu authentifizieren ändert man</p><pre class="notranslate">auth    required        pam_unix.so nullok_secure</pre><p>
in</p><pre class="notranslate">auth    required        pam_poldi.so quiet</pre><p>
Soll die Authentifizierung auf Passwortabfrage zurückfallen, sollte folgendes eingetragen werden: 
</p><pre class="notranslate">auth    sufficient      pam_poldi.so quiet
auth    required        pam_unix.so nullok_secure</pre><p>
Nun ist die Authentifizierung über PAM Poldi konfiguriert. Dies sollte auf jeden Fall noch getestet werden. Dazu ein neues Terminal öffnen und folgendes ausprobieren:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo -i </pre></div></div><p>
Es ist die PIN der Karte einzugeben. Wenn dieses funktioniert, dann ist die Karte richtig konfiguriert.</p></div><div class="section_1"><h2 id="Problemloesung">Problemlösung<a class="headerlink" href="#Problemloesung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Segmentation-fault">Segmentation fault<a class="headerlink" href="#Segmentation-fault">¶</a></h3><p>
Erhält man bei der Authentifizierung eine Fehlermeldung wie <strong>Segmentation fault</strong> oder es funktioniert überhaupt nicht, hilft es den CardReader neu zu verbinden. Dieses Problem tritt auf, wenn man die Karte zwischenzeitlich in Kombination mit GnuPG verwendet hat.</p></div><div class="section_2"><h3 id="Kdesu">Kdesu<a class="headerlink" href="#Kdesu">¶</a></h3><p>
Seit <a class="internal" href="../gutsy_gibbon.html">Gutsy</a> ist in Kubuntu <strong>kdesu</strong> durch <strong>kdesudo</strong> ersetzt. Leider funktioniert <strong>kdesudo</strong> noch nicht mit PAM Poldi. Das Fenster zum Eingeben der PIN wird nicht geöffnet. Das Problem lässt sich umgehen indem man die <em>try-pin</em> Anweisung in <strong>/etc/pam.d/common-auth</strong> setzt. Leider wird dabei überhaupt nicht mehr nach der PIN gefragt. Anwender mit Programmiererfahrung können auch das Problem im Quelltext direkt beheben.</p><p>Allerdings ist die Funktionalität des ursprünglichen <strong>kdesu</strong> ist hier nun über <strong>kdesu.distrib</strong> verfügbar.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="https://www.fsfe.org/en/card/howto" rel="nofollow">FSFE Card howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.gnupg.org/howtos/card-howto/en/smartcard-howto-single.html" rel="nofollow">GnuPG Card howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.schiessle.org/howto/poldi.shtml" rel="nofollow">PAM Poldi howto</a> <img alt="{en}" src="../_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://ubuntu-blog.at/2010/01/24/openpgp-mit-smartcard-verwenden-gnupg/" rel="nofollow">Neuere Anleitung für OpenPGP mit gpg2 unter Karmic Koala</a> <img alt="{de}" src="../_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="../archiv/authentifizierung_openpgp_smartcard/a/revision/660292.html">Diese Revision</a> wurde am 25. November 2013 19:56 von <a href="https://ubuntuusers.de/user/aasche/">aasche</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="../startseite.html">Wiki</a></li>
<li><a href="../archiv.html">Archiv</a></li>
<li><a href="../archiv/authentifizierung_openpgp_smartcard.html">Authentifizierung OpenPGP SmartCard</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="../_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="../_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="../_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="../_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>