<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Mailserver_testen › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./mailserver_testen.html">Mailserver testen</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Mailserver_testen">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./mailserver_testen/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./mailserver_testen/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./mailserver_testen/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./mailserver_testen/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./mailserver_testen/a/backlinks.html">Mailserver testen</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><p> </p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-2"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Grundlagen">Grundlagen
</a></li><li><a class="crosslink" href="#SMTP-Port-25">SMTP (Port 25)
</a><ol class="arabic"><li><a class="crosslink" href="#Begruessung">Begrüßung
</a></li><li><a class="crosslink" href="#Sitzung-beenden">Sitzung beenden
</a></li><li><a class="crosslink" href="#Server-Faehigkeiten">Server-Fähigkeiten
</a></li><li><a class="crosslink" href="#Verschluesselung">Verschlüsselung
</a></li><li><a class="crosslink" href="#Authentifizierung">Authentifizierung
</a></li><li><a class="crosslink" href="#Mails-verschicken">Mails verschicken
</a></li></ol></li><li><a class="crosslink" href="#POP3-Port-110">POP3 (Port 110)
</a><ol class="arabic"><li><a class="crosslink" href="#Sitzung-beenden-2">Sitzung beenden
</a></li><li><a class="crosslink" href="#Faehigkeiten">Fähigkeiten
</a></li><li><a class="crosslink" href="#Verschluesselung-2">Verschlüsselung
</a></li><li><a class="crosslink" href="#Authentifizierung-2">Authentifizierung
</a></li><li><a class="crosslink" href="#Mails-abrufen">Mails abrufen
</a></li></ol></li><li><a class="crosslink" href="#IMAP-Port-143">IMAP (Port 143)
</a><ol class="arabic"><li><a class="crosslink" href="#Sitzung-beenden-3">Sitzung beenden
</a></li><li><a class="crosslink" href="#Faehigkeiten-2">Fähigkeiten
</a></li><li><a class="crosslink" href="#Verschluesselung-3">Verschlüsselung
</a></li><li><a class="crosslink" href="#Authentifizierung-3">Authentifizierung
</a></li><li><a class="crosslink" href="#Weitere-Befehle">Weitere Befehle
</a></li></ol></li><li><a class="crosslink" href="#SASL-Authentifizierung">SASL-Authentifizierung
</a><ol class="arabic"><li><a class="crosslink" href="#LOGIN-2">LOGIN
</a></li><li><a class="crosslink" href="#PLAIN-2">PLAIN
</a></li><li><a class="crosslink" href="#CRAM-MD5-und-andere-Verfahren">CRAM-MD5 und andere Verfahren
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p>Dieser Artikel handelt davon, wie man mit Hilfe des <strong>telnet</strong>-Clients verschiedene Eigenschaften von Mailservern auf der Kommandozeile testen kann<sup><a href="#source-2">[2]</a></sup>. Dies kann nützlich sein, wenn man einen eigenen Server aufsetzt und dessen Funktionsweise überprüfen will, aber auch um bspw. die Fähigkeiten vom Mailserver des Providers zu ermitteln oder zur Fehlerdiagnose. Hierbei wird mit dem Server direkt in seiner Protokollsprache kommuniziert, wobei die drei gängigen Mail-Protokolle verwendet werden: <a class="external" href="http://de.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol" rel="nofollow">SMTP</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> , <a class="external" href="http://de.wikipedia.org/wiki/Post_Office_Protocol" rel="nofollow">POP3</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> und <a class="external" href="http://de.wikipedia.org/wiki/Internet_Message_Access_Protocol" rel="nofollow">IMAP</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> . Welches Protokoll für welchen Zweck geeignet ist, ist nicht Gegenstand dieses Artikels. Dies wird  als Vorwissen vorausgesetzt (und kann z.B. in der Wikipedia unter den o.a. Links nachgelesen werden).</p><p><a class="crosslink anchor" href="#Grundlagen" id="Grundlagen"></a>
</p><div class="section_1"><h2 id="Grundlagen">Grundlagen<a class="headerlink" href="#Grundlagen">¶</a></h2><p>
Das Programm <strong>telnet</strong> ist bei Ubuntu standardmäßig installiert. Sollte das aus irgendwelchen Gründen nicht der Fall sein, muss folgendes Paket installiert werden<sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>telnet</strong> </p></li></ul><p>Jeder andere Telnet-Client funktioniert natürlich auch.</p><p>Möchte man die erwähnte Methode mit <strong>openssl</strong> ausprobieren, um auch verschlüsselt mit den Servern kommunizieren zu können, so muss auch noch folgendes Paket installiert werden<sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>openssl</strong></p></li></ul><p>
Eigentlich ist Telnet in der Vergangenheit eine unverschlüsselte und deswegen völlig unsichere Möglichkeit gewesen, Rechner aus der Ferne zu administrieren. Das Protokoll wurde aber inzwischen nahezu vollständig vom in jeder Hinsicht überlegenen <a class="internal" href="./ssh.html">SSH</a> verdrängt. Man kann mit dem Telnet-Client aber nicht nur mit Telnet-Servern kommunizieren, sondern auch mit nahezu jedem anderen Server, der ein textbasiertes Protokoll spricht, indem man sich einfach mit dem entsprechenden Port verbindet. Diese Eigenschaft wird hier genutzt.</p><p>Das funktioniert einfach so (Beispiel):  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ telnet mail.gmx.de 25
Trying 213.165.64.20...
Connected to mail.gmx.net.
Escape character is '^]'.
220 mail.gmx.net GMX Mailservices ESMTP {mp020} </pre></div></div><p>
In diesem Beispiel wurde mit dem SMTP-Port 25 des Servers mail.gmx.de verbunden, der dann auch sofort mit einer Statusmeldung antwortet und auf weitere Befehle wartet. Diese Befehle unterscheiden sich natürlich je nach Protokoll.</p><p><a class="crosslink anchor" href="#smtp" id="smtp"></a>
</p></div><div class="section_1"><h2 id="SMTP-Port-25">SMTP (Port 25)<a class="headerlink" href="#SMTP-Port-25">¶</a></h2><p>
Das <em>Simple Mail Transfer Protocol (SMTP)</em> besteht aus nacheinander ausgeführten Befehlen, die vom Server jeweils mit einem Statuscode beantwortet werden. Nach dem Statuscode folgt immer auch eine menschenlesbare Beschreibung, die aber für das Protokoll irrelevant ist. Statuscodes, die mit einer <code class="notranslate"></code>2<code class="notranslate"></code> beginnen, signalisieren einen Erfolg der Aktion, eine <code class="notranslate"></code>3<code class="notranslate"></code> bedeutet, dass noch Informationen fehlen, eine <code class="notranslate"></code>5<code class="notranslate"></code> bezeichnet einen Fehler. Werden Statuscode und Beschreibung durch ein Minuszeichen verbunden, so bedeutet das, dass die Ausgabe des Servers noch nicht zu Ende ist. Folgt auf den Code dagegen ein Leerzeichen, so wartet der Server auf den nächsten Befehl.</p><div class="section_2"><h3 id="Begruessung">Begrüßung<a class="headerlink" href="#Begruessung">¶</a></h3><p>
Als erstes erwartet der Server, dass man ihn mit einem anständigen <code class="notranslate"></code>HELO<code class="notranslate"></code> begrüßt. Als Argument sollte man eigentlich den eigenen Rechnernamen angeben. In den allermeisten Fällen ist es aber völlig egal, was für eine Zeichenkette man verwendet. Evtl. erzeugt ein ungültiger HELO-Name einen leicht erhöhten Wert im Spamfilter des Empfängers.  
</p><div class="bash"><div class="contents"><pre class="notranslate">helo test
250 mail.gmx.net GMX Mailservices {mp053} </pre></div></div><div class="section_3"><h4 id="EHLO">EHLO<a class="headerlink" href="#EHLO">¶</a></h4><p>
Das SMTP-Protokoll wurde mit der Zeit erweitert, da es in seiner ursprünglichen Form (zu einer Zeit, als es noch keinen Spam gab) u.a. weder Authentifizierung noch Verschlüsselung besaß. Möchte man diese Erweiterungen nutzen, so muss man sich statt mit <code class="notranslate"></code>HELO<code class="notranslate"></code> mit dem Befehl <code class="notranslate"></code>EHLO<code class="notranslate"></code> (Abk. für <em>Enhanced HELO</em>) anmelden.  
</p></div></div><div class="section_2"><h3 id="Sitzung-beenden">Sitzung beenden<a class="headerlink" href="#Sitzung-beenden">¶</a></h3><p>
Eine SMTP-Sitzung beendet man mit dem einfachen Befehl <code class="notranslate"></code>QUIT<code class="notranslate"></code>.  
</p><div class="bash"><div class="contents"><pre class="notranslate">quit
221 2.0.0 GMX Mailservices {mp006}
Connection closed by foreign host. </pre></div></div></div><div class="section_2"><h3 id="Server-Faehigkeiten">Server-Fähigkeiten<a class="headerlink" href="#Server-Faehigkeiten">¶</a></h3><p>
Die Fähigkeiten des Servers, was Verschlüsselung, Authentifizierung etc. angeht, werden als Antwort auf den <code class="notranslate"></code>EHLO<code class="notranslate"></code>-Befehl gesendet. Der <code class="notranslate"></code>HELO<code class="notranslate"></code>-Befehl gibt sich dagegen schweigsam.</p></div><div class="section_2"><h3 id="Verschluesselung">Verschlüsselung<a class="headerlink" href="#Verschluesselung">¶</a></h3><p>
Wenn in der <code class="notranslate"></code>EHLO<code class="notranslate"></code>-Ausgabe das Schlüsselwort <code class="notranslate"></code>STARTTLS<code class="notranslate"></code> auftaucht, unterstützt der Server die Verschlüsselung. Testen kann man das allerdings über Telnet nicht, da der Server nach Eingabe dieses Befehls nur noch verschlüsselte Daten akzeptiert und jegliche Klartextbefehle mit einer Unterbrechung der Verbindung quittiert.</p><p>Zum Testen der verschlüsselten Kommunikation kann man stattdessen <strong>openssl</strong> benutzen. Ein c't Artikel, der die Vorgehensweise beschreibt, ist <a class="crosslink" href="#Links">unten</a> verlinkt.</p></div><div class="section_2"><h3 id="Authentifizierung">Authentifizierung<a class="headerlink" href="#Authentifizierung">¶</a></h3><p>
Das normale SMTP-Protokoll ohne ESMTP-Erweiterung unterstützt überhaupt keine Authentifizierung. Heutzutage ist das auf Grund der Spamproblematik leider meistens nicht mehr tragbar. Eine Ausnahme gestattet in der Regel nur der eigene Internet-Zugangsprovider, der einen ja bei Missbrauch jederzeit über die IP-Adresse identifizieren kann.</p><p>Zwei SASL-Mechanismen eignen sich zum testen, <code class="notranslate"></code>LOGIN<code class="notranslate"></code> und <code class="notranslate"></code>PLAIN<code class="notranslate"></code>. Wie man die notwendigen Base64-Codierungen vornimmt, steht weiter unten im Abschnitt <a class="crosslink" href="#sasl">SASL</a>.  
</p><div class="section_3"><h4 id="LOGIN">LOGIN<a class="headerlink" href="#LOGIN">¶</a></h4><p>
Für die <code class="notranslate"></code>LOGIN<code class="notranslate"></code>-Authentifizierung sendet man den Befehl <code class="notranslate"></code>auth login<code class="notranslate"></code> mit dem base64-codierten Benutzernamen an den Server. Dieser antwortet mit einer kryptischen Zeichenkette, die die Base64-Entsprechung des Wortes "Password:" ist. Man muss mit dem base64-codierten Passwort antworten:  
</p><div class="bash"><div class="contents"><pre class="notranslate">auth login YmVudXR6ZXJuYW1l          # "benutzername" base64-codiert
334 UGFzc3dvcmQ6
cGFzc3dvcnQ=                         # "passwort" base64-codiert
235 2.7.0 Go ahead {mp030} </pre></div></div><p>
Der 2xx-Statuscode zeigt den Erfolg an.  
</p></div><div class="section_3"><h4 id="PLAIN">PLAIN<a class="headerlink" href="#PLAIN">¶</a></h4><p>
Bei der <code class="notranslate"></code>PLAIN<code class="notranslate"></code>-Authentifizierung muss nur eine Zeichenkette übertragen werden. Zur Zusammensetzung derselben <a class="crosslink" href="#sasl">s.u.</a>:  
</p><div class="bash"><div class="contents"><pre class="notranslate">auth plain YmVudXR6ZXJuYW1lAGJlbnV0emVybmFtZQBwYXNzd29ydA==
235 2.7.0 Go ahead {mp031} </pre></div></div></div></div><div class="section_2"><h3 id="Mails-verschicken">Mails verschicken<a class="headerlink" href="#Mails-verschicken">¶</a></h3><p>
Hat man sich erstmal authentifiziert (oder braucht man das nicht, weil man einen Mailserver im eigenen Heimnetz oder den des Zugangsproviders verwendet), so kann man anfangen, Emails zu versenden. Dafür benötigt man der Reihe nach die drei Befehle <code class="notranslate"></code>MAIL FROM:<code class="notranslate"></code>, <code class="notranslate"></code>RCPT TO:<code class="notranslate"></code> und <code class="notranslate"></code>DATA<code class="notranslate"></code>. Die ersten beiden erwarten jeweils eine Email-Adresse, die in spitze Klammern eingeschlossen werden muss. Es sind mehrere <code class="notranslate"></code>RCPT TO:<code class="notranslate"></code>-Befehle möglich, um die Mail an mehrere Empfänger zu versenden. Ein Beispiel:  
</p><div class="bash"><div class="contents"><pre class="notranslate">mail from: &lt;abc@example.com&gt;
250 2.1.0 Ok
rcpt to: &lt;mail@example.net&gt;
250 2.1.5 Ok
rcpt to: &lt;irgendwer@example.org&gt;
250 2.1.5 Ok
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
From: Test &lt;abc@example.com&gt;
To: xyz &lt;xyz@example.com&gt;
Subject: Test

test
.
250 2.0.0 Ok: queued as 8EA2D30AC20 </pre></div></div><p>
Der <code class="notranslate"></code>DATA<code class="notranslate"></code>-Block endet mit einem einzelnen Punkt in einer eigenen Zeile. Am Anfang des <code class="notranslate"></code>DATA<code class="notranslate"></code>-Blocks kann man der Mail noch beliebige Kopfzeilen mit auf den Weg geben. <em>From</em>, <em>To</em> und <em>Subject</em> sind z.B. sinnvoll.  
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>
Die Mail-Adressen, die man in diese Kopfzeilen einträgt, sind völlig unabhängig von den eigentlichen Absendern und Empfängern, die man per <code class="notranslate">MAIL FROM:</code> und <code class="notranslate">RCPT TO:</code> eingetragen hat! So einfach ist Adressfälschen. <img alt=";)" src="./_/50dff8893f8acddee70889bfa0f88e69aec2395a.png"/></p></div></div><p>
Wenn alles funktioniert, kann man sich auf diese Art eine Testmail schicken.</p><p><a class="crosslink anchor" href="#pop3" id="pop3"></a>
</p></div></div><div class="section_1"><h2 id="POP3-Port-110">POP3 (Port 110)<a class="headerlink" href="#POP3-Port-110">¶</a></h2><p>
Auch beim <em>Post Office Protocol Version 3 (POP3)</em> werden die Befehle einfach in das Terminal getippt. Im Gegensatz zu SMTP kennt POP3 keine "Begrüßungsformel", sondern man kann gleich mit seinem Anliegen loslegen.  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ telnet pop.gmx.de 110
Trying 213.165.64.22...
Connected to pop.gmx.net.
Escape character is '^]'.
+OK GMX POP3 StreamProxy ready &lt;25552.1196273073@mp045&gt; </pre></div></div><p>
Ein POP3-Server beantwortet jeden Befehl mit einem der beiden Codes <code class="notranslate"></code>+OK<code class="notranslate"></code> und <code class="notranslate"></code>-ERR<code class="notranslate"></code>, an denen man erkennen kann, ob der Befehl erfolgreich war. Der Rest der Zeile ist wiederum nur ein für Menschen interessanter Kommentar ohne protokollbezogene Relevanz.</p><p>Möchte der Server weitere Daten ausgeben, z.B. eine Liste vorhandener Mails oder eine bestimmte Mail selber, so schreibt er diese einfach anschließend hinaus. Das Ende der Serverausgabe wird dabei durch einen einzelnen Punkt auf einer eigenen Zeile gekennzeichnet.  
</p><div class="section_2"><h3 id="Sitzung-beenden-2">Sitzung beenden<a class="headerlink" href="#Sitzung-beenden-2">¶</a></h3><p>
Auch bei POP3 lautet der Befehl zum Beenden der Sitzung <code class="notranslate"></code>QUIT<code class="notranslate"></code>.  
</p><div class="bash"><div class="contents"><pre class="notranslate">quit
+OK GMX POP3 server signing off
Connection closed by foreign host. </pre></div></div></div><div class="section_2"><h3 id="Faehigkeiten">Fähigkeiten<a class="headerlink" href="#Faehigkeiten">¶</a></h3><p>
Eine Liste der Fähigkeiten des Servers erhält man mit dem Befehl <code class="notranslate"></code>CAPA<code class="notranslate"></code> (für <em>capabilities</em>):  
</p><div class="bash"><div class="contents"><pre class="notranslate">capa
+OK
STLS
TOP
USER
SASL LOGIN CRAM-MD5
UIDL
RESP-CODES
. </pre></div></div><p>
Die Fähigkeit zu APOP (s.u.) erkennt man bereits am APOP-Zeitstempel in der Begrüßung. (Steht in spitzen Klammern und sieht z.B. so aus: <code class="notranslate"></code>&lt;622.1205709759@mp050&gt;<code class="notranslate"></code>)</p></div><div class="section_2"><h3 id="Verschluesselung-2">Verschlüsselung<a class="headerlink" href="#Verschluesselung-2">¶</a></h3><p>
Der Befehl zur Verschlüsselung der Sitzung heißt <code class="notranslate"></code>STLS<code class="notranslate"></code>, kann aber aus den im Abschnitt SMTP angegebenen Gründen nur schwerlich via Telnet getestet werden (abgesehen davon, dass man überprüfen kann, ob der Server danach wirklich keine unverschlüsselten Befehle mehr akzeptiert).</p><p>Auch hier hilft <strong>openssl</strong>. Ein c't Artikel, der die Vorgehensweise beschreibt, ist <a class="crosslink" href="#Links">unten</a> verlinkt.</p></div><div class="section_2"><h3 id="Authentifizierung-2">Authentifizierung<a class="headerlink" href="#Authentifizierung-2">¶</a></h3><p>
Es gibt mehrere Authentifizierungsvarianten bei POP3. Die einfachste ist die normale über Benutzername und Passwort. Wenn die Verbindung als ganzes aber nicht verschlüsselt ist, können Lauscher das Passwort abfangen. Deswegen wurde das sichere APOP-Verfahren erfunden. Viele POP3-Server und -Clients unterstützen inzwischen auch <a class="crosslink" href="#sasl">SASL</a>.  
</p><div class="section_3"><h4 id="USER">USER<a class="headerlink" href="#USER">¶</a></h4><p>
Bei der USER-Methode werden einfach nacheinander ein <code class="notranslate"></code>USER<code class="notranslate"></code>- und ein <code class="notranslate"></code>PASS<code class="notranslate"></code>-Befehl eingesetzt, z.B. so:  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ telnet pop.gmx.de 110
Trying 213.165.64.22...
Connected to pop.gmx.net.
Escape character is '^]'.
+OK GMX POP3 StreamProxy ready &lt;19622.1205709759@mp050&gt;
user beispiel@gmx.de
+OK May I have your password, please?
pass gEhEiM!
+OK Mailbox locked and ready </pre></div></div></div><div class="section_3"><h4 id="APOP">APOP<a class="headerlink" href="#APOP">¶</a></h4><p>
Beim APOP-Verfahren wird der Zeitstempel mit dem Passwort verknüpft und ein MD5-Hash daraus gebildet. Dieser wird an Stelle des Passworts übertragen. Um den Hash zu errechnen, öffnet man am besten ein zweites Terminal, benutzt den folgenden Befehl und nutzt dann die Zwischenablage, um den Hash in die POP3-Sitzung einzufügen:  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ echo -n '&lt;19622.1205709759@mp050&gt;gEhEiM!' | md5sum -
20376e3ca8d030b31e1fda962a4dfcfb  - </pre></div></div><p>
Das Passwort wird direkt ohne Leerzeichen an den Zeitstempel (inkl. spitzen Klammern) angehängt. Außerdem ist das <code class="notranslate"></code>-n<code class="notranslate"></code> wichtig, damit der <code class="notranslate"></code>echo<code class="notranslate"></code>-Befehl keinen verfälschenden Zeilenendecode einfügt und die Zeichenkette in einfache Anführungszeichen gesetzt wird.</p><p>Der eigentliche <code class="notranslate"></code>APOP<code class="notranslate"></code>-Befehl verlangt zwei Argumente, nämlich den Benutzernamen und den Hash:  
</p><div class="bash"><div class="contents"><pre class="notranslate">apop loginname 20376e3ca8d030b31e1fda962a4dfcfb
+OK Mailbox locked and ready </pre></div></div></div><div class="section_3"><h4 id="SASL">SASL<a class="headerlink" href="#SASL">¶</a></h4><p>
Eine SASL-Authentifizierungsmethode (#sasl s.u.) wird durch den <code class="notranslate"></code>AUTH<code class="notranslate"></code>-Befehl eingeleitet. Hier eine Beispielauthentifizierung mit der LOGIN-Methode:  
</p><div class="bash"><div class="contents"><pre class="notranslate">auth login                 # LOGIN-Methode einleiten
+ VXNlcm5hbWU6             # "Username:" in Base64
YmVudXR6ZXJuYW1l           # Base64-kodierter Benutzername
+ UGFzc3dvcmQ6             # "Password:" in Base64
cGFzc3dvcnQ=               # Base64-kodiertes Passwort
+OK Mailbox locked and ready </pre></div></div></div></div><div class="section_2"><h3 id="Mails-abrufen">Mails abrufen<a class="headerlink" href="#Mails-abrufen">¶</a></h3><p>
Email direkt über POP3 lesen ist nicht besonders komfortabel und deswegen wenig sinnvoll. Deswegen hier nur eine kurze tabellarische Aufstellung der wichtigsten Befehle:</p><table style="width: 97%"><tr class="kopf"><td> <em>Befehl</em> </td><td> <em>Serverantwort</em> </td></tr><tr><td> <code class="notranslate"></code>STAT<code class="notranslate"></code> </td><td> Anzahl der Mails und Auslastung der Mailbox in Bytes </td></tr><tr><td> <code class="notranslate"></code>LIST<code class="notranslate"></code> </td><td> Liste der vorhandenen Mails, jeweils Nummer und Größe der Nachricht </td></tr><tr><td> <code class="notranslate"></code>RETR<code class="notranslate"></code> <em>nr</em> </td><td> Vollständige Mail mit der betreffenden Nummer </td></tr><tr><td> <code class="notranslate"></code>TOP<code class="notranslate"></code> <em>nr</em> <em>zahl</em> </td><td> Nur Beginn der Mail <em>nr</em>. Vollständiger Header plus <em>zahl</em> Zeilen des eigentlichen Inhalts </td></tr><tr><td> <code class="notranslate"></code>DELE<code class="notranslate"></code> <em>nr</em> </td><td> Markiert die betreffende Mail auf dem Server als gelöscht </td></tr></table><p>
<a class="crosslink anchor" href="#imap" id="imap"></a>
</p></div></div><div class="section_1"><h2 id="IMAP-Port-143">IMAP (Port 143)<a class="headerlink" href="#IMAP-Port-143">¶</a></h2><p>
Das <em>Internet Message Access Protocol (IMAP)</em> unterscheidet sich etwas von den anderen beiden, weil man vor jeden Befehl noch eine Zeilennummer setzen muss. Ohne Zeilennummer quittiert der Server jeden Befehl mit einer Fehlermeldung (tatsächlich kann man als Zeilennummer eine beliebige Zeichenfolge eintragen, und diese muss auch nicht eindeutig sein). Die Antwort des Servers beginnt dann stets mit derselben Nummer, gefolgt von einem einzelnen Schlüsselwort über den Erfolg des Befehls (<code class="notranslate"></code>OK<code class="notranslate"></code>, <code class="notranslate"></code>BAD<code class="notranslate"></code>, <code class="notranslate"></code>NO<code class="notranslate"></code>, etc.) und dem obligatorischen Kommentar. Bei inhaltlichen Antworten, z.B. Listen, beginnt jede Zeile mit einem <code class="notranslate"></code>*<code class="notranslate"></code> und dem Namen des Befehls. Anders als bei POP3 wird die Statusmeldung erst am Ende gesendet und zeigt dieses Ende gleichzeitig an.  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ telnet imap.gmx.de 143
Trying 213.165.64.23...
Connected to imap.gmx.net.
Escape character is '^]'.
* OK GMX IMAP4 StreamProxy ready. </pre></div></div><div class="section_2"><h3 id="Sitzung-beenden-3">Sitzung beenden<a class="headerlink" href="#Sitzung-beenden-3">¶</a></h3><p>
Der Befehl zum Beenden einer IMAP-Sitzung heißt <code class="notranslate"></code>LOGOUT<code class="notranslate"></code>.  
</p><div class="bash"><div class="contents"><pre class="notranslate">logout
logout BAD unable to parse command        # Zeilennummer vergessen ;)
02 logout
* BYE GMX IMAP4 StreamProxy terminating connection
02 OK LOGOUT completed </pre></div></div></div><div class="section_2"><h3 id="Faehigkeiten-2">Fähigkeiten<a class="headerlink" href="#Faehigkeiten-2">¶</a></h3><p>
Eine Auflistung verschiedener Fähigkeiten des Servers liefert der Befehl <code class="notranslate"></code>CAPABILITY<code class="notranslate"></code>. U.a. kann man so in Erfahrung bringen, ob der Server TLS-Verschlüsselung unterstützt (<code class="notranslate"></code>STARTTLS<code class="notranslate"></code>) oder SASL-Authentifizierung (<code class="notranslate"></code>AUTH=Methode<code class="notranslate"></code>):  
</p><div class="bash"><div class="contents"><pre class="notranslate">aa capability                     # "a" ist die Zeilennummer
* CAPABILITY IMAP4 IMAP4rev1 ACL QUOTA LITERAL+ MAILBOX-REFERRALS NAMESPACE UIDPLUS ID NO_ATOMIC_RENAME UNSELECT CHILDREN MULTIAPPEND SORT THREAD=ORDEREDSUBJECT THREAD=REFERENCES IDLE STARTTLS AUTH=NTLM AUTH=DIGEST-MD5 AUTH=CRAM-MD5 ANNOTATEMORE
aa OK Completed </pre></div></div></div><div class="section_2"><h3 id="Verschluesselung-3">Verschlüsselung<a class="headerlink" href="#Verschluesselung-3">¶</a></h3><p>
Die Verschlüsselung lässt sich über den <code class="notranslate"></code>STARTTLS<code class="notranslate"></code>-Befehl aktivieren, aber nicht per Telnet ausprobieren:  
</p><div class="bash"><div class="contents"><pre class="notranslate">bb starttls
bb OK Begin TLS negotiation now
tls-test
test
bb NO Starttls negotiation failed
* BAD Invalid tag </pre></div></div><p>Zum Testen der verschlüsselten Kommunikation kann man stattdessen <strong>openssl</strong> benutzen. Ein c't Artikel, der die Vorgehensweise beschreibt, ist <a class="crosslink" href="#Links">unten</a> verlinkt.</p></div><div class="section_2"><h3 id="Authentifizierung-3">Authentifizierung<a class="headerlink" href="#Authentifizierung-3">¶</a></h3><p>
</p><div class="section_3"><h4 id="Unverschluesselt">Unverschlüsselt<a class="headerlink" href="#Unverschluesselt">¶</a></h4><p>
Die einfachste, aber unsichere Methode sich zu authentifizieren, ist die <code class="notranslate"></code>LOGIN<code class="notranslate"></code>-Methode. Dem <code class="notranslate"></code>LOGIN<code class="notranslate"></code>-Befehl werden einfach Benutzername und Passwort als Argumente übergeben:  
</p><div class="bash"><div class="contents"><pre class="notranslate">cc login name gEhEiM! 
cc OK User logged in </pre></div></div></div><div class="section_3"><h4 id="SASL-2">SASL<a class="headerlink" href="#SASL-2">¶</a></h4><p>
Sicherer ist die Authentifizierung über kryptografische SASL-Methoden wie <em>Digest-MD5</em> oder <em>Cram-MD5</em>. Es gibt aber auch unverschlüsselte SASL-Verfahren wie <code class="notranslate"></code>PLAIN<code class="notranslate"></code> oder <code class="notranslate"></code>LOGIN<code class="notranslate"></code>, die zum Testen verwendet werden können. Aktiviert wird eine derartige Methode über den <code class="notranslate"></code>AUTHENTICATE<code class="notranslate"></code>-Befehl, der den Namen der Methode als Argument verlangt. Zur Zusammensetzung der SASL-Zeichenkette <a class="crosslink" href="#sasl">s.u.</a>
</p><div class="bash"><div class="contents"><pre class="notranslate">bb authenticate login      # SASL-Methode LOGIN
+ VXNlcm5hbWU6            # "Username:" base64-kodiert
YmVudXR6ZXJuYW1l          # benutzername    -"-
+ UGFzc3dvcmQ6            # "Password:"     -"-
Z0VoRWlNIQ==              # gEhEiM!         -"-
bb OK User logged in </pre></div></div></div></div><div class="section_2"><h3 id="Weitere-Befehle">Weitere Befehle<a class="headerlink" href="#Weitere-Befehle">¶</a></h3><p>
Das IMAP-Protokoll ist weitaus komplexer als bspw. POP3, weil es u.a. mit verschachtelten Ordnerstrukturen, verschiedenen Markierungen für Emails usw. umgehen muss. Wer sich dafür interessiert, wie man das auf Protokollebene handhabt, sollte sich den <a class="external" href="http://tools.ietf.org/html/rfc3501" rel="nofollow">betreffenden RFC</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> durchlesen.</p><p><a class="crosslink anchor" href="#sasl" id="sasl"></a>
</p></div></div><div class="section_1"><h2 id="SASL-Authentifizierung">SASL-Authentifizierung<a class="headerlink" href="#SASL-Authentifizierung">¶</a></h2><p>
Alle hier vorgestellten Emailprotokolle unterstützen (zumindest optional) das sogenannte <a class="external" href="http://de.wikipedia.org/wiki/SASL" rel="nofollow">Simple Authentication and Security Layer</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> Protokoll zur Authentifizierung (was aber nicht unbedingt heißt, dass auch jeder Server es einsetzt). SASL ist ein erweiterbares Protokoll, was seinerseits verschiedene Authentifizierungsarten ermöglicht. Welche davon ein Server unterstützt, kann man durch Abfrage seiner Fähigkeiten (s.o.) herausfinden.</p><div class="section_2"><h3 id="LOGIN-2">LOGIN<a class="headerlink" href="#LOGIN-2">¶</a></h3><p>
Beim <code class="notranslate"></code>LOGIN<code class="notranslate"></code>-Verfahren werden Benutzername und Passwort getrennt und unverschlüsselt übertragen. Um keine Probleme mit Sonderzeichen zu haben, werden die beiden Zeichenketten jedoch mit dem Base64-Verfahren codiert. Das kann man auf der Kommandozeile mit Hilfe des Perl-Interpreters simulieren:  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ perl -e 'use MIME::Base64; print encode_base64(q"benutzername");'
YmVudXR6ZXJuYW1l
$ perl -e 'use MIME::Base64; print encode_base64(q"passwort");'
cGFzc3dvcnQ= </pre></div></div><p>
Diese beiden Befehle sind mit den eigenen Benutzerdaten auszuführen und die resultierenden Zeichenketten dann am besten per Zwischenablage zum geeigneten Zeitpunkt in die Mail-Sitzung einzufügen.  
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>
Obwohl die Base64-Zeichenketten kryptisch aussehen, stellen sie keine Verschlüsselung dar und können von jedem Lauscher z.B. mit dem <code class="notranslate">decode_base64</code>-Befehl von Perl wieder in Klartext zurückverwandelt werden.</p></div></div></div><div class="section_2"><h3 id="PLAIN-2">PLAIN<a class="headerlink" href="#PLAIN-2">¶</a></h3><p>
Auch beim <code class="notranslate"></code>PLAIN<code class="notranslate"></code>-Verfahren werden die Daten nicht verschlüsselt. Statt zwei Zeichenketten hintereinander zu übertragen, werden Benutzername und Passwort aber in einer einzigen Base64-Zeichenkette kombiniert. Diese besteht aus dem doppelten Benutzernamen (wenn man mit einem master Benutzer einsteigt, ist der erste Benutzername als der man sich ausgeben möchte) und dem Passwort, jeweils getrennt durch ein Nullbyte, in Perl geschrieben so:  
</p><div class="bash"><div class="contents"><pre class="notranslate">$ perl -e 'use MIME::Base64; print encode_base64(join "\0", qw"benutzername benutzername passwort");'
YmVudXR6ZXJuYW1lAGJlbnV0emVybmFtZQBwYXNzd29ydA== </pre></div></div><p>
Der Login würde dann wie folgt erfolgen:
</p><div class="bash"><div class="contents"><pre class="notranslate">bb authenticate plain YmVudXR6ZXJuYW1lAGJlbnV0emVybmFtZQBwYXNzd29ydA==
bb OK User logged in </pre></div></div><p>
</p></div><div class="section_2"><h3 id="CRAM-MD5-und-andere-Verfahren">CRAM-MD5 und andere Verfahren<a class="headerlink" href="#CRAM-MD5-und-andere-Verfahren">¶</a></h3><p>
<code class="notranslate"></code>CRAM-MD5<code class="notranslate"></code> und <code class="notranslate"></code>DIGEST-MD5<code class="notranslate"></code> sind dagegen Beispiele für sichere SASL-Authentifizierungsverfahren, da sie auf einem kryptografischen <a class="external" href="http://de.wikipedia.org/wiki/Challenge-Response-Verfahren" rel="nofollow">Challenge-Response-Verfahren</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> beruhen. Leider sind sie deswegen auch wesentlich komplizierter "von Hand" zu erledigen, was hier deswegen nicht beschrieben wird.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Wer die in diesem Artikel beschriebenen Tests unbedingt über ein unsicheres Medium ausführen muss (und sich nicht z.B. per <a class="internal" href="./ssh.html">SSH</a> einloggen und <em>localhost</em> testen kann) oder die Methode mit <strong>openssl</strong> anwendet, erzeugt sich am besten einen Extra-Account nur für diese Tests, der hinterher wieder deaktiviert werden kann.  
</p></div></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.heise.de/security/artikel/E-Mail-Verschluesselung-austesten-785451.html" rel="nofollow">c't Artikel: E-Mail Verschlüsselung austesten</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="external" href="http://tools.ietf.org/html/rfc1939" rel="nofollow">RFC 1939 - Post Office Protocol - Version 3</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://tools.ietf.org/html/rfc2821" rel="nofollow">RFC 2821 - Simple Mail Transfer Protocol</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://tools.ietf.org/html/rfc3501" rel="nofollow">RFC 3501 - Internet Message Access Protocol - Version 4rev1</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://tools.ietf.org/html/rfc4422" rel="nofollow">RFC 4422 - Simple Authentication and Security Layer (SASL)</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li></ul><p></p></div></div>
<p class="meta">
<a href="./mailserver_testen/a/revision/466417.html">Diese Revision</a> wurde am 26. August 2012 14:57 von <a href="https://ubuntuusers.de/user/aasche/">aasche</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./mailserver_testen.html">Mailserver testen</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>