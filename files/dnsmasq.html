<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Dnsmasq › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./dnsmasq.html">Dnsmasq</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Dnsmasq">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./dnsmasq/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./dnsmasq/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./dnsmasq/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./dnsmasq/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./dnsmasq/a/backlinks.html">Dnsmasq</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p> 
Dieser Artikel ist größtenteils für alle Ubuntu-Versionen gültig.
</p></div></div><p>
</p><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./sudo.html">Root-Rechte erlangen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Konfiguration-als-DNS-Server">Konfiguration als DNS-Server
</a></li><li><a class="crosslink" href="#Konfiguration-als-DHCP-Server">Konfiguration als DHCP-Server
</a></li><li><a class="crosslink" href="#Konfigurationsaenderungen-aktivieren">Konfigurationsänderungen aktivieren
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="./dnsmasq_icon.png" class="image-left" src="./_/1d39d0793bfc4243961e767803b16a5da56be507.png"/>
<a class="external" href="http://thekelleys.org.uk/dnsmasq/doc.html" rel="nofollow">dnsmasq</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein einfacher DNS- und DHCP-Server für kleine Netzwerke. Es werden die Namen aus dem lokalen Netz entsprechend der Datei <a class="internal" href="./hosts.html">/etc/hosts</a> aufgelöst. Unbekannte Namensanfragen werden weitergeleitet und im Cache gespeichert.</p><p>Dnsmasq ist somit:
</p><ul><li><p>ein Nameserver-Forwarder</p></li><li><p>ein DHCP-Server</p></li><li><p>ein Namenscache</p></li><li><p>optimiert für Netzwerke mit Dialup-Außenverbindung</p></li></ul><p>
</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Das Programm ist in den offiziellen Paketquellen enthalten. Es kann über das folgende Paket installiert <sup><a href="#source-1">[1]</a></sup> werden:</p><ul><li><p><strong>dnsmasq</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install dnsmasq </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install dnsmasq </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Konfiguration-als-DNS-Server">Konfiguration als DNS-Server<a class="headerlink" href="#Konfiguration-als-DNS-Server">¶</a></h2><p>
Dnsmasq greift zur lokalen Namensauflösung auf die Datei <strong><a class="internal" href="./hosts.html">/etc/hosts</a></strong> zurück. Daher sollte man diese mit einem Editor <sup><a href="#source-2">[2]</a></sup> und Root-Rechten bearbeiteten <sup><a href="#source-3">[3]</a></sup> und Zeilen in dieser Art hinzufügen.</p><pre class="notranslate">## Lokales Netzwerk
#  = IP =     =  Domainname =    = Rechnername =
192.168.1.1     router.example.org   router           ## Router
192.168.1.2     neo.example.org      neo              ## Workstation
192.168.1.3     felidae.example.org  felidae          ## ein Client-Rechner
192.168.1.5     link.example.org     link             ## Notebook
192.168.1.11    zeus.example.org     zeus             ## Der Server
192.168.1.66    bridge.example.org   bridge           ## WLAN-Brücke</pre><p>Als Beispiel-Domain wird <em>"example.org"</em> genutzt. Üblicherweise besitzt man in einem LAN keine echte Domain, man sollte hier eine Bezeichnung nutzen, die nicht im Internet vorkommt (in <a class="external" href="https://tools.ietf.org/html/rfc6762#appendix-G" rel="nofollow">Anhang G zur RFC6762</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> empfiehlt die <a class="external" href="http://www.ietf.org" rel="nofollow">IETF</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> bspw. <em>.intranet</em>, <em>.internal</em>, <em>.private</em>, <em>.corp</em>, <em>.home</em> oder <em>.lan</em>). Als Schutz vor Namenskollisionen empfiehlt die <a class="external" href="http://www.icann.org" rel="nofollow">ICANN</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> jedoch, besser eigene FQDN zu nutzen (z.B. beispiel.de) und dann für interne Netze eine Subdomain (z.B. intranet.beispiel.de) zu verwenden (<a class="external" href="http://www.icann.org/en/about/staff/security/ssr/name-collision-mitigation-05dec13-en.pdf" rel="nofollow">PDF</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>). Weiterhin sollte die Endung <em>".local"</em> nicht verwendet werden, da diese von <a class="internal" href="./avahi.html">Avahi</a> benutzt wird und es dabei zu Konflikten kommen kann. Wird im Netzwerk dennoch diese Endung vergeben und kommt es genau dabei zu keiner erfolgreichen Auflösung, so lässt sich Avahi zur Analyse mit folgendem Befehl vorübergehend beenden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo service avahi-daemon stop </pre></div></div><div class="section_2"><div class="section_3"><h4 id="Verwendung-des-Cache">Verwendung des Cache<a class="headerlink" href="#Verwendung-des-Cache">¶</a></h4><p>
Damit alle DNS-Anfragen über Dnsmasq verarbeitet und bei Bedarf an externe DNS-Server weitergereicht werden, ist der einfachste Weg, die Datei <strong>/etc/resolv.conf</strong> zu bearbeiten. Dabei ist sicher zu stellen, dass der lokale DNS-Server (Dnsmasq) als erste Zeile eingetragen wird (<code class="notranslate">127.0.0.1</code>). Als nächste Zeile muss mindestens ein weiterer DNS-Server definiert werden, damit Dnsmasq die Anfragen weiterreichen kann. Beispiel mit Weiterleitung an den DNS-Cache der Fritz-Box:</p><pre class="notranslate">nameserver 127.0.0.1
nameserver 192.168.178.1</pre></div><div class="section_3"><h4 id="Besonderheiten">Besonderheiten<a class="headerlink" href="#Besonderheiten">¶</a></h4><p>
</p><div class="section_4"><h5 id="wicd">wicd<a class="headerlink" href="#wicd">¶</a></h5><p>
Bei der Verwendung von <a class="internal" href="./wicd.html">Wicd</a> wird <strong>resolv.conf</strong> automatisch verwaltet bzw. überschrieben, daher müssen statische DNS in genau dieser Reihenfolge festgelegt werden.</p></div><div class="section_4"><h5 id="NetworkManager">NetworkManager<a class="headerlink" href="#NetworkManager">¶</a></h5><p>
Bei Verwendung des <a class="internal" href="./networkmanager.html">NetworkManager</a> darf <strong>resolv.conf</strong> nicht manuell bearbeitet werden. Stattdessen kann die Verbindung im Netzwerkmanager auf <em>"Automatisch (DHCP), nur Adressen"</em> oder auf <em>"manuell"</em> gesetzt werden. Dann können die IP-Adressen von bis zu drei DNS-Servern - durch Kommata getrennt - in das vorgesehene Feld eingetragen werden. Werden die Änderungen gespeichert, werden diese Einträge vom Netzwerkmanager in die Datei <strong>resolv.conf</strong> geschrieben.</p></div><div class="section_4"><h5 id="resolvconf">resolvconf<a class="headerlink" href="#resolvconf">¶</a></h5><p>
Falls das Paket <strong>resolvconf</strong> (in den <em>Main</em> Quellen vorhanden) installiert ist, wird die Datei <strong>/etc/resolv.conf</strong> gleich beim Starten des Systems von dnsmasq geändert, dass automatisch nur noch 127.0.0.1 darin aufgeführt wird. Die von dnsmasq verwendete resolv.conf liegt dann unter <strong>/var/run/dnsmasq/resolv.conf</strong> und beinhaltet dort die "echten" DNS-Server der Netzwerkkonfiguration, wie beispielsweise in <strong>/etc/network/interfaces</strong> hinterlegt.</p><p>Das erfolgreiche lokale Cachen überprüft man am Terminal:</p><div class="bash"><div class="contents"><pre class="notranslate">dig ubuntuusers.de </pre></div></div><p>antwortet am Ende mit</p><pre class="notranslate">;; Query time: 0 msec
;; SERVER: 127.0.0.1#53(127.0.0.1)</pre><p>Soll Dnsmasq wirklich nur als DNS-Server für den eigenen Rechner arbeiten, braucht man nichts mehr zu konfigurieren.</p></div></div><div class="section_3"><h4 id="Dnsmasq-als-DNS-Server-fuer-andere-Rechner-im-lokalen-Netz">Dnsmasq als DNS-Server für andere Rechner im lokalen Netz<a class="headerlink" href="#Dnsmasq-als-DNS-Server-fuer-andere-Rechner-im-lokalen-Netz">¶</a></h4><p>
Möchte man den DNS-Server auch für andere Rechner im lokalen Netz nutzen, dann muss man Dnsmasq dazu bringen, dass es auch an der Netzwerkschnittstelle nach DNS-Abfragen lauscht. Damit die Clients wissen, wie sie den DNS-Server finden, muss der Rechner, auf dem Dnsmasq läuft, dann mit einer statischen Adresse versehen sein.</p><p><strong>/etc/dnsmasq.conf</strong> muss mit Administrator-Rechten bearbeitet werden und folgende Zeilen werden geändert bzw. hinzugefügt:
</p><pre class="notranslate">listen-address=127.0.0.1
listen-address=aaa.bbb.ccc.ddd</pre><p>
wobei <code class="notranslate">aaa.bbb.ccc.ddd</code> die lokale statische IP4-Adresse des Dnsmasq-Rechners ist, also z.B. 192.168.0.20; es muss sowohl die 127.0.0.1 als auch die <code class="notranslate">aaa.bbb.ccc.ddd</code> angegeben werden, damit Dnsmasq sowohl eigene als auch fremde Anfragen bearbeitet. Hat der Rechner mehrere IP-Nrn. muss man - sofern gewünscht oder nötig - auch die zusätzlichen IP-Nrn. angeben. Damit kann man z.B. für ein ganzes Heim-Netzwerk, ein Büro oder auch eine grössere Firma zentral die Zugriffe zum Internet regeln (s. unten).</p><p>Ob das funktioniert, kann man mit dem Konsolenbefehl</p><div class="bash"><div class="contents"><pre class="notranslate">sudo netstat -tulpen | grep dnsmasq </pre></div></div><p>überprüfen, man sieht dann in der Abteilung LISTEN, ob Dnsmasq auf 127.0.0.1 <span class="underline">und</span> aaa.bbb.ccc.ddd lauscht.</p><p>Rechner im LAN, die diesen DNS-Server nutzen wollen, sollten danach so konfiguriert werden, dass sie den Server auch nutzen. Bei Windows-Systemen geht dies in den Netzwerkeinstellungen, und auch bei Linux-Clients lässt sich der zu nutzende DNS-Server leicht <a class="internal" href="./ip-adresse_wechseln.html">einstellen</a>.</p></div></div><div class="section_2"><h3 id="Umleiten-und-Manipulieren-von-DNS-Abfragen">Umleiten und Manipulieren von DNS-Abfragen<a class="headerlink" href="#Umleiten-und-Manipulieren-von-DNS-Abfragen">¶</a></h3><p>
</p><div class="section_3"><h4 id="Umleiten">Umleiten<a class="headerlink" href="#Umleiten">¶</a></h4><p>
Das Umleiten von DNS-Abfragen kann nötig oder sinnvoll sein, wenn man sich in einem Firmennetzwerk mit eigenem Nameserver befindet. Man möchte vielleicht nicht, dass mittels Logs auf dem DNS-Server mitprotokolliert werden kann, wo man herumsurft, braucht aber dennoch die Namensauflösung fürs Firmenintranet. Alle Seiten, die z.B. auf <em>.intranet</em> enden, sollen vom firmeninternen DNS-Server behandelt werden. Alle anderen Namen sollen von einem externen Nameserver aufgelöst werden.</p><p>Unter dnsmasq ist es einfach möglich, für verschiedene Namensbereiche explizit einen oder mehrere DNS-Server zu bestimmen. Dazu trägt man entsprechende Zeilen in die Datei <strong>/etc/dnsmasq.conf</strong> ein:</p><pre class="notranslate">server=/intranet/10.17.1.1</pre><p>Dieser Eintrag würde alle DNS-Anfragen für die Toplevel-Domain <em>.intranet</em>, also Seiten wie <em>firmenportal.intranet</em> an den Server <em>10.17.1.1</em> schicken. Alle übrigen Anfragen z.B. an <em>ubuntuusers.de</em> würden von dem Nameserver bearbeitet werden, der in der Datei <strong>/etc/resolv.conf</strong> eingetragen ist.</p><p>Hier zwei weitere mehr oder weniger sinnvolle Beispiele:</p><pre class="notranslate">server=/google.com/8.8.8.8 # leitet alle DNS-Anfragen für google.com-Seiten an den Google Nameserver weiter
server=/de/213.73.91.35 # leitet alle DNS-Anfragen für .de-Seiten an den Nameserver des Berliner CCC weiter</pre></div><div class="section_3"><h4 id="Manipulieren">Manipulieren<a class="headerlink" href="#Manipulieren">¶</a></h4><p>
Es gibt verschiedene Gründe, warum man DNS-Abfragen manipulieren möchte. Ein Einsatzgebiet ist das Ausblenden von Werbung oder der Schutz der Privatsphäre. Der Ansatz ist hierbei der einer Blacklist. Das heißt, dass man eine Liste an Adressen pflegen muss, die man umleiten bzw. manipulieren möchte.</p><p>Beispielsweise könnte man den Zugriff auf Facebook und das Einblenden von <em>Like</em>-Buttons verhindern wollen. Dazu trägt man folgende zwei Zeilen in die Datei <strong>/etc/dnsmasq.conf</strong> ein und startet dann dnsmasq neu.</p><pre class="notranslate">address=/facebook.com/127.0.0.1
address=/fbcdn.net/127.0.0.1</pre><p>Dadurch werden alle DNS-Anfragen für <em>facebook.com</em>, <em>fbcdn.net</em> (das Facebook Content Delivery Network) und deren Subdomains (z.B. <em>www.facebook.com</em>) so manipuliert, dass die Anfragen auf den eigenen Rechner umgeleitet werden. Dort laufen sie dann ins Leere.</p><p>Werbenetzwerke (z.B. Double Click) und Statistikdienste (z.B. Google Analytics) kann man auf die gleiche Art und Weise aus seinem Netzwerk fernhalten:</p><pre class="notranslate">address=/doubleclick.net/127.0.0.1
address=/google-analytics.com/127.0.0.1</pre><p>Der Vorteil dieser Lösung ist eine zentrale Stelle, an der die Filterregeln angewendet werden, solange jeder Computer im Netzwerk diesen DNS-Server nutzt. So muss nicht jeder Nutzer an jedem Computer im Netzwerk in jedem Browser einen Werbeblocker installieren.</p><p>Nachteilig ist jedoch der manuelle Aufwand, da die Blacklist nicht automatisch gepflegt wird. Außerdem kann der Zugriff auf z.B. Facebook nicht verhindert werden, wenn direkt die IP genutzt wird, um auf die Webseite zu gelangen.</p><p>Damit DNS-Anfragen nicht weiter aufgelöst werden sollen, z.B. interne Domains wie <code class="notranslate">.localnet</code> oder <code class="notranslate">fritz.box</code>, kann man dies auch konfigurieren:
</p><pre class="notranslate">local=/localnet/
local=/fritz.box/</pre><p>
Alle DNS-Anfragen zu <code class="notranslate">*.localnet</code> oder <code class="notranslate">*.fritz.box</code> werden nur anhand der <strong>/etc/hosts</strong> ausgewertet und verlassen den Rechner nicht.</p></div></div></div><div class="section_1"><h2 id="Konfiguration-als-DHCP-Server">Konfiguration als DHCP-Server<a class="headerlink" href="#Konfiguration-als-DHCP-Server">¶</a></h2><p>
Soll Dnsmasq zusätzlich noch als DHCP-Server fungieren, so muss man noch die Datei <strong>/etc/dnsmasq.conf</strong> entsprechend bearbeiten <sup><a href="#source-3">[3]</a></sup>. Üblicherweise braucht hier nicht viel eingestellt zu werden. Die wichtigsten Optionen werden im folgenden vorgestellt.</p><div class="section_2"><h3 id="IP-Bereich">IP-Bereich<a class="headerlink" href="#IP-Bereich">¶</a></h3><p>
</p><pre class="notranslate"># Uncomment this to enable the integrated DHCP server, you need
# to supply the range of addresses available for lease and optionally
# a lease time. If you have more than one network, you will need to
# repeat this for each network on which you want to supply DHCP   
# service.
dhcp-range=192.168.0.100,192.168.0.254,12h  ## 12h ist die Lease-Time</pre><p>In diesem Abschnitt wird festgelegt, aus welchem Bereich der DHCP-Server Adressen vergibt. Üblicherweise kann man hier IP-Bereiche eintragen, die für <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Private_IP-Adresse">Private IP-Adressen</a> vorgesehen sind. Im angegebenen Beispiel würde der DHCP-Server Adressen aus dem Bereich <code class="notranslate">192.168.0.100</code> bis <code class="notranslate">192.168.0.254</code> vergeben und die Zuordnung Rechner &lt;-&gt; IP jeweils 12 Stunden lang beibehalten. Die Adressen <code class="notranslate">192.168.0.0</code> und <code class="notranslate">192.168.0.255</code> dürfen keinem Endgerät zugeordnet werden, da dies die Netz- bzw. Broadcast Adressen sind.</p></div><div class="section_2"><h3 id="Feste-IP-Adressen-zuordnen">Feste IP-Adressen zuordnen<a class="headerlink" href="#Feste-IP-Adressen-zuordnen">¶</a></h3><p>
</p><div class="section_3"><h4 id="Beispiel-1">Beispiel 1<a class="headerlink" href="#Beispiel-1">¶</a></h4><p>
Für manche Anwendungen ist es praktisch, wenn ein Rechner immer unter der selben IP-Adresse zu erreichen ist. Wenn man dies möchte, so kann man der <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/MAC-Adresse">MAC-Adresse</a> der Netzwerkkarte des betroffenen Rechners eine feste IP-Adresse zuordnen.</p><pre class="notranslate">dhcp-host=00:07:95:26:2B:C9,neo,192.168.1.2,infinite</pre><p>In diesem Beispiel würde also der Netzwerkkarte mit der MAC-Adresse <code class="notranslate">00:07:95:26:2B:C9</code> immer der Name <code class="notranslate">neo</code> und die IP-Adresse <code class="notranslate">192.168.1.2</code> für eine unbestimmte Zeit zugewiesen.</p></div><div class="section_3"><h4 id="Beispiel-2">Beispiel 2<a class="headerlink" href="#Beispiel-2">¶</a></h4><p>
Benutzt man zum Beispiel ein Notebook, das im Wechsel mal per Kabelnetzwerk, mal via WLAN vernetzt ist, wird dies anhand der MAC-Adresse erkannt und eine freie IP-Adresse vergeben.</p><pre class="notranslate">dhcp-host=00:00:0E:D2:DA:BE,link,infinite
dhcp-host=00:02:2d:a9:55:92,link,infinite</pre><p>Zahlreiche weitere Beispiele und Konfigurationsmöglichkeiten sind in der <strong>/etc/dnsmasq.conf</strong> selber aufgeführt.</p></div></div><div class="section_2"><h3 id="DHCP-Server-Optionen">DHCP-Server Optionen<a class="headerlink" href="#DHCP-Server-Optionen">¶</a></h3><p>
Der DHCP-Server kann seinen Client-Rechnern nicht nur IPs zuweisen, sondern auch alle notwendigen Netzwerkinformationen übermitteln. Diese und noch weitere Einstellungen lassen sich ebenfalls in der <strong>/etc/dnsmasq.conf</strong> setzen.</p><div class="section_3"><h4 id="Gateway">Gateway<a class="headerlink" href="#Gateway">¶</a></h4><p>
</p><pre class="notranslate">## Syntax: erst die Option, dann die entsprechende Adresse
dhcp-option=3,192.168.1.1</pre><p>Die IP-Adresse des <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Gateway_(Computer)">Gateways</a>, um Daten in das Internet schicken zu können. Läuft Dnsmasq auf demselben Rechner, der sich auch in das Internet einwählt, so ist das die lokale IP-Adresse des Rechners.</p><div class="section_4"><h5 id="Mehrere-Gateways-in-einem-Netzwerk">Mehrere Gateways in einem Netzwerk<a class="headerlink" href="#Mehrere-Gateways-in-einem-Netzwerk">¶</a></h5><p>
Um mehrere Gateways (Internetverbindungen) in einem Netzwerk zu betreiben, werden den einzelnen Gateways Namen (Tags) hinzugefügt. Diese wiederum werden den einzelnen Clients zugeteilt. So erreicht man, dass jeder Client im Netzwerk eine bestimmte Internetverbindung verwendet.</p><pre class="notranslate"># Gateways festlegen
dhcp-option=tag:gateway1,3,192.168.1.2
dhcp-option=tag:gateway2,3,192.168.1.3</pre><pre class="notranslate"># DHCP für Unbekannte
dhcp-range=set:gateway1,192.168.1.200,192.168.1.250,255.255.255.0,12h</pre><pre class="notranslate"># Clients:
dhcp-host=set:gateway1,00:1A:4D:49:80:C2,192.168.1.111,12h # Client 192.168.1.111 verwendet 192.168.1.2 als Gateway
dhcp-host=set:gateway2,00:1A:4B:6F:C6:65,192.168.1.121,12h # Client 192.168.1.121 verwendet 192.168.1.3 als Gateway</pre></div></div><div class="section_3"><h4 id="NTP-Server">NTP-Server<a class="headerlink" href="#NTP-Server">¶</a></h4><p>
Der zu nutzende <a class="internal" href="./systemzeit.html">NTP</a>-Zeitserver, um die exakte Uhrzeit aus dem Internet zu beziehen:</p><pre class="notranslate">dhcp-option=42,130.133.1.10   # Timeserver time.fu-berlin.de</pre></div><div class="section_3"><h4 id="PXE-Server">PXE-Server<a class="headerlink" href="#PXE-Server">¶</a></h4><p>
Ein lokaler Rechner mit <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Preboot_Execution_Environment">PXE-Boot-Images</a>, um über das Netzwerk den Rechner booten zu können:</p><pre class="notranslate">dhcp-boot=/pxelinux.0,zeus,192.168.1.11</pre></div><div class="section_3"><h4 id="Loglevel">Loglevel<a class="headerlink" href="#Loglevel">¶</a></h4><p>
</p><pre class="notranslate">log-queries</pre><p>Für Tests kann man den Loglevel erhöhen, also die Menge der Informationen, die <a class="internal" href="./logdateien.html">mitgeloggt</a> wird. So kann man bei Fehlern oder Problemen schnell auf die Lösung kommen. Welche IP-Adressen Dnsmasq gerade vergeben hat kann man in der Datei <strong>/var/lib/misc/dnsmasq.leases</strong> nachlesen.</p></div><div class="section_3"><h4 id="Weitere-DNS-Server">Weitere DNS-Server<a class="headerlink" href="#Weitere-DNS-Server">¶</a></h4><p>
</p><pre class="notranslate">server=/localnet/IP-Adresse_des_MasterDNS</pre><p>Sollten sich im Netzwerk noch weitere DNS-Server befinden, so kann man diese hier noch zusätzlich angeben.</p></div></div><div class="section_2"><h3 id="Firewall-Einstellungen">Firewall Einstellungen<a class="headerlink" href="#Firewall-Einstellungen">¶</a></h3><p>
Wenn <a class="internal" href="./ufw.html">ufw</a> als Firewall läuft, dann müssen eingehende Verbindungen am bootps Port (67 wie in <strong>/etc/services</strong> festgelegt) erlaubt werden, damit Dnsmasq als DHCP Server fungieren kann:</p><div class="bash"><div class="contents"><pre class="notranslate">$ sudo ufw allow bootps
$ sudo ufw disable &amp;&amp; sudo ufw enable </pre></div></div></div></div><div class="section_1"><h2 id="Konfigurationsaenderungen-aktivieren">Konfigurationsänderungen aktivieren<a class="headerlink" href="#Konfigurationsaenderungen-aktivieren">¶</a></h2><p>
Nach einer Änderung von <strong>/etc/dnsmasq.conf</strong> muss dnsmasq neu gestartet werden, um die Änderungen wirksam werden:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo service dnsmasq restart </pre></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://thekelleys.org.uk/dnsmasq/doc.html" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="interwiki interwiki-debian" href="https://wiki.debian.org/HowTo/dnsmasq">dnsmasq</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - HowTo im Debian-Wiki</p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/Dnsmasq">Dnsmasq</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> im Ubuntu-Wiki</p></li><li><p><a class="external" href="http://linuxwiki.org/dnsmasq" rel="nofollow">dnsmasq</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Tipps und Tricks von LinuxWiki.org</p></li><li><p><a class="external" href="http://ctaas.de/dnsmasq.htm" rel="nofollow">Ubuntu dnsmasq DNS-Server Howto</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - DNS caching/forwarding/adblock, 10/2016</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./dnsmasq/a/revision/944808.html">Diese Revision</a> wurde am 8. November 2017 22:13 von <a href="https://ubuntuusers.de/user/BillMaier/">BillMaier</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./dnsmasq.html">Dnsmasq</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>