<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>CA › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./ca.html">CA</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/CA">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./ca/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./ca/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./ca/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./ca/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./ca/a/backlinks.html">CA</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./artful_aardvark.html">Ubuntu 17.10</a> Artful Aardvark</p></li><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./rechte.html">Rechte für Dateien und Ordner ändern</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Grundlagen">Grundlagen
</a></li><li><a class="crosslink" href="#CA-Zertifikate-verwalten">CA-Zertifikate verwalten
</a></li><li><a class="crosslink" href="#Eigene-CA-betreiben">Eigene CA betreiben
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/service.png" class="image-left" src="./_/afb6c1869d3e3412cb022363511bce77dccf937a.png"/>
Eine "Certification Authority" (CA / <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Zertifizierungsstelle">Zertifizierungsstelle</a>) ist eine Instanz, die <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Digitales%20Zertifikat">digitale Zertifikate</a> ausstellt und beglaubigt. Die "Kunden" einer CA lassen sich darüber ihre Server- oder Client-Zertifikate kryptografisch signieren und können damit nachweisen, dass sie derjenige sind, der sie zu sein vorgeben. <a class="internal" href="./ubuntu.html">Ubuntu</a> bringt über das Paket <strong>ca-certificates</strong> eine ganze Reihe CA-Zertifikate seriöser CAs mit, die von Client-Programmen wie Webbrowsern benutzt werden, um die Identität von <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Transport%20Layer%20Security">TLS</a>-verschlüsselten Server-Diensten zu verifizieren. Schlägt diese Prüfung fehl, präsentiert das Client-Programm dem Benutzer eine Warnung. Grund genug für Anbieter öffentlich zugänglicher Dienste, ein signiertes Zertifikat dieser allgemein anerkannten Stellen zu erwerben.</p><p>Obwohl es inzwischen kostenlose CA-Dienste gibt (siehe <a class="crosslink" href="#Links">Links</a>), möchte nicht jeder für seinen Heim- oder Firmenserver eine dieser öffentlichen Zertifizierungsstellen bemühen. Eine Möglichkeit wäre daher die Benutzung selbstsignierter Zertifikate, die ihre Signatur selbst erstellen und ohne jegliche CA auskommen. Solche selbstsignierten Zertifikate erzeugen allerdings eine Warnung, wenn ein Client das erste Mal diesen Dienst benutzt. Der Benutzer muss hier vorsichtig sein und selbst sicherstellen, dass das Zertifikat vertrauenswürdig ist.</p><p>Wer Dienste für einen größeren Personenkreis anbietet, z.B. in einem Firmen-Intranet, der möchte daher vielleicht eine eigene CA gründen. In diesem Fall muss man nur sein eigenes CA-Zertifikat auf allen potentiellen Clients installieren (oder zum Download anbieten, falls die Benutzer keine Computer-Laien sind) - und alle mit der CA signierten Dienste funktionieren ohne die Misstrauen erweckende Warnung. Der Benutzer muss nur noch dieser einen CA vertrauen, und nicht mehr jedes Zertifikat einzeln überprüfen.</p><div class="section_1"><h2 id="Grundlagen">Grundlagen<a class="headerlink" href="#Grundlagen">¶</a></h2><p>
<a class="crosslink anchor" href="#CAFunktionsweise" id="CAFunktionsweise"></a>
</p><div class="section_2"><h3 id="Generelle-Funktionsweise-von-CAs">Generelle Funktionsweise von CAs<a class="headerlink" href="#Generelle-Funktionsweise-von-CAs">¶</a></h3><p>
CAs sind wesentlicher Bestandteil einer PKI (<a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Public-Key-Infrastruktur">Public-Key-Infrastruktur</a>) und dienen dem Beglaubigen von Server- und Client-Zertifikaten. Ein Benutzer muss beispielsweise beim Browsen im Internet nicht vielen einzelnen Zertifikaten der jeweiligen Webseiteninhaber vertrauen, sondern nur einer geringeren Anzahl an allgemein anerkannten CAs. Ist die <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Digitale%20Signatur">Signatur</a> einer dieser CAs im Server-Zertifikat der Webseite enthalten, darf diesem Zertifikat vertraut werden. Der Browser baut dann eine TLS-verschlüsselte Verbindung zum Webserver auf. Webseiten, die TLS-Verschlüsselung unterstützen, erkennt man am Protokoll <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Hypertext%20Transfer%20Protocol%20Secure">https</a> am Anfang der Addresszeile.</p><p>Wie aber gelangt die Signatur ins Server-Zertifikat? Dazu muss der Webseitenbetreiber zunächst einen <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Asymmetrisches%20Kryptosystem">privaten Schlüssel</a> im <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/RSA-Kryptosystem">RSA</a>-Format erstellen (übliche Dateiendung <strong>.key</strong>). Passend zum RSA-Key wird von ihm außerdem ein Zertifikatsantrag erstellt (übliche Dateiendung <strong>.csr</strong> für <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Certificate%20Signing%20Request">Certificate Signing Request</a>).</p><p>Der Webseitenbetreiber hat jetzt zwei Dateien:
</p><ul><li><p><strong>beispiel.key</strong> - Privater Schlüssel, der nicht weitergegeben werden darf (auch nicht an die CA) und vor fremden Zugriff geschützt werden muss.</p></li><li><p><strong>beispiel.csr</strong> - Zertifikatsantrag ohne sensible Daten. Dort wird lediglich der Name des Webseitenbetreibers ("cn" - Common Name), seine Organisation und der Domänennname der Webseite eingetragen.</p></li></ul><p>
Der Zertifikatsantrag (<strong>beispiel.csr</strong>) wird jetzt zum Signieren an eine CA übergeben. Dies darf durchaus auf ungesichertem Weg geschehen, da <strong>beispiel.csr</strong> keine schützenswerten Daten enthält. Die CA muss allerdings sicherstellen, dass der Antragsteller auch wirklich für die Domäne im Zertifikatsantrag berechtigt ist. Aus diesem Grund werden öffentlich ausgestellte Zertifikate in mehrere <a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Public%20key%20certificate#Validation_levels">Klassen</a> unterteilt, je nach Umfang der Identitätsfeststellung des Antragstellers.</p><p>Die CA wiederum verfügt ebenfalls über zwei PKI-Dateien, die zum Signieren wichtig sind:
</p><ul><li><p><strong>ca.key</strong> - Der private Schlüssel, mit dem der Zertifikatsantrag des Webseitenbetreibers in ein öffentliches Zertifikat umgewandelt wird (Signieren). Dieses öffentliche Zertifikat (<strong>beispiel.crt</strong>) enthält damit die Signatur der CA.</p></li><li><p><strong>ca.crt</strong> - Der öffentliche Schlüssel der Zertifizierungsstelle wird für das Überprüfen der Signatur verwendet. Für das Signieren wird dieser Schlüssel nicht benötigt.</p></li></ul><p>
Details zum Signieren eines Zertifikatsantrags sind <a class="crosslink" href="#CAbetreiben">weiter unten</a> beschrieben. Nach dem erfolgreichen Signieren schickt die CA das neue Webseitenzertifikat (<strong>beispiel.crt</strong>) an den Webseitenbetreiber zurück. Neben den Daten aus dem Zertifikatsantrag enthält die crt-Datei zusätzliche Informationen wie Gültigkeitszeitraum, Seriennummer, Einsatzzweck und natürlich die Signatur.</p><p>Der Webseitenbetreiber hat nun drei Dateien:
</p><ul><li><p><strong>beispiel.key</strong> - privater Schlüssel</p></li><li><p><strong>beispiel.csr</strong> - Zertifikatsantrag</p></li><li><p><strong>beispiel.crt</strong> - öffentliches Zertifikat</p></li></ul><p>
Die Datei <strong>beispiel.csr</strong> wird nicht mehr benötigt. <strong>beispiel.crt</strong> und <strong>beispiel.key</strong> müssen auf dem Webserver abgelegt werden, je nach Server kann der Speicherort variieren. Das Hinterlegen des CA-Zertifikats <strong>ca.crt</strong> auf dem Webserver ist optional.</p><p><img alt="ca.png" class="image-center" src="./_/8c6b33830c1f59d1cc0a71a8474ba22ef0e089ec.png"/></p><p>Ein Benutzer benötigt zum sicheren Browsen zwei Dateien:
</p><ul><li><p><strong>ca.crt</strong> - Öffentliche Zertifikate aller verbreiteten CAs sind bei Ubuntu für <a class="crosslink" href="#Programme">Standardprogramme</a> bereits vorinstalliert. Das Hinzufügen weiterer CAs ist <a class="crosslink" href="#CAhinzufuegen">weiter unten</a> beschrieben.</p></li><li><p><strong>beispiel.crt</strong> - Der Browser lädt das Webserver-Zertifikat automatisch von der besuchten Webseite herunter. Das TLS-Protokoll stellt dabei sicher, dass das Zertifikat nicht manipuliert wird.</p></li></ul><p>
Innerhalb des TLS-Handshakes überprüft der Webbrowser die Signatur in <strong>beispiel.crt</strong> auf Gültigkeit und benutzt dazu das CA-Zertifikat ca.crt. Dabei muss <strong>ca.crt</strong> lokal auf dem Client-System installiert sein. Ist alles in Ordnung, stellt der Browser eine endgültige verschlüsselte Verbindung zur Webseite her.</p><p><img alt="ca-client.png" class="image-center" src="./_/e2f77d132d3d95723f158d848ac24049350a851e.png"/></p><p><a class="crosslink anchor" href="#IntermediateCertificates" id="IntermediateCertificates"></a>
</p></div><div class="section_2"><h3 id="Intermediate-Certificates">Intermediate Certificates<a class="headerlink" href="#Intermediate-Certificates">¶</a></h3><p>
Anhand des vorherigen Beispiels wird schnell deutlich, dass der Austausch eines öffentlichen CA-Zertifikats ziemlich aufwändig ist:
</p><ul><li><p>In allen Browsern / Betriebssystemen muss das alte CA-Zertifikat gelöscht und das neue CA-Zertifikat installiert werden.</p></li><li><p>Alle bisher signierten Server-Zertifikate müssen von der Zertifizierungsstelle zurückgezogen und mit dem neuen CA-Zertifikat neu ausgestellt werden.</p></li><li><p>Alle Server-Betreiber müssen diese neu signierten Server-Zertifikate installieren.</p></li></ul><p>
Um diesen Aufwand soweit wie möglich zu vermeiden, haben CA-Zertifikate in der Regel einen sehr langen Gültigkeitszeitraum. Bei großen Zertifizierungsstellen kann dieser zwischen 20 und 30 Jahren liegen. Aus diesen langen Laufzeiten ergeben sich aber wiederum ganz andere Probleme. So ist es beispielsweise ziemlich wahrscheinlich, dass der eingesetzte Signaturalgorithmus zwischenzeitlich veraltet und nicht mehr sicher ist. Sieht man sich vorinstallierte CA-Zertifikate aus dem Paket <strong>ca-certificates</strong> an, wird dort häufig immer noch "sha1WithRSAEncryption" verwendet.</p><p>Als Lösung für dieses Problem verwenden Zertifizierungsstellen nicht direkt ihr CA-Zertifikat, sondern signieren damit erstmal nur ein oder mehrere untergeordnete CA-Zertifikate. Erst diese werden dann für das Signieren der eigentlichen Zertifikatsanträge verwendet.</p><p>CA-Zertifikate können demnach in folgende Kategorien unterteilt werden:
</p><ul><li><p>Root Certificates - dienen ausschließlich dem Signieren von Intermediate Certificates; werden häufig auch als <a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Trust%20anchor">Trust Anchor</a> bezeichnet, da sie an oberster Stelle einer Zertifikatskette stehen</p></li><li><p>Intermediate Certificates - dienen dem Signieren der eigentlichen Zertifikatsanträge</p></li></ul><p>
<img alt="ca-intermediate.png" class="image-center" src="./_/ef2de7001c574337bf9cd86226cf492f5245bfc2.png"/></p><p>Das Überprüfen der dadurch entstehenden Zertifikatsketten (<a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Chain%20of%20trust">Chain of trust</a>) muss der Client übernehmen. Es ist daher wichtig, dass sowohl das Root Certificate als auch alle darunter liegenden Intermediate Certificates korrekt auf dem Client installiert sind. Alternativ ist es auch möglich, dass der Server die Intermediate Certificates zusammen mit dem Server-Zertifikat während des TLS-Handshakes zum Client sendet. In diesem Fall muss auf dem Client nur noch das Root Certificate fest installiert sein.</p><p>Das folgende Beispiel benutzt <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/OpenSSL">OpenSSL</a> um die Zertifikatskette von <code class="notranslate">https://wiki.ubuntuusers.de</code> anzuzeigen.</p><div class="bash"><div class="contents"><pre class="notranslate">openssl s_client -connect wiki.ubuntuusers.de:443 -servername wiki.ubuntuusers.de -verify 3 </pre></div></div><p>Man erhält folgende Ausgabe (ohne Zeilennummern):
</p><pre class="notranslate">...
1  CONNECTED(00000003)
2  depth=2 O = Digital Signature Trust Co., CN = DST Root CA X3
3  verify return:1
4  depth=1 C = US, O = Let's Encrypt, CN = Let's Encrypt Authority X3
5  verify return:1
6  depth=0 CN = ubuntuusers.de
7  verify return:1
...</pre><p>Interessant sind hier nur die ersten Zeilen:
</p><ol class="arabic"><li><p>Zeigt an dass die Verbindung erfolgreich aufgebaut werden konnte.</p></li><li><p>Das Root-Zertifikat lautet "DST Root CA X3"</p></li><li><p>Das Root-Zertifikat konnte erfolgreich überprüft werden.</p></li><li><p>Das Intermediate-Zertifikat lautet "Let's Encrypt Authority X3". Es wurde vom Root-Zertifikat signiert.</p></li><li><p>Das Intermediate-Zertifikat konnte erfolgreich überprüft werden.</p></li><li><p>Das Server-Zertifikat lautet "ubuntuusers.de". Es wurde vom Intermediate-Zertifikat signiert.</p></li><li><p>Das Server-Zertifikat konnte erfolgreich überprüft werden.</p></li></ol><p>
Außerdem kann man erkennen, dass Root Certificate und Intermediate Certificate von unterschiedlichen Organisationen stammen (O = ...). Es handelt sich hierbei um eine Sonderform der Zertifikatsketten, bei der die Root-CA (Digital Signature Trust Co.) eine andere noch nicht so weit verbreitete CA (Let's Encrypt) <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Public%20Key%20Infrastruktur#Cross-Zertifizierung">cross-zertifiziert</a>.</p><p>Die max. Tiefe (depth=...) einer Zertifikatskette kann begrenzt werden um eine Endlosschleife zu vermeiden (Zertifikat A signiert Zertifikat B und umgekehrt). <strong>openssl</strong> bietet dazu den Parameter -verify an. Webbrowser begrenzen die Tiefe automatisch.</p><p>Intermediate Certificates unterscheiden sich vom Aufbau her kaum von Root Certificates. Der einzige Unterschied besteht darin, dass beim Root Certificate die Felder "Issuer"  und "Subject" identisch sind, während bei Intermediate Certificates im Feld "Issuer" das nächste übergeordnete Zertifikat eingetragen ist (s. <a class="crosslink" href="#CAAufbau">Aufbau eines CA-Zertifikats</a>).</p><p>Auch in der Handhabung unterscheiden sich beide Zertifikatsformen nicht. Ein Intermediate Certificate wird wie jedes andere CA-Zertifikat <a class="crosslink" href="#CAhinzufuegen">im System installiert</a>.</p><p>Unterschiede können jedoch bei Root-CA-Zertifikaten gemacht werden, falls diese im benutzerspezifischen CA-Speicher installiert sind, also z.B. im <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> des Benutzers. Firefox und Chrome <a class="external" href="https://developer.mozilla.org/de/docs/Web/Security/Public_Key_Pinning" rel="nofollow">deaktivieren für HPKP die Pin-Validierung für Pinned Hosts mit Zertifikatsketten, die bei einem benutzerdefinierten Trust Anchor terminieren</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/>.</p></div><div class="section_2"><h3 id="Speicherformate-und-orte-fuer-CAs">Speicherformate und -orte für CAs<a class="headerlink" href="#Speicherformate-und-orte-fuer-CAs">¶</a></h3><p>
CA-Zertifikate unterscheiden sich prinzipiell nicht von Server- oder Client-Zertifikaten und unterliegen der <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/X.509">X.509</a>-Spezifikation. Sie enthalten den öffentlichen Schlüssel eines <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Schl%C3%BCssel%20(Kryptologie)#Schl.C3.BCssel_bei_asymmetrischen_Verfahren">PKI-Schlüsselpaares</a>. Unter Linux werden dafür 2 verschiedene Dateiformate verwendet:
</p><ul><li><p>PEM-Format - Die Zertifikatsdaten sind <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Base64">Base64</a>-kodiert und können daher mit einem Texteditor geöffnet werden. Dies ist das weitaus üblichere Format und wird auch in diesem Artikel verwendet.</p></li><li><p>DER-Format - Die Zertifikatsdaten sind binär kodiert (<a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Abstract%20Syntax%20Notation%20One">ASN.1-Format</a>) und können nicht ohne Weiteres mit einem Texteditor angesehen werden.</p></li></ul><p>
Beispiel eines CA-Zertifikats im PEM-Format, wenn es im Texteditor geöffnet wird. Die erste und die letzte Zeile ("BEGIN CERTIFICATE"/"END CERTIFICATE") sind fester Bestandteil des Zertifikats und dürfen nicht geändert oder gelöscht werden. Sie dienen dazu, mehrere Zertifikate voneinander zu trennen, falls diese in einer einzelnen Datei abgespeichert sind (s. nächster Absatz).</p><pre class="notranslate">-----BEGIN CERTIFICATE-----
MIIG9TCCBd2gAwIBAgISA101uy+kA82E9A89jwHfDLh1MA0GCSqGSIb3DQEBCwUA
MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xNzA5MDEwMTMxMDBaFw0x
...
8fAw48DDFdzg5xFA+2/yOHa1ZmT6KOSPDNmjQzheG0HEkkF64aBwidYy+uVFLvC8
pNEG6npBXCh/+8x/z72Y85mesltZbnldvyc82oOG+v9ftPKiDdU7cyizVUh7s6pK
VTb2TQtqsG9JKPMWFqq3X5vLpzQW0R7JhUv3Q/4tCipAppnuT0v0bCWlQsiOCkMv
cliTEPpcrNCs
-----END CERTIFICATE-----</pre><p>In Ubuntu gibt es mehrere Möglichkeiten, CA-Zertifikate zu hinterlegen:
</p><ul><li><p>Dateien in einem Verzeichnis - Alle Zertifikatsdateien müssen im PEM-Format vorliegen und eine feste Dateiendung haben (<strong>.pem</strong>). Für OpenSSL muss zusätzlich auf jede Datei ein symbolischer Link verweisen, dessen Name aus dem Hash-Wert der Datei besteht. Dies wird automatisch für ein gesamtes Verzeichnis mit dem Programm <strong>c_rehash</strong> erledigt, das im Paket <strong>openssl</strong> enthalten ist. PEM-Dateien in einem Verzeichnis werden von OpenSSL unterstützt.</p></li><li><p>Einzelne Datei mit allen CAs - Alle PEM-Zertifikate sind hintereinander in einer einzelnen Datei gespeichert. Wird die Datei sehr groß, kann dies u.U. dazu führen dass diese Variante langsamer ist als eine Datei pro Zertifikat mit gehashten Indexdateien. Eine einzelne Datei mit allen CAs wird von GnuTLS unterstützt.</p></li><li><p>NSS-Datenbank - Die von Mozilla entwickelte NSS-Bibliothek ermöglicht Berkeley DB- oder SQLite-Datenbanken als CA-Zertifikatsspeicher, bestehend aus einem Satz an Dateien mit der Endung ".db". Der Vorteil von dieser Variante ist u.a., dass neben den eigentlichen Zertifikaten zusätzliche Attribute in der Datenbank abgespeichert werden können, die den Einsatzzweck des jeweiligen Zertifikats eingrenzen ("trust attributes"). Innerhalb der Datenbank werden Zertifikate im DER-Format gespeichert. Beim Import oder Export kann man allerdings das PEM-Format (ASCII-Format) als Option angeben.</p></li><li><p><a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Library%20(computing)#Shared_libraries">Shared Library</a> - NSS-Bibliotheken bieten die Möglichkeit Zertifikate direkt aus einer Bibliotheksdatei (Dateiendung ".so") auszulesen. Die Zertifikate sind in der Shared Library hart kodiert.</p></li><li><p>Hardware-Tokens - CA-Zertifikate können zusammen mit dem privaten Schlüssel auf <a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/PKCS%2011">PKCS #11</a>-kompatibler Hardware gespeichert sein, z.B. <a class="internal" href="./smart_cards.html">Smart Cards</a>, USB-Tokens, <a class="external" href="https://www.yubico.com/solutions/smart-card-piv/" rel="nofollow">YubiKey</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> , etc. PKCS #11 wird von OpenSSL, GnuTLS und NSS unterstützt.</p></li></ul><p>
Der Ort an dem CA-Zertifikate gespeichert werden können, hängt also stark von der verwendeten SSL/TLS-Bibliothek ab:
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/OpenSSL">OpenSSL</a> - mehrere Dateien in einem Verzeichnis</p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/GnuTLS">GnuTLS</a> - einzelne große Datei</p></li><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Network%20Security%20Services">NSS</a> - Datenbank und Shared Library (ist über PKCS #11-Module erweiterbar, z.B. <a class="external" href="https://github.com/kdudka/nss-pem" rel="nofollow">nss-pem</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>)</p></li></ul><p>
<a class="crosslink anchor" href="#Programme" id="Programme"></a>
</p></div><div class="section_2"><h3 id="Verwendung-von-CAs-in-Programmen">Verwendung von CAs in Programmen<a class="headerlink" href="#Verwendung-von-CAs-in-Programmen">¶</a></h3><p>
Für viele Programme kann man beim Kompilieren auswählen, welche SSL/TLS-Bibliothek sie verwenden sollen. Dies geschieht über entsprechende <a class="internal" href="./programme_kompilieren.html#Weitere-Optionen">Optionen des configure-Skripts</a>, die von der jeweiligen Linux-Distribution gesetzt werden. Die folgenden Beispiele sind daher teilweise nur für Ubuntu zutreffend.</p><table><tr class="titel"><td colspan="4" style="text-align: center">Von Programmen verwendeter CA-Zertifikatsspeicher </td></tr><tr class="kopf"><td><strong>Programm</strong> </td><td><strong>SSL/TLS-Bibliothek</strong> </td><td><strong>Globaler Standardspeicher für CAs</strong> </td><td><strong>Lokaler CA-Speicher pro Benutzer</strong></td></tr><tr class="kopf"><td colspan="4" style="text-align: center"> Webbrowser </td></tr><tr><td><a class="internal" href="./epiphany.html">Epiphany</a> </td><td>GnuTLS </td><td><strong>/etc/ssl/certs/ca-certificates.crt</strong> </td><td> </td></tr><tr><td><a class="internal" href="./konqueror.html">Konqueror</a> </td><td>OpenSSL </td><td><strong>/etc/ssl/certs/</strong> </td><td> </td></tr><tr><td><a class="internal" href="./chromium.html">Chromium</a> </td><td>NSS </td><td><strong>/usr/lib/x86_64-linux-gnu/nss/libnssckbi.so</strong> </td><td> <strong>~/.pki/nssdb/</strong> </td></tr><tr><td><a class="internal" href="./firefox.html">Firefox</a> </td><td>NSS (im eigenen Paket enthalten) </td><td><strong>/usr/lib/firefox/libnssckbi.so</strong> </td><td><strong>~/.mozilla/firefox/*.default/</strong> </td></tr><tr class="kopf"><td colspan="4" style="text-align: center"> Email-Clients </td></tr><tr><td><a class="internal" href="./sylpheed.html">Sylpheed</a> </td><td>OpenSSL </td><td><strong>/etc/ssl/certs/</strong> </td><td> </td></tr><tr><td><a class="internal" href="./kmail.html">Kmail</a> </td><td>OpenSSL </td><td><strong>/etc/ssl/certs/</strong> </td><td> </td></tr><tr><td><a class="internal" href="./thunderbird.html">Thunderbird</a> </td><td>NSS (im eigenen Paket enthalten) </td><td><strong>/usr/lib/thunderbird/libnssckbi.so</strong> </td><td><strong>~/.thunderbird/*.default/</strong> </td></tr><tr class="kopf"><td colspan="4" style="text-align: center"> Kommandozeilenprogramme </td></tr><tr><td><a class="internal" href="./wget.html">wget</a> </td><td>OpenSSL  </td><td><strong>/etc/ssl/certs/</strong> </td><td>Parameter "ca-directory" in <strong>~/.wgetrc</strong> </td></tr><tr><td><a class="internal" href="./curl.html">cURL</a> </td><td>GnuTLS </td><td><strong>/etc/ssl/certs/ca-certificates.crt</strong> </td><td>Parameter "cacert" in <strong>~/.curlrc</strong> </td></tr><tr><td><a class="internal" href="./mutt.html">Mutt</a> </td><td>GnuTLS </td><td><strong>/etc/ssl/certs/ca-certificates.crt</strong> </td><td><strong>~/.mutt_certificates</strong> </td></tr><tr><td><a class="internal" href="./w3m.html">w3m</a> </td><td>OpenSSL  </td><td><strong>/etc/ssl/certs/</strong> </td><td>Kommandozeilenparameter "ssl_ca_path" </td></tr><tr><td>ldap-utils </td><td>GnuTLS </td><td><strong>/etc/ssl/certs/ca-certificates.crt</strong> </td><td>Parameter "TLS_CACERT" in <strong>~/.ldaprc</strong> </td></tr><tr class="kopf"><td colspan="4" style="text-align: center"> Laufzeitumgebungen </td></tr><tr><td><a class="internal" href="./java.html">Java</a> </td><td><a class="internal" href="./java.html#JRE">JRE</a> </td><td><a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/Keystore">$JAVA_HOME/jre/lib/security/cacerts</a> ist symb. Link nach <strong>/etc/ssl/certs/java/cacerts</strong> </td><td> </td></tr><tr><td><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Mono%20(Software)">Mono</a> </td><td><a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/OpenSSL#BoringSSL">BoringSSL</a> ab Mono &gt;= 4.8.0, davor kein TLS1.2 </td><td><strong>/etc/mono/certstore/certs/Trust/</strong> </td><td> </td></tr><tr class="kopf"><td colspan="4" style="text-align: center"> Andere Programme </td></tr><tr><td><a class="internal" href="./gajim.html">Gajim</a> </td><td>OpenSSL </td><td><strong>/etc/ssl/certs/</strong> </td><td> </td></tr></table><p>
</p><div class="section_3"><h4 id="PEM-Dateien">PEM-Dateien<a class="headerlink" href="#PEM-Dateien">¶</a></h4><p>
Da die meisten Programme, die OpenSSL und GnuTLS verwenden, CA-Zertifikate unterhalb von <strong>/etc/ssl/certs/</strong> verwenden, gibt es ein zentrales Paket <strong>ca-certificates</strong> mit allgemein anerkannten öffentlichen CA-Zertifikaten (s. <a class="crosslink" href="#CAverwalten">CA-Zertifikate verwalten</a>). Als Quellverzeichnis dient <strong>/usr/share/ca-certificates/</strong>. Die dortigen PEM-Dateien werden beim Konfigurieren des Pakets nach /etc/ssl/certs verlinkt, wo auch die zusätzlichen Hash-Links für OpenSSL angelegt werden. Außerdem erstellt "ca-certificates" dabei eine einzelne große Datei <strong>/etc/ssl/certs/ca-certificates.crt</strong> die alle CA-Zertifikate enthält. Damit ist /etc/ssl/certs/ das unter Ubuntu systemweite Standardverzeichnis für vorinstallierte CA-Zertifikate.</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Eigentlich ist in Ubuntu das Verzeichnis <strong>/usr/lib/ssl/</strong> als Standardverzeichnis für OpenSSL konfiguriert (per <a class="internal" href="./programme_kompilieren.html#Weitere-Optionen">Option des configure-Skripts</a>). Die dortigen Unterverzeichnisse <strong>./certs/</strong> und <strong>./private/</strong> für jeweils öffentliche und private Zertifikate sind im Quellcode von OpenSSL hart einkodiert. Diese beiden Unterverzeichnisse werden allerdings unter Ubuntu als symbolische Links nach <strong>/etc/ssl/certs/</strong> und <strong>/etc/ssl/private/</strong> angelegt. Man kann für OpenSSL das Standardverzeichnis für CA-Zertifikate daher leicht ändern, indem man den symbolischen Link <strong>/usr/lib/ssl/certs/</strong> auf ein anderes Verzeichnis zeigen lässt.
</p></div></div></div><div class="section_3"><h4 id="NSS-Datenbanken">NSS-Datenbanken<a class="headerlink" href="#NSS-Datenbanken">¶</a></h4><p>
Programme die die NSS-Datenbank verwenden, können auf keine vorinstallierten systemweiten CA-Zertifikate zurückgreifen. Das Paket <strong>libnss3-nssdb</strong> enthält eine leere Zertifikatsdatenbank. Vom Benutzer lokal installierte CAs werden meistens in einer NSS-Datenbank im <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> abgespeichert.</p></div><div class="section_3"><h4 id="Shared-Libraries">Shared Libraries<a class="headerlink" href="#Shared-Libraries">¶</a></h4><p>
Programme die eine Shared Library als Standard-CA-Speicher verwenden, zeigen diese CAs meist unter der Bezeichnung "Builtin Object Token" an. Von dieser Bezeichnung ist dann der Name der Shared Library abgeleitet: <strong>libnssckbi.so</strong> für "nss built-in root certificates". Das Paket <strong>libnss3</strong> enthält z.B. fest kodierte CAs in der Shared Library <strong>/usr/lib/x86_64-linux-gnu/nss/libnssckbi.so</strong> die von <a class="internal" href="./chromium.html">Chromium</a> verwendet werden. <a class="footnote" href="#fn-1" id="bfn-1"><span class="paren">[</span>1<span class="paren">]</span></a></p></div><div class="section_3"><h4 id="Laufzeitumgebungen-verbreiteter-Programmiersprachen">Laufzeitumgebungen verbreiteter Programmiersprachen<a class="headerlink" href="#Laufzeitumgebungen-verbreiteter-Programmiersprachen">¶</a></h4><p>
</p><div class="section_4"><h5 id="Java">Java<a class="headerlink" href="#Java">¶</a></h5><p>
Mit Hilfe des Pakets <strong>ca-certificates-java</strong> werden die globalen CA-Zertifikate von Ubuntu beim Konfigurieren des Pakets <strong>ca-certificates</strong> automatisch mit in den globalen Keystore von Java kopiert. Das Paket installiert dazu einen Update-Hook im Verzeichnis <strong>/etc/ca-certificates/update.d</strong>.</p><p>Java unterstützt verschiedene Formate für einen Keystore, z.B.
</p><ul><li><p>JKS - Java Key Store (<a class="internal" href="./java/oracle_java.html">Oracle JDK</a>)</p></li><li><p>BKS - BouncyCastle Key Store (<a class="external" href="https://bouncycastle.org/" rel="nofollow">Bouncy Castle Crypto API</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>)</p></li></ul><p>
</p></div><div class="section_4"><h5 id="Mono">Mono<a class="headerlink" href="#Mono">¶</a></h5><p>
Mono enthält <a class="external" href="http://www.mono-project.com/docs/faq/security/#why-doesnt-mono-includes-root-certificates-from-x-y-and-z" rel="nofollow">keine vorinstallierten CA-Zertifikate im eigenen Keystore</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/>. Mit Hilfe des Pakets <strong>ca-certificates-mono</strong> werden jedoch die globalen CA-Zertifikate von Ubuntu beim Konfigurieren des Pakets <strong>ca-certificates</strong> automatisch mit in den globalen Keystore von Mono kopiert. Das Paket installiert dazu einen Update-Hook im Verzeichnis <strong>/etc/ca-certificates/update.d</strong>.</p><p><a class="crosslink anchor" href="#CAAufbau" id="CAAufbau"></a>
</p></div></div></div><div class="section_2"><h3 id="Aufbau-eines-CA-Zertifikats">Aufbau eines CA-Zertifikats<a class="headerlink" href="#Aufbau-eines-CA-Zertifikats">¶</a></h3><p>
CA-Zertifikate müssen lediglich dem X.509-Standard entsprechen. Technisch gesehen ist das bereits ausreichend. Das bedeutet dass zumindest folgende Attribute vorhanden sein müssen:
</p><ul><li><p>"Subject" - Beschreibung für was das Zertifikat gültig sein soll</p></li><li><p>"Issuer" - Ausstellende Instanz die das Zertifikat signiert hat</p></li></ul><p>
Beide Attribute müssen mindestens den Domänennamen im Feld "CN" (Common Name) enthalten (z.B. "CN = beispiel.de"). Da es für  Root-CA-Zertifikate keine übergeordnete Instanz gibt (s. Kapitel <a class="crosslink" href="#IntermediateCertificates">Intermediate Certificates</a>), sind hier die Attribute "Subject" und "Issuer" identisch. Weitere Felder in "Subject" und "Issuer" wie "O" (Organisation), "OU" (Organisationseinheit), "C" (Country, Land), etc. sind optional.</p><p>In der Praxis benötigen CA-Zertifikate allerdings noch weitere Attribute um von Betriebssystemen und Programmen akzeptiert zu werden. Diese werden in den sogenannten "X.509 v3-Erweiterungen" abgespeichert. <a class="footnote" href="#fn-2" id="bfn-2"><span class="paren">[</span>2<span class="paren">]</span></a></p><table><tr class="titel"><td colspan="4" style="text-align: center"> Attribute für CA-Zertifikate </td></tr><tr class="kopf"><td> OID </td><td> Attribut </td><td> Wert </td><td> Beschreibung </td></tr><tr><td>2.5.29.15 </td><td>Key Usage </td><td>Certificate Sign, CRL Sign </td><td>Einsatzzweck (Zertifikate und <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Zertifikatsperrliste">Zertifikatsperrlisten</a> signieren) </td></tr><tr><td>2.5.29.19 </td><td>Basic Constraints (critical) </td><td>CA:TRUE </td><td>Es handelt sich um ein CA-Zertifikat, nicht um ein Server- oder Client-Zertifikat. </td></tr><tr><td>2.5.29.14 </td><td>Subject Key Identifier </td><td>20:29:A8:27:BC:67:2E:60:5A:58:31:4F:FF:98:5C:F2:30:67:2A:6F (Beispiel) </td><td>Sollte aus dem öffentlichen Schlüssel über eine <a class="internal" href="./hashfunktionen.html">Hash-Funktion</a> abgeleitet sein; wichtig für CAs ist nur dass dieses Attribut existiert, der tatsächliche Wert wird im Allgemeinen nicht überprüft </td></tr><tr><td>2.5.29.35 </td><td>Authority Key Identifier </td><td>keyid:20:29:A8:27:BC:67:2E:60:5A:58:31:4F:FF:98:5C:F2:30:67:2A:6F </td><td>Enthält den Subject Key Identifier der ausstellenden CA zum Überprüfen der Zertifikatskette (optional) </td></tr></table><p>
Die OID ist ein eindeutiger Identifier der den Typ des Attributs festlegt. Er wird in der ASN.1-Kodierung des Zertifikats verwendet.</p><p>Damit die X.509 v3-Erweiterungen in ein selbstsigniertes Root-CA-Zertifikat eingefügt werden, sind folgende Einträge in der OpenSSL-Konfigurationsdatei <strong>openssl.cnf</strong> notwendig.</p><pre class="notranslate">...
[req]
x509_extensions = v3_ca
...
[ v3_ca ]
keyUsage = cRLSign, keyCertSign
basicConstraints = critical,CA:TRUE
subjectKeyIdentifier = hash
authorityKeyIdentifier = keyid:always,issuer
...</pre><p><a class="crosslink anchor" href="#SelbstsignierteZertifikate" id="SelbstsignierteZertifikate"></a>
</p></div><div class="section_2"><h3 id="Selbstsignierte-Zertifikate">Selbstsignierte Zertifikate<a class="headerlink" href="#Selbstsignierte-Zertifikate">¶</a></h3><p>
Häufig werden selbstsignierte Zertifikate mit Zertifikaten verwechselt, die über eine eigene CA signiert wurden. Weil man dann eben "selbst" das Zertifikat signiert, und nicht eine öffentliche Zertifizierungsstelle.</p><p>Alle Zertifikate die über eine (eigene oder fremde) CA signiert wurden, sind keine selbstsignierten Zertifikate. Das "selbst" bezieht sich nämlich nicht auf eine Organisaton oder Person, sondern auf ein PKI-Schlüsselpaar. Selbstsignierte Zertifikate werden mit dem eigenen privaten Schlüssel signiert.</p><p>Wie aber kann ein PKI-Schlüsselpaar sich selbst signieren? Im Kapitel <a class="crosslink" href="#CAAufbau">Aufbau eines CA-Zertifikats</a> haben wir gesehen, dass an CA-Zertifikate technisch gesehen keine besonderen Anforderungen bestehen. Jedes beliebige PKI-Schlüsselpaar kann als CA verwendet werden, auch für sich selbst.</p><p>Folgendes Vorgehen ist daher möglich:
</p><ol class="arabic"><li><p>Erstellen eines privaten Schlüssels <strong>beispiel.key</strong></p></li><li><p>Erstellen eines Zertifikatsantrags <strong>beispiel.csr</strong> anhand des privaten Schlüssels</p></li><li><p>Signieren des Zertifikatsantrags <strong>beispiel.csr</strong> mit dem eigenen privaten Schlüssel <strong>beispiel.key</strong></p></li><li><p>Infolge des Signierens erhält man das Zertifikat <strong>beispiel.crt</strong></p></li></ol><p>
Selbstsignierte Zertifikate lassen sich mit <strong>openssl</strong> in einem einzigen Befehl erstellen (s. "<a class="internal" href="./man.html">man</a> req"). Hier benutzt openssl die globale Konfigurationsdatei <strong>/etc/ssl/openssl.cnf</strong>.
</p><div class="bash"><div class="contents"><pre class="notranslate">openssl req -x509 -newkey rsa:2048 -keyout beispiel.key -out beispiel.crt </pre></div></div><p>Nach Eingabe einer Passphrase für den privaten Schlüssel und einiger Informationen über das öffentliche Zertifikat, erstellt der Befehl folgende Dateien im aktuellen Verzeichnis:
</p><ul><li><p><strong>beispiel.key</strong> - privater Schlüssel</p></li><li><p><strong>beispiel.crt</strong> - öffentliches selbstsigniertes Zertifikat</p></li></ul><p>
Alternativen für die Erstellung selbstsignierter Zertifikate sind auch in den Wiki-Artikeln <a class="internal" href="./apache/ssl.html">Apache/SSL</a> und <a class="internal" href="./ssl-cert.html">ssl-cert</a> beschrieben.</p><p>Ein derartiges Zertifikat wird aber von den meisten Anwendungen wenn überhaupt, dann nur mit einer Warnung akzeptiert. Im Kapitel <a class="crosslink" href="#CAFunktionsweise">Generelle Funktionsweise von CAs</a> wurde beschrieben wie der Webbrowser während des TLS-Handshakes das Server-Zertifikat vom Server herunterlädt und mit dem lokal installierten CA-Zertifikat überprüft. Im Falle von selbstsignierten Zertifikaten sind beide Zertifikate identisch. Das CA-Zertifikat ist dasselbe Zertifikat wie das Server-Zertifikat. Es wird daher in der Regel über entsprechende Warnhinweise prinzipiell als verdächtig bzw. unsicher eingestuft oder der Client-Zugriff wird sogar komplett blockiert. Daher müssen selbstsignierte Zertifikate erst heruntergeladen und über dauerhafte Ausnahmeregeln auf dem Client legitimiert werden. Falls z.B. Firefox dieses verweigert bzw. gar nicht erst anbietet, ruft man die Pseudo-Adresse <code class="notranslate">about:config</code> auf und setzt den Wert des Schlüssels</p><pre class="notranslate">browser.xul.error_pages.expert_bad_cert</pre><p>auf <code class="notranslate">true</code>. Inzwischen warnen aber auch andere Browser vor selbstsignierten Zertifikaten.</p><p>Anwendungsfälle für selbstsignierte Zertifikate:</p><ul><li><p>Erstellen eines Root-CA-Zertifikats - Root-CA-Zertifikate stehen ganz oben in der Zertifikatskette (Chain of trust). Es gibt daher keine übergeordnete CA die sie signieren könnte.</p></li><li><p>Einsatz für Testzwecke - Da das Erstellen von selbstsignierten Zertifikaten sehr schnell und einfach geht, lohnt sich der Aufwand einer CA bei Testsystemen oder nur privat genutzten Sytemen oft nicht.</p></li></ul><p>
<a class="crosslink anchor" href="#CAverwalten" id="CAverwalten"></a>
</p></div></div><div class="section_1"><h2 id="CA-Zertifikate-verwalten">CA-Zertifikate verwalten<a class="headerlink" href="#CA-Zertifikate-verwalten">¶</a></h2><p>
Wie im Kapitel <a class="crosslink" href="#Programme">Verwendung von CAs in Programmen</a> beschrieben, existieren bereits unter einer Standardinstallation von Ubuntu eine ganze Reihe an unterschiedlichen CA-Zertifikatsspeichern. Noch umfangreicher wird diese Liste, wenn für einzelne Programme separate Zertifikatsspeicher konfiguriert werden, oder Benutzer ihre eigenen CA-Speicher anlegen. Für diese Fälle gibt es keine allgemein gültige Lösung, und diese separaten CA-Speicher müssen manuell gepflegt werden.</p><p>Im Folgenden werden daher nur die Standard-Zertifikatsspeicher berücksichtigt, die unterhalb von <strong>/etc/ssl/certs/</strong> liegen und über das Paket <strong>ca-certificates</strong> verwaltet werden. ca-certificates enthält eine Reihe allgemein anerkannter CA-Zertifikate, die größtenteils aus <a class="external" href="https://wiki.mozilla.org/CA:Overview" rel="nofollow">Mozilla's CA Certificate Program</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> übernommen werden (s. <strong>/usr/share/doc/ca-certificates/README.Debian</strong>).</p><p>Für die globalen Keystores von Java und Mono (s. Kapitel <a class="crosslink" href="#Programme">Verwendung von CAs in Programmen</a>) gibt es entsprechende Zusatzpakete (<strong>ca-certificates-java</strong>, <strong>ca-certificates-mono</strong>), die sich in den Update-Hook von ca-certificates einklinken und damit ebenfalls abgedeckt sind.</p><p>Alle Pakete sind für Ubuntu-Desktop und <a class="internal" href="./server_installation.html">Ubuntu-Server</a> bereits vorinstalliert.
</p><ul><li><p><strong>ca-certificates</strong></p></li><li><p><strong>ca-certificates-java</strong></p></li><li><p><strong>ca-certificates-mono</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install ca-certificates ca-certificates-java ca-certificates-mono </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install ca-certificates ca-certificates-java ca-certificates-mono </pre></div></div><p>
</p></div></div><p>Für separate CA-Speicher hat man die Möglichkeit eigene Update-Hooks in <strong>/etc/ca-certificates/update.d/</strong> zu installieren (s. "<a class="internal" href="./man.html">man</a> update-ca-certificates").</p><p>Für den Umgang mit Zertifikaten bringen alle SSL/TLS-Bibliotheken ihre eigenen Befehle mit. Bei OpenSSL liegen diese im Paket <strong>openssl</strong> das unter Ubuntu bereits vorinstalliert ist. Bei GnuTLS und NSS muss jeweils noch ein zusätzliches Paket nachinstalliert werden. Java-Laufzeitumgebungen enthalten ihr eigenes Tool.</p><table><tr class="titel"><td colspan="3" style="text-align: center"> Befehle für den Umgang mit X.509-Zertifikaten </td></tr><tr class="kopf"><td> SSL/TLS-Bibliothek </td><td> Paket </td><td> Befehl </td></tr><tr><td>OpenSSL </td><td><strong>openssl</strong> (vorinstalliert) </td><td>openssl </td></tr><tr><td>GnuTLS </td><td><strong>gnutls-bin</strong> </td><td>certtool </td></tr><tr><td>NSS </td><td><strong>libnss3-tools</strong> </td><td>certutil </td></tr><tr><td>JRE </td><td>s. "update-java-alternatives --jre --list" für bereits installierte Pakete </td><td>keytool </td></tr></table><p>
</p><ul><li><p><strong>openssl</strong></p></li><li><p><strong>gnutls-bin</strong></p></li><li><p><strong>libnss3-tools</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install openssl gnutls-bin libnss3-tools </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install openssl gnutls-bin libnss3-tools </pre></div></div><p>
</p></div></div><p><a class="crosslink anchor" href="#CAanzeigen" id="CAanzeigen"></a>
</p><div class="section_2"><h3 id="CA-Informationen-anzeigen">CA-Informationen anzeigen<a class="headerlink" href="#CA-Informationen-anzeigen">¶</a></h3><p>
OpenSSL-Befehl um alle Felder eines CA-Zertifikats anzuzeigen, das im PEM-Format vorliegt:
</p><div class="bash"><div class="contents"><pre class="notranslate">openssl x509 -in beispiel.crt -noout -text </pre></div></div><p>
Entsprechender Befehl für GnuTLS:
</p><div class="bash"><div class="contents"><pre class="notranslate">certtool --certificate-info --infile beispiel.crt </pre></div></div><p>
Beide Befehle sollten dieselbe Ausgabe anzeigen.</p><p>Um NSS-Datenbanken abzufragen gibt es je nach Datenbankversion 2 Möglichkeiten. Hier im Beispiel werden die lokalen benutzerspezifischen CA-Zertifikate für <a class="internal" href="./firefox.html">Firefox</a> und <a class="internal" href="./thunderbird.html">Thunderbird</a> aufgelistet.</p><p>Altes Datenbankformat (BerkeleyDB) für Firefox:
</p><div class="bash"><div class="contents"><pre class="notranslate">certutil -d ~/.mozilla/firefox/*.default -L </pre></div></div><p>
Neues Datenbankformat (SQLite) für Thunderbird:
</p><div class="bash"><div class="contents"><pre class="notranslate">NSS_DEFAULT_DB_TYPE="sql" certutil -d ~/.thunderbird/*.default -L </pre></div></div><p>Auflisten aller Zertifikate im globalen CA-Speicher von Java:
</p><div class="bash"><div class="contents"><pre class="notranslate">keytool -list -keystore /etc/ssl/certs/java/cacerts </pre></div></div><p><a class="crosslink anchor" href="#CAhinzufuegen" id="CAhinzufuegen"></a>
</p></div><div class="section_2"><h3 id="CAs-in-Ubuntu-hinzufuegen">CAs in Ubuntu hinzufügen<a class="headerlink" href="#CAs-in-Ubuntu-hinzufuegen">¶</a></h3><p>
CA-Zertifikate sind entweder bereits im Betriebssystem vorinstalliert (für allgemein anerkannte CAs), oder müssen von der Webseite der CA heruntergeladen und manuell installiert werden. In diesem Fall sollte das CA-Zertifikat sorgfältig geprüft werden, z.B. per telefonischem Abgleich des Fingerprints.</p><p>Abgesehen davon, dass man Zertifikate auch als einfacher Benutzer über Importfunktionen oder Konfigurationsdirektiven in den diversen Client-Programmen nutzen kann, kann man ein CA-Zertifikat auch systemweit installieren. Als erstes muss man dafür die CA-Zertifikatsdatei im PEM-Format nach <strong>/usr/local/share/ca-certificates/</strong> kopieren. Am Besten denkt man sich ggf. noch einen aussagekräftigeren Namen für die Datei aus, z.B. <strong>organisationsname.crt</strong>. Wichtig ist aber, dass die Dateiendung <strong>.crt</strong> verwendet wird. Dann wird folgender Befehl ausgeführt:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo dpkg-reconfigure ca-certificates </pre></div></div><p>Auf die Frage ob neue Zertifikate akzeptiert werden sollen, antwortet man entweder mit <em>"ja"</em>, dann wird das neue Zertifikat ohne weitere Rückfrage in die Liste aufgenommen, oder mit <em>"nachfragen"</em>. Im letzteren Fall erscheint ein neuer Dialog mit einer Liste aller Zertifikate, die in <strong>/usr/share/ca-certificates/</strong> zu finden sind. Das neue Zertifikat wird nicht angezeigt: Bei allen Zertifikaten in <strong>/usr/local/share/ca-certificates/</strong> wird davon ausgegangen, dass diese nachträglich manuell hinzugefügt wurden und daher auf jeden Fall mit installiert werden sollen. Nachdem man die Liste überprüft hat, muss man mit <em>"Ok"</em> bestätigen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Zertifizierungsstellen denen man nicht vertraut, können in diesem Dialog auch abgewählt werden. Insbesondere kann man alle Zertifikate abwählen, falls man das Paket <strong>ca-certificates</strong> ansonsten sowieso nicht gebraucht hätte. Es empfiehlt sich aber nicht dies auf Maschinen zu tun, auf denen Benutzer aktiv arbeiten. Ansonsten werden diese in Zukunft bei jeder SSL-verschlüsselten öffentlichen Seite mit einer Warnung belästigt. Benutzer dahingehend zu erziehen permanent Warnfenster wegzuklicken, ist vom Sicherheitsstandpunkt her kontraproduktiv!
</p></div></div><p>Da das Paket <strong>ca-certificates</strong> in den <a class="internal" href="./paketquellen.html">Paketquellen</a> nur gelegentlich Updates erhält, gibt es die Möglichkeit global installierte CA-Zertifikate selbst auf den neuesten Stand zu bringen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-ca-certificates -f </pre></div></div><p><a class="crosslink anchor" href="#CAloeschen" id="CAloeschen"></a>
</p></div><div class="section_2"><h3 id="CAs-aus-Ubuntu-loeschen">CAs aus Ubuntu löschen<a class="headerlink" href="#CAs-aus-Ubuntu-loeschen">¶</a></h3><p>
Für das Löschen von CAs gilt dasselbe wie für das <a class="crosslink" href="#CAhinzufuegen">Hinzufügen von CAs in Ubuntu</a>. Wegen der Vielzahl an Möglichkeiten an welchem Ort CAs im System hinterlegt werden können, bezieht sich das Löschen hier nur auf CA-Zertifikate unterhalb von <strong>/etc/ssl/certs/</strong> und solche die über Update-Hooks in <strong>/etc/ca-certificates/update.d/</strong> verwaltet werden.</p><p>Um selbst installierte CA-Zertifikate zu entfernen, müssen diese zunächst aus dem Verzeichnis <strong>/usr/local/share/ca-certificates/</strong> gelöscht werden. Anschließend ruft man folgenden Befehl auf:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo dpkg-reconfigure ca-certificates </pre></div></div><p>Die Vorgehensweise ist daraufhin identisch mit der aus dem <a class="crosslink" href="#CAhinzufuegen">vorherigen Abschnitt</a>.</p><p><a class="crosslink anchor" href="#CAbetreiben" id="CAbetreiben"></a>
</p></div></div><div class="section_1"><h2 id="Eigene-CA-betreiben">Eigene CA betreiben<a class="headerlink" href="#Eigene-CA-betreiben">¶</a></h2><p>
</p><div class="section_2"><h3 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h3><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Anfang April 2014 ist der <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/OpenSSL#Heartbleed-Bug">Heartbleed-Bug</a> (CVE-2014-0160) in OpenSSL bekannt geworden. Leider hat sich Canonical entscheiden, bis einschließlich <a class="internal" href="./trusty.html">Ubuntu 14.04</a> nicht die aktualisierte Version 1.0.1g oder neuer zu nutzen, sondern nur die Pakete in den offiziellen Paketquellen zu patchen. Seit dem 7. April 2014 stehen diese als Update zur Verfügung. Man sollte sich daher nicht durch die scheinbar betroffene Versionsnummer des Pakets täuschen lassen.</p><p>Allerdings wird empfohlen, vor diesem Datum erstellte Zertifikat zu verwerfen und durch Neue zu ersetzen.
</p></div></div><p>Das Paket <strong>openssl</strong> bringt alles Nötige mit, um eine eigene CA zu erstellen. Es ist sowohl in Ubuntu-Desktop als auch <a class="internal" href="./server_installation.html">Ubuntu-Server</a> bereits vorinstalliert.</p><ul><li><p><strong>openssl</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install openssl </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install openssl </pre></div></div><p>
</p></div></div><p><a class="crosslink anchor" href="#CAerstellen" id="CAerstellen"></a>
</p></div><div class="section_2"><h3 id="Erstellen-der-neuen-CA">Erstellen der neuen CA<a class="headerlink" href="#Erstellen-der-neuen-CA">¶</a></h3><p>
Das Paket <strong>openssl</strong> bringt ein Perl-Skript <strong>CA.pl</strong> als Frontend mit, mit dem man sehr bequem seine eigene CA erschaffen und verwalten kann. Das Skript befindet sich im Verzeichnis <strong>/usr/lib/ssl/misc/</strong>. Um es zu benutzen benötigt man keine erweiterten Rechte, man kann die CA einfach im eigenen <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> erstellen.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Je nachdem wofür man die CA benutzen möchte, sollte man einen angemessenen Sicherheitsaufwand betreiben. Wer den privaten Schlüssel der CA stiehlt, kann sich später problemlos reihenweise SSL-Zertifikate im Namen der ausstellenden Instanz beschaffen. Wer durch eine eigene CA signierte Zertifikate in seinem Unternehmen benutzen will, sollte deswegen die CA auf einem abgeschotteten Rechner ohne Netzwerkzugang in einem abschließbaren Raum ablegen.</p><p>Alternativ könnte man die CA auch auf einem USB-Stick oder sonstigem Wechselmedium erstellen und vor jeder Benutzung die Netzwerkverbindung des Rechners kappen und von einer <a class="internal" href="./live-cd.html">Live-CD</a> booten. 
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Möchte man eine CA erstellen die länger als drei Jahre gültig ist, muss in <strong>/usr/lib/ssl/misc/CA.pl</strong> die Variable "<code class="notranslate">$CADAYS</code>" auf einen höheren Wert als 1095 eingestellt werden. Erst danach sollte man seine eigene CA erstellen. Die Gültigkeitsdauer der signierten Zertifikate wird in der Variable "<code class="notranslate">$DAYS</code>" festgelegt.
</p></div></div><p>Mit dem <strong>CA.pl</strong>-Skript ist die Erstellung der CA ziemlich einfach. Im Verlauf verschiedener Schritte wird man nach diversen Daten gefragt, die man eingeben kann. Nur die Passphrase - die in diesem Fall ruhig besonders lang und kompliziert ausfallen darf - und der <em>"Common Name"</em> müssen auf jeden Fall angegeben werden. Ebenso ist der Organisationsname sinnvoll, aber nicht zwingend erforderlich. Wer noch zusätzlich eine Kontakt-E-Mail-Adresse im CA-Zertifikat eintragen möchte, sollte sich vorher Gedanken über <a class="internal missing" href="./wiki/tags/spam.html">Spam</a> machen. Welche Felder letztendlich vorhanden sein müssen, wird über eine Policy in der OpenSSL-Konfiguration <strong>/usr/lib/ssl/openssl.cnf</strong> bestimmt. Dort wird festgelegt welche Felder in den signierten Zertifikaten denselben Wert wie im CA-Zertifikat haben müssen, da sie sonst bei der Überprüfung abgelehnt werden. Diese Felder dürfen dann bei der CA nicht leer sein. Es empfiehlt sich daher die Konfigurationsdatei wie folgt abzuändern, damit nur "commonName" in den signierten Zertifikaten enthalten sein muss, und "organisationName" im CA-Zertifikat und im zu überprüfenden Zertifikat übereinstimmen müssen.</p><pre class="notranslate">...
# For the CA policy
[ policy_match ]
countryName             = optional
stateOrProvinceName     = optional
organizationName        = match
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional
...
[ req_distinguished_name ]
...
#countryName_default            = AU
...
#stateOrProvinceName_default    = Some-State
...</pre><p>Das Erstellen der CA findet im Terminal<sup><a href="#source-2">[2]</a></sup> statt und sieht dann in etwa so aus:</p><div class="bash"><div class="contents"><pre class="notranslate">/usr/lib/ssl/misc/CA.pl -newca </pre></div></div><p>Ausgabe:</p><pre class="notranslate">CA certificate filename (or enter to create)                      # &lt;Enter&gt; drücken
Making CA certificate ...
Generating a 1024 bit RSA private key
................++++++
......................................++++++
writing new private key to './demoCA/private/cakey.pem'
Enter PEM pass phrase:                                            # besonders lange und komplizierte Passphrase eingeben
Verifying - Enter PEM pass phrase:                                # Passphrase wiederholen
 -----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
 -----
Country Name (2 letter code) []:                                  # z.B. DE, oder mit &lt;Enter&gt; leer lassen
State or Province Name (full name) []:                            # z.B. Schleswig-Holstein, oder mit &lt;Enter&gt; leer lassen
Locality Name (eg, city) []:                                      # z.B. Helgoland, oder mit &lt;Enter&gt; leer lassen
Organization Name (eg, company) [Internet Widgits Pty Ltd]:       # z.B. Karl-Heinz Beispiel GmbH
Organizational Unit Name (eg, section) []:                        # z.B. Niederlassung 1, oder mit &lt;Enter&gt; leer lassen
Common Name (eg, YOUR name) []:                                   # z.B. eine eigene Domain á la beispiel.de
Email Address []:                                                 # z.B. abc@beispiel.de, oder mit &lt;Enter&gt; leer lassen

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:                                          # Kann man auslassen (&lt;Enter&gt;)
An optional company name []:                                      # Kann man ebenfalls weglassen
Using configuration from /usr/lib/ssl/openssl.cnf
Enter pass phrase for ./demoCA/private/cakey.pem:                 # noch einmal die Passphrase von oben eingeben
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            f3:43:40:d0:07:37:64:9a
        Validity
            Not Before: Jun 16 20:53:57 2007 GMT
            Not After : Jun 15 20:53:57 2010 GMT
        Subject:
            organizationName          = Karl-Heinz Beispiel GmbH
            commonName                = beispiel.de
        X509v3 extensions:
            X509v3 Subject Key Identifier: 
                47:EA:3D:2B:41:8B:29:EE:A5:56:E1:8E:3A:AD:15:0C:F8:AD:D0:73
            X509v3 Authority Key Identifier: 
                keyid:47:EA:3D:2B:41:8B:29:EE:A5:56:E1:8E:3A:AD:15:0C:F8:AD:D0:73

            X509v3 Basic Constraints: 
                CA:TRUE
Certificate is to be certified until Jun 15 20:53:57 2010 GMT (1095 days)

Write out database with 1 new entries
Data Base Updated</pre><p>Im aktuellen Verzeichnis sollte jetzt ein neues Verzeichnis <strong>demoCA</strong> mit einigen Dateien und weiteren Unterverzeichnissen entstanden sein. Folgende davon sind wichtig:</p><ul><li><p><strong>cacert.pem</strong> - Das öffentliche Zertifikat der CA. Diese Datei sollte auf allen Clients <a class="crosslink" href="#Import">importiert</a> werden. Danach vertrauen diese Clients automatisch allen von der CA ausgestellten Zertifikaten. </p></li><li><p><strong>certs/</strong> - Das Verzeichnis in dem die signierten Zertifikate untergebracht werden. </p></li><li><p><strong>private/</strong> - Das Verzeichnis für die privaten Schlüssel. </p></li><li><p><strong>private/cakey.pem</strong> - Der private Schlüssel der CA. Dieser sollte die CA nie verlassen, außer zu Backup-Zwecken. (Und auch dann gesondert gesichert werden.)</p></li><li><p><strong>index.txt</strong> - Sogenannte Datenbank der CA mit einer Liste aller ausgestellten Zertifikate und deren Status.</p></li></ul><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Datei <strong>cacert.pem</strong> hat nichts mit der im Artikel <a class="internal" href="./cacert.html">CAcert</a> beschriebenen Organisation zu tun.
</p></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Wenn man die CA auf einem FAT-<a class="internal" href="./dateisystem.html">Dateisystem</a> - bspw. einem USB-Stick - erstellt, bekommt man auf Grund der Großbuchstaben im Verzeichnisnamen "demoCA" Probleme. FAT unterscheidet nicht zwischen Groß- und Kleinbuchstaben, so dass Linux alle Dateinamen als Kleinbuchstaben behandelt. Um Komplikationen aus dem Weg zu gehen sollte man in diesem Fall den Verzeichnisnamen von vorneherein in etwas "kleines", z.B. <em>democa</em>, umwandeln. Das geschieht in der Datei <strong>/usr/lib/ssl/openssl.cnf</strong>, in der man folgende Deklaration abändern muss <sup><a href="#source-3">[3]</a></sup>: 
</p><pre class="notranslate">[ CA_default ] 
dir             = ./demoCA              # Where everything is kept</pre><p>
Außerdem muss die Variable "<code class="notranslate">$CATOP</code>" in <strong>/usr/lib/ssl/misc/CA.pl</strong> entsprechend angepasst werden.
</p></div></div><p>Als nächstes sollte man sicherheitshalber noch allen Gruppen und anderen Benutzern sämtliche Rechte am <strong>private</strong>-Verzeichnis entziehen <sup><a href="#source-4">[4]</a></sup>. Die CA ist jetzt fertig und einsatzbereit.</p><p><a class="crosslink anchor" href="#Signieren" id="Signieren"></a>
</p></div><div class="section_2"><h3 id="Zertifikate-signieren">Zertifikate signieren<a class="headerlink" href="#Zertifikate-signieren">¶</a></h3><p>
Mit dieser CA fängt man nun an die eigentlichen Zertifikate zu signieren, die man dann bspw. auf seinen Servern einsetzt. Auch hierfür verwendet man das <strong>CA.pl</strong>-Skript. Das Signieren läuft in zwei Stufen ab. Als erstes erstellt man einen neuen privaten Schlüssel und einen "Zertifikatsantrag" (<code class="notranslate">CA.pl -newreq</code>). Anschließend signiert man den Zertifikatsantrag (<code class="notranslate">CA.pl -sign</code>). Damit das Skript funktioniert, muss man sich im selben Verzeichnis befinden in dem man auch die CA erstellt hat, also eines oberhalb von <strong>demoCA</strong>.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Bei <em>"Common Name"</em> trägt man exakt den vollqualifizierten Domainnamen (FQDN im Format <code class="notranslate">servername.domain.topleveldomain</code>, z.B. <code class="notranslate">www.beispiel-worpswede.de</code>) des Servers ein, sonst wird das Zertifikat von den Clients später nicht akzeptiert. 
</p></div></div><div class="bash"><div class="contents"><pre class="notranslate">/usr/lib/ssl/misc/CA.pl -newreq </pre></div></div><p>
Ausgabe:
</p><pre class="notranslate">Generating a 1024 bit RSA private key
.........................++++++
....................++++++
writing new private key to 'newkey.pem'
Enter PEM pass phrase:                                            # eine andere Passphrase für dieses Zertifikat wählen
Verifying - Enter PEM pass phrase:                                # Passphrase wiederholen
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) []:                                  # z.B. DE, oder mit &lt;Enter&gt; leer lassen
State or Province Name (full name) []:                            # z.B. Niedersachsen, oder mit &lt;Enter&gt; leer lassen
Locality Name (eg, city) []:                                      # z.B. Worpswede, oder mit &lt;Enter&gt; leer lassen
Organization Name (eg, company) [Internet Widgits Pty Ltd]:       # z.B. Karl-Heinz Beispiel GmbH, muss mit CA übereinstimmen (s. Policy)
Organizational Unit Name (eg, section) []:                        # kann man wieder auslassen
Common Name (eg, YOUR name) []:                                   # muss unbedingt der reale Name des Dienstes sein
                                                                  # z.B. www.beispiel-worpswede.de
Email Address []:                                                 # z.B. abc@beispiel.de, oder mit &lt;Enter&gt; leer lassen

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:                                          # &lt;Enter&gt; drücken
An optional company name []:                                      # &lt;Enter&gt; drücken
Request is in newreq.pem, private key is in newkey.pem</pre><p>Beim Signieren des Zertifikatsantrags wird nicht nur die Gültigkeitsdauer (s. <a class="crosslink" href="#CAerstellen">Erstellen der neuen CA</a>) sondern auch der Verwendungszweck festgelegt. Per Default werden Zertifikate ohne besonderen Verwendungszweck ausgestellt. Für Webserver empfiehlt es sich allerdings den Zertifikatstyp und Verwendungszweck als zusätzliche X.509 v3-Erweiterungen hinzuzufügen. Dazu muss wieder die OpenSSL-Konfiguration <strong>/usr/lib/ssl/openssl.cnf</strong> angepasst werden.
</p><pre class="notranslate">...
[ usr_cert ]
...
basicConstraints=critical,CA:FALSE
...
nsCertType = server
...
keyUsage = critical,keyEncipherment
extendedKeyUsage = serverAuth
...</pre><p>Jetzt wird der Zertifikatsantrag signiert und das neue Zertifkat mit den oben konfigurierten Attributen (X.509 v3-Erweiterungen) ausgestellt. Zuvor muss noch der Zertifikatsantrag ins aktuelle Verzeichnis kopiert werden, damit klar ist welcher Antrag signiert werden soll (es können ja bereits mehrere Zertifikatsanträge ausgestellt worden sein).</p><div class="bash"><div class="contents"><pre class="notranslate">cp demoCA/newreq.pem .
/usr/lib/ssl/misc/CA.pl -sign </pre></div></div><p>Ausgabe:</p><pre class="notranslate">Using configuration from /usr/lib/ssl/openssl.cnf
Enter pass phrase for ./demoCA/private/cakey.pem:                 # Passphrase des CA-Schlüssels (erste Passphrase) angeben
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number:
            c3:ba:a2:3f:4b:7a:c1:ec
        Validity
            Not Before: Jun 16 22:25:19 2007 GMT
            Not After : Jun 15 22:25:19 2008 GMT
        Subject:
            organizationName          = Karl-Heinz Beispiel GmbH
            commonName                = www.beispiel-worpswede.de
        X509v3 extensions:
            X509v3 Basic Constraints: critical 
                CA:FALSE
            Netscape Cert Type: 
                SSL Server
            X509v3 Key Usage: critical
                Key Encipherment
            X509v3 Extended Key Usage: 
                TLS Web Server Authentication
            Netscape Comment: 
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier: 
                7D:A0:95:41:D5:D5:8C:D2:37:C8:6C:02:24:29:7A:9D:EB:2C:8F:41
            X509v3 Authority Key Identifier: 
                keyid:47:EA:3D:2B:41:8B:29:EE:A5:56:E1:8E:3A:AD:15:0C:F8:AD:D0:73

Certificate is to be certified until Jun 15 22:25:19 2008 GMT (365 days)
Sign the certificate? [y/n]:                                      # unbedingt &lt;y&gt; eingeben, nicht nur &lt;Enter&gt;


1 out of 1 certificate requests certified, commit? [y/n]          # ebenfalls &lt;y&gt; eingeben
Write out database with 1 new entries
Data Base Updated
Signed certificate is in newcert.pem</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die Passphrase im Signierschritt ist natürlich die des privaten CA-Schlüssels, und nicht die des Server-Schlüssels den wir gerade erstellen. Außerdem muss man darauf achten am Ende wirklich mit <em>"y"</em> zu bestätigen, sonst bricht das Skript mit einem Fehler ab.
</p></div></div><p>Im aktuellen Verzeichnis - immer noch das von <strong>demoCA</strong> übergeordnete - befinden sich jetzt die Dateien:
</p><ul><li><p><strong>newreq.pem</strong> - Zertifikatsantrag</p></li><li><p><strong>newcert.pem</strong> - Signiertes öffentliches Zertifikat</p></li></ul><p>
<strong>newreq.pem</strong> ist inzwischen nutzlos geworden und kann gelöscht werden. Wichtig sind nur die beiden Dateien newcert.pem und demoCA/newkey.pem. Diesen sollte man aussagekräftigere Namen geben und sie zur Archivierung in das jeweilige demoCA-Unterverzeichnis verschieben. Wer das Schlüsselpaar auf einem Server benutzen möchte und nicht bei jedem Server-Start die Passphrase des privaten Schlüssels eingeben will, kann dieses noch vorher aus dem privaten Schlüssel löschen. In diesem Fall sollte man aber auf jeden Fall darauf achten, dass der private Schlüssel ohne Passphrase durch restriktive Dateirechte<sup><a href="#source-4">[4]</a></sup> auf dem Server vor neugierigen Blicken geschützt wird:</p><div class="bash"><div class="contents"><pre class="notranslate">openssl rsa -in demoCA/newkey.pem -out newkey-without-password.pem
mv newkey-without-password.pem demoCA/private/worpswede_key.pem
mv newcert.pem demoCA/certs/worpswede_cert.pem </pre></div></div><p>Diese zwei Dateien sind es auch, die der betreffende Server zum SSL-Betrieb benötigt. Die Datei <strong>demoCA/newkey.pem</strong> kann jetzt ebenfalls gelöscht werden. (Nachdem man sich davon überzeugt hat, dass mit der Umwandlung alles geklappt hat, und <strong>newkey-without-password.pem</strong> nicht etwa leer ist.)</p><p>Wo diese Dateien auf dem Server letztendlich hinkopiert werden müssen, hängt vom benutzten Server ab. Üblich sind aber die Verzeichnisse <strong>/etc/ssl/certs/</strong> und <strong>/etc/ssl/private/</strong>.</p><p><a class="crosslink anchor" href="#Import" id="Import"></a>
</p></div><div class="section_2"><h3 id="CA-Zertifikat-importieren">CA-Zertifikat importieren<a class="headerlink" href="#CA-Zertifikat-importieren">¶</a></h3><p>
Als nächstes muss auf allen Clients, die das neue Server-Zertifikat akzeptieren sollen, die CA-Zertifikatsdatei <strong>demoCA/cacert.pem</strong> installiert werden. Wie das bei Ubuntu funktioniert ist weiter oben im Kapitel <a class="crosslink" href="#CAhinzufuegen">CAs in Ubuntu hinzufügen</a> beschrieben.</p><p><a class="crosslink anchor" href="#Erneuern" id="Erneuern"></a>
</p></div><div class="section_2"><h3 id="Zertifikate-erneuern">Zertifikate erneuern<a class="headerlink" href="#Zertifikate-erneuern">¶</a></h3><p>
In der Regel bekommt man vor Ablauf eines Zertifikats einen entsprechenden Hinweis von der öffentlichen Zertifizierungsstelle. Betreibt man eine eigene CA, sollte man einen Kalendereintrag vor dem Ablauf von Zertifikaten anlegen, oder die Zertifikate per Monitoring überwachen, z.B. mit <a class="internal" href="./howto/check_mk.html">Check_MK</a>.</p><p>Es gibt dann 2 Möglichkeiten das Zertifikat zu erneuern:
</p><ul><li><p>Zertifikatsantrag mit dem alten privaten Schlüssel - Dies ist nur in den wenigsten Fällen sinnvoll, und wird auch nicht vom hier verwendete Perl-Skript unterstützt.</p></li><li><p>Zertifikatsantrag mit neuem privaten Schlüssel - Dies ist der Standardfall. Sowohl der private Schlüssel als auch das signierte Zertifikat werden vollständig neu generiert. Das hier verwendete Perl-Skript erstellt ebenfalls mit jedem Zertifikatsantrag einen neuen privaten Schlüssel. Das Vorgehen ist im Kapitel <a class="crosslink" href="#Signieren">Zertifikate signieren</a> beschrieben.</p></li></ul><p>
</p></div><div class="section_2"><h3 id="Problembehebung">Problembehebung<a class="headerlink" href="#Problembehebung">¶</a></h3><p>
</p><div class="section_3"><h4 id="Nutzung-auf-einem-Webserver">Nutzung auf einem Webserver<a class="headerlink" href="#Nutzung-auf-einem-Webserver">¶</a></h4><p>
Soll das erstellte Zertifikat den eigenen Webserver authentifizieren (hier eine Synology Disk Station), müssen noch ein paar Anpassungen am Server-Schlüsselpaar erledigt werden. Das öffentliche Zertifikat (worpswede_cert.pem) wird mit einem Texteditor geöffnet und alles ausserhalb von <code class="notranslate">-----BEGIN CERTIFICATE-----</code> und <code class="notranslate">-----END CERTIFICATE-----</code> gelöscht. Anschließend wird der private Schlüssel (worpswede_key.pem) vom Passwort befreit:
</p><div class="bash"><div class="contents"><pre class="notranslate">openssl rsa -in worpswede_key.pem -out worpswede_key-ohne-passwort.pem </pre></div></div><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Der neue private Schlüssel ist nicht mehr passwortgeschützt. Falls die Datei gelöscht werden soll, muss ein <a class="internal" href="./daten_sicher_löschen.html">sicheres Verfahren</a> benutzt werden!
</p></div></div></div><div class="section_3"><h4 id="Zertifikat-kann-nicht-gelesen-werden">Zertifikat kann nicht gelesen werden<a class="headerlink" href="#Zertifikat-kann-nicht-gelesen-werden">¶</a></h4><p>
Beim manuellen Einlesen eines Zertifikates aus einer PEM-Datei muss alles vor "-----BEGIN CERTIFICATE-----" entfernt werden.</p><p><a class="crosslink anchor" href="#Links" id="Links"></a>
</p></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="./ssl-cert.html">ssl-cert</a> - Paket <strong>ssl-cert</strong> für selbstsignierte Zertifikate</p></li><li><p><a class="internal" href="./apache/ssl.html">Apache/SSL</a></p></li><li><p><a class="external" href="https://opsec.eu/src/tinyca/" rel="nofollow">TinyCA</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Graphische Oberfläche für den Betrieb einer eigenen kleinen CA (Gtk2-Perl)</p></li><li><p><a class="external" href="http://gnomint.sourceforge.net/" rel="nofollow">gnoMint</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Grafische Verwaltung einer CA (GTK+/C++)</p></li><li><p><a class="internal" href="./cacert.html">CAcert</a> - Community, die kostenlose SSL-Zertifikate ausstellt</p></li><li><p><a class="interwiki interwiki-heise" href="https://www.heise.de/-2460155">Let's Encrypt: Mozilla und die EFF mischen den CA-Markt auf</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - heise Security, 11/2014</p></li><li><p><a class="interwiki interwiki-heise" href="https://www.heise.de/-880221">SSL für lau - Kostenlose Zertifikate  einrichten</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - heise Security, 01/2010</p></li></ul><p>
</p><ul class="footnotes"><li><a class="crosslink" href="#bfn-1" id="fn-1">1</a>: <a class="external" href="https://wiki.mozilla.org/NSS:Root_certs" rel="nofollow" title="https://wiki.mozilla.org/NSS:Root_certs">https://wiki.mozilla.org/NSS:Root_certs</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - NSS:Root certs</li><li><a class="crosslink" href="#bfn-2" id="fn-2">2</a>: <a class="external" href="https://tools.ietf.org/html/rfc5280" rel="nofollow">RFC 5280 - Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></li></ul></div></div>
<p class="meta">
<a href="./ca/a/revision/945809.html">Diese Revision</a> wurde am 29. Dezember 2017 00:56 von <a href="https://ubuntuusers.de/user/BillMaier/">BillMaier</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./ca.html">CA</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>