<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>System_verschlüsseln › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./system_verschlüsseln.html">System verschlüsseln</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/System_verschlüsseln">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./system_verschlüsseln/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./system_verschlüsseln/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./system_verschlüsseln/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./system_verschlüsseln/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./system_verschlüsseln/a/backlinks.html">System verschlüsseln</a></h1>
<div id="page"><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Das Verschlüsseln von Daten kann der Sicherheit bei der Wahrung der Privatsphäre oder sensibler Daten dienen, beinhaltet aber in der Konsequenz, dass eine eventuell zukünftig notwendige Datenrettung durch eine manuelle Entschlüsselung erschwert werden kann. Eine Entscheidung für oder gegen eine Datenverschlüsselung sollte daher nicht leichtfertig erfolgen. Empfohlen wird eine individuelle Nutzen-Risiko-Abwägung bezogen auf Anwendungsbereich, Computerkenntnisse des Nutzers oder ähnliche Faktoren, um die Gefahr eines späteren Datenverlusts zu minimieren.</p><p>Ohne ein sicheres Kennwort nutzt die stärkste Verschlüsselung nichts! Wie man Passwörter am besten wählt, steht hier: <a class="internal" href="./sicherheits_1x1.html#Passwoerter">Sicherheits 1x1</a>
</p></div></div><p>
</p><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./ubuntu_installation.html">Ubuntu installieren</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./internetzugang.html">Internetverbindung einrichten</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-5" id="source-5"></a> <a class="internal" href="./partitionierung.html">Festplatten in Partitionen einteilen</a></p></li><li><p><a class="crosslink anchor" href="#source-6" id="source-6"></a> <a class="internal" href="./luks.html">Verschlüsselte Partitionen mit LUKS</a></p></li><li><p><a class="crosslink anchor" href="#source-7" id="source-7"></a> <a class="internal" href="./logical_volume_manager.html">Partitionen mit LVM erstellen</a></p></li><li><p><a class="crosslink anchor" href="#source-8" id="source-8"></a> <a class="internal" href="./skripte/gerät_mit_pseudozufallszahlen_überschreiben.html">Gerät mit Pseudozufallszahlen überschreiben</a></p></li><li><p><a class="crosslink anchor" href="#source-9" id="source-9"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-10" id="source-10"></a> <a class="internal" href="./systeminformationen_ermitteln.html#Festplatten">Systeminformationen ermitteln</a></p></li><li><p><a class="crosslink anchor" href="#source-11" id="source-11"></a> <a class="internal" href="./grub_2/konfiguration.html">Bootloader konfigurieren</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Vorbereitungen">Vorbereitungen
</a><ol class="arabic"><li><a class="crosslink" href="#Software-und-Kernelmodule-laden">Software und Kernelmodule laden
</a></li><li><a class="crosslink" href="#Partitionierung">Partitionierung
</a></li><li><a class="crosslink" href="#Verschluesselung-der-Partition">Verschlüsselung der Partition
</a></li><li><a class="crosslink" href="#Erstellung-der-LVM-Partitionen">Erstellung der LVM-Partitionen
</a></li></ol></li><li><a class="crosslink" href="#Installation">Installation
</a><ol class="arabic"><li><a class="crosslink" href="#Ins-verschluesselte-System-wechseln">Ins verschlüsselte System wechseln
</a><ol class="arabic"><li><a class="crosslink" href="#Software-installieren">Software installieren
</a></li><li><a class="crosslink" href="#etc-crypttab-editieren">/etc/crypttab editieren
</a></li><li><a class="crosslink" href="#etc-modules-editieren">/etc/modules editieren
</a></li><li><a class="crosslink" href="#Kernel-Initramfs-aktualisieren">Kernel-Initramfs aktualisieren
</a></li><li><a class="crosslink" href="#GRUB-Konfiguration-aktualisieren-ueberpruefen">GRUB-Konfiguration aktualisieren/überp...</a></li></ol></li><li><a class="crosslink" href="#Beenden-Neustart">Beenden/Neustart
</a></li></ol></li><li><a class="crosslink" href="#Passwort-aendern">Passwort ändern
</a><ol class="arabic"><li><a class="crosslink" href="#Schluessel-hinzufuegen">Schlüssel hinzufügen
</a></li><li><a class="crosslink" href="#Schluessel-entfernen">Schlüssel entfernen
</a></li></ol></li><li><a class="crosslink" href="#Informationen-anzeigen">Informationen anzeigen
</a><ol class="arabic"><li><a class="crosslink" href="#bersicht-ueber-den-LUKS-Header-ausgeben">Übersicht über den LUKS Header ausgeben
</a></li><li><a class="crosslink" href="#Pruefen-ob-der-TRIM-Befehl-durchgereicht-wird">Prüfen ob der TRIM-Befehl durchgereicht ...</a></li></ol></li><li><a class="crosslink" href="#Probleme-beim-Start">Probleme beim Start
</a></li><li><a class="crosslink" href="#Alternative-Installation-mit-Hilfe-eines-Skripts">Alternative - Installation mit Hilfe eines...</a></li><li><a class="crosslink" href="#Alternatives-Entschluesseln-der-Systempartition-mit-einem-USB-Schluessel">Alternatives Entschlüsseln der Systemparti...</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/security.png" class="image-left" src="./_/41964c605d00862ffb1a26a04504ddefdfeb498d.png"/>
Das Ubuntu-System lässt sich seit Ubuntu 12.10 bereits automatisch bei der <a class="internal" href="./installation.html">Installation</a> verschlüsseln. Diese Anleitung installiert Ubuntu durch manuelle statt automatische <a class="internal" href="./partitionierung.html">Partitionierung</a> in einem verschlüsselten Bereich, so dass man Einfluss auf die Partitionierung hat.  Wie bei der automatischen Installation bleibt die Boot-Partition, und bei einem <a class="internal" href="./efi.html">UEFI-System</a> zusätzlich die EFI-Partition, unverschlüsselt. Hier befinden sich lediglich Bootlader und Kernel, weil der Bootlader keine Daten aus dem verschlüsselten Bereich lesen kann.</p><p>Es wird der <a class="internal" href="./logical_volume_manager.html">Logical Volume Manager</a> eingesetzt, da mit diesem beim Start nur eine Passworteingabe nötig ist, der <a class="internal" href="./energiesparmodi_mit_acpi.html#ACPI-SUSPEND-Modi-S0-S1-S2-S3-S4-S5">Ruhezustand (S4)</a> noch funktioniert und er, was die Partitionierung angeht, sehr flexibel ist.</p><p>Alternativ ist es auch möglich, das System <a class="internal" href="./system_verschlüsseln/schlüsselableitung.html">ohne LVM zu verschlüsseln</a>, jedoch ist diese Variante weniger flexibel, was nachträgliche Partitionsänderungen innerhalb des LVM angeht. Außerdem kann man das System auch mit der <a class="internal" href="./system_verschlüsseln/alternate_installation.html">nicht-grafischen Installation verschlüsseln</a>, was die Option der Wahl ist, wenn keine Internet-Verbindung zur Verfügung steht.</p><div class="section_1"><h2 id="Vorbereitungen">Vorbereitungen<a class="headerlink" href="#Vorbereitungen">¶</a></h2><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle folgenden Befehle benötigen <a class="internal" href="./sudo.html">Root-Rechte</a>. Man sollte also entweder immer <code class="notranslate">sudo</code> vor das betreffende Kommando setzen oder mit <code class="notranslate">sudo -s</code> Root-Status erlangen!
</p></div></div><p>Wenn sich auf dem Computer schon ein Betriebssystem (wie beispielsweise Windows, Mac OS oder ein anderes Linux-System) oder wichtige Daten befinden, sollte von den wichtigen Daten unbedingt eine Sicherung erstellt werden. Wie bei jeder Veränderung am Computer kann immer auch etwas schiefgehen.</p><p>Zur Installation wird die normale Desktop-CD benötigt. Diese einfach booten <sup><a href="#source-1">[1]</a></sup>. Nachdem das Live-System geladen wurde, jedoch nicht das Installationsprogramm ausführen. Es wird zwingend eine funktionierende Internetverbindung <sup><a href="#source-2">[2]</a></sup> benötigt, da Programme nachinstalliert werden müssen.</p><div class="section_2"><h3 id="Software-und-Kernelmodule-laden">Software und Kernelmodule laden<a class="headerlink" href="#Software-und-Kernelmodule-laden">¶</a></h3><p>
Bei älteren Versionen unterstützt die Desktop-CD von Haus aus kein <a class="internal" href="./logical_volume_manager.html">LVM</a>. Mindestens seit 13.10 ist die Unterstützung aber vorhanden. Bei älteren Versionen kann man dies durch die Installation des folgenden Pakets <sup><a href="#source-3">[3]</a></sup> korrigieren:</p><ul><li><p><strong>lvm2</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install lvm2 </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install lvm2 </pre></div></div><p>
</p></div></div></div><div class="section_2"><h3 id="Partitionierung">Partitionierung<a class="headerlink" href="#Partitionierung">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p><strong>/dev/sdX1</strong> bzw. <strong>/dev/sdX2</strong> muss im Folgenden immer durch die tatsächliche Bezeichnung <sup><a href="#source-10">[10]</a></sup> der Partition ersetzt werden!
</p></div></div><p>Zwei Partitionen werden benötigt <sup><a href="#source-5">[5]</a></sup>:
</p><ul><li><p><strong>/dev/sdX1</strong> (ext4)</p><ul><li><p>Boot-Partition (unverschlüsselt)</p></li><li><p>Größe: mindestens 250 MB (um für 4 Kernel Platz zu lassen, genauere Erklärung unter <a class="internal" href="./manuelle_partitionierung.html#Vorueberlegungen">Manuelle Partitionierung</a>)</p></li></ul></li><li><p><strong>/dev/sdX2</strong> (unformatiert)</p><ul><li><p>verschlüsseltes LVM-Volume</p></li><li><p>Größe: üblicherweise der verfügbare Rest, aber mindestens 8 GB (root + Arbeitsspeicher)</p></li></ul></li></ul><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Man sollte sich vorab darüber informieren, ob der Rechner mit einem <a class="internal" href="./efi_bootmanagement.html">EFI Bootmanagement</a> versehen ist und wie die Festplatte(n) <a class="internal" href="./grub_2/grundlagen.html">formatiert</a> wurden! Weitere Informationen stehen unter <a class="internal" href="./efi_grundlagen.html">EFI Grundlagen</a> zur Verfügung!
</p></div></div><p>
Bei EFI-Systemen ist zu beachten, dass auf jeden Fall neben der unverschlüsselten Boot-Partition noch eine unverschlüsselte <a class="internal" href="./grub_2/grundlagen.html#Mit-EFI">EFI-Partition</a> anzulegen ist. Eine Alternative wäre die Nutzung des BIOS-Kompatibilitätsmodus <strong>CSM</strong>.</p></div><div class="section_2"><h3 id="Verschluesselung-der-Partition">Verschlüsselung der Partition<a class="headerlink" href="#Verschluesselung-der-Partition">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Es ist aus Sicherheitsgründen empfehlenswert, die Partition ein Mal mit Zufallszahlen zu überschreiben, vor allen Dingen, wenn auf dieser vorher unverschlüsselte Daten gespeichert waren. <sup><a href="#source-8">[8]</a></sup> Ansonsten sind unter Umständen viele Dateien nach dem Verschlüsseln noch auslesbar.
</p></div></div><p>Daraufhin wird in der großen Partition ein LUKS-Medium erstellt und anschließend mit dem Namen <strong>lukslvm</strong> geöffnet <sup><a href="#source-6">[6]</a></sup>. Beim Einsatz von <a class="interwiki interwiki-wikipedia_en" href="https://en.wikipedia.org/wiki/XEX-TCB-CTS#XTS">XTS</a> mit 256 Bit <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Advanced_Encryption_Standard">AES</a> sehen die Befehle <sup><a href="#source-4">[4]</a></sup> wie folgt aus:</p><div class="bash"><div class="contents"><pre class="notranslate">cryptsetup luksFormat -c aes-xts-plain64 -s 512 -h sha512 /dev/sdX2
cryptsetup luksOpen /dev/sdX2 lukslvm </pre></div></div><p>XTS benötigt einen Verwaltungsschlüssel mit einer Länge von 128 oder 256 Bit. Die Länge des Verwaltungsschlüssels muss zur Schlüssellänge hinzuaddiert werden. Mit AES sind also Gesamtschlüssellängen von 256, 320, 384, 448 oder 512 Bit möglich.</p></div><div class="section_2"><h3 id="Erstellung-der-LVM-Partitionen">Erstellung der LVM-Partitionen<a class="headerlink" href="#Erstellung-der-LVM-Partitionen">¶</a></h3><p>
Mit folgenden Befehlen <sup><a href="#source-4">[4]</a></sup> wird das LVM-Volume in der verschlüsselten Partition erzeugt.<sup><a href="#source-7">[7]</a></sup></p><div class="bash"><div class="contents"><pre class="notranslate">pvcreate /dev/mapper/lukslvm
vgcreate vgubuntu /dev/mapper/lukslvm </pre></div></div><p>Bei einer Standard-Installation von Ubuntu werden zwei Partitionen angelegt, eine für den <a class="internal" href="./swap.html">Swap-Speicher</a> - üblicherweise das ca. 1,3fache des RAMs, also bei 1024 MB Arbeitsspeicher knapp 1300 MB - und eine für das Root-Dateisystem mit dem restlichen Speicherplatz. Diese werden wie folgt als Logical Volume <sup><a href="#source-7">[7]</a></sup> erstellt:</p><div class="bash"><div class="contents"><pre class="notranslate">lvcreate -L 1300M -n swap vgubuntu
lvcreate -l 100%FREE -n root vgubuntu </pre></div></div><p>Sollten noch weitere Partitionen benötigt werden, können diese genauso eingerichtet werden. Natürlich darf dann für root nicht 100% des verfügbaren Platzes vergeben werden.</p><p>Wegen Problemen mit dem Live-CD-Installer müssen alle Partitionen vorher manuell formatiert werden.
Mit der Option -L name kann der Partition noch eine Bezeichnung (Label) gegeben werden:</p><div class="bash"><div class="contents"><pre class="notranslate">mkswap /dev/mapper/vgubuntu-swap -L swap
mkfs.ext4 /dev/mapper/vgubuntu-root -L root </pre></div></div></div></div><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
<img alt="Partitionierung.png" class="image-right" src="./_/d01efe22df78d51c0dd25fec4ffb6465abcffe83.png"/></p><p>Danach wird das Installationsprogramm gestartet <sup><a href="#source-1">[1]</a></sup> und mit diesem bis <a class="internal" href="./ubuntu_installation.html#Auswahl-der-Partition-bzw-Partitionierung-und-Bootloader">Auswahl der Partitionierung</a> fortgefahren, bei dem die <em>"manuelle Partitionierung"</em> ausgewählt wird.</p><p>Im nächsten Installationspunkt werden die folgenden Partitionen jeweils mit einem Doppelklick auf die entsprechenden Einträge konfiguriert. Die Swap-Partition braucht nicht ausgewählt zu werden, da sie automatisch erkannt wird.</p><p>Für die Einhängepunkte <strong>/</strong>, <strong>/tmp</strong>, <strong>/var</strong> und <strong>/usr</strong> sollte man das Häkchen zum Formatieren der Partition setzen, da sonst die Installation bei der Statusmeldung "Installierte Pakete werden gesichert." nicht mehr weiterläuft und hängen bleibt. Dieses Problem wurde in Kubuntu 14.04 festgestellt.</p><ul><li><p><strong>/dev/sdX1</strong></p><ul><li><p>Boot-Partition</p></li><li><p>Dateisystem: <strong>ext4</strong></p></li><li><p>Formatieren: <em>"ja"</em></p></li><li><p>Einhängepunkt: <strong>/boot</strong></p></li></ul></li><li><p><strong>/dev/mapper/vgubuntu-root</strong></p><ul><li><p>Root-Partition</p></li><li><p>Dateisystem: <strong>ext4</strong> oder gewünschtes <a class="internal" href="./dateisystem.html#Linux-Dateisysteme">Linux-Dateisystem</a></p></li><li><p>Formatieren: <em>"ja"</em></p></li><li><p>Einhängepunkt: <strong>/</strong></p></li></ul></li></ul><p>
Es ist darauf zu achten, dass der Bootloader auf einem sinnvollen Gerät außerhalb des verschlüsselten Containers installiert wird, z.B. dem Master Boot Record der Festplatte (<em>„Device for Bootloader installation:“</em> <strong>/dev/sdX</strong>). Danach wird gemäß Anleitung <sup><a href="#source-1">[1]</a></sup> mit der Installation fortgefahren, jedoch nach dem Abschluss der Installation nicht neugestartet.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Eventuelle Änderungen an Partitionen können nicht mehr rückgängig gemacht werden! 
</p></div></div><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Sollte parallel Windows installiert und mit <a class="internal" href="./veracrypt.html">VeraCrypt</a> bzw. <a class="internal" href="./truecrypt.html">TrueCrypt</a> verschlüsselt worden sein, muss <a class="internal" href="./grub.html">GRUB</a> in die Boot-Partition <strong>/dev/sdX1</strong> anstelle des MBRs installiert werden. Das muss im <a class="internal" href="./ubuntu_installation.html#Schritt-7-berpruefung-und-Auswahl-Speicherort-Bootloader">Installations-Punkt 7</a> unter <em>"Erweitert"</em> eingestellt werden. Dort muss anstelle von <strong>hd0</strong> die Boot-Partition ausgewählt werden. GRUB erscheint dann, sobald 
<span class="key">Esc</span>  im VeraCrypt /  Truecrypt-Bootloader gedrückt wird.</p><p>Bei <a class="internal" href="./efi_bootmanagement.html">EFI Bootmanagement</a> ist es egal, welche Einstellung man für den Bootloader wählt. Er wird immer in die EFI-Partition installiert. Allerdings muss man der EFI-Partition die Auswahl <a class="internal" href="./efi_installieren.html#Installationsart-Etwas-Anderes">EFI-Boot-Partition zuweisen</a>.
</p></div></div><div class="section_2"><h3 id="Ins-verschluesselte-System-wechseln">Ins verschlüsselte System wechseln<a class="headerlink" href="#Ins-verschluesselte-System-wechseln">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Alle folgenden Befehle müssen in ein und demselben Terminal <sup><a href="#source-4">[4]</a></sup> ausgeführt werden.
</p></div></div><p>Um die nötigen Anpassungen vorzunehmen, wird mittels <a class="internal" href="./chroot.html">chroot</a> in das eigentliche, verschlüsselte System gewechselt. Das geschieht durch die Eingabe der folgenden Befehle. Es ist dabei zu beachten, dass man, falls man zusätzliche Partitionen wie z.B. <strong>/var</strong> angelegt hat, diese ebenfalls vor dem chroot-Befehl noch entsprechend mounten muss:</p><div class="bash"><div class="contents"><pre class="notranslate"># root Filesystem
mount /dev/mapper/vgubuntu-root /mnt
# boot Filesystem
mount /dev/sdX1 /mnt/boot
# Notwendige system-interne Filesysteme
mount -o rbind /dev /mnt/dev
mount -t proc proc /mnt/proc
mount -t sysfs sys /mnt/sys
# Zusätzliche LVM Verzeichnisse (notwendig bei 15.10, evtl. auch hilfreich bei früheren Releases)
mount -o rbind /run/lvm      /mnt/run/lvm
mount -o rbind /run/lock/lvm /mnt/run/lock/lvm
# DNS-Auflösung im verschlüsseltem System ermöglichen
cp /etc/resolv.conf /mnt/etc/resolv.conf
# In das verschlüsselte System wechseln
chroot /mnt /bin/bash </pre></div></div><p>Bei <a class="internal" href="./efi_bootmanagement.html">EFI Bootmanagement</a> muss Zeile 2 durch die beiden folgenden ersetzt werden:
</p><div class="bash"><div class="contents"><pre class="notranslate">mount /dev/sdX2 /mnt/boot
mount /dev/sdX1 /mnt/boot/efi  </pre></div></div><p>
In der Regel ist die EFI-Partition <code class="notranslate">sdX1</code>, worauf die Bootpartition <strong>/mnt/boot</strong> mit <code class="notranslate">sdX2</code> folgt.</p><div class="section_3"><h4 id="Software-installieren">Software installieren<a class="headerlink" href="#Software-installieren">¶</a></h4><p>
Die benötigten Pakete werden mit diesem Befehl <sup><a href="#source-4">[4]</a></sup> installiert:</p><div class="bash"><div class="contents"><pre class="notranslate">apt-get install cryptsetup lvm2 </pre></div></div></div><div class="section_3"><h4 id="etc-crypttab-editieren">/etc/crypttab editieren<a class="headerlink" href="#etc-crypttab-editieren">¶</a></h4><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Gegebenenfalls ist die Datei <strong>/etc/crypttab</strong> noch nicht vorhanden. Mit der unten beschriebenen kompakten Methode lässt diese sich einfach erstellen.</p><p>Grundsätzlich ist die crypttab wie folgt aufgebaut:
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>&lt;target name&gt;	&lt;source device&gt;		&lt;key file&gt;	&lt;options&gt;
</pre></div>
</td></tr></table></div><p>
</p></div></div><p>Zuerst muss die <a class="internal" href="./uuid.html">UUID</a> der verschlüsselten Partition bzw. des verschlüsselten LVM-Volumes ermittelt werden. Das geschieht mit folgendem Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">blkid /dev/sdX2 </pre></div></div><p>Daraufhin wird mit dieser Eingabe die nötige Zeile in <strong>/etc/crypttab</strong> eingefügt, wobei <code class="notranslate">&lt;VOLUME_ID&gt;</code> vorher durch die ermittelte UUID ersetzt werden muss. Die UUID muss dabei ohne Anführungszeichen in die <strong>/etc/crypttab</strong> eingetragen werden (also <code class="notranslate">xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</code> statt <code class="notranslate">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</code>). Falls zuvor, beim Öffnen der verschlüsselten Partition mit <code class="notranslate">luksOpen</code>, ein anderer Name als lukslvm angegeben wurde, dann muss genau dieser eingetragen werden - weicht der Eintrag in /etc/crypttab vom aktuell verwendeten Namen ab, kann beim Neustart die Partition nicht entschlüsselt werden:</p><div class="bash"><div class="contents"><pre class="notranslate">echo "lukslvm UUID=&lt;VOLUME_ID&gt; none luks" &gt;&gt; /etc/crypttab </pre></div></div><p>Neuere Versionen von cryptsetup können die UUID auch selbst ermitteln:
</p><div class="bash"><div class="contents"><pre class="notranslate">cryptsetup luksUUID /dev/sdX2 </pre></div></div><p>
oder kompakt:
</p><div class="bash"><div class="contents"><pre class="notranslate">printf "lukslvm\tUUID=%s\tnone\tluks\n" "$(cryptsetup luksUUID /dev/sdX2)" | tee -a /etc/crypttab </pre></div></div></div><div class="section_3"><h4 id="etc-modules-editieren">/etc/modules editieren<a class="headerlink" href="#etc-modules-editieren">¶</a></h4><p>
Nun muss noch unter <strong>/etc/modules</strong> das dm-crypt-Modul hinzugefügt werden, falls es dort noch nicht existiert:</p><div class="bash"><div class="contents"><pre class="notranslate">echo "dm-crypt" &gt;&gt; /etc/modules </pre></div></div></div><div class="section_3"><h4 id="Kernel-Initramfs-aktualisieren">Kernel-Initramfs aktualisieren<a class="headerlink" href="#Kernel-Initramfs-aktualisieren">¶</a></h4><p>
Um die Änderungen an der crypttab zu übernehmen, muss noch</p><div class="bash"><div class="contents"><pre class="notranslate">update-initramfs -u -k all </pre></div></div><p>
ausgeführt werden.</p></div><div class="section_3"><h4 id="GRUB-Konfiguration-aktualisieren-ueberpruefen">GRUB-Konfiguration aktualisieren/überprüfen<a class="headerlink" href="#GRUB-Konfiguration-aktualisieren-ueberpruefen">¶</a></h4><p>
Wenn die root-Partition mit aktiviertem "data journaling" gemountet werden soll, muss bereits beim Kernelstart ein entsprechender Kernel-Parameter angegeben werden. Der Eintrag in der <strong>/etc/fstab</strong> reicht dann nicht mehr aus, weil diese Datei erst dann gelesen werden kann, wenn das root-Dateisystem bereits entschlüsselt und in das System eingehängt wurde.
Unter <strong>/etc/default/grub</strong> editiert man die GRUB-Datei folgendermaßen:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">"kopt=root=/dev/mapper/vgubuntu-root"</span>
</pre></div>
</td></tr></table></div><p>Anschließend muss man Grub aktualisieren:
</p><div class="bash"><div class="contents"><pre class="notranslate"> update-grub </pre></div></div></div></div><div class="section_2"><h3 id="Beenden-Neustart">Beenden/Neustart<a class="headerlink" href="#Beenden-Neustart">¶</a></h3><p>
Mit den folgenden Befehlen wird die chroot-Umgebung geschlossen, die Dateisysteme soweit möglich ausgehängt und das System neugestartet. Das Installationsmedium (USB-Stick bzw. DVD) muss entfernt werden und beim anschließenden Bootvorgang sollte dann nach dem LUKS-Passwort gefragt werden.</p><div class="bash"><div class="contents"><pre class="notranslate"># Das verschlüsselte System verlassen
exit
# Puffer für Datenträger schreiben
sync
# "Gemountete" Filesystem wieder entfernen
umount /mnt/run/lvm
umount /mnt/run/lock/lvm
umount /mnt/sys
umount /mnt/proc
umount /mnt/boot/efi   # nur bei EFI-Systemen nötig
umount /mnt/boot
#
swapoff -a
#
reboot </pre></div></div></div></div><div class="section_1"><h2 id="Passwort-aendern">Passwort ändern<a class="headerlink" href="#Passwort-aendern">¶</a></h2><p>
Durch das vom Benutzer eingegebene Passwort wird lediglich ein Master-Schlüssel entschlüsselt, welche letztendlich für die Sicherheit des Dateisystems verwendet wird. Das hier verwendete LUKS ermöglicht es somit, dass das Passwort leicht geändert werden kann, ohne dass das ganze Dateisystem neu verschlüsselt werden muss. Der Generalschlüssel bleibt letztendlich der gleiche. Es können sogar mehrere Schlüssel (bis zu 8 Stück) gleichzeitig verwendet werden, der Generalschlüssel liegt dann einfach mehrfach mit den jeweils verwendeten Passwort vor, bei der Passwortabfrage muss dann nur der jeweilige Slot entsperrt werden können.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei einem Angriff auf das verschlüsselte System reicht es bereits, einen Slot zu entschlüsseln. Es ist also darauf zu achten, dass alle verwendeten Passwörter ausreichend sicher sind. Mehrere Passwörter zu verwenden, ist vor allem bei einem Mehrbenutzersystem sinnvoll. Alternativ lässt sich ein Zweitpasswort setzen, falls man das eigentlich verwendete Passwort vergisst. Auch kann man dasselbe Passwort in einem weiteren Slot abspeichern, um sich so vor Dateisystemfehlern in einem der Slots zu schützen.
</p></div></div><div class="section_2"><h3 id="Schluessel-hinzufuegen">Schlüssel hinzufügen<a class="headerlink" href="#Schluessel-hinzufuegen">¶</a></h3><p>
Der folgende Befehl fügt einen Schlüssel zum angegeben Laufwerk hinzu:</p><div class="bash"><div class="contents"><pre class="notranslate"> cryptsetup luksAddKey /dev/sdX2 </pre></div></div></div><div class="section_2"><h3 id="Schluessel-entfernen">Schlüssel entfernen<a class="headerlink" href="#Schluessel-entfernen">¶</a></h3><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Hier kann man sich unter Umständen vom System aussperren, sofern man nicht aufpasst. Bei einer Passwortänderung zunächst das gewünschte Passwort anlegen, eventuell testen und erst dann das alte Passwort löschen.
</p></div></div><p>Der folgende Befehl entfernt nachfolgend eingegebenen Schlüssel:</p><div class="bash"><div class="contents"><pre class="notranslate">cryptsetup luksRemoveKey /dev/sdX2 </pre></div></div></div></div><div class="section_1"><h2 id="Informationen-anzeigen">Informationen anzeigen<a class="headerlink" href="#Informationen-anzeigen">¶</a></h2><p>
</p><div class="section_2"><h3 id="bersicht-ueber-den-LUKS-Header-ausgeben">Übersicht über den LUKS Header ausgeben<a class="headerlink" href="#bersicht-ueber-den-LUKS-Header-ausgeben">¶</a></h3><p>
Der folgende Befehl gibt eine Übersicht über die Informationen, die der LUKS Header der verschlüsselten Partition enthält, aus. 
Damit ist z.B. zu erkennen, wie viele der 8 Schlüsselslots schon belegt und welche noch frei sind.
Auch wird darüber Auskunft erteilt, welche Verschlüsselungsmethode für diese Partition verwendet wird, so wie einige weitere Informationen, wie z.B. auch über die schon weiter oben erwähnte UUID.</p><div class="bash"><div class="contents"><pre class="notranslate"> cryptsetup luksDump /dev/sdX2 </pre></div></div></div><div class="section_2"><h3 id="Pruefen-ob-der-TRIM-Befehl-durchgereicht-wird">Prüfen ob der TRIM-Befehl durchgereicht wird<a class="headerlink" href="#Pruefen-ob-der-TRIM-Befehl-durchgereicht-wird">¶</a></h3><p>
Möchte man prüfen, ob der TRIM-Befehl, welcher für SSDs sinnvoll sein kann, bei einer LUKS Partition durchgereicht wird,
so kann dies mit folgendem Befehl geprüft werden.</p><div class="bash"><div class="contents"><pre class="notranslate"> cryptsetup status  /dev/mapper/lukslvm  </pre></div></div><p>Man beachte, dass bei diesem Beispiel cryptsetup auf die LVM-Partition und nicht auf <strong>/dev/sdX2</strong> angewendet wird.
Wenn dann neben dem Feld <em>"flags"</em> die Option <em>"discards"</em> angezeigt wird, dann wird der Trim-Befehl durchgereicht.
Falls nicht, dann muss TRIM, sofern man TRIM verwenden möchte, noch entsprechend aktiviert werden, siehe dazu <a class="internal" href="./ssd/trim.html">SSD/TRIM</a>.</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Die Verwendung des TRIM Befehls im Zusammenhang mit der LUKS Verschlüsselung kann ein Sicherheitsrisiko sein. 
Mehr dazu steht in folgendem Artikel: <a class="internal" href="./ssd/trim.html#TRIM-mit-Festplattenverschluesselung">SSD/TRIM</a>.
</p></div></div></div></div><div class="section_1"><h2 id="Probleme-beim-Start">Probleme beim Start<a class="headerlink" href="#Probleme-beim-Start">¶</a></h2><p>
Sind nur einzelne Partitonen verschlüsselt, die beim Start eingehängt werden sollen, kommt es dazu, dass dem Benutzer angeboten wird, das Einhängen abzubrechen, bevor der Schlüssel eingegeben werden kann. Um dies zu verhindern, fügt man in die <strong>/etc/init/mountall.conf</strong> hinter
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="c1"># temporary, until we have progress indication</span>
<span class="c1"># and output capture (next week :p)</span>
console output
</pre></div>
</td></tr></table></div><p>
den folgenden Codeblock ein:
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>pre-start script
    . /lib/cryptsetup/cryptdisks.functions

    <span class="k">case</span> <span class="s2">"</span><span class="nv">$CRYPTDISKS_ENABLE</span><span class="s2">"</span> in
    <span class="o">[</span>Nn<span class="o">]</span>*<span class="o">)</span>
        <span class="nb">exit</span> <span class="m">1</span>
        <span class="p">;;</span>
    <span class="k">esac</span>

    <span class="nv">INITSTATE</span><span class="o">=</span><span class="s2">"init"</span>
    do_start
end script
</pre></div>
</td></tr></table></div><p>Dadurch wartet das System, bis die Codeingabe abgeschlossen ist.</p></div><div class="section_1"><h2 id="Alternative-Installation-mit-Hilfe-eines-Skripts">Alternative - Installation mit Hilfe eines Skripts<a class="headerlink" href="#Alternative-Installation-mit-Hilfe-eines-Skripts">¶</a></h2><p>
<a class="external" href="https://gist.githubusercontent.com/HoffmannP/699f3beb2f9901cd64e8/raw/322e29a6a4c8d9261b882fb8e4b968388d58fb06/full-disk-encryption-lvm-luks%25202" rel="nofollow" title="https://gist.githubusercontent.com/HoffmannP/699f3beb2f9901cd64e8/raw/322e29a6a4c8d9261b882fb8e4b968388d58fb06/full-disk-encryption-lvm-luks%25202">https://gist.githubusercontent.com/HoffmannP/699f3beb2f9901cd64e8/raw/322e29a6a4c8d9261b882fb8e4b968388d58fb06/full-disk-encryption-lvm-luks%25202</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein OpenSource-<a class="internal" href="./shell.html">Shell</a>-Skript, welches ebenfalls ein via LUKS/LVM vollverschlüsseltes Ubuntu-System installieren kann. Das halbautomatische Skript erleichtert einem die Arbeit, da keine komplizierten Befehlsfolgen eingegeben werden müssen. Außerdem braucht man so im Vergleich zu einer Standardinstallation nur wenige Minuten länger, um ein vollverschlüsseltes System zu installieren.</p><div class="box warning"><h3 class="box warning">Hinweis!</h3><div class="contents"><p>
<a class="internal" href="./fremdsoftware.html">Fremdsoftware</a> kann das System gefährden.
</p></div></div><p>Sollte man sich für diese Methode entscheiden:
</p><ol class="arabic"><li><p>Von CD booten, um eine Live-Session zu starten.</p></li><li><p>Skript herunterladen und ausführen. Dazu einfach ein Terminal öffnen und folgende Befehle ausführen (Kopieren und Einfügen empfohlen):</p></li></ol><div class="bash"><div class="contents"><pre class="notranslate">wget "https://gist.githubusercontent.com/HoffmannP/699f3beb2f9901cd64e8/raw/322e29a6a4c8d9261b882fb8e4b968388d58fb06/full-disk-encryption-lvm-luks%25202" -O "/tmp/ubuntu-full-disk-encryption-lvm-luks.sh"
chmod a+rx /tmp/full-disk-encryption-lvm-luks.sh
 /tmp/full-disk-encryption-lvm-luks.sh </pre></div></div><p>
</p><ol class="arabic"><li><p>Den Anweisungen des Skripts folgen.</p></li></ol><p>
Sofern man sich für die Hintergründe interessiert, findet sich im Artikel "<a class="external" href="http://blog.andreas-haerter.com/2011/06/18/ubuntu-festplattenvollverschluesselung-lvm-luks" rel="nofollow">Vollverschlüsseltes System mit Ubuntu (ab 9.04 Jaunty), LVM und LUKS</a>" <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> eine detaillierte Beschreibung.
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Das Skript funktioniert derzeit leider nicht korrekt mit Ubuntu 14.04 Trusty Tahr.
</p></div></div></div><div class="section_1"><h2 id="Alternatives-Entschluesseln-der-Systempartition-mit-einem-USB-Schluessel">Alternatives Entschlüsseln der Systempartition mit einem USB-Schlüssel<a class="headerlink" href="#Alternatives-Entschluesseln-der-Systempartition-mit-einem-USB-Schluessel">¶</a></h2><p>
Möchte man das System mit Hilfe eines USB-Sticks entschlüsseln (ohne eine offensichtliche Schlüsseldatei auf besagtem Stick zu haben, der Stick kann demnach auch beliebig formatiert werden), hilft der Artikel <a class="internal" href="./system_verschlüsseln/entschlüsseln_mit_einem_usb-schlüssel.html">Entschlüsseln mit einem USB-Schlüssel</a> weiter.</p></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="./sicherheit.html">Sicherheit</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> Übersichtsseite</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./system_verschlüsseln/a/revision/944305.html">Diese Revision</a> wurde am 20. Oktober 2017 14:30 von <a href="https://ubuntuusers.de/user/noisefloor/">noisefloor</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./system_verschlüsseln.html">System verschlüsseln</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>