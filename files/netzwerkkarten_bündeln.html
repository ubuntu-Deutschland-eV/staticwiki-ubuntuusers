<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Netzwerkkarten_bündeln › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./netzwerkkarten_bündeln.html">Netzwerkkarten bündeln</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Netzwerkkarten_bündeln">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./netzwerkkarten_bündeln/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./netzwerkkarten_bündeln/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./netzwerkkarten_bündeln/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./netzwerkkarten_bündeln/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./netzwerkkarten_bündeln/a/backlinks.html">Netzwerkkarten bündeln</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a> </p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a> </p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./editor.html">Einen Editor öffnen</a> </p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Vorbereitung">Vorbereitung
</a></li><li><a class="crosslink" href="#Benutzung-Konfiguration">Benutzung/Konfiguration
</a></li><li><a class="crosslink" href="#Bonding-Modi">Bonding Modi
</a></li><li><a class="crosslink" href="#Eine-sichere-Variante-mit-zwei-Bonding-Interfaces">Eine sichere Variante mit zwei Bonding Int...</a></li><li><a class="crosslink" href="#Hardwareunabhaengiges-Image">Hardwareunabhängiges Image
</a></li><li><a class="crosslink" href="#Fehlerbehebung">Fehlerbehebung
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="Wiki/Icons/Oxygen/network-wired.png" class="image-left" src="./_/662b0558adb0082729035d1835deb99b67123b2a.png"/>
<img alt="Wiki/Icons/Oxygen/network-wired.png" class="image-left" src="./_/662b0558adb0082729035d1835deb99b67123b2a.png"/></p><p>Manchmal ist es notwendig, zwei Netzwerkkarten zu bündeln, z.B. für eine höhere Ausfallsicherheit oder um einfach den Durchsatz zu erhöhen. Man spricht auch vom NIC-Teaming oder Bonding, wenn man zwei Netzwerkschnittstellen zu einer virtuellen Einheit zusammenfasst. So wird erreicht, dass das System beide Karten als ein Gerät anspricht. Das bedeutet, dass beide Karten dieselbe Hardware-(MAC-)Adresse haben.</p><p>Die Bündelung der Netzwerkkarten wird durch das Dienstprogramm <strong>ifenslave</strong> bewerkstelligt, das dem Kernel ermöglicht, nur ein Gerät zu sehen und zu verwenden, während es die Datenpakete tatsächlich über die zwei Karten sendet. Hiermit kann sowohl Ausfallsicherheit als auch die Nutzung einer größeren Bandbreite erreicht werden.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
Folgendes Paket muss installiert <sup><a href="#source-1">[1]</a></sup> werden:</p><ul><li><p><strong>ifenslave</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install ifenslave </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install ifenslave </pre></div></div><p>
</p></div></div><p>Gegebenenfalls werden noch die folgenden Programme benötigt:</p><ul><li><p><strong>net-tools</strong> (<em>universe</em>, beinhaltet das Programm mii-tool, das unabhängig vom Medium den Status der Schnittstelle sowie die Geschwindigkeits- und Duplex-Einstellungen abfragen bzw. einstellen kann. Mii-Tool wird für den Modus 4 (802.3ad) und das Abfragen der verfügbaren Schnittstellen benötigt.)</p></li><li><p><strong>ethtool</strong> (<em>universe</em>, ein Programm zum Setzen der Geschwindigkeits- und Duplex-Einstellungen bei Ethernet-Schnittstellen. Ethtool wird für die Modi 4 (802.3ad), 5 (balance-tlb) und 6 (balance-alb) benötigt. Siehe auch <a class="internal" href="./ethtool.html">ethtool</a>.)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install net-tools ethtool </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install net-tools ethtool </pre></div></div><p>
</p></div></div><p>
Optional ist das folgende Programm:</p><ul><li><p><strong>bmon</strong> (Bandwith Monitor, ein Programm, das die Datenübertragungsraten pro Gerät in Echtzeit anzeigen kann.)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install bmon </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install bmon </pre></div></div><p>
</p></div></div></div><div class="section_1"><h2 id="Vorbereitung">Vorbereitung<a class="headerlink" href="#Vorbereitung">¶</a></h2><p>
Vor dem Versuch, zwei Netzwerkkarten zu bündeln, sollte die Integrität und Funktionalität jeder Karte geprüft werden. Das Verwenden des Mii-Tools sollte etwa Folgendes zeigen:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mii-tool </pre></div></div><p>
Ausgabe:</p><pre class="notranslate">eth0: negotiated 100baseTx-FD flow-control, link ok
eth1: negotiated 100baseTx-FD flow-control, link ok</pre><p>Damit die Bündelung der Netzwerkkarten funktioniert, muss der Kernel dies unterstützen. Dies lässt sich wie folgt überprüfen <sup><a href="#source-2">[2]</a></sup>:</p><div class="bash"><div class="contents"><pre class="notranslate">find /lib/modules/`uname -r` -iname bonding* </pre></div></div><p> Ausgabe: </p><pre class="notranslate">/lib/modules/2.6.20-16-server/kernel/drivers/net/bonding/bonding.ko</pre><p>
</p></div><div class="section_1"><h2 id="Benutzung-Konfiguration">Benutzung/Konfiguration<a class="headerlink" href="#Benutzung-Konfiguration">¶</a></h2><p>
Zuerst werden alle Netzwerkkarten im zukünftigen Verbund deaktiviert:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ifdown eth0
sudo ifdown eth1
sudo ifdown eth... </pre></div></div><p>Dann wird die Konfiguration erstellt. Die <strong>/etc/network/interfaces</strong> kann wie oben beschrieben konfiguriert werden. Jedoch müssen einige Einträge enthalten sein und geändert werden. Dies wurde ab Ubuntu 8.04 deutlich vereinfacht, da ab nun die gesamte bonding-Konfiguration in dieser Datei abgelegt wird (aber nicht muss).</p><div class="section_2"><h3 id="Einfach-und-schnell">Einfach und schnell<a class="headerlink" href="#Einfach-und-schnell">¶</a></h3><p>
Da in den Ubuntu-Versionen neuer als 8.04 alle Bonding-Optionen in <strong>/etc/network/interfaces</strong> gemacht werden kann, genügt es, lediglich <strong>ifenslave-2.6</strong> zu installieren. Das betrifft zumindest die Konfiguration auf Linux-Seite. Manche bonding-Modi benötigen zusätzlich noch eine Konfiguration des Switches.</p><pre class="notranslate">auto bond0
iface bond0 inet static
    address 10.0.0.10
    netmask 255.255.255.0
    network 10.0.0.0
    broadcast 10.0.0.255
    gateway 10.0.0.1
    dns-nameservers 10.0.0.1
    bond-slaves eth0 eth1
    bond-mode 0
    bond-miimon 100
    bond-updelay 200
    bond-downdelay 200</pre><p><strong>Erklärungen</strong>
</p><ul><li><p>bond-slaves: Welche Schnittstellen diesem Bond zugehörig sind, "all", falls alle.</p></li><li><p>bond-mode: 0 bis 6 oder Names des Modus, in dem der bonding-Treiber arbeiten soll.</p></li><li><p>bond-miimon: Das bonding-Modul überprüft alle 100ms den Link-Status aller gebündelten Schnittstellen.</p></li><li><p>bond-updelay: Wenn eine Schnittstelle als (wieder) aktiv erkannt wird, werden 200ms abgewartet, ehe der bonding-Treiber das interface wieder in den Verbund integriert, ansonsten sofort.</p></li><li><p>bond-downdelay: Gibt es einen Übertragungsfehler oder Aussetzer, so betrachtet das bonding-Modul die Schnittstelle erst nach 200ms als verloren und entfernt diese aus dem bond, ansonsten sofort.</p></li></ul><p>
Die Konfiguration für alle anderen Interfaces bis auf das <code class="notranslate">loopback</code>-Interface können entfernt bzw. deaktiviert werden. Wer ungeduldig ist, kann nun mit folgenden Befehlen den Treiber laden und die Netzwerke neu starten:</p><div class="bash"><div class="contents"><pre class="notranslate">modprobe bonding
/etc/init.d/networking stop
/etc/init.d/networking start </pre></div></div><p>
Sicherer ist es, das System neu zu starten. Es sind keine weiteren Einträge in <strong>/etc/modules</strong> oder anderswo nötig, der bonding-Treiber wird automatisch nach einem Neustart geladen.</p></div><div class="section_2"><h3 id="Ausfuehrlicher-teilweise-fuer-aeltere-Versionen">Ausführlicher, teilweise für ältere Versionen<a class="headerlink" href="#Ausfuehrlicher-teilweise-fuer-aeltere-Versionen">¶</a></h3><p>
Folgender Eintrag muss hinzugefügt werden:</p><pre class="notranslate">auto bond0
iface bond0 inet static
	address 10.0.0.10
	netmask 255.255.255.0
	network 10.0.0.0
	broadcast 10.0.0.255
	gateway 10.0.0.1
	dns-nameservers 10.0.0.2
	dns-search example.com
        slaves eth0 eth1</pre><p>
Anmerkungen:
</p><ul><li><p>Hier wird eine statische Konfiguration verwendet, soll die Maschine ihre IP-Adresse mittels DHCP beziehen, wird <code class="notranslate">iface bond0 inet static</code> durch <code class="notranslate">iface bond0 inet dhcp</code> ersetzt, die eingerückten Zeilen entfallen dann. Die IP-Adress-Einstellungen müssen an das eigene Netzwerk angepasst werden.</p></li><li><p>Hier werden die Schnittstellen eth0 und eth1 für den Verbund verwendet. Sollen weitere Schnittstellen eingebunden werden, so werden diese hinten angefügt. Alternativ kann auch <code class="notranslate">slaves all</code> geschrieben werden, wenn alle aktiven Schnittstellen in den Verbund aufgenommen werden sollen.</p></li></ul><p>
Des Weiteren sollten für die darin enthaltenen einzelnen Schnittstellen die Funktion "auto" durch "allow" ersetzt werden, damit diese nicht zusätzlich bei dem Systemstart mitgestartet werden. Im Skript für den Systemstart ist die Funktion "ifup -a" enthalten und die startet alle Netzwerkschnittstellen, die in der Konfiguration mit "auto" vermerkt sind. Ansonsten startet Linux jede einzelne Schnittstelle und zusätzlich den Verbund. Das ist falsch, denn die einzelnen Schnittstellen sollen durch den Verbund aktiviert werden. Deshalb sollte man für die im Verbund enthaltenen Schnittstellen den Eintrag wie folgt ändern:</p><pre class="notranslate">allow eth1
iface eth1 inet dhcp</pre><p>
Dabei ist es egal, ob man "dhcp" setzt oder was anderes, da diesen Schnittstellen keine eigene IP-Adresse mehr zugeteilt wird. Das ist richtig, da die Schnittstellen nur noch durch EINE IP-Adresse angesprochen werden sollen. Dies muss und sollte die IP-Adresse des Verbundes sein.</p><p>Danach sollte nach JEDEM Systemstart der Befehl "ifconfig" für bond0 folgenden Hinweis enthalten:
</p><pre class="notranslate">[...]
UP BROADCAST RUNNING MASTER MULTICAST
[...]</pre><p>
und für die darin enthaltenen Schnittstellen:
</p><pre class="notranslate">[...]
UP BROADCAST RUNNING SLAVE MULTICAST
[...]</pre><p>Die Konfiguration des Bonding-Treibers muss angegeben werden, hierfür wird in <strong>/etc/modprobe.d</strong> mit Superuser-Rechten eine neue Datei <strong>bonding.conf</strong> erstellt und folgendes eingetragen:
</p><pre class="notranslate">alias bond0 bonding
options bonding mode=1 miimon=100</pre><p>
Anmerkung: Hier wird Bonding-Mode 1 (active-backup) verwendet, das Mii-Tool soll alle 100 Millisekunden den Link-Status überprüfen.</p><p>Das Laden des Moduls erfolgt mit dem Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo modprobe bonding </pre></div></div><p>
Damit das auch beim nächsten Neustart noch der Fall ist, sollte das bonding-Modul noch in die <strong>/etc/modules</strong> eingetragen werden <sup><a href="#source-3">[3]</a></sup>:</p><pre class="notranslate">bonding</pre><p>
Nun wird das Modul automatisch beim Systemstart geladen.</p><p>Der neue Verbund wird mit folgendem Befehl gestartet:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ifup bond0 </pre></div></div></div></div><div class="section_1"><h2 id="Bonding-Modi">Bonding Modi<a class="headerlink" href="#Bonding-Modi">¶</a></h2><p>
Bei der Konfiguration muss ein Bonding-Modus (<code class="notranslate">bond-mode</code>) angegeben werden, der den Zweck und die Art der Bündelung der Netzwerkschnittstellen angibt. Die zur Verfügung stehenden Modi sind im Folgenden aufgelistet.</p><table><tr class="titel"><td colspan="4" style="text-align: center"> <strong>Bonding Modi</strong> </td></tr><tr class="kopf"><td> <strong>Modus</strong></td><td><strong>Bezeichnung</strong></td><td><strong>Zweck</strong></td><td><strong>Beschreibung</strong></td></tr><tr><td>0</td><td>balance-rr</td><td>Lastverteilung &amp; Ausfallsicherheit</td><td>Die genutzte Netzwerkschnittstelle wird im <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Round_Robin_(Informatik)">Round-Robin</a>-Verfahren festgelegt, das heißt die verfügbaren Schnittstellen werden in Senderichtung wechselweise genutzt. In Empfangsrichtung kann max. die Geschwindigkeit einer einzelnen Schnittstelle erreicht werden - je mehr Teilnehmer, umso mehr Upload-Gesamtbandbreite, denn diese werden auf die übrigen freien Schnittstellen aufgeteilt. </td></tr><tr class="highlight"><td> 1</td><td>active-backup</td><td>Ausfallsicherheit</td><td>Nur eine Schnittstelle ist aktiv, im Fehlerfalle wird eine der anderen im Verbund genutzt. die Netzwerkkarten können über verschiedene <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Switch_(Computertechnik)">Switches</a> angebunden werden.</td></tr><tr><td>2</td><td>balance-xor</td><td>Lastverteilung &amp; Ausfallsicherheit</td><td>Es wird für jede Gegenstelle im Netzwerk eine zu nutzende Netzwerkschnittstelle zugewiesen, die Zuordnung geschieht über den Modulo der Division zwischen der Formel (Quell-MAC-Adresse XOR Ziel-MAC-Adresse) und der Anzahl der Slave-Schnittstellen.</td></tr><tr class="highlight"><td> 3</td><td>broadcast</td><td>Ausfallsicherheit</td><td>Daten werden auf allen Netzwerkschnittstellen gesendet. Die Nutzung mehrerer Switches ist möglich.</td></tr><tr><td>4</td><td>802.3ad</td><td>Lastverteilung &amp; Ausfallsicherheit</td><td>802.3ad ist ein Standard der IEEE, der die Bündelung mehrerer Schnittstellen mit gleichen Übertragungseinstellungen (Geschwindigkeit und Duplex-Einstellungen) erlaubt, um eine höhere Bandbreite zu erhalten. Es kann nur ein Switch verwendet werden, dieser muss 802.3ad unterstützen. <code class="notranslate">ethtool</code> oder <code class="notranslate">mii-tool</code> wird benötigt.</td></tr><tr class="highlight"><td> 5</td><td>balance-tlb</td><td>Lastverteilung</td><td>Es wird für jede Gegenstelle im Netzwerk eine zu nutzende Netzwerkschnittstelle zugewiesen. Das Verfahren hierzu ist jedoch komplexer und effizienter als bei <code class="notranslate">balance-xor</code>. Das Programm <code class="notranslate">ethtool</code> wird benötigt.</td></tr><tr><td>6</td><td>balance-alb</td><td>Lastverteilung</td><td>Erweitertes <code class="notranslate">balance-tlb</code>, zusätzlich zur MAC-basierten Zuordnung der Schnittstellen für ausgehende Verbindungen werden eingehende Verbindungen auf die Schnittstellen verteilt. Das Programm <code class="notranslate">ethtool</code> wird benötigt.</td></tr></table><p>
</p></div><div class="section_1"><h2 id="Eine-sichere-Variante-mit-zwei-Bonding-Interfaces">Eine sichere Variante mit zwei Bonding Interfaces<a class="headerlink" href="#Eine-sichere-Variante-mit-zwei-Bonding-Interfaces">¶</a></h2><p>
Bei Unsicherheiten oder scheinbaren Zufälligkeiten der Funktionalität der Konfiguration kann die folgende Variante gewählt werden. Diese geht davon aus, dass ein Interface per DHCP, das andere direkt adressiert wird. Voraussetzung ist das folgende Paket:</p><ul><li><p><strong>moreutils</strong> (<em>universe</em>)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install moreutils </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install moreutils </pre></div></div><p>
</p></div></div><p>
Die Bonding-Parameter werden in <strong>/etc/modprobe.d/bonding.conf</strong> gesetzt:</p><pre class="notranslate">alias bond0 bonding
alias bond1 bonding
options bonding max_bonds=2 mode=1 miimon=100 use_carrier=1</pre><p>
Das Bonding Modul muss geladen werden. Dazu wird <strong>/etc/modules</strong> ergänzt um die Zeile:</p><pre class="notranslate">bonding</pre><p>
Danach wird die Netzwerkkonfiguration erstellt. Diese enthält folgende Nebenbedingungen:</p><ul><li><p>Über <code class="notranslate">eth0</code> wird eine DHCP-Adresse vermittelt</p></li><li><p>Die Interfaces <code class="notranslate">eth0</code> und <code class="notranslate">eth1</code> bilden <code class="notranslate">bond0</code></p></li><li><p>Mittels <code class="notranslate">eth2</code> und <code class="notranslate">eth3</code> wird statisch eine Adresse an <code class="notranslate">bond1</code> gebunden</p></li></ul><p>
Die Schnittstellendefinition wird in <strong>/etc/network/interfaces</strong> ergänzt bzw. modifiziert:
</p><pre class="notranslate">auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp
iface bond0 inet manual
iface eth1 inet manual

auto bond1
iface bond1 inet static
	pre-up /sbin/ifconfig eth2 up
        pre-up /sbin/ifconfig eth3 up
       	up /sbin/ifenslave bond1 eth2
        up /sbin/ifenslave bond1 eth3
        post-down /sbin/modprobe -r bond1 eth2 eth3
	address …
	netmask …
	network …
	broadcast …
	gateway …
	dns-nameservers …
	dns-search …</pre><p>Nun muss noch <code class="notranslate">bond0</code> entsprechend konfiguriert werden. Das geschieht in <strong>/etc/rc.local</strong>
</p><pre class="notranslate">set -x
/sbin/ifconfig eth1 $(/usr/bin/ifdata -pa eth0) \
                netmask $(/usr/bin/ifdata -pn eth0) up &amp;&amp; \
        /sbin/ifconfig bond0 $(/usr/bin/ifdata -pa eth0) \
                netmask $(/usr/bin/ifdata -pn eth0) &amp;&amp; \
        /sbin/ifenslave bond0 eth0 eth1 &amp;&amp; \
        /sbin/ifenslave -c bond0 eth1
set +x</pre><div class="section_2"><h3 id="Variante-die-auch-funktionierte">Variante, die auch funktionierte<a class="headerlink" href="#Variante-die-auch-funktionierte">¶</a></h3><p>
Gewisse Unsicherheiten ergeben sich aus der im Paket <code class="notranslate">linux-doc</code> beschriebenen Dokumentation <code class="notranslate">/usr/share/doc/linux-doc/networking/bonding.txt.gz</code>. Folgende Variante im obrigen Beispiel von <code class="notranslate">bond1</code> funktionierte:</p><p><strong>/etc/network/interfaces</strong>
</p><pre class="notranslate">auto bond1
iface bond1 inet static
        bond-slaves none
        bond-mode active-backup
        bond-miimon 100
	address …
	... 

auto eth2
iface eth2 inet manual
        bond-master bond1
        bond-primary eth2 eth3

auto eth3
iface eth3 inet manual
        bond-master bond1
        bond-primary eth2 eth3</pre></div><div class="section_2"><h3 id="Nur-zufaellig-funktionierende-Varianten">Nur zufällig funktionierende Varianten<a class="headerlink" href="#Nur-zufaellig-funktionierende-Varianten">¶</a></h3><p>
Bei den folgenden Variante sind die in <strong>/etc/rc.local</strong> eingetragenen Modifikationen still zu legen.</p><p><strong>/etc/network/interfaces</strong>
</p><pre class="notranslate">auto bond0
iface bond0 inet dhcp
        bond-slaves none
        bond-mode active-backup
        bond-miimon 100

auto eth0
iface eth0 inet dhcp
        bond-master bond0
        bond-primary eth0 eth1

auto eth1
iface eth1 inet manual
        bond-master bond0
        bond-primary eth0 eth1</pre><p>Diese Variante funktionierte nicht immer. Für die MAC-Adresse von <code class="notranslate">eth0</code> wird dabei eine IP Adresse bereit gestellt. Die Mac-Adresse von <code class="notranslate">eth1</code> wird nicht mit einer IP-Adresse versorgt.</p><pre class="notranslate">auto bond0
iface bond0 inet dhcp
        bond-slaves none
        bond-mode active-backup
        bond-miimon 100

auto eth0
iface eth0 inet manual
        bond-master bond0
        bond-primary eth0 eth1

auto eth1
iface eth1 inet manual
        bond-master bond0
        bond-primary eth0 eth1</pre><p>
Die letzte Variante, die genau der Beschreibung aus <code class="notranslate">linux-doc</code> entspricht, funktionierte leider gar nicht bei mir.</p></div></div><div class="section_1"><h2 id="Hardwareunabhaengiges-Image">Hardwareunabhängiges Image<a class="headerlink" href="#Hardwareunabhaengiges-Image">¶</a></h2><p>
Aus Gründen der Hochverfügbarkeit kann es nötig sein, ein Image zu bauen, welches auch auf anderen, baugleichen Rechnern läuft. Dabei kann dieses Image sowohl ein NFS-Filesystem als auch ein Fibre-Channel-Filesystem sein. Wichtig ist, dass dieses Image bei Hardwareausfall auf einem anderen, baugleichen Rechner läuft.</p><p>Damit dies gewährleistet ist muss die MAC-Adresse aus der Konfiguration der Netzwerkkarte entfernt werden und durch Hardwaremerkmale ersetzt werden. Dazu müssen die entsprechenden Merkmale ermittelt werden.</p><p>Dies Kann mit folgendem Befehl beispielsweise erfolgen:</p><div class="bash"><div class="contents"><pre class="notranslate">for I in {0,1,2,3,4,5,6,7}
do echo eth$I
udevadm info -a -p /sys/class/net/eth$I | grep KERNELS
udevadm info -a -p /sys/class/net/eth$I | grep 'ATTR{dev_id}'
udevadm info -a -p /sys/class/net/eth$I | grep 'ATTR{type}'
done </pre></div></div><p>Wichtig ist dabei, dass Merkmale gewählt werden, die nur auf diese Hardwareelemente (Netzwerkanschlüsse) zutreffen. Im obrigen Beispiel kommt es zu folgender Ausgabe:</p><pre class="notranslate">eth0
    KERNELS=="0000:04:00.0"
    KERNELS=="0000:00:02.2"
    KERNELS=="pci0000:00"
    ATTR{dev_id}=="0x0"
    ATTR{type}=="1"
eth1
    KERNELS=="0000:04:00.1"
    KERNELS=="0000:00:02.2"
    KERNELS=="pci0000:00"
    ATTR{dev_id}=="0x0"
    ATTR{type}=="1"
…</pre><p>Daraus sollte dann die Definition von <strong>/etc/udev/rules.d/70-persistent-net.rules</strong> überschrieben werden.</p><pre class="notranslate"># PCI device 0x8086:/sys/devices/pci0000:00/0000:00:02.2/0000:04:00.0 (igb)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", KERNELS=="0000:04:00.0", ATTR{dev_id}=="0x0", ATTR{type}=="1", KERNEL=="eth*", NAME="eth0"

# PCI device 0x8086:/sys/devices/pci0000:00/0000:00:02.2/0000:04:00.1 (igb)
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", KERNELS=="0000:04:00.1", ATTR{dev_id}=="0x0", ATTR{type}=="1", KERNEL=="eth*", NAME="eth1"

...</pre><p>Mittels </p><div class="bash"><div class="contents"><pre class="notranslate">sudo service udev restart </pre></div></div><p> wird die Änderung getestet bzw. wirksam.</p></div><div class="section_1"><h2 id="Fehlerbehebung">Fehlerbehebung<a class="headerlink" href="#Fehlerbehebung">¶</a></h2><p>
</p><div class="section_2"><h3 id="Problembeschreibung">Problembeschreibung<a class="headerlink" href="#Problembeschreibung">¶</a></h3><p>
Wenn man mehrere Netzwerkkarten des gleichen Typs einsetzt, kann es passieren, dass die Netzwerkkarten neu benannt werden. Ein</p><div class="bash"><div class="contents"><pre class="notranslate">sudo ifconfig -a </pre></div></div><p>
liefert dann z.B. einen Eintrag wie:</p><pre class="notranslate">[...]
eth?_rename
[...]</pre><p>
Um dies zu vermeiden muss die Datei <a class="internal" href="./interfaces.html">/etc/network/interfaces</a> editiert werden. Im Abschnitt <code class="notranslate">bonding</code> muss die Angabe für eine MAC eingefügt werden:</p><pre class="notranslate">auto bond0
iface bond0 inet static
	...
        hwadress ether {<strong class="highlighted">MAC-ADRESSE</strong>}
        ...</pre><p>
Bitte keine MAC von einer vorhandenen Karte benutzen, sondern selber eine setzen.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/UbuntuBonding">Bonding</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> - Ubuntu Community Documentation</p></li><li><p><a class="interwiki interwiki-debian" href="https://wiki.debian.org/Bonding">Bonding</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> im Debian Wiki</p></li><li><p><a class="external" href="http://web.archive.org/web/20111105062131/http://www.5dollarwhitebox.org/wiki/index.php/Howtos_NIC_Bonding_Debian" rel="nofollow">NIC Bonding Debian</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://www.nwlab.net/art/teaming/nic-teaming.html" rel="nofollow">Lastverteilung und Ausfallsicherheit mit mehreren Netzwerkkarten</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> </p></li><li><p><a class="external" href="http://www.linux-magazin.de/heft_abo/ausgaben/2004/07/doppelt_reissfest" rel="nofollow">Doppelt reissfest</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/>  - Linux-Magazin, 07/2004</p></li><li><p><a class="external" href="http://www.linuxhorizon.ro/bonding.html" rel="nofollow">Erläuterung der verschieden Modi auf LINUX Horizon</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> </p></li><li><p><a class="external" href="http://blog.brightbox.co.uk/posts/howto-do-ethernet-bonding-on-ubuntu-properly" rel="nofollow" title="http://blog.brightbox.co.uk/posts/howto-do-ethernet-bonding-on-ubuntu-properly">http://blog.brightbox.co.uk/posts/howto-do-ethernet-bonding-on-ubuntu-properly</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="https://www.kernel.org/doc/Documentation/networking/bonding.txt" rel="nofollow">bonding.txt (Kernel.org Documentation)</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://blog.netways.de/2012/11/21/bonding-unter-ubuntu-12-04-1" rel="nofollow">Bonding unter Ubuntu 12.04.1</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> </p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./netzwerkkarten_bündeln/a/revision/940431.html">Diese Revision</a> wurde am 8. Mai 2017 18:02 von <a href="https://ubuntuusers.de/user/Heinrich_Schwietering/">Heinrich_Schwietering</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./netzwerkkarten_bündeln.html">Netzwerkkarten bündeln</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>