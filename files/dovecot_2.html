<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Dovecot_2 › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./dovecot_2.html">Dovecot 2</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Dovecot_2">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./dovecot_2/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./dovecot_2/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./dovecot_2/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./dovecot_2/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./dovecot_2/a/backlinks.html">Dovecot 2</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./pakete_installieren.html">Installation von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./programme_starten.html">Starten von Programmen</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-4" id="source-4"></a> <a class="internal" href="./sudo.html">Root-Rechte</a></p></li></ol></div></div><p>
</p><div class="toc toc-depth-1"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation">Installation
</a></li><li><a class="crosslink" href="#Dienststeuerung">Dienststeuerung
</a></li><li><a class="crosslink" href="#Konfiguration">Konfiguration
</a></li><li><a class="crosslink" href="#Links">Links
</a></li></ol></div><p><img alt="./dovecot_logo.gif" class="image-left" src="./_/75d912d1be45476e1012d61a32ccff58f9460cd6.gif"/>
<a class="external" href="http://www.dovecot.org/" rel="nofollow">Dovecot</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> ist ein Open Source E-Mailserver für Linux, der die Protokolle IMAP und POP3 unterstützt. Seine Spezialität sind kleine Netzwerke (ca. 200 Mailboxen) bis hin zu großen Firmennetzwerken (über 1000 Mailboxen). Die Daten werden im mbox- bzw. Maildir-Format abgelegt und können so leicht migriert oder in E-Mail Clients genutzt werden, die lokal auf die Daten zugreifen. Des Weiteren müssen keine Benutzer angelegt werden. Jeder lokale Benutzer kann sich direkt auf dem Mailserver mit seinem Benutzerdaten anmelden.</p><p>Die hier beschriebene Version 2.x ist der Nachfolger der im Artikel <a class="internal" href="./archiv/dovecot.html">Dovecot</a> beschriebenen Version 1.x.</p><div class="section_1"><h2 id="Installation">Installation<a class="headerlink" href="#Installation">¶</a></h2><p>
</p><div class="section_2"><h3 id="Grundfunktionalitaet">Grundfunktionalität<a class="headerlink" href="#Grundfunktionalitaet">¶</a></h3><p>
Zuerst muss das Grundpaket installiert werden <sup><a href="#source-1">[1]</a></sup>:</p><ul><li><p><strong>dovecot-core </strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install dovecot-core  </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install dovecot-core  </pre></div></div><p>
</p></div></div><p>
Die zu installierenden Protokoll-Pakete sind abhängig von den E-Mail-Protokollen, die man anbieten möchte. Wer Dovecot z.B. als reinen IMAP-Server nutzen möchte, braucht <strong>dovecot-pop3d</strong> nicht zu installieren; umgekehrt gilt natürlich dasselbe. Mindestens eines muss aber installiert sein.</p><ul><li><p><strong>dovecot-imapd</strong></p></li><li><p><strong>dovecot-pop3d</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install dovecot-imapd dovecot-pop3d </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install dovecot-imapd dovecot-pop3d </pre></div></div><p>
</p></div></div></div><div class="section_2"><h3 id="Benutzerauthentifizierung">Benutzerauthentifizierung<a class="headerlink" href="#Benutzerauthentifizierung">¶</a></h3><p>
Dovecot kann sich gegen sehr viele Benutzerdatenbanken authentifizieren. Neben lokal gespeicherten Passwortdatenbanken oder der Authentifizierung anhand der Systembenutzer kann <a class="internal" href="./openldap_ab_precise.html">LDAP</a> oder eine klassische Datenbank benutzt werden. Dovecot unterstützt <a class="internal" href="./mysql.html">MySQL</a>, <a class="internal" href="./postgresql.html">PostgreSQL</a> und <a class="internal" href="./sqlite.html">SQLite</a>.</p><ul><li><p><strong>dovecot-ldap</strong> (optional)</p></li><li><p><strong>dovecot-mysql</strong> (optional)</p></li><li><p><strong>dovecot-pgsql</strong> (optional)</p></li><li><p><strong>dovecot-sqlite</strong> (optional)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install dovecot-ldap dovecot-mysql dovecot-pgsql dovecot-sqlite </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install dovecot-ldap dovecot-mysql dovecot-pgsql dovecot-sqlite </pre></div></div><p>
</p></div></div></div><div class="section_2"><h3 id="Hilfspakete">Hilfspakete<a class="headerlink" href="#Hilfspakete">¶</a></h3><p>
Zudem bietet Dovecot noch einige Hilfspakete. Insbesondere die beiden Sieve-Pakete, die eine serverseitige E-Mail-Filterung ermöglichen und das Antispam-Plugin sind sehr nützlich.</p><ul><li><p><strong>dovecot-lmtpd</strong> (optional)</p></li><li><p><strong>dovecot-sieve</strong> (optional)</p></li><li><p><strong>dovecot-managesieve</strong> (optional)</p></li><li><p><strong>dovecot-antispam</strong> (optional)</p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install dovecot-lmtpd dovecot-sieve dovecot-managesieve dovecot-antispam </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install dovecot-lmtpd dovecot-sieve dovecot-managesieve dovecot-antispam </pre></div></div><p>
</p></div></div></div></div><div class="section_1"><h2 id="Dienststeuerung">Dienststeuerung<a class="headerlink" href="#Dienststeuerung">¶</a></h2><p>
Dovecot arbeitet als <a class="internal" href="./dienste.html">Dienst</a> im Hintergrund. Nachdem alle benötigten Pakete (nach)installiert und der Server korrekt konfiguriert wurde, kann man ihn aus einem Terminal heraus <sup><a href="#source-2">[2]</a></sup> über den Befehl</p><div class="bash"><div class="contents"><pre class="notranslate">sudo service dovecot restart </pre></div></div><p>neu starten.</p></div><div class="section_1"><h2 id="Konfiguration">Konfiguration<a class="headerlink" href="#Konfiguration">¶</a></h2><p>
Dovecot 2 wird, anders als noch Dovecot 1, über Konfigurationsdateien unterhalb des Verzeichnisses <strong>/etc/dovecot/conf.d/</strong> konfiguriert. Die Datei  <strong>/etc/dovecot/dovecot.conf</strong> ist weiterhin vorhanden, sie bindet die jeweiligen spezifischen Konfigurationsdateien ein. Eine monolithische Konfiguration ist somit weiterhin möglich, die Aufsplittung der Konfiguration ist allerdings sehr empfehlenswert, da man so bei einer Fehlkonfiguration nur den betroffenen Teil zurücksetzen muss, um wieder einen funktionierenden E-Mail-Server zu haben.</p><p>Falls man sich die komplette aktuelle Konfiguration anzeigen lassen möchte, kann man dies mit:</p><div class="bash"><div class="contents"><pre class="notranslate">doveconf -n </pre></div></div><p>
tun.</p><div class="section_2"><h3 id="Konfiguration-der-POP3-und-IMAP-Backends">Konfiguration der POP3 und IMAP-Backends<a class="headerlink" href="#Konfiguration-der-POP3-und-IMAP-Backends">¶</a></h3><p>
Grundsätzlich sollten die Standardeinstellungen bei beiden ausreichen, allerdings schadet es nicht, sich die beiden Konfigurationsdateien einmal anzusehen. Diese sind <strong>/etc/dovecot/conf.d/20-pop3.conf</strong> und <strong>/etc/dovecot/conf.d/20-imap.conf</strong>. In beiden findet man eine Variable, mit der man auf Eigenheiten bestimmter E-Mail Clients eingehen kann. Diese lauten <code class="notranslate">pop3_client_workarounds</code> beziehungsweise <code class="notranslate">imap_client_workarounds</code> und sind standardmäßig auskommentiert. Die möglichen Belegungen werden in den Kommentaren dazu erläutert.</p><p>Ebenso findet man in beiden Dateien die Variable <code class="notranslate">mail_max_userip_connections</code>, welche angibt, wie viele gleichzeitige Verbindungen von einem Benutzer pro verbundener Internet-IP erlaubt sind. Diese ist bei beiden Standardmäßig auf 10 eingestellt, was im Normalfall ausreichen sollte. Gerade bei IMAP in Verbindung mit IMAP IDLE für Push-Benachrichtigungen kann es aber vorkommen, das mehr Verbindungen benötigt werden. Wenn man dann noch mit mehreren Clients (Laptop, Smartphone, Tablet) hinter einem NAT-Router sitzt, bekommt man Verbindungsprobleme. Dann kann es helfen, diese Variable auf 20 oder höher zu setzen.</p></div><div class="section_2"><h3 id="Verschluesselte-Kommunikation">Verschlüsselte Kommunikation<a class="headerlink" href="#Verschluesselte-Kommunikation">¶</a></h3><p>
Grundsätzlich sollte man nur verschlüsselte Kommunikation mit dem E-Mail-Server zulassen. Dazu fragt Dovecot bei Installation, ob ein selbstsigniertes Zertifikat erstellt werden soll. Hat man dies verneint, kann man dies mit <a class="internal" href="./ssl-cert.html">ssl-cert</a> nachholen. Besser ist es allerdings, ein korrekt signiertes Zertifikat zu benutzen. Dabei muss man genau wie in <a class="internal" href="./apache/ssl.html">Apache/SSL</a> beschrieben vorgehen. Alternativ kann man auch  <a class="internal" href="./cacert.html#Webserver">CAcert</a> nutzen oder eine eigene <a class="internal" href="./ca.html">Certificat Authority</a> betreiben.</p><p>Hat man ein SSL-Zertifikat, muss man dieses in der Konfigurationsdatei <strong>/etc/dovecot/conf.d/10-ssl.conf</strong> eintragen.</p><pre class="notranslate">ssl = required
ssl_cert = &lt;/etc/ssl/certs/dein-serverzertifikat.crt
ssl_key = &lt;/etc/ssl/private/dein-serverschlüssel.key</pre><p>Der Wert "required" erfordert zwingend eine verschlüsselte Verbindung. Dies sollte man nicht verändern. Die Werte für das Zertifikat und den privaten Schlüssel müssen an die eigenen Begebenheiten angepasst werden; die beiden "&lt;" sind keine Tippfehler. Wer weitergehende Einstellungen für SSL vornehmen will, sei auf die <a class="external" href="http://wiki2.dovecot.org/SSL/DovecotConfiguration" rel="nofollow">SSL-Konfiguration</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> im Dovecot-Wiki verwiesen.</p></div><div class="section_2"><h3 id="Speicherort-und-Mailbox-Format">Speicherort und Mailbox-Format<a class="headerlink" href="#Speicherort-und-Mailbox-Format">¶</a></h3><p>
E-Mails können von Dovecot auf drei verschiedene Arten gespeichert werden: In einer großen <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/mbox">mbox</a>-Datei und als <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/maildir">maildir</a>, wobei jede E-Mail als eine Datei in den entsprechenden Unterordner des Postfachs gespeichert wird. Diese beiden Formate werden auch von anderen Mailservern verstanden und sind somit sehr portabel. Das dritte Format ist das Dovecot-Spezifische dbox, welches in diesem Artikel aber nicht weiter behandelt wird.</p><p>Standardmäßig speichert Dovecot unter Ubuntu die Mails in einer mbox unterhalb des mail-Verzeichnisses im Homeverzeichnis. Der eigentliche Posteingang bleibt aber unterhalb von <strong>/var/mail/</strong>. Dies kann in der Datei <strong>/etc/dovecot/conf.d/10-mail.conf</strong> geändert werden.</p><pre class="notranslate">mail_location = mbox:~/mail:INBOX=/var/mail/%u</pre><p>Wie man sieht, ist klar definiert, das es sich um eine mbox handelt. Der Platzhalter %u wird automatisch zum vollen Benutzernamen erweitert. Lautet dieser <code class="notranslate">benutzer@domäne</code>, wird dies so übernommen. Möchte man nur den Benutzer-Teil, nimmt man %n, möchte man den Domänen-Teil, $d.</p><p>Möchte man jetzt maildir benutzen und zudem alle Dateien in einem bestimmten Verzeichnis haben, ändert man dies beispielsweise auf:</p><pre class="notranslate">mail_location = maildir:/var/maildirs/%d/%n</pre><p>In diesem Fall gibt es keinen speziellen Eintrag für den Posteingang mehr (INBOX), zudem werden die Mailboxen erst nach der Domäne des Benutzers und danach nach dem Benutzernamen einsortiert und liegen zudem alle unterhalb des Ordner <strong>/var/maildirs/</strong>. Dieser Ordner muss dem Benutzer <strong>mail</strong> gehören, da Dovecot sonst keine neuen Mailboxen anlegen kann, wenn sich ein Benutzer anmeldet.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Es ist darauf zu achten, das die Mailbox nicht automatisch zwischen den Formaten konvertiert wird. Will man nachträglich wechseln, muss man diesen Schritt manuell durchführen. Die dazu notwendigen Schritte findet man im entsprechenden <a class="external" href="http://wiki2.dovecot.org/Migration/MailFormat" rel="nofollow">Migrations-Artikel</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> im Dovecot-Wiki.
</p></div></div></div><div class="section_2"><h3 id="Konfiguration-der-Benutzer-Anmeldung">Konfiguration der Benutzer-Anmeldung<a class="headerlink" href="#Konfiguration-der-Benutzer-Anmeldung">¶</a></h3><p>
Dovecot hat zwei verschiedene Datenbanken mit Nutzerinformationen. Die Passwortdatenbank wird benutzt, um herauszufinden, ob sich ein Benutzer am Server anmelden darf. In der Benutzerdatenbank stehen weitere Informationen über den Benutzer. So können hier Standardeinstellungen wie die für den Login und den Zugriff auf den Mail-Speicherort zu benutzenden User- und Gruppen-IDs, das Mailbox-Format und der Ort und das Homeverzeichnis für den Benutzer überschrieben werden.</p><p>Bei Benutzern muss man zwischen 2 Arten unterscheiden. Einmal reale Benutzer, die auch eine Account auf dem Rechner haben, auf dem der Server läuft und die sich dort demzufolge einloggen können. Zum anderen virtuelle Nutzer, also solche, die das nicht können, aber trotzdem ein E-Mail-Konto haben. Da es sich hierbei nicht um richtige Benutzer mit Zugriff auf das System handelt, müssen für diese noch ein paar Vorkehrungen getroffen werden.</p><p>Für virtuelle Benutzer benötigt man zwei Dinge: erstens einen Benutzer auf dem System, der der Gruppe "mail" angehört, mit dem die Mailboxen im Dateisystem erstellt werden können und der danach für die Dateizugriffsrechte benutzt wird. Hier reicht ein Benutzer ohne Anmeldemöglichkeit (also ohne Passwort, Shell und Homeverzeichnis) aus. Wie man einen solchen erstellt, ist im Artikel <a class="internal" href="./adduser.html">adduser</a> beschrieben.</p><p>Zweitens haben virtuelle Benutzer keine Homeverzeichnis. Dovecot benötigt zwar aktuell für den Regelbetrieb nicht zwingend ein Homeverzeichnis für jeden Benutzer, manche Plugins setzen dies aber schon voraus, so etwa das Sieve-Plugin. Die Entwickler behalten sich zudem vor, in Zukunft ein Homeverzeichnis zu fordern und empfehlen deshalb schon jetzt, für jeden Benutzer eines einzurichten. Für virtuelle Benutzer sollte also entweder per Standardeinstellung oder einem entsprechenden Eintrag in der Benutzerdatenbank ein Homeverzeichnis zugewiesen werden. Dieses Verzeichnis (z.B. <strong>/home/virtual</strong>) muss für die Gruppe "mail" schreibbar sein, damit die Homeverzeichnisse, genau wie die Mailboxen, erstellt werden können.</p><p>Die Konfiguration der Passwort und Benutzerdatenbanken werden in der Datei <strong>/etc/dovecot/conf.d/10-auth.conf</strong> festgelegt. Hier muss die Raute <code class="notranslate">#</code> vor dem entsprechenden Eintrag/gewünschten Backend entfernt werden. Für lokale Benutzer ist keine Änderung nötig, diese können sich direkt auf dem Mailserver mit ihrem normalen Login/Passwort einloggen. Möchte man dies deaktivieren, kommentiert man die folgende Zeile ein:</p><pre class="notranslate"># !include auth-system.conf.ext</pre><p>Für einfache Konfigurationen reicht es oftmals auch aus, nur in der Passwortdatenbank zu prüfen, ob ein Benutzer berechtigt ist, auf den Server zuzugreifen und alle weiteren Felder durch eine statische Benutzerdatenbank generieren zu lassen. Diese wird dann anstatt der dynamischen Benutzerdatenbank in den jeweiligen Konfigurationsdateien eingefügt. Eine Konfiguration könnte dann wie folgt aussehen:</p><pre class="notranslate">userdb {
  driver = static
  args = uid=vmail gid=vmail home=/home/virtual/%u
}</pre><div class="section_3"><h4 id="Lokale-Passwortdatei">Lokale Passwortdatei<a class="headerlink" href="#Lokale-Passwortdatei">¶</a></h4><p>
Für die zusätzliche Nutzung einer lokal gespeicherten Passwortdatei mit <strong>dovecot-passwd</strong> löscht man das Kommentarzeichen <code class="notranslate">#</code> vor:</p><pre class="notranslate">!include auth-passwdfile.conf.ext</pre><p>Damit liest Dovecot standardmäßig die Benutzer und Passwörter aus der Datei <strong>/etc/dovecot/users</strong> aus. Die verwendete Formatierung der Datei ist dabei an die Datei <strong>/etc/passwd</strong> angelehnt.</p><pre class="notranslate">user:password:uid:gid:(gecos):home:(shell):extra_fields</pre><p>Unter Verwendung von <strong>doveadm pw</strong> können Passwort-Hashes erstellt werden. Standardmäßig wird hier das Schema CRAM-MD5 benutzt, mit dem Parameter <code class="notranslate">-s</code> kann man ein eigenes angeben. Mit <code class="notranslate">-l</code> listet man alle verfügbaren Schemata auf.</p><p>Anschließend erstellt man die entsprechende Zeile in der Passwortdatei, wobei 2000 in diesem Fall die User- sowie Group-ID des erstellten Mail-Benutzers ist. Das Feld für die Shell kann bei virtuellen Benutzern frei bleiben, da es nicht benötigt wird (siehe oben). Hat man für das Homeverzeichnis ein generisches Muster festgelegt, so kann auch dieses leer bleiben.</p><pre class="notranslate"># user:passwort:UserID:GroupID::homeDir
test:$6$o6mAiIneKi.qISGA$GubLbhEXCp/UTSf993zmhkehI067ZJ.zTOhm261visOxVBM614jEG8Q7BGni/MdPMOl88knIqg/CpTnNMdn7l/:2000:2000::/home/virtual/test</pre><p>Mehr Informationen:</p><ul><li><p><a class="external" href="http://wiki2.dovecot.org/AuthDatabase/PasswdFile" rel="nofollow">PasswdFile</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="external" href="http://wiki2.dovecot.org/Authentication/PasswordSchemes" rel="nofollow">PasswordSchemes</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p>
</p></div><div class="section_3"><h4 id="LDAP-Authentifizierung">LDAP-Authentifizierung<a class="headerlink" href="#LDAP-Authentifizierung">¶</a></h4><p>
Um eine Anmeldung über LDAP zu ermöglichen, muss die folgende Zeile auskommentiert werden:</p><pre class="notranslate">!include auth-ldap.conf.ext</pre><p>Diese Datei muss nur in Ausnahmefällen editiert werden. Die weitere Konfiguration erfolgt nur in der Datei <strong>/etc/dovecot/dovecot-ldap.conf.ext</strong>. Folgende Einstellungen sind wichtig:</p><pre class="notranslate">hosts = ldap-server-1 ldap-server-2
base = ou=users,dc=domain,dc=com
scope = subtree
auth_bind = yes</pre><p>In <code class="notranslate">hosts</code> werde die verfügbaren LDAP-Server eingetragen und <code class="notranslate">base</code> ist der Startpunkt für die Suche im LDAP-Verzeichnisbaum. Von diese Basis ausgehend sucht Dovecot dann im <code class="notranslate">scope</code> nach Benutzern. Möglich sind hier "base" (nur in der Basis), "onelevel" (in der Basis und allen direkten Unterordnern) und "subtree" (kompletter Verzeichnisbaum ab der Basis). Wenn man also weiß, dass Benutzer nur in der Basis angelegt werden, kann man "base" auswählen. Hat man eine komplexere Struktur mit Unterverzeichnissen, muss man auf "onelevel" oder "subtree" ausweichen.</p><p>Der Parameter <code class="notranslate">auth_bind</code> steht für ""Authentication Bind"". Steht er auf <code class="notranslate">yes</code>, wird das Passwort vom LDAP-Server selbst verifiziert (Dovecot bekommt es also nie zu sehen und bekommt nur ein "Gültig" oder "Ungültig" zurückgemeldet). Bei <code class="notranslate">no</code> liest Dovecot das Passwort aus dem LDAP aus und überprüft es selbst. Aufgrund der höheren Sicherheit wird das Aktivieren der Authentication Binds empfohlen.</p></div><div class="section_3"><h4 id="Datenbank-Authentifizierung">Datenbank-Authentifizierung<a class="headerlink" href="#Datenbank-Authentifizierung">¶</a></h4><p>Für die Anmeldung anhand einer Datenbank wird, analog zu den anderen auth-Backends, die entsprechende Zeile auskommentiert:</p><pre class="notranslate">!include auth-sql.conf.ext</pre><p>Die Konfiguration erfolgt für Postgres und MySQL gleich, da nur SQL-Befehle benutzt werden. Die folgende Beispielkonfiguration wurde mit MySQL getestet.</p><p>Bevor man die Konfiguration einstellt, muss man die Voraussetzungen schaffen, sich über die Datenbank anzumelden. Dazu müssen, sofern nicht eine bestehende Datenbanktabelle genutzt werden soll, eventuell ein neues Schema, eine Tabelle zum Speichern der Benutzer sowie ein Benutzer mit Lese-Zugriff auf die Benutzertabelle erstellt werden.</p><p>Eine Tabelle zum Speichern der Benutzer kann beispielsweise wie folgt erstellt werden:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="k">domain</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">home</span><span class="o">`</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">uid</span><span class="o">`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">gid</span><span class="o">`</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">)</span>
  <span class="n">active</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">'Y'</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div><p>In der Datei <strong>/etc/dovecot/dovecot-ldap.conf.ext</strong> werden dann manuell die SQL-Queries eingetragen, mit denen die passdb bzw. userdb dann arbeitet.</p><pre class="notranslate"># Treiber für die Datenbank, auf &gt;pgsql&lt; ändern für Postgres
driver = mysql 

# The mysqld.sock socket may be in different locations in different systems.
# Use "host= ... pass=foo#bar" with double-quotes if your password has '#' character.
connect = host=datenbankserver dbname=datenbankname user=datenbankbenutzer password=datenbankpasswort
# Alternatively you can connect to localhost as well:
#connect = host=localhost dbname=mails user=admin password=pass

password_query = SELECT username, domain, password \
  FROM users WHERE username = '%n'

# deactivated if we are using statuc userdb
user_query = SELECT home, uid, gid FROM users WHERE username = '%n' AND domain = '%d'

default_pass_scheme = SHA512-CRYPT</pre><p>Die queries müssen relevante Felder mit den passenden Namen zurückliefern! Heißen diese, wie in der oben genannten Beispieltabelle, schon in der Datenbank richtig, ist nichts weiter zu tun. Ansonsten müssen alle betroffenen Felder mit dem "AS"-Stichwort umbenannt werden. Folgende Namen müssen für die entsprechenden Felder verwendet werden:</p><p>
</p><table><tr class="titel"><td> Feld </td><td> Name </td></tr><tr><td> Benutzer </td><td> <code class="notranslate">username</code> </td></tr><tr><td> Domäne </td><td> <code class="notranslate">domain</code> </td></tr><tr><td> Passwort </td><td> <code class="notranslate">password</code> </td></tr><tr><td> Home-Verzeichnis </td><td> <code class="notranslate">home</code> </td></tr><tr><td> User-ID </td><td> <code class="notranslate">uid</code> </td></tr><tr><td> Gruppen-ID </td><td> <code class="notranslate">gid</code> </td></tr></table><p>
Ein entsprechender password_query mit unpassenden Benutzer- und Passwort-Feldern könnte dann wie folgt aussehen:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="k">SELECT</span> <span class="k">user</span> <span class="k">AS</span> <span class="n">username</span><span class="p">,</span> <span class="k">domain</span><span class="p">,</span> <span class="n">pw_hash</span> <span class="k">AS</span> <span class="n">password</span> <span class="k">FROM</span> <span class="n">usertable</span> <span class="k">WHERE</span> <span class="k">user</span> <span class="o">=</span> <span class="s1">'%n'</span>
</pre></div>
</td></tr></table></div><p>Für den user_query gilt das gleiche:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="k">SELECT</span> <span class="n">homedir</span> <span class="k">AS</span> <span class="n">home</span><span class="p">,</span> <span class="n">user_id</span> <span class="k">AS</span> <span class="n">uid</span><span class="p">,</span> <span class="n">group_id</span> <span class="k">AS</span> <span class="n">gid</span> <span class="k">FROM</span> <span class="n">usertable</span> <span class="k">WHERE</span> <span class="k">user</span> <span class="o">=</span> <span class="s1">'%n'</span> <span class="k">AND</span> <span class="k">domain</span> <span class="o">=</span> <span class="s1">'%d'</span>
</pre></div>
</td></tr></table></div></div></div><div class="section_2"><h3 id="Plugins">Plugins<a class="headerlink" href="#Plugins">¶</a></h3><p>
Dovecot bringt mehrere Plugins mit, die man optional aktivieren kann, um zusätzliche Funktionalitäten bereitzustellen.</p><p>Plugins können in der Datei <strong>10-mail.conf</strong> global aktiviert werden. Alternativ bietet es sich an, die Plugins in den Konfigurationsdateien der Unterkomponenten zu aktivieren. So nützt einem das Antispam-Plugin bei Benutzung von POP3 wenig, da die Funktionalität hier brachliegt. Es liegt also nahe, dieses nur in der IMAP-Konfiguration zu aktivieren. In der 10-mail.conf trägt man die zu verwendenden Plugins einfach als Leerzeichen-getrennte Liste in die <strong>mail_plugins</strong> ein, wobei man die Option erst durch Entfernen des Kommentarzeichens <code class="notranslate">#</code> am Zeilenanfang aktivieren muss. In den Konfigurationsdateien der Unterkomponenten trägt man die Plugins einfach am Ende der bestehenden Auflistung ein, wobei das voranstehende <strong>mail_plugins = $mail_plugins</strong> nicht verändert werden darf, da sonst vorherige Plugins deaktiviert werden.</p><div class="section_3"><h4 id="Sieve">Sieve<a class="headerlink" href="#Sieve">¶</a></h4><p>
E-Mails in Dovecot kann man mit <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Sieve">Sieve-Skripten</a> automatisch filtern lassen. Wenn das Paket <strong>dovecot-sieve</strong> installiert wurde, kann pro Postfach ein Sieve-Script abgelegt werden. Der Ort wo das Sieve-Script abgelegt wird, wird in <strong>90-sieve.conf</strong> festgelegt. Standardmäßig ist dies <strong>$HOME/.dovecot.sieve</strong>. Die Logdatei findet sich unter <strong>$HOME/.dovecot.sieve.log</strong>. Das Sieve-Skript benötigt ohne eigene Konfiguration also ein (virtuelles) Homeverzeichnis.</p><p>Um das Plugin zu aktivieren kann man es, alternativ zur erwähnten globalen Konfigurationsdatei, in der <strong>20-lmtp.conf</strong> eintragen.</p></div><div class="section_3"><h4 id="Manage-Sieve">Manage-Sieve<a class="headerlink" href="#Manage-Sieve">¶</a></h4><p>
Will man die Sieve-Skripte nicht manuell per Texteditor auf dem Server anpassen, muss bei Ubuntu nur das am Anfang des Artikels genannte Paket für das Manage-Sieve-Plugin installiert werden. Das Plugin ist nach einem Neustart von Dovecot automatisch aktiviert und übernimmt zudem die SSL-Einstellungen des Hauptprogramms. Hat man dort, wie empfohlen, SSL als erforderlich markiert, findet auch die Verbindung zum Manage-Sieve-Plugin nur verschlüsselt statt.</p><p>Ist das Plugin installiert, kann man seine Sieve-Skripte auch über entsprechende Oberflächen schreiben. Der Webmailer <a class="external" href="https://roundcube.net/" rel="nofollow">Roundcube</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> bietet dabei eine grafische Schnittstelle. <a class="internal" href="./kmail.html">KMail</a> hat einen simplen Texteditor integriert, der beim Speichern das Skript auf den Server lädt. Bei Thunderbird lässt sich diese Funktionalität über ein Plugin nachrüsten.</p></div><div class="section_3"><h4 id="Antispam">Antispam<a class="headerlink" href="#Antispam">¶</a></h4><p>
Das Antispam-Plugin erlaubt das einfache Markieren von Nachrichten als Spam bzw. nicht-Spam. Dazu muss man nach erfolgter Konfguration die E-Mails nur in den Spam-Ordner verschieben, um sie als Spam zu markieren bzw. aus dem Spam-Ordner herausschieben, um sie als nicht-Spam (Ham) zu kennzeichnen. Das Plugin trainiert dann automatisch den eingetragenen Spamfilter. Antispam sortiert nicht eingehende E-Mails automatisch in den Spam-Ordner. Dafür erstellt man sich eine für die eigenen Spam-Konfiguration passende Sieve-Regel wie z.B. die folgende:</p><pre class="notranslate">require ["fileinto","imapflags"];
# rule:[SPAM]
if header :contains "subject" ["***SPAM***"] {
        setflag "\\seen";
        fileinto "Spam";
        stop;
} else {
        # The rest goes into INBOX
        # default is "implicit keep", we do it explicitly here
        keep;
}</pre><p>Das Plugin kann entweder global oder in der <strong>20-imap.conf</strong> aktiviert werden und benötigt eine funktionierende <a class="internal" href="./amavis-spam-virenfilter.html">Spamassasin</a>-Installation.</p><p>Zusätzlich muss ein Skript erstellt werden, das den Spamfilter antrainiert. Dieses speichert man unter <strong>/usr/local/bin/sa-learn-pipe.sh</strong> mit folgendem Inhalt:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nb">echo</span> /usr/bin/sa-learn <span class="nv">$*</span> /tmp/sendmail-msg-<span class="nv">$$</span>.txt <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$$</span><span class="s2">-start (</span><span class="nv">$*</span><span class="s2">)"</span> &gt;&gt; /tmp/sa-learn-pipe.log
/usr/bin/sa-learn <span class="nv">$*</span> /tmp/sendmail-msg-<span class="nv">$$</span>.txt <span class="o">&amp;&amp;</span> rm -f /tmp/sendmail-msg-<span class="nv">$$</span>.txt <span class="p">&amp;</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$$</span><span class="s2">-end"</span> &gt;&gt; /tmp/sa-learn-pipe.log
<span class="nb">exit</span> <span class="m">0</span>
</pre></div>
</td></tr></table></div><p>Dieses Skript wird dann in der Pluginkonfiguration <strong>90-plugin.conf</strong> eingetragen, zusammen mit ein paar weiteren Optionen.</p><pre class="notranslate">plugin {
#  antispam_mail_sendmail_args= --username=%u        # Wenn man benutzerspezifische Spamfilter benutzen möchte
  antispam_mail_spam  = --spam
  antispam_mail_notspam  = --ham
  antispam_mail_sendmail = /usr/local/bin/sa-learn-pipe.sh # Das oben erstellte Skript
  antispam_spam = Spam;SPAM                          # Ordner die Spam enthalten
  antispam_trash = Trash;trash                       # Papierkörbe; wenn eine Mail hierhin verschoben wird, gilt sie nicht als "Ham"
}</pre></div><div class="section_3"><h4 id="Weitere-Plugins">Weitere Plugins<a class="headerlink" href="#Weitere-Plugins">¶</a></h4><p>
Dovecot bringt noch weitere Plugins mit, unter anderen ein Plugin mit dem man Quotas für Benutzer aktivieren kann. Für diese sei aber auf das ausführliche Dovecot-Wiki verwiesen.</p></div></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="external" href="http://www.dovecot.org/" rel="nofollow">Projektseite</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p><ul><li><p><a class="external" href="http://wiki2.dovecot.org/" rel="nofollow">Dokumentation</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/Dovecot">Dovecot</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> im Ubuntu-Wiki</p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/lts/serverguide/dovecot-server.html">Dovecot Server</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/> - Ubuntu 14.04 Server-Leitfaden</p></li><li><p><a class="external" href="https://skrilnetz.net/server-side-mail-filtering-with-horde-ingo-and-sieve/" rel="nofollow">Server side Mail Filtering with Horde – Ingo and Sieve</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li><li><p><a class="internal" href="./serverdienste.html#E-Mail">Serverdienste</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/> weitere E-Mail-Server</p></li></ul><p>
</p></div></div>
<p class="meta">
<a href="./dovecot_2/a/revision/884483.html">Diese Revision</a> wurde am 8. April 2016 18:52 von <a href="https://ubuntuusers.de/user/u1000/">u1000</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./dovecot_2.html">Dovecot 2</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>