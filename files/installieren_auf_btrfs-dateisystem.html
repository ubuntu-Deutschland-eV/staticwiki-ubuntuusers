<!DOCTYPE html>
<html lang="">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Installieren_auf_Btrfs-Dateisystem › ubuntuusers statisches Wiki</title>
<link href="./_/34e5d78db234405457773cc26741aada99f7fff2.css" rel="stylesheet" type="text/css"/>
<link href="./_/61af784fc5c93e296fec3be63b8e0bb48443727c.css" rel="stylesheet" type="text/css"/>
<link href="./_/634e8d1015b02df998cdec7cb07c5aff61d068b5.css" rel="stylesheet" type="text/css"/>
<link href="./_/b583ff7e37147497a59224ccf54cfee812a1d21b.css" rel="stylesheet" type="text/css"/>
<link href="./_/a0d5775ed6f36f8cc5b12bcf2f1c1bd98a3eb225.css" rel="stylesheet" type="text/css"/>
<link href="./_/98de73bded109a634cbd1e924abdd8c8964b8df2.css" media="print" rel="stylesheet" type="text/css"/>

<meta content="#a87300" name="theme-color"/>

</head>
<body>
<div class="wrap">
<div class="header">
<h1><a href="http://ubuntuusers.de/"><span>ubuntuusers.de</span></a></h1>
<ul class="tabbar">
<li class="portal">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ubuntuusers.de/">Portal<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="forum">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://forum.ubuntuusers.de/">Forum<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="wiki active">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/">Wiki<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="ikhaya">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://ikhaya.ubuntuusers.de/">Ikhaya<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="planet">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://planet.ubuntuusers.de/">Planet<span></span></a></div>
<div class="tab_right"></div>
</li>
<li class="community">
<div class="tab_left"></div>
<div class="tab_center"><a href="http://wiki.ubuntuusers.de/Mitmachen">Mitmachen<span></span></a></div>
<div class="tab_right"></div>
</li>
</ul>
</div>
<div class="body">
<div class="appheader">

<div class="pagetitle">
<h1 class="breadcrumb_title">
<a class="separator" href="./startseite.html">
              Wiki
            </a>
</h1>
<h2 class="breadcrumb_subtitle"><a href="./installieren_auf_btrfs-dateisystem.html">Installieren auf Btrfs-Dateisystem</a></h2>
</div>
</div><div class="message staticwikinote"><strong>Hinweis:</strong> Dies ist ein statischer Snapshot unseres Wikis vom Jan. 17, 2018 und kann daher nicht bearbeitet werden. Der aktuelle Artikel ist unter <a href="http://wiki.ubuntuusers.de/Installieren_auf_Btrfs-Dateisystem">wiki.ubuntuusers.de</a> zu finden.</div>

<!--[if lt IE 8]>
      <div class="message fail">Bitte installiere den Internet Explorer 8 oder neuer.</div>
      <![endif]-->
<div class="page_content">
<div class="navi_sidebar navigation">
<div class="container">
<h3 class="navi_wiki">Wiki</h3>
<ul>
<li><a href="./wiki/index.html">Index</a></li>
<li><a href="./wiki/recentchanges.html">Letzte Änderungen</a></li>
<li><a href="./wiki/neue_artikel.html">Liste neuer Artikel</a></li>
<li><a href="./wiki.html">Übersicht</a></li>
<li><a href="./wiki/faq_-_häufig_gestellte_fragen.html">FAQ</a></li>
<li><a href="./wiki/benutzung.html">Benutzung</a></li>
<li><a href="./kategorien.html">Kategorie</a></li>
<li><a href="./wiki/tagcloud.html">Wortwolke</a></li>
</ul>
<h3 class="navi_join">Mitmachen</h3>
<ul>
<li><a href="./wikiartikel_anlegen.html">Wikiartikel anlegen</a></li>
<li><a href="./howto.html">Howto anlegen</a></li>
<li><a href="./wiki/referenz.html">Wiki-Referenz</a></li>
<li><a href="./wiki/syntax.html">Wiki-Syntax</a></li>
<li><a href="./baustelle.html">Baustellen</a></li>
<li><a href="./wiki/artikelideen.html">Artikelideen</a></li>
<li><a href="./wiki/ungetestet.html">Ungetestete Artikel</a></li>
<li><a href="./wiki/vorlagen/ausbaufähig/a/backlinks.html">Ausbaufähige Artikel</a></li>
<li><a href="./wiki/vorlagen/fehlerhaft/a/backlinks.html">Fehlerhafte Artikel</a></li>
<li><a href="https://forum.ubuntuusers.de/forum/wiki/">Rund ums Wiki</a></li>
</ul>
<h3 class="navi_config">Konfiguration</h3>
<ul>
<li><a href="./installieren_auf_btrfs-dateisystem/a/backlinks.html">Backlinks anzeigen</a></li>
<li>
        Exportieren
        <ul>
<li><a href="./installieren_auf_btrfs-dateisystem/a/export/meta.html" rel="nofollow">Metadaten</a></li>
<li><a href="./installieren_auf_btrfs-dateisystem/a/export/raw.html" rel="nofollow">Rohformat</a></li>
<li><a href="./installieren_auf_btrfs-dateisystem/a/export/html.html" rel="nofollow">HTML</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div class="content content_tabbar content_sidebar">
<h1 class="pagetitle"><a href="./installieren_auf_btrfs-dateisystem/a/backlinks.html">Installieren auf Btrfs-Dateisystem</a></h1>
<div id="page"><p>
</p><div class="box tested_for"><h3 class="box tested_for">Dieser Artikel wurde für die folgenden
Ubuntu-Versionen getestet:</h3><div class="contents"><p>
</p><ul><li><p><a class="internal" href="./xenial_xerus.html">Ubuntu 16.04</a> Xenial Xerus</p></li><li><p><a class="internal" href="./trusty_tahr.html">Ubuntu 14.04</a> Trusty Tahr</p></li></ul></div></div><p>
</p><div class="box advanced"><h3 class="box advanced">Artikel für fortgeschrittene Anwender</h3><div class="contents"><p>
Dieser Artikel erfordert mehr Erfahrung im Umgang mit
Linux und ist daher nur für fortgeschrittene Benutzer
gedacht.
</p></div></div><div class="box knowledge"><h3 class="box knowledge">Zum Verständnis dieses Artikels sind folgende Seiten hilfreich:</h3><div class="contents"><p>
</p><ol class="arabic"><li><p><a class="crosslink anchor" href="#source-1" id="source-1"></a> <a class="internal" href="./terminal.html">Ein Terminal öffnen</a></p></li><li><p><a class="crosslink anchor" href="#source-2" id="source-2"></a> <a class="internal" href="./pakete_installieren.html">Pakete installieren</a></p></li><li><p><a class="crosslink anchor" href="#source-3" id="source-3"></a> <a class="internal" href="./partitionierung.html">Eine Partition einrichten</a></p></li></ol></div></div><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Um den aktuellen Befehlsumfang zu <code class="notranslate">btrfs</code> zu erhalten (Optionen, Ergänzungen), sollte man den jeweiligen Befehl im Terminal <sup><a href="#source-1">[1]</a></sup> ohne Option (entspricht der Option <code class="notranslate">--help</code>) abfragen - die <a class="internal" href="./man.html">Manpages</a> sind teilweise fehlerhaft bzw. Hinweise fehlen ganz!</p><p>Bis <a class="internal" href="./raring_ringtail.html">Raring Ringtail</a> (13.04) steht eine aktuellere Version der <strong>btrfs-tools</strong> unter den <a class="crosslink" href="#Links">Links</a> bereit.
</p></div></div><div class="toc toc-depth-3"><div class="head">Inhaltsverzeichnis</div><ol class="arabic"><li><a class="crosslink" href="#Installation-auf-Btrfs">Installation auf Btrfs
</a></li><li><a class="crosslink" href="#Btrfs-Vorbereitung">Btrfs Vorbereitung
</a><ol class="arabic"><li><a class="crosslink" href="#Vergleich-Ergebnisse">Vergleich Ergebnisse
</a></li></ol></li><li><a class="crosslink" href="#Btrfs-einrichten">Btrfs einrichten
</a><ol class="arabic"><li><a class="crosslink" href="#Der-mkfs-btrfs-Befehl">Der mkfs.btrfs Befehl
</a><ol class="arabic"><li><a class="crosslink" href="#Optionen-mkfs-btrfs">Optionen mkfs.btrfs
</a></li><li><a class="crosslink" href="#Formatierung-Partition">Formatierung Partition
</a></li><li><a class="crosslink" href="#Formatierung-RAID-Verbund">Formatierung RAID-Verbund
</a></li></ol></li><li><a class="crosslink" href="#Formatierung-ueberpruefen">Formatierung überprüfen
</a></li></ol></li><li><a class="crosslink" href="#Zusaetzliche-Massnahmen">Zusätzliche Maßnahmen
</a><ol class="arabic"><li><a class="crosslink" href="#Daten-komprimieren">Daten komprimieren
</a></li><li><a class="crosslink" href="#fstab-ergaenzen">fstab ergänzen
</a><ol class="arabic"><li><a class="crosslink" href="#Solid-State-Drive">Solid State Drive
</a></li><li><a class="crosslink" href="#Komprimierung">Komprimierung
</a></li><li><a class="crosslink" href="#Fehlerbehandlung-Rootlaufwerk">Fehlerbehandlung Rootlaufwerk
</a></li></ol></li><li><a class="crosslink" href="#GRUB-2-einrichten">GRUB_2 einrichten
</a></li><li><a class="crosslink" href="#Externer-GRUB-2">Externer GRUB_2
</a><ol class="arabic"><li><a class="crosslink" href="#GRUB-2-primaeres-System">GRUB_2 primäres System
</a></li><li><a class="crosslink" href="#GRUB-2-sekundaeres-System">GRUB_2 sekundäres System
</a></li></ol></li></ol></li><li><a class="crosslink" href="#Probleme-und-Abhilfe">Probleme und Abhilfe
</a><ol class="arabic"><li><a class="crosslink" href="#fsck-btrfs">fsck.btrfs
</a></li><li><a class="crosslink" href="#Defektes-Btrfs-Raid">Defektes Btrfs-Raid
</a></li></ol></li><li><a class="crosslink" href="#Links">Links
</a><ol class="arabic"><li><a class="crosslink" href="#Informationen">Informationen
</a></li><li><a class="crosslink" href="#Downloads">Downloads
</a></li></ol></li></ol></div><p><img alt="btrfs_logo.png" class="image-left" src="./_/b9ae6d0682d614c896f53714f0b086eb596bb621.png"/>
</p><div class="section_1"><h2 id="Installation-auf-Btrfs">Installation auf Btrfs<a class="headerlink" href="#Installation-auf-Btrfs">¶</a></h2><p>
Dieser Artikel befasst sich mit der Installation auf einem Btrfs-Dateisystem und verweist auf jeweilige Besonderheiten, die man beachten sollte - soweit diese den Autoren bekannt sind bzw. erwähnenswert eingestuft wurden.</p><p>Eine dieser Besonderheiten ist, dass bei einer Installation gleich die Unterlaufwerke (Subvolumes) für das Rootverzeichnis mit <strong>@</strong> und für das <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> mit <strong>@home</strong> angelegt werden. Damit kann man dann auf einfache Art entsprechende <a class="internal" href="./befehle_btrfs-dateisystem.html#btrfs-subvolume-snapshot">Schnappschüsse</a> (Quasi-Backups) anlegen.</p><p>Im separaten Artikel <a class="internal" href="./befehle_btrfs-dateisystem.html">Befehle für das Btrfs-Dateisystem</a> sind alle Befehle aufgelistet und deren Anwendung beschrieben, die für den Einsatz und die Überprüfung eines <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Btrfs">Btrfs-Dateisystems</a> verfügbar sind.</p><p>Die Installation wird wie bei allen anderen Installationen ausgeführt, entweder über:
</p><ul><li><p><a class="internal" href="./desktop-cd.html">Desktop-CD/DVD</a></p><ul><li><p>zu den <a class="internal" href="./downloads.html">Downloads</a></p></li><li><p><a class="internal" href="./ubuntu_installation_ab_natty.html">Installieren</a></p></li></ul></li><li><p>Alternate-CD</p><ul><li><p>zu den <a class="internal" href="./downloads.html">Downloads</a></p></li><li><p><a class="internal" href="./alternate_installation.html">Installieren</a></p></li></ul></li><li><p>Online (<a class="internal" href="./downloads/netzwerkinstallation.html">Netzwerkinstallation</a>)</p></li><li><p>von einem bestehenden Linux (<a class="internal" href="./installation_mit_debootstrap.html">Installation mit debootstrap</a>)</p></li></ul><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Man sollte beachten, dass eine Installation von GRUB 2 nur unter besonderen Bedingungen in einen Partitionsbereich (PBR) möglich ist. Will man den bestehenden MBR nicht antasten, muss ein anderer Bootloader / Bootmanager benutzt werden, um das System zu starten. Dann sind entsprechende <a class="internal" href="./grub_2/installation.html#Zusaetzliche-Massnahmen">Vorbereitungen</a> zu treffen. Diese sind hinsichtlich einem Btrfs-Dateisystem noch zu erweitern - siehe die ergänzenden Hinweise zu <a class="crosslink" href="#Externer-GRUB-2">Externer GRUB_2</a>.
</p></div></div></div><div class="section_1"><h2 id="Btrfs-Vorbereitung">Btrfs Vorbereitung<a class="headerlink" href="#Btrfs-Vorbereitung">¶</a></h2><p>
Will man ein Betriebssystem mit Ubuntu bzw. eines der Derivate <span class="underline">bootfähig</span> mit einem Btrfs-Dateisystem auf einem Rechner installieren, sollte dieses  <span class="underline">vorab</span> vorbereitet werden. Eine zusätzliche Installation (Multiboot), die von einem anderen Linux aus aufgerufen werden soll (via <a class="internal" href="./grub_2/skripte.html#Configfile">configfile</a> oder Vergleichbarem), kann ggf. ohne weitere Vorbereitung nicht normal ausgeführt werden. Siehe dazu auch die Ausführungen unter <a class="crosslink" href="#Zusaetzliche-Massnahmen">Zusätzliche Maßnahmen</a>. Dazu muss und darf dann auch kein PBR gesetzt werden!</p><p>Weitergehende Informationen zur Aufbereitung von Datenträgern, insbesondere bei einer <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/GUID">GUID</a>-Partitionstabelle, siehe auch unter <a class="internal" href="./grub_2/grundlagen.html">GRUB 2 Grundlagen</a></p><div class="section_2"><h3 id="Vergleich-Ergebnisse">Vergleich Ergebnisse<a class="headerlink" href="#Vergleich-Ergebnisse">¶</a></h3><p>
Nachfolgend das Ergebnis für eine Partitionierung mit Installer alter Art:
</p><pre class="notranslate">   Gerät  boot.     Anfang        Ende     Blöcke   Id  System
/dev/sdc1              62    10566659     5283299   83  Linux
/dev/sdc2        10566660    15650907     2542124   83  Linux
....</pre><p>Und hier das vergleichbare Ergebnis mit GParted bzw. Installer neuer Art:</p><pre class="notranslate">   Gerät  boot.     Anfang        Ende     Blöcke   Id  System
/dev/sdc1            2048    10565631     5281792   83  Linux
/dev/sdc2        10566660    15650907     2542124   83  Linux
....</pre><p>Insbesondere sei hier darauf hingewiesen, dass andere Partitionstabellen als der Standard (= <strong>MSDOS</strong>) ohnehin nur mit den Werkzeugen für eine Partitionierung erstellt werden können - als Beispiel das Ergebnis für eine "GUID"-Formatierung:
</p><pre class="notranslate">   Gerät  boot.     Anfang        Ende     Blöcke   Id  System
/dev/sdc1               1    15663103     7831551+  ee  GPT</pre></div></div><div class="section_1"><h2 id="Btrfs-einrichten">Btrfs einrichten<a class="headerlink" href="#Btrfs-einrichten">¶</a></h2><p>
Das nachfolgende Werkzeug ist in der Regel auf den Installationsmedien enthalten
</p><ul><li><p><strong>btrfs-tools</strong></p></li></ul><p><img alt="Wiki/Vorlagen/Installbutton/button.png" class="image-default" src="./_/fd60ccb86c4d96df2f4518df2936cc7d038467aa.png"/>
mit <a class="internal" href="./apturl.html">apturl</a>
</p><div class="package-list"><div class="contents"><p>
Paketliste zum Kopieren:
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo apt-get install btrfs-tools </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo aptitude install btrfs-tools </pre></div></div><p>
</p></div></div><p>
und enthält alle Programme zum Einrichten und Arbeiten mit einem Btrfs-Dateisystem.</p><div class="section_2"><h3 id="Der-mkfs-btrfs-Befehl">Der mkfs.btrfs Befehl<a class="headerlink" href="#Der-mkfs-btrfs-Befehl">¶</a></h3><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Der Befehl <code class="notranslate">mkfs.btrfs</code> kann <span class="underline">keine</span> Partition erstellen, sondern die angegebene Partition nur mit einem Btrfs-Dateisystem formatieren. Zum eigentlichen Erstellen einer Partition benutzt man die allgemein bekannten grafischen Werkzeuge für eine Partitionierung oder verwendet im Terminal <sup><a href="#source-1">[1]</a></sup> z.B. den Befehl <code class="notranslate">cfdisk</code> <sup><a href="#source-3">[3]</a></sup>. Die in den nachfolgenden Beispielen verwendeten Begriffe und sonstige Angaben sind dem eigenen System sinngemäß anzupassen.
</p></div></div><p>Eine Information über den Befehl erhält man mit der Eingabe in das Terminal <sup><a href="#source-1">[1]</a></sup> von:
</p><div class="bash"><div class="contents"><pre class="notranslate">mkfs.btrfs </pre></div></div><p>
Die Ausgabe enthält eine Übersicht zu den Optionen:</p><div class="section_3"><h4 id="Optionen-mkfs-btrfs">Optionen mkfs.btrfs<a class="headerlink" href="#Optionen-mkfs-btrfs">¶</a></h4><p>
</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Die folgenden Vorgaben hinsichtlich der Optionen <code class="notranslate">-A</code> bzw. <code class="notranslate">-b</code> betreffen nur interne Daten innerhalb vom festgelegten Rahmen der Partition. Diese Einstellungen werden nur im Regelbetrieb bei der Belegung der Partition berücksichtigt!
</p></div></div><p>Mögliche Optionen für das Formatieren eines Btrfs-Dateisystemes, einzusetzen <span class="underline">vor</span> der Bestimmung von einem oder mehrerer Laufwerke, sind:
</p><p>
</p><table><tr class="titel"><td colspan="2">Optionen zum Formatieren eines Btrfs-Dateisystems </td></tr><tr><td> <code class="notranslate">-A</code><br/><code class="notranslate">--alloc-start</code> </td><td> Einen nicht zugewiesenen Bereich zwischen dem Start der Partition (nach einer normalen Partitionierung) und dem Start der eigentlichen Datenablage in Bytes bestimmen (Integerzahl mit Faktor: g= GB, m= MB, k= KB). </td></tr><tr><td> <code class="notranslate">-b</code><br/><code class="notranslate">--byte-count</code> </td><td> Größe des Laufwerkes, die Angabe erfolgt als Integerzahl mit Faktor: g= GB, m= MB, k= KB </td></tr><tr><td> <code class="notranslate">-d</code><br/><code class="notranslate">--data</code> </td><td> Datenprofil -&gt; Zulässig ist raid0, raid1, raid5, raid6, raid10 or single </td></tr><tr><td> <code class="notranslate">-m</code><br/><code class="notranslate">--metadata</code> </td><td> Metadatenprofile -&gt; Zulässig ist raid0, raid1, raid5, raid6, raid10, single or dup <div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Bei <code class="notranslate">single</code> ist <code class="notranslate">dup</code>  (duplicate) automatisch mit gesetzt - ausgenommen bei einer <a class="internal" href="./ssd.html">SSD</a>, diese hat immer <code class="notranslate">single</code> per default! Dieses weil eine <a class="internal" href="./ssd.html">SSD</a> die internen Blöcke eigenständig neu anordnet (remapping). Die gleichzeitige Anwendung beider Funktionen könnte zu Fehlern führen.
</p></div></div> </td></tr><tr><td> <code class="notranslate">-l</code><br/><code class="notranslate">--leafsize</code> </td><td> Größe  <code class="notranslate">btree leaves</code> -&gt; Default = Seitengröße </td></tr><tr><td> <code class="notranslate">-n</code><br/><code class="notranslate">--nodesize</code> </td><td> Größe der <code class="notranslate">btree nodes</code> -&gt; Default = Seitengröße </td></tr><tr><td> <code class="notranslate">-s</code><br/><code class="notranslate">--sectorsize</code> </td><td> minimale Größe der Sektoren in Byte -&gt; Default = 4096  </td></tr><tr><td> <code class="notranslate">-L</code><br/><code class="notranslate">--label</code> </td><td> Dem Laufwerke eine Bezeichnung zuordnen. -&gt; "HD_NAME" </td></tr></table><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Die Option <code class="notranslate">-d</code> single (= keine Redundanz) sollte man nur mit Bedacht wählen - denn defekte Metadaten bedeuten unlesbares Laufwerk! Die Standardwerte der Optionen <code class="notranslate">-l</code>, <code class="notranslate">-n</code> und <code class="notranslate">-s</code> sollte man nur in begründeten Fällen setzen.
</p></div></div></div><div class="section_3"><h4 id="Formatierung-Partition">Formatierung Partition<a class="headerlink" href="#Formatierung-Partition">¶</a></h4><p>
Eine normale Formatierung kann man mit den bekannten Werkzeugen für eine Partitionierung ausführen oder man gibt in das Terminal <sup><a href="#source-1">[1]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mkfs.btrfs -L "HD_NAME" /dev/sda1 </pre></div></div><p>Die angegebene Partition sda1 wird mit einem Btrfs-Dateisystem mit den Vorgabewerten versehen, löscht dabei alle Daten auf dieser Partition und bekommt die Bezeichnung "HD_NAME".</p></div><div class="section_3"><h4 id="Formatierung-RAID-Verbund">Formatierung RAID-Verbund<a class="headerlink" href="#Formatierung-RAID-Verbund">¶</a></h4><p>
Für die Formatierung eines Btrfs-RAID-Verbundes mit einer Bezeichnung gibt man (beispielhaft) im Terminal <sup><a href="#source-1">[1]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mkfs.btrfs -m raid1 -d raid1 -L "BTRFS_RAID" /dev/sda1 /dev/sdb1 </pre></div></div><p>Bei der eigentlichen Installation wird dann <span class="underline">nur</span> eines der Laufwerke aus dem Btrfs-Raid-Verbund herangezogen / bestimmt. Die Information zur erfolgreichen Erstellung fragt man ab mit der Eingabe in ein Terminal <sup><a href="#source-1">[1]</a></sup> von:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo blkid </pre></div></div><pre class="notranslate">/dev/sdb1: LABEL="BTRFS_RAID" UUID="2f613613-85b4-46cf-bbbe-90a1748f7753" UUID_SUB="e88dd65c-f471-415a-827b-2fc47359ba2d" TYPE="btrfs" 
/dev/sda1: LABEL="BTRFS_RAID" UUID="2f613613-85b4-46cf-bbbe-90a1748f7753" UUID_SUB="80eb4ebe-9e95-4052-8162-dbc2a48f3899" TYPE="btrfs"</pre><p>Zu beachten ist, dass auch bei einem Btrfs-RAID-Verbund für die Partitionen die gleiche <a class="internal" href="./uuid.html">UUID</a> - jedoch je Partition eine unterschiedliche UUID_SUB vergeben wurde. In die <strong>/etc/fstab</strong> wird nur <span class="underline">einmal</span> die gemeinsame <a class="internal" href="./uuid.html">UUID</a> eingetragen - das Dateisystem ordnet das schon richtig zusammen. Nachfolgend ein beispielhafter Eintrag für die Root-Partition eines Btrfs-RAID-Verbundes in der <strong><a class="crosslink" href="#fstab-einrichten">/etc/fstab</a></strong>:</p><pre class="notranslate">UUID=2f613613-85b4-46cf-bbbe-90a1748f7753 / btrfs  defaults,subvol=@,compress	0   1</pre><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Es darf die <a class="internal" href="./mount.html#Optionen">Option</a> <code class="notranslate">errors=remount -ro</code> bei einem Btrfs-Dateisystem <span class="underline">nicht</span> benutzt werden!
</p></div></div></div></div><div class="section_2"><h3 id="Formatierung-ueberpruefen">Formatierung überprüfen<a class="headerlink" href="#Formatierung-ueberpruefen">¶</a></h3><p>
Nach Abschluss der Formatierung und bevor man diese Partition benutzt, kann und sollte man die Partitionen überprüfen - dazu dient der Befehl:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs filesystem show </pre></div></div><p>Dann werden alle Laufwerke angezeigt, unabhängig von Mount-Status. Für alle ohne Btrfs-Dateisystem erhält man für ein einzelnes Btrfs-Laufwerk folgende (beispielhaften) Informationen:
</p><pre class="notranslate">failed to read /dev/sde
failed to read /dev/sdd</pre><p>Für ein einzelnes Laufwerk mit einem Btrfs-Dateisystem folgende (beispielhaften) Informationen:</p><pre class="notranslate">Label: 'HD_NAME'  uuid: ed1545d8-dc26-415c-b82b-e00d7f85d4c1
	Total devices 1 FS bytes used 58.71MB
	devid    1 size 2.00GB used 445.31MB path /dev/sda1</pre><p>Für einen Btrfs-RAID-Verbund folgende (beispielhaften) Informationen:</p><pre class="notranslate">Label: 'BTRFS_RAID'  uuid: 2f613613-85b4-46cf-bbbe-90a1748f7753
	Total devices 2 FS bytes used 2.55GB
	devid    2 size 232.76GB used 2.76GB path /dev/sdc1
	devid    1 size 232.76GB used 2.76GB path /dev/sdb1</pre><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Ausgehend vom obigen Beispielen kann und sollte der <a class="internal" href="./grub_2/installation.html">Bootloader</a> bei einem Btrfs-RAID-Verbund <span class="underline">nacheinander</span> jeweils in eine der Festplatten geschrieben werden (siehe auch <a class="crosslink" href="#Defektes-Btrfs-Raid">Defektes Btrfs-Raid</a>). Von Interesse sind dabei für einen Btrfs-RAID-Verbund die "Device ID's", nur die Festplatte mit der höchsten, hier <code class="notranslate">devid = 2</code>, sollte in einem Btrfs-RAID-Verbund als sogenannte erste Festplatte im BIOS zum Booten verwendet werden. Man sollte bei der Bestimmung im BIOS zur ersten Festplatte (von der gebootet werden soll) erst sicherstellen, dass das auch funktioniert. Bei der Wahl der "falschen" Festplatte wird der Suchvorgang nach den <a class="internal" href="./grub_2.html">GRUB 2</a>-Imagedateien abgebrochen und dann neu gebootet (Dauerschleife)!
</p></div></div><p>Der Befehl mit einer Option
</p><div class="bash"><div class="contents"><pre class="notranslate">btrfs filesystem show /dev/sda1 </pre></div></div><p>
begrenzt die Informationen auf das gewählte Laufwerk. Mögliche Option sind dabei (entweder!)
</p><ul><li><p>Device, Eingabe = <code class="notranslate">/dev/sda1</code></p></li><li><p>UUID, Eingabe = <code class="notranslate">ed1545d8-dc26-415c-b82b-e00d7f85d4c1</code></p></li><li><p>Label, Eingabe= <code class="notranslate">HD_NAME</code></p></li></ul></div></div><div class="section_1"><h2 id="Zusaetzliche-Massnahmen">Zusätzliche Maßnahmen<a class="headerlink" href="#Zusaetzliche-Massnahmen">¶</a></h2><p>
Nachfolgend sind einige Maßnahmen aufgeführt, die während der Installation standardmäßig nicht abgearbeitet werden, jedoch für den Betrieb von Interesse sein können. Teilweise ist ohne eine entsprechende Nachbearbeitung das Betriebssystem nicht uneingeschränkt nutzbar.</p><div class="section_2"><h3 id="Daten-komprimieren">Daten komprimieren<a class="headerlink" href="#Daten-komprimieren">¶</a></h3><p>
Man kann einerseits sowohl am Speicherplatz etwas einsparen - wesentlicher ist jedoch die Zugriffszeit auf den Speicherbereich zu optimieren. Dazu dient die Mountoption  <a class="crosslink" href="#Komprimierung"><code class="notranslate">compress</code></a>. Da dieses bei der normalen Installation nicht berücksichtigt wird (und auch nur mit Risiken realisierbar ist), kann man das am frischen System nachholen. Als Beispiel wird hier davon ausgegangen, dass sich das Rootverzeichnis <strong>@</strong> auf der Partition <strong>/dev/sda1</strong> befindet.</p><p>Dazu startet man ein Live-System und gibt dort nacheinander in ein Terminal <sup><a href="#source-1">[1]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount -o compress /dev/sda1 /mnt </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs subvolume create /mnt/@plus </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo chmod -R 755 /mnt/@plus </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo cp -apr /mnt/@/* /mnt/@plus/ </pre></div></div><p>Dieser Vorgang kann je nach Rechnerleistung etwas dauern!</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs subvolume delete /mnt/@ </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mv /mnt/@plus /mnt/@ </pre></div></div><p>Bei dieser Gelegenheit kann man auch gleich den ersten Schnappschuss (Bezeichnung beispielhaft) anlegen mit:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs subvolume snapshot /mnt/@ /mnt/root-datum </pre></div></div><p>Das System wird dann ausgehangen mit:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo umount /dev/sda1 </pre></div></div><p>Aufgrund der geringen Datenmenge kann das beim <a class="internal" href="./homeverzeichnis.html">Homeverzeichnis</a> (<strong>@home</strong>) vernachlässigt werden - in die <strong>/etc/fstab</strong> sollte man die Mountoption <a class="crosslink" href="#Komprimierung"><code class="notranslate">compress</code></a> aber auf jeden Fall einbringen!</p></div><div class="section_2"><h3 id="fstab-ergaenzen">fstab ergänzen<a class="headerlink" href="#fstab-ergaenzen">¶</a></h3><p>
Während der Installation werden in der <a class="internal" href="./fstab.html"><strong>/etc/fstab</strong></a> bei den <a class="internal" href="./mount.html#Optionen">Optionen</a> nur die Basisparameter eingetragen. Bei einer Installation auf einem Btrfs-Dateisystem sollte man zusätzlich in der <strong>/etc/fstab</strong> folgende Positionen überprüfen und soweit erforderlich nachtragen.</p><div class="section_3"><h4 id="Solid-State-Drive">Solid State Drive<a class="headerlink" href="#Solid-State-Drive">¶</a></h4><p>
Die Option <code class="notranslate">ssd</code> und weitere: <br/>Wurde die Installation auf ein <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Solid_State_Drive">Solid State Drive</a> (Halbleiterlaufwerk) aufgebracht, so wird der entsprechende Eintrag (<code class="notranslate">ssd</code>) dafür unter den Optionen in die <strong>/etc/fstab</strong> eingebracht. Es können noch weitere, nützliche Parameter verwendet werden - siehe hierzu die Artikelserie <a class="internal" href="./ssd.html">SSD</a> sowie diese speziellen <a class="internal" href="./ssd/trim.html#TRIM-mit-btrfs">Ausführungen</a>.</p></div><div class="section_3"><h4 id="Komprimierung">Komprimierung<a class="headerlink" href="#Komprimierung">¶</a></h4><p>
Die Option <a class="internal" href="./btrfs-mountoptionen.html#Mountoptionen">Mountoptionen <code class="notranslate">compress</code></a>: <br/>Dieser Eintrag in die <strong>/etc/fstab</strong> muss manuell nachgetragen werden und sorgt für eine Komprimierung der Daten, wenn diese auf das Laufwerk geschrieben werden. Diese Arbeit wird beim Komprimieren bzw. Dekomprimieren von der CPU erledigt und ist Teil der Kernelroutinen. Diese Zusatzbelastung dürfte aber bei heutigen CPUs keine fühlbaren Auswirkungen mehr haben, bringt jedoch eine Einsparung beim Speicherplatz und beschleunigt das Auslesen erheblich. Beispielhaft für das Rootverzeichnis kann dann diese Ergänzung wie folgt aussehen:</p><pre class="notranslate">UUID=2f613613-85b4-46cf-bbbe-90a1748f7753  /   btrfs  defaults,<strong class="highlighted">compress,</strong>subvol=@  0   1</pre></div><div class="section_3"><h4 id="Fehlerbehandlung-Rootlaufwerk">Fehlerbehandlung Rootlaufwerk<a class="headerlink" href="#Fehlerbehandlung-Rootlaufwerk">¶</a></h4><p>
Die Option <code class="notranslate">errors=remount -ro</code> <br/>darf bei einem Btrfs-Dateisystem nicht benutzt werden! Dieses führt zu einem nicht betriebsfähigen System.</p></div></div><div class="section_2"><h3 id="GRUB-2-einrichten">GRUB_2 einrichten<a class="headerlink" href="#GRUB-2-einrichten">¶</a></h3><p>
Da der <a class="internal" href="./grub_2.html">GRUB 2</a>-Bootloader in der Standardkonfiguration schreibende Zugriffe auf
</p><ul><li><p>das Verzeichnis <strong>/@/boot/grub</strong> und die Datei <strong>grubenv</strong> </p></li></ul><p>ausführt und dieses zu einem Fehlerhinweis während des Bootvorganges führen würde, wird diese Funktion
</p><ul><li><p><strong>recordfail</strong></p></li></ul><p>bei einem Btrfs-Dateisystem beim Installieren von <a class="internal" href="./grub_2.html">GRUB 2</a> per Default unterdrückt. Der Aufruf innnerhalb der <em>"menuentry"</em> wird dann auf eine blinde Subroutine geleitet.</p><p>Auch das Schreiben, ausgelöst durch die Variable <a class="internal" href="./grub_2/konfiguration.html#Bedeutung-der-Variablen">GRUB_SAVEDEFAULT=true</a> in der Datei <strong>/etc/default/grub</strong> sollte man nicht benutzen.</p><p>Der jeweils ausgewählte Menüeintrag kann nicht auf einem Btrfs-Dateisystem abgespeichert werden.</p></div><div class="section_2"><h3 id="Externer-GRUB-2">Externer GRUB_2<a class="headerlink" href="#Externer-GRUB-2">¶</a></h3><p>
Da in der Regel bei einem Btrfs-Dateisystem während der Installation Unterlaufwerke (Subvolume = <strong>@</strong>, <strong>@home</strong> usw.) angelegt werden, wird dieses (sekundäre) Betriebssystem nicht so ohne Weiteres über die Funktion des Skriptes
</p><ul><li><p><strong>/etc/grub.d/30_os-prober</strong></p></li></ul><p>von einem anderen (primären) Betriebssystem gefunden! Man muss das primäre System (mit dem aktiven Bootloader) für den Zugriff auf das sekundäre System entsprechend einrichten.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Der Bootloader des nachfolgend als primär bezeichneten Systems muss in der Lage sein, ein Btrfs-Dateisystem zu lesen. Ansonsten muss man im primären System die <a class="crosslink" href="#Btrfs-einrichten">btrfs-tools</a> nachinstallieren.
</p></div></div><div class="section_3"><h4 id="GRUB-2-primaeres-System">GRUB_2 primäres System<a class="headerlink" href="#GRUB-2-primaeres-System">¶</a></h4><p>
Zum Einbinden des neuen Systems legt man sich das folgende Skript ausführbar im primären System ab unter:
</p><ul><li><p><strong>/etc/grub.d/nn_btrfs-suchen</strong></p></li></ul><p>(wobei mit der Zahl (hier "nn") die Position im Grub-Menü festgelegt werden kann). Die Liste der zu ladenden Module (hier z.B. <strong>insmod gzio</strong>) sowie die der Kernel-Optionen (hier z.B. <code class="notranslate">vt.handoff=7</code>) muss man aus dem sekundären System einmalig in das Skript übernehmen.</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#! /bin/bash</span>
<span class="nb">set</span> -e

<span class="c1">###FIXME die Bezeichnung "DEVICE" muss auf die reale Partition</span>
<span class="c1"># mit dem Btrfs-Dateisystem angepasst werden!</span>

<span class="nv">DEVICE</span><span class="o">=</span><span class="s2">"/dev/sda5"</span><span class="p">;</span>

AUSSTIEG <span class="o">()</span> <span class="o">{</span>
<span class="nb">echo</span> <span class="s2">"Das Laufwerk </span><span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span><span class="s2"> ist kein \"Btrfs-Dateisystem\"!"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">exit</span> <span class="m">1</span>
<span class="o">}</span>

<span class="nv">TEST_UUID</span><span class="o">=</span><span class="k">$(</span> blkid <span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span> <span class="p">|</span> grep btrfs <span class="k">)</span> &gt;/dev/null <span class="o">||</span> AUSSTIEG<span class="p">;</span>
<span class="nv">UUID_BTRFS</span><span class="o">=</span><span class="k">$(</span> blkid -c /dev/null -o value -s UUID <span class="si">${</span><span class="nv">DEVICE</span><span class="si">}</span> <span class="k">)</span><span class="p">;</span>
 
<span class="nb">echo</span> <span class="s2">"UUID = </span><span class="si">${</span><span class="nv">UUID_BTRFS</span><span class="si">}</span><span class="s2"> vom Btrfs-Dateisystem gefunden"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
<span class="nb">echo</span> <span class="s2">"Startmenü für ein Btrfs-Dateisystem eingefügt"</span> &gt;<span class="p">&amp;</span><span class="m">2</span>

cat <span class="s">&lt;&lt; EOF</span>
<span class="s">menuentry "Ubuntu (auf Btrfs-Dateisystem) starten" --class gnu-linux --class gnu --class os {</span>
<span class="s">	recordfail</span>
<span class="s">	insmod gzio</span>
<span class="s">	insmod part_msdos</span>
<span class="s">	insmod btrfs</span>
<span class="s">	search --no-floppy --fs-uuid --set=root ${UUID_BTRFS}</span>
<span class="s">	linux	/@/boot/vmlinuz root=UUID=${UUID_BTRFS} ro rootflags=subvol=@ ${GRUB_CMDLINE_LINUX_DEFAULT} ${GRUB_CMDLINE_LINUX} vt.handoff=7</span>
<span class="s">	initrd	/@/boot/initrd.img</span>
<span class="s">}</span>
<span class="s">EOF</span>
</pre></div>
</td></tr></table></div><p>Mit der Eingabe in das Terminal <sup><a href="#source-1">[1]</a></sup> von:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo grub-mkconfig </pre></div></div><p>kann man die erfolgreiche Suche überprüfen und dann mit der Eingabe von:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-grub </pre></div></div><p>dieses in den aktiven Bootloader übernehmen.</p></div><div class="section_3"><h4 id="GRUB-2-sekundaeres-System">GRUB_2 sekundäres System<a class="headerlink" href="#GRUB-2-sekundaeres-System">¶</a></h4><p>
Damit das primäre System immer einen aktuellen Kernel aufruft und somit die Daten unabhängig vom Zustand / Upgrade des sekundären Systems sind, wird im sekundären System das folgende Skript abgelegt unter:
</p><ul><li><p><strong>/etc/grub.d/09_K-aktuell</strong></p></li></ul><p>
</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1"># Hiermit wird bei einem 'update-grub' der aktuelle Kernel</span>
<span class="c1"># intern auf eine einheitliche Form innerhalb '/boot' verlinkt.</span>
<span class="nb">set</span> -e

SETZE_LINK <span class="o">()</span> <span class="o">{</span>
rm -f <span class="si">${</span><span class="nv">SUCHE_WAS</span><span class="si">}</span><span class="p">;</span>
<span class="nv">list</span><span class="o">=</span><span class="k">$(</span> <span class="k">for</span> i in <span class="si">${</span><span class="nv">SUCHE_WAS</span><span class="si">}</span>-* <span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> -n <span class="s2">"</span><span class="nv">$i</span><span class="s2"> "</span> <span class="p">;</span> <span class="k">done</span> <span class="k">)</span>
<span class="o">[</span> <span class="s2">"x</span><span class="nv">$list</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"x"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit</span> 
<span class="nv">linux</span><span class="o">=</span><span class="k">$(</span> version_find_latest <span class="nv">$list</span> <span class="k">)</span>
ln -s <span class="s2">"</span><span class="nv">$linux</span><span class="s2">"</span> <span class="si">${</span><span class="nv">SUCHE_WAS</span><span class="si">}</span> &gt; /dev/null
<span class="nb">echo</span> <span class="s2">"Link für </span><span class="nv">$linux</span><span class="s2"> eingefügt"</span>  &gt;<span class="p">&amp;</span><span class="m">2</span><span class="p">;</span>
<span class="o">}</span>

. /usr/lib/grub/grub-mkconfig_lib
<span class="nb">cd</span> /boot<span class="p">;</span>

<span class="nv">SUCHE_WAS</span><span class="o">=</span><span class="s2">"vmlinuz"</span> <span class="o">&amp;&amp;</span> SETZE_LINK<span class="p">;</span>
<span class="nv">SUCHE_WAS</span><span class="o">=</span><span class="s2">"initrd.img"</span> <span class="o">&amp;&amp;</span> SETZE_LINK<span class="p">;</span>
</pre></div>
</td></tr></table></div><p>Nach jedem
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo update-grub </pre></div></div><p>und somit auch bei einem Kernel-Upgrade wird damit automatisch eine Verlinkung zum jeweils aktuellen Kernel hergestellt. Dieses ist erforderlich, weil der normale Link im Rootverzeichnis zum Zeitpunkt, wenn das Btrfs-Dateisystem noch nicht konfiguriert (eingehängt) ist, ins Leere weist. Bei einem <a class="internal" href="./efi_bootmanagement.html">EFI Bootmanagement</a> wird diese Verlinkung automatisch an das <strong>secure-boot</strong> angepasst.</p></div></div></div><div class="section_1"><h2 id="Probleme-und-Abhilfe">Probleme und Abhilfe<a class="headerlink" href="#Probleme-und-Abhilfe">¶</a></h2><p>
</p><div class="box warning"><h3 class="box warning">Achtung!</h3><div class="contents"><p>Falls es beim Booten in Zusammenhang mit dem Festplattentest zu einer Fehlermeldung kommt, sollte man überprüfen, ob es im Verzeichnis <strong>/sbin</strong> einen Link von <strong>fsck.btrfs</strong> nach <strong>btrfsck</strong> gibt und diesen ggf. im Terminal <sup><a href="#source-1">[1]</a></sup> anlegen mit: </p><div class="bash"><div class="contents"><pre class="notranslate">sudo ln -s /sbin/btrfsck /sbin/fsck.btrfs </pre></div></div><p>
</p></div></div><div class="section_2"><h3 id="fsck-btrfs">fsck.btrfs<a class="headerlink" href="#fsck-btrfs">¶</a></h3><p>
</p><div class="box experts"><h3 class="box experts">Experten-Info:</h3><div class="contents"><p>Eine Prüfung der Partitionen wird in der Regel beim Hochfahren des Systems aufgerufen, sofern in der <strong>/etc/fstab</strong> am Ende der Zeile zum Einbinden des Laufwerkes bzw. Unterlaufwerkes (Subvolume) die zweitletzte Prüfzahl ungleich <code class="notranslate">0</code> gesetzt ist. Man kann alle Prüfzahlen auf <code class="notranslate">0 0</code> setzen und verkürzt damit die Bootzeit je Eintrag erheblich. Dann sollte man aber in regelmäßigen Abständen eine Prüfung manuell bzw. mittels <a class="internal" href="./cron.html">Cron</a> mit dem Befehl <a class="crosslink" href="#btrfsck">btrfsck</a> ausführen!
</p></div></div><p>Der Befehl fsck.btrfs ist <span class="underline">kein</span> direkter Befehl aus den Paket <strong>btrfs-tools</strong>, sondern wird in der Regel bei der Installation im Verzeichnis <strong>/sbin</strong> als Link auf den Befehl <a class="internal" href="./befehle_btrfs-dateisystem.html#btrfsck">btrfsck</a> angelegt.</p><p>Damit wird sichergestellt, das <em>mountall</em> eine relevante Sequenz für die Prüfung des Dateisystemes beim Booten findet. <em>mountall</em> bildet aus <code class="notranslate">fsck</code> und dem Eintrag in der <strong>/etc/fstab</strong> <code class="notranslate">btrfs</code> als Angabe zum Dateisystem dann den Befehl <strong>fsck.btrfs</strong></p></div><div class="section_2"><h3 id="Defektes-Btrfs-Raid">Defektes Btrfs-Raid<a class="headerlink" href="#Defektes-Btrfs-Raid">¶</a></h3><p>
Wird in einem Btrfs-Dateisystem mit einem Btrfs-RAID-Verbund ein Teillaufwerk als defekt erkannt und das System will nicht mehr booten, so bieten sich zwei Varianten an:</p><ul><li><p>Annahmen zum Beispiel</p><ul><li><p><strong>/dev/sda1</strong> sei intakt</p></li><li><p><strong>/dev/sdb1</strong> sei defekt</p></li><li><p><strong>/dev/sdc1</strong> sei die Reserve</p></li></ul></li></ul><p>
Sofern noch das Bootmenü erscheint, startet man mit der ersten Variante, ansonsten muss man gleich die zweite Variante benutzen.</p><ul><li><p><strong>Variante 1:</strong> Man drückt im Bootloader-Menü die Taste 
<span class="key">E</span> </p></li></ul><p>nachdem man die relevante Startzeile mit den Pfeiltasten 
<span class="key">↑</span>  / 
<span class="key">↓</span>  aufgerufen hat und ergänzt / editiert die folgenden Zeilen:</p><div class="code"><table class="notranslate syntaxtable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="notranslate syntax"><pre><span></span>	<span class="nb">set</span> <span class="nv">root</span><span class="o">=</span><span class="s1">'(hd1,msdos1)'</span>
	search --no-floppy --fs-uuid --set<span class="o">=</span>root 2f613613-85b4-46cf-bbbe-90a1748f7753
	linux	/@/boot/vmlinuz-3.2.0-7-generic <span class="nv">root</span><span class="o">=</span><span class="nv">UUID</span><span class="o">=</span>2f613613-85b4-46cf-bbbe-90a1748f7753 ro <span class="nv">rootflags</span><span class="o">=</span><span class="nv">subvol</span><span class="o">=</span>@ …
</pre></div>
</td></tr></table></div><ul><li><p>Die Zeile 1</p></li></ul><p>Sofern erforderlich, muss man hier die Daten auf die noch intakte Festplatte ändern, ausgehend vom Beispiel also auf: 
</p><pre class="notranslate">set root='(hd<strong class="highlighted">0</strong>,msdos1)'</pre><ul><li><p>Die Zeile 2</p></li></ul><p>Musste Zeile 1 angepasst werden, dann deaktiviert man die Zeile 2 durch Voranstellen mit 
<span class="key">#</span>  (man beachte <a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/QWERTY-Tastaturbelegung#Vereinigte_Staaten">US-Tastatur</a> = 
<span class="key">⇧</span>  + 
<span class="key">3</span> )</p><ul><li><p>Die Zeile 3</p></li></ul><p>Man editiert / ergänzt die Zeile 3 bei den rootflags um <code class="notranslate">,degraded</code>:
</p><pre class="notranslate">ro rootflags=subvol=@<strong class="highlighted">,degraded</strong> ...</pre><p>und startet dann den Bootprozess mit 
<span class="key">F10</span> .</p><ul><li><p><strong>Variante 2:</strong> Man startet ein Live-System und überprüft als erstes mit</p></li></ul><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfsck /dev/sdXY </pre></div></div><p>
nacheinander die relevanten Laufwerke dahingehend, welches keine Fehler aufweist und bindet das Laufwerk ohne Fehler, nachfolgend mit <strong>/dev/sda1</strong> angenommen, ein. Weisen die Laufwerke keine Fehler auf, kann man versuchen, durch das Einsetzen von Schnappschüssen eine Lösung zu finden.</p><div class="box notice"><h3 class="box notice">Hinweis:</h3><div class="contents"><p>Man kann erst einmal versuchen, das <span class="underline">nicht</span> funktionsfähige Laufwerk neu zu formatieren und dieses als Ersatz einzusetzen, so lange nicht andere, eindeutige Hinweise die Verwendung ausschließen.
</p></div></div><p>Bei beiden Varianten gibt man am jeweiligen Desktop nacheinander in ein Terminal <sup><a href="#source-1">[1]</a></sup> ein:</p><div class="bash"><div class="contents"><pre class="notranslate">sudo mount -o degraded /dev/sda1 /mnt </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs device add /dev/sdc1 /mnt </pre></div></div><p>
</p><div class="bash"><div class="contents"><pre class="notranslate">sudo btrfs device delete missing /mnt </pre></div></div><p>Mit dem letzten Befehl wird gleichzeitig ein Abgleich der Daten vom ersten Laufwerk auf das neue Laufwerk eingeleitet - dieses kann je nach Umfang eine Zeit in Anspruch nehmen. Erst danach sollte man das defekte Laufwerk auch physisch aus dem Rechner entfernen.</p><p>Mit dem Befehl <a class="crosslink" href="#Formatierung-ueberpruefen"><code class="notranslate">btrfs filesystem show</code></a> überprüft man die korrekte Ausführung - es sollte jetzt das Laufwerk <strong>/dev/sdc1</strong> mit einer neuen <code class="notranslate">devid</code> belegt und ein Teil des RAID-Verbundes sein. Man sollte noch (ggf. in einer <a class="internal" href="./chroot.html">chroot</a>-Umgebung) den Zustand von <a class="internal" href="./grub_2/reparatur.html#chroot-Methode">GRUB_2</a> erneuern bzw. wieder herstellen.</p></div></div><div class="section_1"><h2 id="Links">Links<a class="headerlink" href="#Links">¶</a></h2><p>
</p><ul><li><p><a class="internal" href="./btrfs-dateisystem.html">Das Btrfs Dateisystem</a> <img alt="{Übersicht}" src="./_/021d71c30babf2ce4dd27339ba3c55995610945b.png"/></p><ul><li><p><a class="internal" href="./faq_btrfs-dateisystem.html">Allgemeine Hinweise zum Btrfs Dateisystem</a></p></li><li><p><a class="internal" href="./konvertierung_nach_btrfs.html">Konvertierung nach Btrfs</a></p></li><li><p><a class="internal" href="./befehle_btrfs-dateisystem.html">Befehle Btrfs-Dateisystem</a></p></li><li><p><a class="internal" href="./btrfs-mountoptionen.html">Btrfs-Mountoptionen</a></p></li></ul></li></ul><p>
</p><div class="section_2"><h3 id="Informationen">Informationen<a class="headerlink" href="#Informationen">¶</a></h3><p>
</p><ul><li><p><a class="interwiki interwiki-wikipedia" href="https://de.wikipedia.org/wiki/Btrfs">Btrfs-Dateisystem</a></p></li><li><p><a class="interwiki interwiki-ubuntu_doc" href="https://help.ubuntu.com/community/btrfs">Ubuntu-Help Btrfs</a></p></li><li><p><a class="external" href="https://btrfs.wiki.kernel.org/" rel="nofollow">btrfs.wiki.kernel.org</a> <img alt="{us}" src="./_/36152d62b7197ebd79bc885a8a2614445933cf09.png"/></p></li><li><p><a class="external" href="http://www.admin-magazin.de/Das-Heft/2009/04/Das-neue-Linux-Dateisystem-Btrfs-im-Detail" rel="nofollow">Btrfs im Detail</a> <img alt="{de}" src="./_/ffd333e1d59794eac31aea8b3e984e1b88473c33.png"/></p></li><li><p><a class="external" href="http://www.funtoo.org/wiki/BTRFS_Fun" rel="nofollow">funtoo.org Btrfs</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/></p></li></ul><p>
</p></div><div class="section_2"><h3 id="Downloads">Downloads<a class="headerlink" href="#Downloads">¶</a></h3><p>
</p><ul><li><p><a class="external" href="http://sourceforge.net/projects/partedmagic/" rel="nofollow">PartedMagic</a> <img alt="{en}" src="./_/d5ecf89114b079f85d02099649c4ee617ffa34c7.png"/> <img alt="{dl}" src="./_/8e630211d0f5f5cb7c6424055f9c9aa15a420fab.png"/></p></li></ul><p></p></div></div></div>
<p class="meta">
<a href="./installieren_auf_btrfs-dateisystem/a/revision/941021.html">Diese Revision</a> wurde am 10. Mai 2017 21:31 von <a href="https://ubuntuusers.de/user/frustschieber/">frustschieber</a> erstellt.
    
  </p>
</div>
</div>
<div style="clear: both;"></div>
<div class="pathbar breadcrumb">
<div class="breadcrumb">
<ol>
<li><a href="./startseite.html">Wiki</a></li>
<li><a href="./installieren_auf_btrfs-dateisystem.html">Installieren auf Btrfs-Dateisystem</a></li>
</ol>
</div>
</div>
</div>
<div class="footer" style="clear: both;">
<ul>
<li class="poweredby"><li class="poweredby">Erstellt mit <a href="http://inyokaproject.org/">Inyoka</a></li></li>
<li class="license">

<img alt="Copyleft" src="./_/65dad5b770326dbbe1bd26ee6363e366a76bd8b7.png"/>
          2004 – 2017 ubuntuusers.de • Einige Rechte vorbehalten<br/>
<a href="./_lizenz.html" rel="cc:morePermissions">Lizenz</a> •
          <a href="http://ubuntuusers.de/kontakt/">Kontakt</a> •
          <a href="http://ubuntuusers.de/datenschutz/">Datenschutz</a> •
          <a href="http://ubuntuusers.de/impressum/">Impressum</a> •
          <a href="https://ubuntuusers.statuspage.io">Serverstatus</a>
</li>
<li class="housing">
<span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br/>
<img alt="noris network" src="./_/e7d27e9081eec23a8a5a5fe9434d7b2f1532e1d9.png"/>
<img alt="anexia" src="./_/ad1b63a3fc35749344af0a03e8c3ce05a2a3ee7e.png"/>
</li>
</ul>
</div>
<div style="clear: both;"></div>
</div>






</body>
</html>